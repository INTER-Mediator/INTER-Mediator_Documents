[
    {
        "id": 2,
        "parent": "/ja/",
        "path": "/ja/for-novices/",
        "title": "INTER-Mediatorをはじめよう",
        "breadcrumb": "はじめよう",
        "body": "\n            \n                これから始める方はこのページからご覧ください。ダウンロードとインストール方法、試用や学習用途として利用できるバーチャルマシンのダウンロードリンクと利用方法、スタートアップガイド、ハンズオンセッション手順書があります。\n            \n            \n                ビデオで始めるINTER-Mediator\n                INTER-MediatorのVMを準備する手順や、ハンズオンでの作業を行なった様子をビデオでご覧いただけます。\n                トライアル版の利用方法\n                INTER-Mediatorの試用や学習用途として利用できるトライアルWebアプリケーションの利用方法について説明しています。\n                ダウンロードとインストール(Ver.6以降)\n                INTER-Mediatorの入手方法、開発時の利用法、運用時の利用方法をまとめました。\n                スタートアップガイド\n                データベースの基本から、宣言的な記述で可能な範囲での開発手法をまとめた文書です。 データベースエンジンに絡む設定については解説はしていませんが、 ページファイルや定義ファイルをどのように記述すればいいのかということを実例とともに概念を含めた説明をしています。 2013年にINTER-Mediatorの学習可能性を調査したときに使ったテキストを加筆訂正したものです。\n                ハンズオンセッション手順書\n                Virtual Machineを利用して、ハンズオンでINTER-Mediatorを学習するための手順書を作成しました。手順に従ってコードを入力して、どのような結果になるかを見ていただけます。\n                ダウンロードとインストール(Ver.5まで)\n                INTER-Mediatorの入手方法、開発時の利用法、運用時の利用方法をまとめました。\n                バーチャルマシンの利用(Ver.8まで)\n                INTER-Mediatorの試用や学習用途として利用できるバーチャルマシンの利用方法について説明しています。\n            \n        "
    },
    {
        "id": 3,
        "parent": "/ja/",
        "path": "/ja/practices/",
        "title": "プラクティス",
        "breadcrumb": "プラクティス",
        "body": "\n            \n                「プラクティス」とは、実際の開発時に発生するニーズに近い形式のテーマをもとにしてサンプルプログムを作成し、その動作をみながら個別の機能をどのように実現しているかを示すものです。書籍で言えば「クックブック」といった名称で紹介されるような内容です。順次、充実させる予定です。\n            \n            \n                検索をしてその結果を一覧表示する（プログラムなし版）\n                検索をしてその結果を一覧表示する（JavaScript版）\n                \n                    検索条件を与えて一覧に表示するという仕組みは多くのアプリケーションで見られます。 一覧と検索を連動させる手法を解説します。いちばん手軽に実装できるのは、プログラムなし版の方です。 もし、細かなユーザーインタフェースの機能の組み込みが必要なら、同様なページをJavaScriptで実装することもできます。\n                \n                一覧と詳細\n                \n                    一覧を表示し、その中の選択した項目の詳細情報を表示したり編集ページを表示するという手法はよく利用されます。「マスター/ディテール」方式とも呼ばれます。 INTER-Mediatorでは定義ファイルにキーワードで指定するだけで、2つのコンテキストの一方をマスター、もう一方をディテール領域として稼働できます。\n                \n                モバイルでよく見られるステップ動作のサイト\n                モバイルアプリケーションでは、画面全体を使って選択肢を提示し、選択すると次の画面に以降するという「ステップ動作」のユーザーインタフェースがよく見られます。INTER-Mediatorでそうしたサイトを作成する方法を説明します。\n                ティップス集\n                スタイルの値にフィールドの値を設定する、一覧ページから詳細ページに移動するボタンを設置する、URLの検索パラメータの値を検索条件にする、ページ移動時に「保存されない」場合の対処、「クリックを受け付けない場合がある」と感じた時の対処、条件に応じてページ生成を行わないようにする、Bootstrapのクラス名を自動生成されるボタンに適用する、デバッグ情報をページ上に出さない、検索機能をANDにする、マスター/ディテールページで新規レコード作成時に詳細ページに移動する、一覧と詳細が別々のページである場合に新規レコード作成時に詳細ページに移動する、disabled属性を条件に応じて設定する               \n              \n        "
    },
    {
        "id": 4,
        "parent": "/ja/",
        "path": "/ja/for-developers/",
        "title": "開発ガイド",
        "breadcrumb": "開発ガイド",
        "body": "\n            \n                ここでは、定義ファイルの記述方法、Dockerの利用、データベースごとの固有の事情、計算式、メール送信、ユーザー認証とアクセス権、サンプルファイルについて、検索ページを作成するための機能など、実際に開発を行う際に必要な内容について説明しています。\n            \n            \n                INTER-MediatorによるWebアプリケーションの概要\n                定義ファイルやページファイルの作成方法に加えて、以下の文書に含まれていないことがこちらにあります。\n                定義ファイルの記述方法\n                定義ファイルの記述方法を説明したリファレンスです。\n                バージョン移行ガイド\n                INTER-Mediatorのバージョンを移行する際にアプリケーション側を書き換える必要がある箇所を説明しています。\n                HTMLの属性に記述する書式を適用する機能\n                data-im-format属性などを利用した書式設定に関するリファレンスです。\n                データベース特有の設定\n                FileMaker ServerやPostgreSQLでの特有の情報についてまとめてあります。\n                計算式\n                計算式の記述方法をまとめてあります。\n                値をコピーするルックアップ\n                ルックアップによりマスターの値をコピーすることができる機能の説明です。\n                メール送信(Ver.10)\n                データベース処理を行ったときにメールを送る事ができます。\n                Slackにメッセージを送信する\n                データベース処理を行ったときにメッセージを送る事ができます。\n                ユーザー認証とアクセス権\n                ユーザー認証とアクセス権に関する設定について、まとめています。\n                サンプルファイル\n                配布ファイルに含まれているサンプルファイルについて説明します。\n                検索ページを作成するための機能\n                検索ページを一切JavaScriptのプログラムを書かないでもできる手法を説明します。\n                変更結果の即時更新をマルチクライアントで実現する(Ver.7)\n                同一のエンティティを複数のクライアントで開いたとき、あるユーザの変更結果を即時に他のクライアントに反映する仕組みです。\n            \n        "
    },
    {
        "id": 5,
        "parent": "/ja/",
        "path": "/ja/for-programmers/",
        "title": "プログラミングガイド",
        "breadcrumb": "プログラミングガイド",
        "body": "\n            \n                クライアント側で処理を行うJavaScriptの処理、INTERMediatorの各クラスのプロパティ、メディアの取り扱い、サーバーサイドの拡張等、より高度な使い方をされる場合にご覧ください。また、ソースコードの投稿についても説明しています。\n            \n            \n                JavaScriptのインタフェース\n                INTER-MediatorにおけるJavaScript向けのAPIを紹介します。\n                JavaScriptコンポーネントの使い方\n                ファイルのアップロード用コンポーネントの使用方法と、既存のJavaScriptのライブラリを元にしたコンポーネントを作る方法を説明しています。\n                MediaAccessクラスとその拡張点\n                画像やPDF生成などのHTMLの外部にデータがある場合の処理について説明しています。\n                サーバーサイドの拡張（Ver.6.0以降）\n                サーバーサイドの処理をPHPを利用して機能を拡張する方法とAPIをまとめておきました。なお、Ver.5.3までの手法はこちら、Ver.5.4以降のVer.5系列はこちらをご覧ください。\n                ソースコードの投稿\n                INTER-Mediatorへのソースコードを投稿する場合の手順です。INTER-Mediatorのコミッターや、あるいはバグレポートの1つの方法として、ソースコードの投稿を歓迎しています。\n            \n        "
    },
    {
        "id": 6,
        "parent": "/ja/",
        "path": "/ja/developers-blog/",
        "title": "開発者、コミッター、利用者によるブログ",
        "breadcrumb": "ブログ",
        "body": "\n            \n                INTER-Mediatorの記事を掲載している記事やブログのリンク集です。\n            \n            \n                \n                    開発者：新居雅行によるブログ\n                    \n                        INTER-Mediatorの開発者である新居雅行のブログのうち、INTER-Mediatorのカテゴリのものです。 一部はそのまま本サイトのドキュメントとして流用しています。\n                    \n                \n                \n                    FAMLog: INTER-Mediator\n                    \n                        INTER-Mediatorのコミッターであり、FMプランを提供しているエミックの松尾篤氏によるブログで、INTER-Mediatorのカテゴリの文書です。\n                    \n                \n                \n                    Unified Web Application Development - A Declarative Approach to Empower End-User Developers\n                    \n                        Dr.M.LaineのAalto Universityにおける博士論文において、INTER-Mediatorについてエンドユーザー開発を指向したソフトウェアの1つとして、言及されています。\n                    \n                \n                \n                    伊藤清徳の垂直落下式ムーンサルトプレス\n                    \n                        INTER-Mediatorと他のフレームワーク統合をいくつか行っている伊藤清徳氏によるブログで、INTER-Mediatorに関する文書です。（2022年3月10日現在、リンク先は全てエラーになります。）\n                    \n                    \n                        YiiでInter-Mediatorを使ってみる\n                        \n                        INTER-Mediatorのバリデーションを構築するクラスをつくったった\n                        \n                        INTER-Mediatorのページネーション機能を少し便利に – 1\n                        \n                        Inter-MediatorをCodeigniterから使ってみる\n                        \n                    \n                \n            \n        "
    },
    {
        "id": 7,
        "parent": "/ja/for-novices/",
        "path": "/ja/for-novices/deploy.html",
        "title": "ダウンロードとインストール(Ver.5まで)",
        "breadcrumb": "ダウンロードとインストール(Ver.5まで)",
        "body": "\n            \n                はじめに\n                この文書では、リリース版のダウンロード情報と、Ver.5.xまでのINTER-Mediatorを使って開発をする場合のINTER-Mediatorの準備方法と、さらに作成したWebアプリケーションで使用するINTER-Mediatorを作成する方法をまとめたものです（INTER-Mediator Ver.6以降はこちらの文書をご覧ください）。INTER-MediatorはGitHubでソースを公開しています。通常の開発時は、リポジトリにあるものをインストールしておくのがおすすめです。そして、アプリケーション完成後は、JavaScriptに圧縮をかけた実稼働用のINTER-Mediatorを利用するのが少しの事ですが、効率よくなります。これらの方法を説明します。\n                \n            \n            \n                ダウンロード\n                INTER-Mediatorのリリースバージョンは、こちらをご覧ください。日々、リポジトリはアップデートされていますが、一定の機能を組み込むごとにバージョン番号を付与して、リリース版として公開します。最新のリリースバージョンはVer.7、Ver.5.x系統の最新版はVer.5.12です。\n            \n            \n                リポジトリから取り出したバージョンを開発時に利用する\n                お勧めするのは、通常の開発は、リポジトリから取り出したもので進めておき、実際にアプリケーションを配備するときに、特定のバージョン向けにビルドしたものに置き換えるということになります。gitの使い方はいろいろ難しいですが、gitを全く知らない方も、ともかく以下のようにしてみてください。また、以下はコマンドラインによる汎用的な方法ですが、GitHubアプリケーションを使っても同様に可能です。\n                まず、あるフォルダに作成するWebアプリケーションのファイルをまとめておくとします。そのフォルダを作ります。以下は、Documentsの下にmywebappフォルダを作りました。\n                \n                    \n                \n                次に、GitHubのINTER-Mdiatorのページに行きます。アカウントを持ってサインインしていただくのがいいのですが、なくてもソースのダウンロードは可能です。ここで、中央右付近にあるbranchがmasterになっているのを確認してください。ブランチのmasterがその時点でのコンプリートなソースです。そして、右の方にあるHTTPS clone URLをコピーしておきます。URLが薄く見える右のボタンをクリックすれば、コピーできます。\n                \n                    \n                \n                そして、ターミナルを開いてください。次のように作業をします。#以降はコメントです。ファイルパスはもちろん、ご自分の作られているフォルダ構成に従って指定をしてください。ブランチの指定は「5.x」です。xは数字に指定しないで小文字のエックスにしてください。\n                \n                    cd ~/Documents/mywebapp  # Webアプリケーションのフォルダをカレントにする\ngit clone -b 5.x https://github.com/INTER-Mediator/INTER-Mediator.git  # サーバーからリポジトリを複製する\n                \n                これだけでOKです。すると、mywebappフォルダに、INTER-Mediatorフォルダが作られます。このINTER-Mediatorフォルダがフレームワーク本体となります。この階層に、たとえば、index.htmlファイルやら、アプリケーションのhtml/phpファイルを作って行けばOKです。後はこれをサーバーにコピーして稼働を確認します。\n                \n                \n                ここで、リポジトリからクローンしたINTER-Mediatorを参照するには、定義ファイルのcontext.phpはたとえば、次のように記述をします。\n                \n                    &lt;?php\nrequire_once('INTER-Mediator/INTER-Mediator.php');\nIM_Entry( .... );\n?&gt;\n                \n                なお、サンプルファイルは、INTER-Mediatorフォルダ内のSamplesフォルダにあります。\n                もし、リポジトリ側に新しいソースコードが加わっていれば、以下のようにコマンドを入れれば、最新版を取得できます。INTER-Mediatorフォルダをカレントにして、git pullとすればいいです。\n                \n                    cd ~/Documents/mywebapp/INTER-Mediator\ngit pull origin 5.x\n                \n                念のために説明しておきますが、pullは最新版に更新するという使い方は非常に稀で、正しくは別のリポジトリの修正を取り込むという意味合いがあります。ソースコードをメンテする上では単なる更新ではないのですが、ソースを利用する側の方から見れば更新コマンドと思っていただいて概ねいいかと思います。もし、自分でフレームワーク側のソースを修正された場合には、単純ではありませんので、ここではソースは参照だけでタッチしないという前提で、説明をここまでとします。\n                gitには実に多彩な機能があり、ここまでに説明した手順はほんとうにその一端でしかないのですが、これだけを知っていれば、とりあえず大丈夫かと思います。もし、フレームワーク側の修正結果をコミットしていただけるなら、それなりにコマンドを打ち込むか、あるいはアプリケーションを使うことになるかと思いますが、取り出すだけなら上記の手順以上はほとんどないと思います。\n                もし、開発中に、フレームワーク側のバグが見つかったなら、もちろん、報告をしてください。なるべく早く対処します。リポジトリのクローンを作って作業をしていれば、対処が終われば、git pullをするだけで済みます。\n                OS XでGitHubアプリケーションを使う場合\n                コマンドラインがどうしても苦手だという方は、GitHubのアプリケーションを入手してインストールをしてください。そして、セットアップを一通りすませます。GitHubへのログインが必要なのですが、通常はアカウントを持っていると思われるので、そのアカウントでログインをしておきます。\n                GitHubのページには、「Clone in Desktop」というボタンがあるので、それをクリックするとGitHubアプリケーションが起動して、いきなりINTER-Mediatorフォルダを作る場所を聞いてきます。そこで、配置した場所を選択してCloneボタンを押せばOKです。その後は、GitHubアプリケーションで、リポジトリのChangeのボタンを左側で選び、右上のSyncボタンをクリックすれば、サーバーにある最新のリポジトリの内容をダウンロードしてアップデートします。\n                \n                \n                ただし、この方法だと、2つ目のクローンを同じアカウント内に作成しようとしても、最初に作ったリポジトリをGitHubアプリケーション側では提示して、新たなリポジトリを作りに行きません。その場合は、クローン作成については、コマンドで行ってください。その上で、リポジトリの一覧を表示します。GitHubアプリケーションのタイトルバーの一番左の「Repositories」をクリックすればいいでしょう。そして、ウインドウ下にある「＋」ボタンをクリックして、「Add Local Repository」を選択します。そして、コマンドで作ったクローンのフォルダを指定すると、INTER-Mediatorの項目が複数登録できるようになります。あるいは、リポジトリのフォルダを、Repotoriesを選択してリポジトリ一覧が見えているウインドウの中にドラッグして追加します。ただし、リポジトリのリストで区別ができなくなるので、リポジトリのリストを右クリックして「Show in Finder」を選択してフォルダを確認して、間違えて作業しないように気をつけないといけません。\n            \n            \n                WindowsでGitHubアプリケーションを使う場合\n                WindowsにもGitHubアプリケーションがありますので、それを使ってくローンを作り、更新するということはもちろん可能です。ただし、サイトに見える「Clone Desktop」ボタンを押しても、アプリケーションの案内が見えるだけで、GitHubアプリケーションが起動して何かを始めるということはありません。従って、最初に作るクローンは、アプリケーションの左側のアカウント一覧から見えている場合は、その項目を選択して、右ボタンメニューから「Clone」を選択するなどして作成できます。\n                もし、どうしても出てこないなら、Git Shellという機能を使ってコマンドラインを呼び出し、クローンを作りたい場所をカレントディレクトリにして、「git clone https://github.com/INTER-Mediator/INTER-Mediator.git」というコマンドを実行します。コマンドラインで作ったクローンをGitHubアプリケーションで認識させるには、フォルダをアプリケーションのウインドウにドラッグ&amp;ドロップします。\n                \n                \n                作成すると、リポジトリの詳細を表示すれば、上にsyncボタンが登場します。更新はこのボタンを押すだけでOKです。\n                \n                \n            \n            \n                ダウンロードしたバージョンを開発時に利用する\n                GitHubのINTER-Mdiatorのページで、右側の「Donwload ZIP」ボタンをクリックすると、現状のリポジトリの各ファイルを圧縮・アーカイブしてダウンロードします。ブランチがmasterであれば、ダウンロードして展開したフォルダは、INTER-Mediator-masterという名前になっています。フォルダ名を適当に変更して、開発中のアプリケーションのフォルダ等へ移動します。\n                もちろん、こちらの方が当初は手軽なのですが、リポジトリとは切り離されることになるので、リポジトリの更新があれば、その都度、同じ作業を繰り返さないといけません。\n            \n            \n                実稼働向けINTER-Mediatorを生成する\n                リポジトリから取り出した結果で開発しているので、その状態で稼働はできるはずです。また、以下の方法でビルドすれば、サンプルなど実稼働に不要な素材が取り除かれると同時に、JavaScriptのプログラムを1つのファイルに圧縮してまとめるので、動作のパフォーマンスは有利になります。\n                まず、準備として、リポジトリから取り出したINTER-Mediatorフォルダと同じ階層に、Minifyをダウンロードします。ダウンロードにはgitコマンドを利用します（バージョン5.6以降ではyuicompressor-2.4.7.jarではなくMinifyを使用します）。\n                \n                    git clone -b 5.x https://github.com/INTER-Mediator/INTER-Mediator.git\ngit clone https://github.com/matthiasmullie/minify.git\n                \n                独自のバージョンと本日の日付を組み込んだ現状のINTER-Mediatorを作るには、dist-docs/buildup.shというスクリプトを使ってください。たとえば、INTER-Mediatorのディレクトリがカレントディレクトリであれば、MacあるいはUNIX系OSなら、以下のように入力します。\n                \n                    cd INTER-Mediator/dist-docs/\n./buildup.sh\n                \n                一方、Windowsの場合はCygwinで実行させてください。buildup.shファイルを、Cygwinのターミナルのウインドウにドラッグ&amp;ドロップして、Cygwinのターミナルでreturnキーを押すのが手軽でしょう。なお、ドライブのパスを指定したい場合は、Cygwinでは、/cygdrive/c/で、C:¥ドライブのルートを示すパスとなります。\n                \n                    \n                \n                すると以下のようなメッセージがターミナルに表示されます。ここで、キーボードから、1、2、3、4のいずれかをキータイプしてreturnキーを押してください。metadata.jsonファイルを更新する(4)を除くと3種類のビルド形式が選択できますが、(2)が最小の構成で、通常はこちらでいいかと思われます。(3)は認証ユーザの管理ページのサンプルや、定義ファイルエディタなどを含むようになります。なお、認証のアプリケーションに関しては、Autu_Supportフォルダの内容をもとに独自に開発されることをお勧めします。\n                \n                    $ ./buildup.sh\n=================================================\nStart to build the INTER-Mediator Ver.5.6\n-------------------------------------------------\n Original: /Users/msyk/Documents/INTER-Mediator_develop/INTER-Mediator\n Build to: /Users/msyk/Documents/INTER-Mediator_develop/im_build/INTER-Mediator\n Path of minifier: /Users/msyk/Documents/INTER-Mediator_develop/minify\n-------------------------------------------------\nChoose the build result from these:\n (1) Complete (everything contains)\n (2) Core only (the least set to work wep applications)\n (3) Core + Support (add Auth_Support and INTER-Mediator-Support)\n (4) Write just version and release date to metadata.json\nType 1, 2, 3 or 4, and then type return----&gt;\n                \n                INTER-Mediatorフォルダと同じ階層に、Minifyのディレクトリがあれば、これを使ってJavaScriptのプログラムを圧縮します。ない場合には圧縮しないで、いくつかあるJavaScriptのファイルを1つにまとめることだけを行います。\n                その後、メッセージ通り、INTER-Mediatorフォルダと同じ階層に、「im_build」フォルダが作られ、その中に、INTER-Mediatorフォルダがあります。こちらのファイルの中は、動作実行上必要なものだけに絞られています。このim_build/INTER-Mediatorフォルダを、現状のINTER-Mediatorフォルダと置き換えればOKです。\n                ただし、1点注意があります。ビルドしたINTER-Mediatorは、すべてのJavaScriptのプログラムを、INTER-Mediator.jsファイルにまとめて、その他のjsファイルは削除されています。そのままFTPでアップロードすると、消えたはずのその他のjsファイルが残ったままになります。なので、サーバー側にあるINTER-Mediatorフォルダもいったん消した上で、アップロードするのが確実です。動作がおかしいと思ったときには、INTER-Mediator.js以外のJavaScriptファイルがサーバー上で存在していないかを確認してください。\n                バージョン番号については、buildup.shファイルの最初の方に記述があるので、それを変更して利用してください。なお、バージョンのルールは次のようにします。\n                \n                    バージョン番号は、整数をピリオドで区切ることとする（例：3.4、3.11）\n                    バージョン表記は、Ver.を基本とするが、vでもVersionでもversionでも基本的には構わない\n                    整数が2つのものを「正式バージョン」とする（例：3.4、3.11）\n                    開発者が独自にバージョンを付ける場合、3つ目の整数を必ず付ける（例：3.4.1、3.11.133）\n                    開発者が独自にバージョンを付ける場合、さらに追加してもいい（例：3.4.1-rev.21）\n                \n                つまり、INTER-Mediatorをダウンロードして、実際にアプリケーションに搭載する上で少し修正したとしたら、3つ目の整数で枝番号を付けてくださいということです。できれば、その状態をコミット/プッシュした上で、そのバージョンタグをつけていただけると、自分のバックアップ用にもなると思います。他の人とバージョンが重ならないように、リポジトリをチェックして異なる番号を付けてください。また、3桁目は飛び番号でもいいとしましょう。けっこう緩いルールですね。\n            \n        "
    },
    {
        "id": 32,
        "parent": "/ja/for-novices/",
        "path": "/ja/for-novices/deploy6.html",
        "title": "ダウンロードとインストール(Ver.6以降)",
        "breadcrumb": "ダウンロードとインストール(Ver.6以降)",
        "body": "\n            \n                はじめに\n                この文書では、リリース版のダウンロード情報と、Ver. 6以降のINTER-Mediatorを使って開発をする場合のINTER-Mediatorの準備方法と、さらに作成したWebアプリケーションで使用するINTER-Mediatorを作成する方法をまとめたものです（INTER-Mediator Ver.5以前はこちらの文書をご覧ください）。INTER-MediatorはGitHubでソースを公開しています。通常の開発時は、リポジトリにあるものをインストールしておくのがおすすめです。そして、アプリケーション完成後は、JavaScriptに圧縮をかけた実稼働用のINTER-Mediatorを利用するのが少しの事ですが、効率よくなります。これらの方法を説明します。\n                \n            \n            \n                INTER-Mediatorを稼働する準備\n                INTER-Mediatorを稼働するコンピューターは、大別して、開発用のものと、運用用のものがあります。また、目的等により自由にセットアップができますが、説明の都合上、標準的な手順として、開発用のコンピューターでコード作成を行い、それを運用用のコンピューターに随時コピーすることを想定します。また、実際にアプリケーションを稼働させるためには、データベースも必要になると思われるので、運用用コンピューター上で稼働テストを行うのが一般的と考えられますが、開発用コンピューターにデータベースをセットアップしたりあるいは開発用コンピューターからデータベースへのアクセスを可能にすれば、開発用コンピューターの中だけでアプリケーションの動作テストは行えます。\n                \n                開発用のコンピューターに必要なものは、以下の通りです。\n                \n                    PHP Ver.7.1以上：サーバーコードを実行する仕組みを用意する必要があります\n                    git：ソースコードの取得に必要です\n                    composer：ライブラリの取得や稼働環境を整えるのに必要です\n                    開発環境：IDEあるいはテキストエディタで、コード作成のために必要です\n                \n                運用用のコンピューターに必要なものは、前記の開発用コンピューターに用意するもののうち、開発環境以外のものに加えて以下の通りです。つまり、運用用コンピューターでも、PHP、git、composerのセットアップはおこなってください。\n                \n                \n                    データベース：稼働はもちろん、アプリケーションのスキーマを適用している\n                    Webサーバー（Apache、IIS、nginx等）：PHPが稼働するように設定する\n                    Node.js：INTER-Mediatorのセットアップでもインストールされるが、OSにあっても良い\n                \n                WebサーバーとPHP 7.xのセットアップ\n                PHPは、開発用と運用用のいずれのコンピューターにも必須ですが、Webサーバーに関しては、運用用のみ必須となります。開発用コンピューターでは、PHPのWebサーバー機能を利用して稼働できるので、必ずしもサーバーは必要ありません。\n                \n                Ubuntu18.02でのApache2とPHP 7.xのセットアップ\n                Ubuntu18.02は、PHP 7.2がパッケージとして用意されています。これらのインストールを行い、さらに、MySQL、PostgreSQL、SQLiteをセットアップするまでは以下のようにコマンドを入れれば可能です。INTER-MEdiatorに必要なPHPのモジュールについても、以下の通りで、必要なものはインストールされます。\n                \n                \n                    sudo apt-get install -y apache2 php7.2 libapache2-mod-php7.2\nsudo apt-get install -y php7.2-mbstring php7.2-bcmath php7.2-curl php7.2-xml\nsudo apt-get install -y mysql-server-5.7 mysql-client-core-5.7 php7.2-pdo-mysql\nsudo apt-get install -y postgresql php7.2-pdo-pgsql\nsudo apt-get install -y sqlite3 php7.2-pdo-sqlite\n                \n                ドキュメントルートは「/var/www/html」、セットアップ関連ファイルは「/etc/apache2」、ログファイルは「/var/log/apache2」のそれぞれのディレクトリにあります。\n                Ubuntuでは、Webサーバのプロセスは、www-dataという名前のユーザで稼働します。INTER-Mediator Ver.6では、このwww-dataユーザが自身のホームディレクトリに書き込み権限を持っている必要があります。通常のユーザはもちろん自分のホームに書き込みできますが、www-dataはプロセス稼働用なので、ログインができなくなっています。ホームは、/var/wwwになっていますが、このフォルダはwww-dataには書き込み権限が与えられていません。ここで、Webのドキュメントフォルダ以下を、developerというユーザ（developerグループにも自動的に所属しているとする）でログインして管理することも考慮して、以下のようにコマンドをいれておくとよいでしょう。\n                \n                \n                    sudo chown -R www-data:developer /var/www\nsudo chmod -R g+w /var/www\n                \n                インストール後は、次のコマンドでApache2を再起動できます。インストール作業で試行錯誤した場合には、インストール作業の後にこのコマンドを入れれば良いでしょう。\n                \n                    sudo systemctl restart apache2\n                \n                macOSでのApache2とPHP 7.xのセットアップ\n                macOSはApacheもPHPも最初から含まれています。しかしながら、更新のサイクルを考えれば、homebrewを使いたいと考えるかもしれません。また、ハイブリットな管理も考えられます。ここでは、 macOSでのApache2とPHPを使う場合と、homebrewを使う場合で分けて、インストール方法を説明します。\n                macOSの標準機能を使う\n                まず、設定ファイルは、/etc/apache2/httpd.confです。このファイルをsudo nanoなどで開いて必要に応じて編集をしてください。このファイル内にある「#LoadModule php7module ...」の行の最初の#を消して、php7moduleがロードされるようにします。ほかに、このファイルでは、Apache2のプロセスのユーザーが_wwwであることや、ドキュメントルートが/Library/WebServer/Documentsであることが分かります。\n                初期状態ではphp.iniは用意されていませんが、/etcディレクトリに用意すると認識されます。なお、INTER-Mediatorの稼働には、基本的にOSに組み込まれたPHPのモジュールだけで利用できます。\n                INTER-Mediator Ver.6では、この_wwwユーザが自身のホームディレクトリに書き込み権限を持っている必要があります。通常のユーザはもちろん自分のホームに書き込みできますが、_wwwはプロセス稼働用なので、ログインができなくなっています（dscl . /Users/_www というコマンドで確認できます）。ホームは、/Library/WebServerになっていますが、このフォルダは_wwwには書き込み権限が与えられていません。ここで、Webのドキュメントフォルダ以下を、developerというユーザ（developerグループにも自動的に所属しているとする）でログインして管理することも考慮して、以下のようにコマンドをいれておくとよいでしょう。\n                \n                    sudo chown -R _www:developer /Library/WebServer\nsudo chmod -R g+w /Library/WebServer\n                \n                Webサーバを稼働するには以下のようにコマンドを入れます。Apache2が起動するともに、macOS起動時にapache2も起動します。なお、Apache2を止める場合は、loadの代わりにunloadというサブコマンドを指定します。そのとき、-wがあれば、macOS起動時の自動起動もオフになります。\n                \n                    sudo launchctl load -w /System/Library/LaunchDaemons/org.apache.httpd.plist\n                \n                Homebrewを使う\n                Homebrewのインストール方法はこちらのページをご覧ください。\n                まず、macOSを開発用コンピューターにしている場合が多いと思われるので、PHPのインストールを先に説明します。PHPをインストーするコマンドは以下の通りです。比較的多くのモジュールが最初から組み込まれており、INTER-Mediatorは追加でインストールすることなく、これだけで必要なものがインストールされます。\n                \n                \n                    brew install php\n                \n                macOS Mojaveでは、標準のPHP 7.1は「/usr/bin/php」で起動されますが、HomebrewのPHPをインストーすると「/usr/local/bin/php」というコマンドが追加され、Ver.7.3系列のPHPが利用できます。なお、「/usr/local/bin/php」は「/usr/local/Cellar/php/7.3.2/bin/php」へのショートカットリンクになっています。つまり、Homebrewによって管理されるPHPの様々なファイルは、/usr/local/Cellar/php以下のディレクトリに存在します。php.iniファイルのパスは「/usr/local/etc/php/7.3/php.ini」になります。\n                \n                さらに、HomebrewでApache2をインストールする方法も説明します。なお、開発用コンピューターであれば、わざわざApache2のセットアップまではする必要はありません。標準のApache2を使う場合と、いろいろ勝手が違うこともあるので、計画的にセットアップを進めてください。インストールは以下のコマンドです。\n                \n                \n                    brew install apache2\n                \n                主要なバイナリであるhttpdファイルの様子もPHPと似ており、標準の「/usr/sbin/httpd」に対して、「/usr/local/bin/httpd」が作られ、「/usr/local/Cellar/httpd/2.4.39/bin/httpd」にリンクされています。HomebrewのApache2のドキュメントルートは「/usr/local/var/www」、ログファイルは「/usr/local/var/log/httpd」、設定ファイルは「/usr/local/etc/httpd」のそれぞれのディレクトリが利用されています。いずれも、標準のApache2とは異なります。\n                HomebrewでセットアップしたAapche2でPHPを稼働させたい場合、以下の記述を設定ファイルのどこかに記述する必要があります。設定ファイルのディレクトリにあるhttpd.confの末尾に追加するなどの方法で構いません。\n                \n                    LoadModule php7_module /usr/local/opt/php/lib/httpd/modules/libphp7.so\n    \n&lt;FilesMatch \\.php$&gt;\n    SetHandler application/x-httpd-php\n&lt;/FilesMatch&gt;\n                    \n                Homebrewのapache2を利用した場合でも、標準のapache2と同様、_wwwというユーザでプロセスを稼働します。INTER-Mediator Ver.6では、_wwwユーザが自身のホームディレクトリに書き込み権限を持っている必要があります。通常のユーザはもちろん自分のホームに書き込みできますが、_wwwはプロセス稼働用なので、ログインができなくなっています（dscl . /Users/_www というコマンドで確認できます）。ホームは、OS標準のドキュメントルートの直上である/Library/WebServerになっていますが、このフォルダは_wwwには書き込み権限が与えられていません。ここで、Webのドキュメントフォルダ以下を、developerというユーザ（developerグループにも自動的に所属しているとする）でログインして管理することも考慮して、以下のようにコマンドをいれておくとよいでしょう。\n                    \n                        sudo chown -R _www:developer /Library/WebServer\nsudo chown -R _www:developer /usr/local/var/www\nsudo chmod -R g+w /usr/local/var/www\n                    \n                Apache2を起動するには、「sudo brew services start httpd」とコマンドを入力します。終了する場合はstartの代わりにstopサブコマンドを指定します。Homebrewで開かれるポートは、規定値では8080と8443になっています。通常通り80と443のポートで運用したい場合には、設定ファイルのディレクトリにあるhttpd.confとextra/httpd-ssl.confについて、それぞれポート番号の定義部分を変更する必要があります。\n\n                Windows 10でのIISとPHPのセットアップ\n                PHPのサイトでのWindows向けインストール情報では、Microsoft Web Platform Installer（WebPI）を使うのが簡単と書いてあります。執筆時点では、Ver.5.0のダウンロードが可能とMicrosoftのサイトでは表示されていますが、実際にはVer.5.1がダウンロードされます。インストーラでインストールをし、その後、スタートメニューから「Microsoft Web Platform Installer」を選択して、セットアップ用のアプリケーションを選択します。そして、検索窓で「PHP 7.3」などと入力して項目を探します。執筆時点では、PHP7.3.4がリリースされていますが、WebPIでは最新ではないものの7.3.1がダウンロードできました。PHPだけ、あるいはIIS Express用のものがあるので、状況に応じて選択すれば良いでしょう。\n                Windows 10でのWebサーバーであるIISを利用するには、スタートメニューの左側のギアのアイコンなどから「設定」アプリを開きます。そして、「アプリ」をクリックし、右側の関連設定にある「プログラムと機能」を選択します。ここからはウインドウが開いてコントロールパネルの作業になります。左側にある「Windowsの機能の有効化または無効化」を選択すると、ダイアログボックスが開きます。その中の「インターネットインフォメーションサービス」にある「World Wide Webサービス」と、「Web管理ツール」の「IIS管理コンソール」をオンにして、OKボタンをクリックします。PHPを使う場合には、「World Wide Webサービス」の「アプリケーション開発機能」にある「CGI」のチェックは必ず入れておきます。これでIISがインストールされます。\n                PHPのサイトには、Windowsに手作業でインストールする方法も記載されています。ダウンロードのページには、4種類のファイルがアップロードされていますが、32ビット/64ビット以外に、スレッドセーフとそうでないものもあります。IISの場合はスレッドセーフでないもの、Apacheの場合はスレッドセーフのものを選択します。ファイルをダウンロードすると、フォルダにファイルが入ったものが得られるので、そこからは自分で適切な位置に移動して、php.exeなどにパスが通るように、展開したルートフォルダに当たるphpのフォルダを環境変数のPathを設定します。\n                手作業でインストールしたPHPをIISで利用できるようにするには、エクスプローラーを使って、phpのフォルダに対して、IIS_IUSRSグループに対する「読み取りと実行」「フォルダーの内容の一覧表示」の権限を与えます。さらに、IISマネージャーで、新たにハンドラーマッピングを追加します。設定は、*.phpという要求パスに対して、FastCgiModleのモジュールを適用し、実行するファイルとして、phpのフォルダ以下にあるphp-cgi.exeを指定します。実行ファイルは絶対パスを指定します。\n                Windows ServerでのIISとPHPのセットアップ\n                Windows Serverをインストール後、サーバマネージャーの役割と機能の追加で、「Webサーバー(IIS)」を選択し、「役割」で、Webサーバー＞アプリケーション開発＞CGIのチェックを入れて、役割の追加を行います。これで、C:\\inetpub\\wwwrootをドキュメントルートとして、Webサーバーが起動します。\n                PHPを利用できるようにするには、PHPのサイトに記載された手作業でインストールする方法で行います。ダウンロードのページには、4種類のファイルがアップロードされていますが、32ビット/64ビット以外に、スレッドセーフとそうでないものもあります。IISの場合はスレッドセーフでないもの、Apacheの場合はスレッドセーフのものを選択します。ダウンロードしたPHPのフォルダを、例えば、C:\\などにおいて利用します。ここで、一度、php.exeをダブルクリックして、コマンドプロンプトのウインドウが出るかを確認します。それが出ずに、「VCRUNTIME140.dll」というファイルがないというメッセージが出てくれば、「Visual Studio 2015のC++再配布パッケージ」をインストールします。DLLのファイル名が違っている場合は、それらに対応した別のバージョンの再配布パッケージをインストールします。\n                続いて、インターネットインフォメーションサービス（IIS）マネージャーを利用します。サーバーの項目を選択して、「ハンドラマッピング」のところに新たに項目を作成します。要求パスは「*.php」、モジュールは「FastCgiModule」、実行可能ファイルはPHPのフォルダにある「php-cgi.exe」を選択し、名前は「PHP」としておきます。IISの設定は以上のとおりです。\n                さらに、php.iniファイルを用意します。PHPのフォルダにあるphp.ini-productionファイルをコピーして、ファイル名をphp.iniに変更します。そして、次のextensionを有効にします。\n                \n                    curl, mbstring, pdo_mysql, pdo_pgsql, pdo_sqlite\n                \n                こうして稼働するIISでのPHPは、ここでは、DefaultAppPoolというユーザでプロセスを稼働します。INTER-Mediator Ver.6では、PHPを稼働しているユーザが自身のプロファイルのに書き込み権限を持っている必要があります。そのために、C:\\Windows\\System32\\config\\systemprofileというフォルダに対して、IIS_IUSRSグループに対する「書き込み」と「変更」の権限を、フォルダのプロパティの「セキュリティ」のタブで付与しておきます。このグループはIISに関係するユーザーが自動的に登録されるので、アクセス権の設定に便利です。\n                \n                    \n                \n\n                composerのインストール\n                composerは、PHPのライブラリ管理ツールです。INTER-Mediator Ver.6より、composerの利用は必須となりました。インストールはcomposerのページに記載があります。macOSやLinuxでは、そのページの「Download」の先のページに書いてある数行のコマンドラインをコピーして、ターミナルにペーストして、インストールを行うのが1つの方法です。この方法は、https://getcomposer.org/installerから得られるPHPのスクリプトをcomposer-setup.phpというファイルに保存し、チェックサムを調べてOKであれば、ダウンロードしたスクリプトをphpコマンドで動かし、終わればそのファイルを消すというものです。なお、macOSではHomebrew、Linuxではapt-getなどでインストールすることもできますが、最新版でないことも時折あるので、コマンドでインストーするのが良いでしょう。なお、コマンドを実行するには、phpがコマンドラインで利用可能になっている必要があります。Windowsについては、composerのサイトのGetting Startedのページ内にインストーラーがあるのでそれを利用するのが便利でしょう。なお、composer自身のアップデートは「composer selfupdate」とコマンドライン入力をします。\n                その他のツールのセットアップ\n                いずれのOSでも、gitコマンドが稼働できるようにしておいてください。macOSは、Xcodeをインストールして、１度起動すると開発むけコマンドラインのインストーラーが動くので、その中にgitが入っています。Linuxではapt-get等で取得をしましょう。また、Linuxではzipについてもインストールをしておきましょう。Windowsでは、Git for Windowsをインストールします。これで、Windowsでもgitコマンドが利用できるようになります。また、Git BashというUNIXで使われるシェルも稼動できるので便利です。\n                \n                さらに、GitHub Desktopについてもインストールしておくと便利です。レポジトリからの取り出しなど、基本的な作業はコマンドを使わなくてもアプリケーション上でできるようになります。\n            \n            \n                リポジトリからINTER-Mediatorをダウンロードしてセットアップ\n                GitのレポジトリにあるINTER-Mediatorをダウンロードし、さらにセットアップする手順を示します。コマンドラインを使う方法と、アプリケーションを使う方法を説明します。\n                コマンドラインを使った方法\n                まず、開発用コンピューターのあるフォルダに作成するWebアプリケーションのファイルをまとめておくとします。そのフォルダを作ります。このフォルダは、ファイルを単にまとめておくだけなので、Webサーバーの公開ディレクトリの中でなくても良いでしょう。以下は、Documentsの下にmywebappフォルダを作りました。\n                \n                \n                    \n                \n                コマンドを使ってクローンを作成\n                そして、ターミナルを開いてください。次のように作業をします。#以降はコメントで、入力は不要です。ファイルパスはもちろん、ご自分の作られているフォルダ構成に従って指定をしてください。\n                \n                    cd ~/Documents/mywebapp  # Webアプリケーションのフォルダをカレントにする\ngit clone https://github.com/INTER-Mediator/INTER-Mediator.git  # サーバーからリポジトリを複製する\n                \n                すると、mywebappフォルダに、INTER-Mediatorフォルダが作られます。このINTER-Mediatorフォルダがフレームワーク本体となります。この階層に、たとえば、index.htmlファイルや、アプリケーションのhtml/phpファイル（ページファイルと定義ファイル）を作って行けばOKです。\n                \n                \n                \n                定義ファイルの記述方法\n                定義ファイルで、リポジトリからクローンしたINTER-Mediatorを参照するには、定義ファイルのcontexts.phpはたとえば、次のように記述をします。\n                \n                    &lt;?php\nrequire_once('INTER-Mediator/INTER-Mediator.php');\nIM_Entry( .... );\n                \n                なお、サンプルファイルは、INTER-Mediatorフォルダ内のsamplesフォルダにあります。\n                レポジトリの更新\n                もし、リポジトリ側に新しいソースコードが加わっていれば、以下のようにコマンドを入れれば、最新版を取得できます。INTER-Mediatorフォルダをカレントにして、git pullとすればいいです。\n                \n                \n                    cd ~/Documents/mywebapp/INTER-Mediator\ngit pull\n                \n                念のために説明しておきますが、pullは最新版に更新するという使い方は非常に稀で、正しくは別のリポジトリの修正を取り込むという意味合いがあります。ソースコードをメンテする上では単なる更新ではないのですが、ソースを利用する側の方から見れば更新コマンドと思っていただいて概ねいいかと思います。もし、自分でフレームワーク側のソースを修正された場合には、単純ではありませんので、ここではソースは参照だけでタッチしないという前提で、説明をここまでとします。\n                \n                GitHubアプリケーションを使う場合\n                レポジトリに対する操作は、アプリケーションとして利用できるGitHub\n                        Desktopがありますので、それを使ってクローンを作り、更新するということが可能です。インストーラーがあるのでインストールは簡単です。また、WindowsとmacOSで操作方法に大きな違いはありません。\n                \n                GitHub Desktopでクローンを作成する\n                最初に行う操作はコマンドラインの場合と同様に「クローン」です。初めて使う場合には、次のような画面になると思われるので、右側の「Clone a repository from the\n                    Internet...」をクリックします。あるいは、FileメニューからClone Repositoryを選択します。\n                \n                続いて、クローンに関する設定を行います。Clone a\n                    repositoryのボックス上部にある「URL」を選択します。INTER-MediatorのレポジトリはGitHubにあるので、最初のテキストフィールドには、「INTER-Mediator/INTER-Mediator」と入力します。最後に.gitは不要です。Local\n                    pathは、クローンを行うフォルダを指定します。Chooseボタンで選択できるので、もし、すでにフォルダが決まっているのなら、そのフォルダを指定します。そして、Cloneボタンをクリックします。\n                \n                \n                GitHubのサイトから直接クローンを作成\n                クローンを作成する場合、GitHubのページにある「Clone or download」のドロップダウンから「Open in Desktop」をクリックすることでも可能です。その前に、GitHub\n                    Desktopのインストールが必要です。\n                \n                「Open in Desktop」をクリックしてしばらく待つと、GitHub Desktopが起動し、Clone a\n                    Repositoryのパネルが開きます。URLは正しいものが入力されているので、Local Pathを望む場所に指定して、Cloneをクリックして進めれば良いでしょう。\n                \n                クローンを作成後のGitHub Desktop\n                クローンが完了すると、レポジトリを表示する画面になります。ウインドウ上部の黒い部分が主要な操作を行う箇所でCurrent\n                    Repositoryおよび「INTER-Meidator」と見えている部分が、現在、INTER-Mediatorのクローンしたレポジトリを参照している状態であることを示しています。複数のレポジトリを扱うようになった場合はここをクリックして、切り替えるレポジトリを選択することなどを行います。その右には、Current\n                    Branchとして「master」が見えていますが、これはレポジトリの中の異なるソースコードの状態を管理できるブランチの機能の選択です。右側に「Fetch\n                    origin」と見えている部分は、これをクリックすることで、GitHub上の最新のレポジトリの状態に更新できます。GitHubのレポジトリの内容は、頻繁に更新されるので、バグが修正されたりリリースのタイミングで手元のINTER-Mediatorを最新のものにするには、このFetch\n                    originのボタンは手軽に利用できます。白い背景で見えているのは、レポジトリの更新履歴などです。\n                \n                ダウンロードしたバージョンを開発時に利用する\n                GitHubのINTER-Mdiatorのページで、右側の「Donwload\n                    ZIP」ボタンをクリックすると、現状のリポジトリの各ファイルを圧縮・アーカイブしてダウンロードします。ブランチがmasterであれば、ダウンロードして展開したフォルダは、INTER-Mediator-masterという名前になっています。フォルダ名を適当に変更して、開発中のアプリケーションのフォルダ等へ移動します。\n                \n                もちろん、こちらの方が当初は手軽なのですが、リポジトリとは切り離されることになるので、リポジトリの更新があれば、その都度、同じ作業を繰り返さないといけません。\n            \n            \n                composerを使って稼働できるようにする\n                ファイルをレポジトリからダウンロードした後、ターミナル等でフレームワークのルート、つまりINTER-Mediatorフォルダの直下をカレントディレクトリにして、以下のようにcomposerのコマンドを入力し、しばらく待ちます。この作業によって、必要なライフラリをダウンロードします。\n                \n                \n                    cd INTER-Mediator  # INTER-Mediatorフォルダをカレントにする\ncomposer update # 必要なライブラリをセットアップする\n                \n                かなり時間がかかりますが、しばらく待っていてください。途中、警告が出る場合もありますが、概ねそのまま進めても問題がないものが多いと思われます。PHPのライブラリだけでなく、npmを使ったJavaScriptのライブラリのインストールも同時に行います。個別に行うこともできますが、「レポジトリのルートでcomposer\n                    updateをする」というシンプルな作業で進めることができるようになっているので、composerをインストールしてライブラリのインストールを行ってください。\n                \n                サービスサーバー稼働の確認\n                実際にアプリケーションが稼働するようになったとき、ページの最後に出てくるINTER-Mediatorのフッター表示にある「Service Server Status」を確認してください。図のように、緑色になっていれば稼働していますが、赤の場合は稼働していません。\n                \n                このサービスサーバーは、Ver.8現在、サーバーサイドでのバリデーションと、クライアント間でのリアルタイム同期のために利用していますが、今後のバージョンで利用は拡大する可能性があります。PHPではなく、Node.jsを使ったサーバーであり、サーバー上で常駐します。サーバーへのリクエストは、PHP側からのみに行い、クライアントから直接は行いません。なんらかの理由でサービスサーバーを止めたい場合は、例えば、次のようにコマンドを入力します。INTER-Mediatorフォルダがカレントディレクトになっているとします。\n                \n                \n                    node_modules/forever/bin/forever stopall\n                \n                サービスサーバーに関するトラブルシューティング\n                composerにより、INTER-Mediator側にNode.jsをインストールしており、条件が揃えば、Webアクセスがあった時に自動的にサービスサーバーが起動するようになっています。しかしながら、自動的に起動できる条件が揃っていない状況も多々あります。その場合は、サーバーOS側にNode.jsを通常通りaptやyum等でインストールして稼働してください。Node.jsのコマンドにパスが通っていれば、それで確実にサービスサーバーは稼働します。\n                Alpine Linuxの場合、composerでインストールしたnodeやnpmが起動しないことがあります。この場合、apkコマンドで、nodejsとnodejs-npmをインストールします。そして、composer updateがnpmを呼び出したところでエラーで止まるので、すぐに「npm install」コマンド入れれば良いでしょう。また、foreverコマンドに実行権限が付与されていないので、例えば、INTER-Mediatorのルールで「sudo chmod a+x node_modules/forever/bin/forever」などと入力をして実行権限を与えてください。\n            \n            \n                開発用コンピューターでテスト稼動する\n                開発用のコンピューター上で稼動テストをする場合は、phpのWebサーバー機能を使うのが便利です。なお、データベースへの接続が可能な状態になっている必要があります。そして、例えば、次のようなコマンドを入力します。前の例の通り、mywebappフォルダにアプリケーションがある場合、例えば次のようにコマンドを入力します。\n                \n                \n                    cd ~/Documents/mywebapp  # アプリケーションのフォルダをカレントにする\nphp -S localhost:9000 # phpのWebサーバーを稼動する\n                \n                最初のコマンドで、phpのWebサーバーのルートをカレントフォルダにします。カレントフォルダを指定することも可能ですが、カレントにして次のphpコマンドを実行するのが手軽です。そして、-Sオプションを付けてphpコマンドを実行します。-Sオプションは、応答するIPアドレスとポートを指定します。例のように指定すると、phpが実行しているコンピューター内であれば、「http://localhost:9000」のURLで、mywebappフォルダの内容を参照できます。したがって、他のコンピューターからは参照できません。他のコンピューターから参照したい場合には、localhostではなく、自分自身のEthernetのIPアドレスなど、外部接続可能なホスト名を指定してください。ポート番号は、Webサーバー等の利用ポートを避けるのが一般的かと思われますが、もちろん、9000である必要はありません。使われていないポートであればOKです。これで、mywebappフォルダにあるanylist.htmlファイルは、ブラウザのアドレス欄に「http://localhost:9000/anylist.html」と入力することでアクセスでき、PHPが稼動してINTER-Mediatorは正しく動作します。\n                \n                サンプルを実際に稼働させる\n                サンプルを実際に稼働させるには、まず、データベースにサンプル用のデータを追加する必要があります。MySQLとFileMakerのサンプルは豊富なので、どちらかを稼働させるのが良いでしょう。PostgreSQL、SQLiteのサンプルは限られています。データベース稼働の方法は、このページでは割愛します。\n                \n                MySQLを利用する場合、サンプルを利用するためのデータベーススキーマが、INTER-Mediatorフォルダ内のdist-docsフォルダにある「sample_schema_mysql.txt」ファイルに記載されています。これを例えば、以下のコマンドで入力します。ファイルの内容はSQLコマンドなので、状況に合わせて修正して読み込ませてください。\n                \n                \n                    cd INTER-Mediator/dist-docs #カレントフォルダの移動\nmysql -uroot &lt; sample_schema_mysql.txt #スキーマの読み込み\n                \n                FileMakerのサンプルファイルは、INTER-Mediatorフォルダ内のdist-docsフォルダにある「TestDB.fmp12」です。このファイルをFileMaker\n                    Serverで公開してください。\n                データベースの準備ができれば、実際にWebサーバーで公開しますが、これも、phpで公開するのが手軽でしょう。また、他のファイルとの混乱を避ける意味でも、INTER-Mediatorフォルダを公開するのが良いでしょう。例えば、以下のようにコマンドを入力して、INTER-Mediatorフォルダをphpコマンドで公開します。\n                \n                \n                    cd ~/Documents/mywebapp/INTER-Mediator  # INTER-Mediatorのフォルダをカレントにする\nphp -S localhost:9000 # phpのWebサーバーを稼動する\n                \n                そして、ブラウザからは、「http://localhost:9000/samples/」と入力してください。サンプルの一覧のページが見えるはずです。ここで、samplesの後のスラッシュも入力してください。Apacheだと、フォルダ参照の場合の最後のスラッシュは必要に応じて補完しますが、phpのWebサーバー機能はそうした機能はないので/を入れておく必要があります。これがないと、スタイルシートの読み込みなどがうまく行かないなど、意図しない見え方になります。\n                \n            \n            　 \n                実稼働向けINTER-Mediatorを生成する\n                リポジトリから取り出した結果で開発しているので、その状態で稼働はできるはずです。また、以下の方法でビルドすれば、サンプルなど実稼働に不要な素材が取り除かれると同時に、JavaScriptのプログラムを1つのファイルに圧縮してまとめるので、動作のパフォーマンスは有利になります。\n                \n                実行用のINTER-Mediatorを作成する\n                独自のバージョンと本日の日付を組み込んだ現状のINTER-Mediatorを作るには、dist-docs/buildup.shというスクリプトを使ってください。たとえば、INTER-Mediatorのディレクトリがカレントディレクトリであれば、MacあるいはUNIX系OSなら、以下のように入力します。Windowsの場合、PowerShellで稼動します。すると、おそらくGit\n                    Bashが別のウインドウを開いて稼動するので、どのOSでもUNIXのシェル環境で稼動することになると思われます。Cygwindでの稼働もできます。\n                \n                    cd INTER-Mediator/dist-docs/\n./buildup.sh\n                \n                すると以下のようなメッセージがターミナルに表示されます。ここで、キーボードから、1、2、3のいずれかをキータイプしてreturnキーを押してください。3種類のビルド形式が選択できますが、(2)が最小の構成で、通常はこちらでいいかと思われます。(3)についてはこの後説明します。\n                \n                \n                    $ ./buildup.sh\n=================================================\n Start to build the INTER-Mediator Ver.6-dev\n-------------------------------------------------\n Original: /Users/msyk/Documents/mywebapp/INTER-Mediator\n Build to: /Users/msyk/Documents/mywebapp/im_build/INTER-Mediator\n Path of minifyer (installed by composer): /Users/msyk/Documents/mywebapp/INTER-Mediator/vendor/matthiasmullie/minify\n-------------------------------------------------\nChoose the build result from these:\n (1) Complete (everything contains)\n (2) Core only (the least set to work web applications)\n (3) Core only, and move it to 3-up directory (the ancestor of original INTER-Mediator)\nType 1, 2 or 3, and then type return----&gt; \n                \n                その後、メッセージ通り、INTER-Mediatorフォルダと同じ階層に、「im_build」フォルダが作られ、その中に、INTER-Mediatorフォルダがあります。こちらのファイルの中は、動作実行上必要なものだけに絞られています。また、このフォルダ内でcomposer\n                    updateも自動的に実行されるので、PHPやJavaScriptのライブラリはすでにインストールされた状態になります。このim_build/INTER-Mediatorフォルダを、現状のINTER-Mediatorフォルダと置き換えればOKです。\n                \n                \n                \n                前記の手法ではビルド後のINTER-Mediatorの移動が面倒であるとも考えられますし、元のINTER-Mediatorフォルダを上書きすると、レポジトリからの更新ができないなどの問題もあります。オリジナルのINTER-Mediatorを残しつつ、実行用のINTER-Mediatorを効率的に管理するために、アプリケーションのフォルダのルートにlibフォルダ、そしてその中にsrcフォルダを作り、そこにクローンを作成しておくという方法があります。クローンの作業から説明すると、例えば次のようなコマンドで作成が可能です。作成結果の例も示します。\n                \n                \n                    cd ~/Documents/mywebapp\nmkdir lib\ncd lib\nmkdir src\ncd src\ngit clone https://github.com/INTER-Mediator/INTER-Mediator.git\n                \n                \n                そして、buildup.shスクリプトを稼働します。INTER-Mediatorフォルダがカレントの場合は、「dist-docs/buildup.sh」のように相対パスでスクリプトを指定して起動しても構いません。ここで、「\n                    (3) Core only, and move it to 3-up directory」を選択します。これを選択すると、「(2) Core\n                    only」に加えて、im_buildフォルダに作られた実行用INTER-Mediatorフォルダを、3つ上位のディレクトリに移動させます。つまり、srcにあるオリジナルのINTER-Mediatorからビルドした実行用INTER-Mediatorを、libの直下に移動するまでを自動的に行っているということです。src内部はそのまま変更はされません。\n                \n                \n                    $ pwd\n/Users/msyk/Documents/mywebapp/lib/src/INTER-Mediator\n$ dist-docs/buildup.sh \n=================================================\n Start to build the INTER-Mediator Ver.6-dev\n-------------------------------------------------\n Original: /Users/msyk/Documents/mywebapp/lib/src/INTER-Mediator\n Build to: /Users/msyk/Documents/mywebapp/lib/src/im_build/INTER-Mediator\n Path of minifyer (installed by composer): /Users/msyk/Documents/mywebapp/lib/src/INTER-Mediator/vendor/matthiasmullie/minify\n-------------------------------------------------\nChoose the build result from these:\n (1) Complete (everything contains)\n (2) Core only (the least set to work web applications)\n (3) Core only, and move it to 3-up directory (the ancestor of original INTER-Mediator)\nType 1, 2 or 3, and then type return----&gt; \n                \n\n                \n                この方法だと、フォルダの移動はしなくても済みます。もし、INTER-Mediatorのアップデートを取り込みたい場合は、srcフォルダ側のINTER-Mediatorをカレントにして「git\n                    pull」を実行し、その後、dist-docs/buildup.shを起動して(3)を選択すれば、自動的にlib直下のINTER-Mediatorが更新されるということになります。\n                開発用と運用用のコンピューターが別々の場合\n                ここでさらに実用的な場合を考えます。現状では、開発用クライアントはmacOSやWindowsを使うことが一般的である一方、運用用サーバーはLinuxあるいはWindowsであることが一般的でしょう。通常は、運用サーバー側に必要なファイルを開発用のクライアント側で整えて、全部アップロードするということがよく行われます。しかしながら、composerやその背後で動いているnpmを用いてインストールを行うと、ライブラリのファイル数が半端なく多く、アップロードに大変時間がかかります。また、一部のライブリは、プラットフォームによる違いがある場合も考えられるので、そのままアップロードして良いかどうかは検討の余地があると思われます。何れにしても、最初の１回でもかなり時間がかかるのはあまり気持ちの良いものではありません。\n                \n                この問題を解決する方法は、開発用クライアントと運用用サーバーそれぞれで、composer\n                    updateコマンドを実行することです。また、クライアントでの実行をしないのなら、サーバー側にINTER-Mediatorフォルダをコピーした後に、サーバー側でcomposer\n                    updateコマンドを実行すれば良いでしょう。さらに、buildup.shで(3)のビルドをする場合、buildup.shを運用用のサーバーがで実行するのが良いと思われます。ただ、開発ツールでは参照したファイルが存在しないとエラーを出すので、開発用と運用用でそれぞれでbuildup.shを動かすのが現実的かもしれません。何れにしても、大量のライブラリのファイルの移動を避けるように開発作業を進めるという点が重要です。\n                \n                例えば、開発用クライアントでの実行はせず、運用用あるいはテスト用のサーバーがあって、そちらでもっぱら稼働するとしたら、作業フローは次のようになると思われます。\n                \n                    クライアントにフォルダを用意し、その中にlib、srcフォルダを用意する\n                    srcフォルダにINTER-Mediatorをレポジトリからクローンする\n                    lib以下をサーバーにコピーする。src以下もコピーする\n                    サーバーにログインする。以下の作業はサーバーにログインして進める\n                    INTER-Mediatorフォルダをカレントにして、composer updateを実行する\n                    INTER-Mediatorフォルダをカレントにして、dist-docs/buildup.shを起動し、(3)を選択する\n                    lib以下にINTER-Mediatorがあることを確認する\n                    lib以下のINTER-Mediatorにある、node_modules/forever/bin/foreverが、Webサーバーのユーザーに書き込み権限があることを確認し、ない場合は権限を与えておく\n                    \n                    プログラムをクライアント側で作成する。定義ファイルでのINTER-Mediatorの参照先パスは「/lib/INTER-Mediator/INTER-Mediator.php」とする\n                    作成した定義ファイルやページファイルなどを、その都度クライアントからサーバーにアップロードして、テストする\n                \n                INTER-Mediatorフォルダを、composer\n                    updateを行う前の状態にしたい場合には、INTER-Mediatorフォルダ直下のnode_modulesとvendorの2つのフォルダを単に削除するだけで構いません。\n                バージョン番号を独自に設定する\n                バージョン番号については、buildup.shファイルの最初の方に記述があるので、それを変更すれば、独自のバージョンを設定することができます。なお、バージョンのルールは次のようにします。なお、以下のルールはVer.6以降に適用します。\n                \n                \n                    バージョン番号は、整数のみをピリオドで区切ることとする（例：6、3.4、3.11）\n                    バージョン表記は、Ver.を基本とするが、vでもVersionでもversionでも基本的には構わない\n                    整数が1つのものを「正式バージョン」とする（例：6、11）\n                    開発者が独自にバージョンを付ける場合、2つ目以降の整数を必ず付ける（例：6.2、7.1.11）\n                    開発者が独自にバージョンを付ける場合、さらに追加してもいい（例：3.4.1-rev.21）\n                \n                つまり、INTER-Mediatorをダウンロードして、実際にアプリケーションに搭載する上で少し修正したとしたら、2つ目の整数で枝番号を付けてくださいということです。できれば、その状態をコミット/プッシュした上で、そのバージョンタグをつけていただけると、自分のバックアップ用にもなると思います。他の人とバージョンが重ならないように、リポジトリをチェックして異なる番号を付けてください。また、2桁目以降は飛び番号でもいいとします。\n                \n            \n        "
    },
    {
        "id": 8,
        "parent": "/ja/for-novices/",
        "path": "/ja/for-novices/vm.html",
        "title": "バーチャルマシンの利用",
        "breadcrumb": "バーチャルマシンの利用",
        "body": "\n            \n                INTER-MediatorのVMについては、Ver.8及びVer.5.12の配布を最終版とします。M1 Macの登場まではほとんどのPC環境がIntelだったので、Mac/Windowsで使えるVMが構築できましたが、M1の登場により共通にかつフリーで使えるVM環境が整わない状態となったので、VMの製作は行わないことにしました。今後は、『トライアル版の利用方法』で紹介するDocker等での方法で、INTER-Mediatorの試用等を行ってください。（2022-05-22）\n                はじめに\n                INTER-Mediatorの試用や学習用に、即座にサーバーとして利用できるVirtual Machine（VM）についての情報をこの文書に記載します。VMを自分で作成するか、あるいはすでに作成されているVMをダウンロードするかして利用できます。\n                このVirtual Machineは、特定のホスト内でのみ利用することを想定して、ログインアカウントなどを見える場所に記載しています。学習用に定義ファイルとページファイルをブラウザーで編集できる状態にしているため、Virtual Machineとして配布している「INTER-Mediator-Server VM」をそのままインターネットに公開することは絶対に行わないでください。\n                【中・上級者へのアドバイス：追記1】INTER-Mediator 5.7以降、モバイルアプリでよく使われる「ステップ動作」開発にも活用できる機能を拡張しています。以下の説明では「ホストオンリーネットワーク」でのVM使用を強く推奨していますが､それではモバイル端末での実機テストができません。\n                安全が確保された同一ネットワーク内でのみ\bの利用を想定した「ブリッジネットワーク」接続を設定すれば､こうしたモバイル端末での動作確認を実機で行えます。以下､【追記1】として、これに関する設定方法を追記しています。ただし､その場合は既定のパスワードの変更、安全が確保されたLAN内での利用にとどめる、などの配慮に努めてください。（2018/04/07追記）\n                \n            \n            \n                使用までの準備\n                VMは、VirtualBox用を提供します。アプリケーション形式のVirtualBoxを以下の方法で、ご自分のパソコンにインストールしておいてください。\n                VirtualBoxのインストール\n                Windows、Mac、Linux、Solarisで利用できるVirtual Machine実行環境の「VirtualBox」は、Oracle社が開発してフリーで配布しているものです。こちらのページより、ご利用のホストコンピュータに対応したVirtualBoxをダウンロードしてご利用ください。\n            \n            \n                INTER-Mediator-Server VMのダウンロード\n                INTER-Mediator-Server VMは以下のリンクよりダウンロードしてください。いずれも、Intelプラットフォーム向けのLinuxをベースにしているため、Intel版Mac、通常のWindowsでは稼働しますが、Apple M1チップ搭載Macでは稼働しません。Apple Silicon搭載Mac向けにはVirtualBoxが安定してから、あるいはDockerでの動作環境提供を開発中です。\n                \n                    \n                        INTER-Mediator-Server VM 8（2021/07、約2.3GB）\n                            \n                    \n                    \n                        INTER-Mediator-Server VM 5.12（約880MB、最終更新日：2021/05/29）\n                            \n                    \n                \n            \n            \n                VMの準備\n                VMをINTER-Mediatorに含まれているスクリプト等を利用して自分で生成する方法を「VMを自分で作成して起動する」に、一方、すでに誰かが作ったVMを利用する方法を「VMをダウンロードして利用する」に解説します。もちろん、いずれか一方の作業を行うことで、VMを利用することができるので、状況に応じて使い分けてください。\n                VMをダウンロードして利用する\n                以下の手順は、VirtualBoxの初期状態を仮定しています。他の利用などでさまざまな設定がある場合には、手順が異なるかもしれませんが、原則として、ホストオンリーネットワークを用意して、そのネットワークを使用してVMが起動するようにセットアップされていればOKです。ダウンロードしたVMは、macOSでもWindowsでも、プラットフォームに関係なく利用できます。ただし、FileMaker Serverの場合には、VMとホスト側のIPアドレスが以下で行われる設定と同一である必要があります。\n                VirtualBoxの準備\n                VirtualBoxで稼働させるゲストのネットワーク環境にはいくつかありますが、「ホストオンリーネットワーク」を利用します。この方法だと、ゲストOS自体は、ホストマシン外からのネットワークアクセスはできなくなります。また、ゲストOSからホストOSへの接続も可能です。作成されるVMは、ホストオンリーネットワークであることを前提としているので、それ以外の設定での利用では、VMの状況を確認するなどして、ご自分で対処する必要があります。\n                Windowsでは、「ホストオンリーネットワーク」が最初から1つ作成されています。確認のため、「ファイル」メニューから「環境設定」を選択して、ダイアログボックスの左側で「ネットワーク」を選択し、「ホストオンリーネットワーク」のタブを選択します。そこに最初から「VirtualBox Host-Only Ethernet Adapter」が存在することを確認してください。\n                \n                    \n                \n                Mac版では、「ホストオンリーネットワーク」は最初は1つもありません。「VirtualBox」メニューの「環境設定」を選択してダイアログボックスを表示します。ツールバーにある「ネットワーク」を選択します。さらに、「ホストオンリーネットワーク」のタブを選択します。ここに何もない場合には、リストの右側の3つあるアイコンの一番上をクリックして、項目を1つ作ります。作成されたままの状態で通常はかまいません。\n                \n                    \n                \n                ダウンロードした.ovaファイルの読み込み\n                WindowsおよびMacのいずれの場合でも、「ファイル」メニューから「仮想アプライアンスのインポート」を選択してください。そして、ダウンロードしたファイルを指定して読み込み、「VirtualBox マネージャー」の画面の左側に新しい項目ができていることを確認します。\n                INTER-Mediator-Server VMのネットワーク設定\n                「VirtualBox マネージャー」で、読み込んだINTER-Mediator-Server VMの項目を選択します。そして、ツールバーの「設定」アイコンをクリックします。すると、そのVirtual Machineの設定が画面が表示されます。\n                Windowsでは、画面左側のリストで「ネットワーク」を選択します、さらに「アダプター2」のタブを選択します。そして、「割り当て」のポップアップメニューで「ホストオンリーアダプター」を選択します。すると、「名前」のところは、自動的に、「ホストオンリーネットワーク」に定義された名前が見えています。そこまでを確認して、OKボタンをクリックします。\n                \n                    \n                \n                Macの場合は、ツールバーの「ネットワーク」を選択して、さらに「アダプター2」のタブを選択します。そして、「割り当て」のポップアップメニューで「ホストオンリーアダプター」を選択します。すると、「名前」のところは、自動的に、「ホストオンリーネットワーク」に定義された名前が見えています。そこまでを確認して、OKボタンをクリックします。\n                \n                    \n                \n                【追記１】同一ネットワーク内の別デバイスからアクセスする「ブリッジネットワークの設定」\n                「ホストオンリーネットワーク」ではVMホストが稼働しているマシンからしか接続できません。\bしかし、それではiOSやAndroidデバイスでの実機操作テストができず不便です。そこで、中・上級者向けの方法としてブリッジネットワークを設定する方法を解説します。\n                「VirtualBox」メニューの「環境設定」を選択してダイアログボックスを表示したあと、ツールバーにある「ネットワーク」を選択します。「Adapter 1（アダプター1）」の「Attached to:（割り当て）」を「Bridged Adapter」にセットします。\n                \n                \n                    \n                \n                重要：既定ユーザーのパスワード変更\n                このようにセットしたあと､VirtualBox マネージャーでINTER-Mediator-Server VMの項目を選択して「起動」ボタンをクリックすると、黒いコンソール画面が現れます。\n                最初の起動時には既定値のログインID:developer、Password:im4135devでログインしますが､即座にしなければならないことがあります。パスワードの変更です。 ブリッジネットワークに設定したあと､VMが稼働しているマシンを不用意にカフェなどでWi-Fi接続して動作させると､同一ネットワーク内にいる他のユーザーからアクセスされる危険に晒されます。即座に独自のパスワードに変更した上で､IMをVM上で稼働させてください。\n                パスワードの変更はVMサーバー画面上で行います。まず､既定のログインID､パスワードでログインしたあと､passwdとタイプします。すると次の画面のようにこれまでのパスワードを要求されます。ただしくタイプできたら続いて新しいパスワードを入れるよう促されます。その際あまり短い文字列やローマ字のみのパスワードを入れると「パスワードが弱い」とはねられます。数字や記号混じりのパスワードをセットしてください。\n                \n                    \n                \n                パスワード変更が終わると、LAN内でどのようなIPアドレスが振られているか確認します。\n                ifconfig eth0\n                とタイプします。これでネットワークアダプターのEthernet port0の状況が分かります。\n                これを見ると「192.168.12.143」でINTER-Mediator Serverが公開されているのが分かります。このアドレスはあくまでも筆者の環境下での値ですので､このアドレスはあなたの使っているVM上に表示されたアドレスに読み替えて使ってください。\n                \n                    \n                \n                ここまでできたら、上記IPアドレスを手元のモバイル端末のWebブラウザのアドレスバーに入力してアクセスしてみてください。ただし､冒頭の注意書きでも強調したようにご自身の管理下にある安全が確保されているネットワーク内でのみ使用するように心がけてください。\n                \bまた､安全策としてIMのVM版にはVMが稼働している同一マシン上でしか設定ファイルエディタ、Pageエディタなどが動作しないように設定しています（下図）。学習や開発を行う場合はネットワーク上の他の機器からではなく､VMが動作しているマシン上で行ってください。\n                \n                    \n                \n                \n            \n            \n                INTER-Mediator-Server VMの利用\n                以上の準備ができれば、VirtualBox マネージャーでINTER-Mediator-Server VMの項目を選択して「起動」ボタンをクリックします。黒いコンソール画面に文字が流れて起動します。ログインプロンプトが表示されます。Webブラウザから「http://192.168.56.101」に接続してください。すると、このINTER-Mediator-Server VMで利用出来る機能などなどが見えるページがあります。\n                「サンプルプログラム」のリンクからは、INTER-MediatorのSamplesフォルダの内容を即座に稼働させることができます。ホスト側でFileMaker Serverが稼働している場合、INTER-Mediatorのディストリビューションの中にあるdist-docs/TestDB.fmp12をサーバーに登録してXML共有ができる状態になっていれば、ゲストからホストに接続して動作するので、FileMaker Serverのサンプルも試せます。FileMaker Serverが稼働していない場合には、FileMaker Serverのサンプルはエラーが出ます。\n                \n                    \n                \n                また、Webブラウザ上で、定義ファイルとページファイルを修正して、実際にプログラムした結果を参照することもできます。たとえば、ページファイルのpage01.htmlを開くリンクだけでなく、page01.htmlを編集するリンクはHTMLエディタを表示します。また、def01.phpはpage01.htmlからSCRIPTタグで参照されている定義ファイルで、定義ファイルエディタを開いて修正もできるようになっています。\n                \n                    \n                \n                「http://192.168.56.101」に接続できない場合\n                INTER-Mediator-Server VMが起動しているのなら、ユーザ名「developer」、パスワード「im4135dev」でログインをしてみて、「ifconfig」コマンドを実行してください。そこに、INTER-Mediator-Server VMが現在使用しているIPアドレスが見えます。eth1と記述された塊の中の、inet addrの後のIPアドレスが、現在のゲストOSのIPアドレスです。ホスト側でWebブラウザを起動して、そのIPアドレスで接続をしてみてください。\n                それでも考えられるのは次のようなことです。\n                \n                    そもそも、VirtualBox自体がきちんと動かない状態である。Windowsで仮想化機能が無効になっている、Windows 10でHyper-Vを有効にしている、VMwareで稼働するWindowsの上でさらにINTER-Mediator-Server VMを使用しようとした、など。\n                    ここまでに説明したネットワークの設定が正しく行われていない。あるいは、以前にその種の設定を独自に変更してしまっている。\n                    なんらかの設定により、ホストからゲストへのIP接続ができない状態になっている。VirtualBoxでの設定次第で、あり得ると考えられます。\n                \n                自分で作ったファイルを運用する\n                「http://192.168.56.101」に接続したページに、ログイン可能なアカウントが末尾に書かれています。それをご利用ください。SFTPでファイルの転送をするのが手軽かと思われます。また、INTER-Mediator-Server VM自体にログインをして、独自のデータベーススキーマを読み込ませるなどしてください。データベースの管理アカウントも、「http://192.168.56.101」に接続したページに記載しています。\n                INTER-Mediatorをアップデートする\n                ホストマシン上で、sshにより「192.168.56.101」に接続してください。ユーザー名は「developer」、パスワードは「im4135dev」です。例えば、macOSの場合は「ターミナル」アプリケーションで、「ssh developer@192.168.56.101」とコマンドを入れて、パスワードがその後にたずねられるので、キータイプをします。Windowsの場合は、TeraTermやPuTTY等のアプリケーションをご利用ください。\n                INTER-Mediator Ver.5.2（Ver.5.2-RC3を含む）以降のINTER-Mediator-Server VMの場合、以下のようにコマンドを入力します。\n                \n                    cd /var/www/html/INTER-Mediator\ngit pull origin stable\n                \n                INTER-Mediator Ver.5.2-RC1およびそれ以前のINTER-Mediator-Server VMの場合、以下のようにコマンドを入力します。checkoutの後にスペースとドット（git checkout .）を入れるのを忘れないようにして下さい。\n                \n                    cd /var/www/html/INTER-Mediator\ngit checkout .\ngit pull origin stable\n                \n                GitHubのリポジトリにあるINTER-Mediatorの最新安定版がVMに反映されます。なお、開発版の最新状況を反映させる場合には「git pull origin stable」の代わりに「git checkout master;git pull origin master」を実行します。現在のバージョンは、INTER-Mediator以下、dist-docs/build.shというスクリプトの最初の方のバージョン記述を確認してください。反映されている最終的なコミットは、git logやgit showコマンドで、現在のcommitの識別子（16進数の非常に長いコードで、commitの後に続けて記述されている）を得て、GitHubのリポジトリで探してください。なお、Ver.5.1以前の場合は、アクセス権の設定が若干違います。もともと用意されているページファイルと定義ファイルの編集には問題がありませんが、自分でファイルを追加したような場合などは、アクセス権について見直してください。\n            \n            \n                （参考）VMを自分で作成して起動する\n                INTER-Mediatorの配布ファイルの中には、VMを生成するためのスクリプト等が含まれています。最新のINTER-Mediatorが組み込まれたVMを作成するには、この方法が最適です。なお、標準環境のWindowsでは、Vagrantをインストールしてもスクリプトが稼働しないので、ご注意ください（別途Git for Windowsなどのソフトウェアをインストールしてsshを実行できる環境が必要です）。\n                \n                    Vagrantをインストールします。こちらのページに移動して、使用するOSに対応したアプリケーションをダウンロードしてインストールします。単にインストールするだけで大丈夫です。\n                    INTER-Mediatorの最新版をcloneします。こちらのページににある「Clone in Desktop」ボタンを利用するのが手軽な方法です。\n                    macOSであればターミナルアプリケーションを起動し、cloneしたINTER-Mediatorフォルダ内のdist-docs/vm-for-trialフォルダに移動します。\n                    「vagrant up」というコマンドを実行します。ダウンロードや作成処理に時間がかかります。概ね20分程度です。「INTER-Mediator-Server VM is ready.」と表示されたら準備完了です。\n                    なお、ダウンロード済みのboxファイルを削除する場合には「vagrant box remove INTER-Mediator-Server」というコマンドを実行します。\n                \n            \n        "
    },
    {
        "id": 9,
        "parent": "/ja/for-novices/",
        "path": "/ja/for-novices/startup.html",
        "title": "スタートアップガイド",
        "breadcrumb": "スタートアップガイド",
        "body": "\n            \n                はじめに\n                \n                    INTER-Mediatorを利用して、Webアプリケーションの開発を行おうと考えている方々向けに、プログラミングを行わない範囲の記述で開発可能な部分について、この文書にまとめました。最初にHTMLやデータベースの基本を簡単に説明しています。INTER-Mediatorでの開発では、HTML/CSS/JavaScriptについての知識が必要で、これらについてはすでにある程度知識があるという前提での解説になっています。データベースは概念的な理解で、既に用意されているデータベースを利用するという観点で、Webページ上への表示などを説明します。（新居雅行, 2014/2/18, 2016/11/29改訂）\n                \n            \n            \n                1. Webページ制作についての基本\n                まず最初に、Webページの成り立ちについて、知っておいていただきたい知識をまとめておきます。次のページ以降の内容を読み進めるための前提知識をこのページで説明します。\n                WebサーバーとWebクライアント\n                \n                    Webページのコンテンツは、通常は「サーバー」というインターネット上で共有可能なコンピュータ上に保持されています。それらをネットワークを通じてデータをクライアントに転送した上で参照します。クライアントとして使われるアプリケーションは、一般には「Webブラウザ」と呼ばれます。\n                HTMLについて\n                \n                    Webページのコンテンツは、HTMLという規格に従ってテキストで記述されたものが中心になっており、サーバー上ではたとえば拡張子が.htmlの1つのファイルで保存されています。そのファイルの内容をWebブラウザが解釈することで、段落や表、色の付いた文字などのレイアウトを施したWebとして表示できます。HTMLで記述されたファイルを「HTMLファイル」、HTMLの記述内容に従って表示された結果を「HTMLページ」と呼びます。\n                \n                    HTMLによる記述の特徴は、表示する文字とは別に、「タグ」として書式やレイアウトなど、テキストをどのように見せるのかという記述も付加されていることです。また、タグはデータの区切り目を示すなど見せ方に限らない使い方もあります。\n                タグは、たとえば &lt;div align=\"center\"&gt;abcdef&lt;/div&gt; のような書き方をします。開きタグ、閉じタグで囲まれるのが一般的で、divのような「タグ名」はHTMLで決められたものを利用します。また、alignのような「属性」をタグに付与できますが、属性名はタグごとに使える物が決まっています。属性名、イコールに続いて、属性の値がダブルクォート等で囲まれて記述され、値は状況に寄って変わります。\n                \n                \n                    Webページの表示では、テキスト以外に、画像やムービーも表示できます。これらは、通常はサーバーでは別のファイルとして保存されたものになっており、HTMLページ内に特定の画像を表示するには、画像であれば画像を表示するIMGタグのSRC属性に、画像のファイル名やURIを記述します。\n                CSSとJavaScriptについて\n                \n                    HTMLで表示されるものの書式設定は、CSSとして別途規格が定められており、多様な表現が可能になっています。CSSを利用する事で表現力が上がるだけでなく、まとめて設定したり、複数のHTMLファイルで設定情報を共有することができます。前者は、idやclass属性、あるいはタグに対する書式設定ができることで実現されています。後者は、CSSの定義自体を独立したファイルに記述して、HTMLからCSSが記述されたファイルの内容を参照する仕組みで実現されています。\n                \n                    HTMLでの記述やCSSによる記述は、その場でどうするかということ（例えば、画像を見せるとか、段落を右寄せにするなど）を記述する方式ですが、一方で、そうした記述以上のことを行う仕組みとして、JavaScriptというプログラミング言語を用いたプログラムをHTMLページの中で使われる事が一般的になっています。プログラム自体をHTMLの内部やあるいは別のファイルで供給できるようになっています。\n            \n            \n                2. データベースについての基本\n                \n                    データベースとは\n                    \n                        あらかじめ決められた内容を常に表示するWebページは、HTMLファイルなどを作ってサーバーに保存すれば、概ね目的は達成できます。しかしながら、販売品目が変わるコマースサイトなど、状況に応じた内容を表示する必要があるWebサイトでは、Webページを構成するための仕組みとは別に、データのみを「データベース」に保存するのが一般的です。データベースに保存する理由は、確実に保持できる事や、高速に検索できるなどの理由があり、MySQLなどのオープンソース系のデータベースソフトウェアを、Webサーバーとは別にサーバー上にインストールして利用するのが一般的です。\n                    \n                        データベースとして利用されるソフトウェアは、リレーショナル型データベースという手法に基づく物が広く利用されています。最近ではそうでないものもありますが、INTER-Mediatorで利用するのはリレーショナル型なので、この手法のみを扱います。\n                    データベースでの記録形式\n                    \n                        データベースに記録されているデータは雑多に記録されているわけではありません。Excelなどの表計算ソフトのような「テーブル形式」で記録されているのが基本です。このとき、Excelの1行に相当する物を「レコード」、1列に相当するものを「フィールド」と呼びます（ソフトウェアによっては異なる呼び方の場合もありますが、この名称で以後は説明します）。\n                    \n                        \n                    \n                    \n                        この形式でのデータは、概ね、フィールドによって「どんな種類のデータなのか」ということが決められることになります。住所録での「住所」フィールドには、たとえばある人の住所の文字が入力されて、そこに生年月日などは入力しません。そのフィールドがいくつか集まったものが「レコード」です。住所録では、1人の情報が1つのレコードになります。\n                    \n                        なお、フィールドに記録できるデータの種類（「型」などと呼びます）をあらかじめ決めておくのが一般的です。この点については、「フィールドは文字列を入力するのか、数値を入力するのかがあらかじめ決められている」といったことでの理解で十分です。\n                    データを特定する\n                    \n                        テーブル形式のデータでは、「どのレコード」の「どのフィールド」なのかを指定すると、通常は文字列か数値の1つのデータを得ることができますし、一方保存する事もできます。「どのフィールドか」ということは、フィールド名で特定します。そのため、同一のテーブルではフィールド名が重複することはできません。\n                    \n                        一方、「どのレコードか」ということはフィールド名のような名前をレコードに対しては付けていないため、異なる手法を取ります。明示的な順序を決めずに「適当に順番で前からいくつ目」といった特定方法は、リレーショナル型データベースでは原則として使うべきではないとされています。動作の効率化のため、毎回同じ順序でレコードが登場するということは保証されていません。このような事情もあって、リレーショナル型データベースでは、レコードを特定するためのフィールドを設けます。そのためのフィールドを「主キーフィールド」あるいは「キーフィールド」と呼ばれます。\n                    \n                        たとえば、住所録を考えてください。名前からレコードが特定できるかもしれませんが、同姓同名の人もいるかもしれません。そのような状況での1つの方法として、住所録には本来ないかもしれない「番号フィールド」を設けて、データベースソフトウェアの機能を使って、そこに1番以降の連番を自動的に入力し、レコードごとに必ず異なる数値データを入れておく事にします。データが増えてしまうとは言え、その番号フィールドが120だとかいった数値が分かれば、あるレコードを特定できることになります。主キーに関しても設計上はいろいろな手法が可能ですが、INTER-Mediatorではデータとは独立して連番が自動設定されるようなフィールドを利用する事が一番シンプルな方法です。\n                    検索とソート\n                    \n                        リレーショナル型データベースは特定のテーブルに対して、条件を与えてレコードを取り出す事ができます。条件は、フィールドに対して式を記述して与えます。たとえば、「金額が1000円以上」のような条件を、条件に従って記述します。その結果、条件に合ったレコード群（レコードセット）が得られます。このレコードセットは、0個以上のレコードが含まれます。この検索結果は、検索を指示した元に返すまえに、特定のフィールドのデータに基づいて並べ替えを行います。そのフィールドも検索要求に含め、指示によって昇順や降順といった並べ替えができます。\n                    \n                        以上の点から、テーブルは表計算ソフトのワークシートのように理解をすればいいのですが、現実には、テーブルは複数のレコードからなり、レコードは複数のフィールドからなる（正確にはフィールドというよりも「フィールド名で指定されたデータ」と言うべき）といった階層関係があると理解する方が、より実体に即したものと言えるでしょう。\n            \n            \n                3. Webアプリケーションの概略\n                Webアプリケーションの基本的な構成\n                \n                    データベースを利用したWebページを作成するとき、状況に応じてデータを取得して、その結果をHTMLとして生成し、それをクライアントに送るという作業を行う必要があります。HTML/CSS/JavaScriptだけではその仕組みは完全にはできないため、サーバー側で何らかの処理をさせる仕組みが必要になります。そうした仕組みを一般に「Webアプリケーション」と呼びますが、用語の示す範囲はややあいまいです。ここでは、Webサーバーとデータベース以外に、目的に応じたソフトウェアを追加しないといけないということが重要です。\n                \n                    つまり、ニュースサイトとコマースサイトでは要求が異なるため、単一の追加ソフトウェアではまかなえません。要求に応じたソフトウェアを、サイトごとに作る必要があります。そのための仕組みの基本がCGIであり、Webサーバーは単にファイルの内容を返すだけでなく、何らかの処理を行ってその結果を返すとか、クライアントのフォームで入力した結果を受け取ってなんらかの処理をするという仕組みを持っています。その処理を行うソフトウェアははさまざまな手法で構築されています。PHPやJavaなど、さまざまな実行環境や言語が利用されています。多くのソフトウェアは、プログラミング言語を用いて開発されているのが実情です。そのため、Webアプリケーション開発は、プログラミングやシステム開発を行うような会社や人材がまかなう業務となっています。\n                \n                    Webアプリケーションが複雑化するにともない、プログラミングを1から行うようなことは少なくなり、現在はほとんどの開発を「フレームワーク」と呼ばれる一定の共通的な機能をまかなうソフトウェアをベースに作られます。有名なフレームワークとしては、CakePHPやRuby on Railsがあります。\n                INTER-Mediatorの動作上の構成\n                \n                    ご利用されるINTER-Mediatorは、このフレームワークに属するものです。データベースがあり、Webサーバーがある状態で、データベースを利用したWebアプリケーションを開発するための素材です。しかしながら、INTER-Mediatorは他のフレームワークと大きく異なり、プログラミング言語でのプログラム作成をしなくても、機能を作り込めるようにしています。どのようにすればいいのかは次のページ以降、詳細に説明しますが、概ね、HTML内に記述を加えることと、データベースの利用に関するルールを列挙することと思っていてください。\n                \n                    Webアプリケーションでは複雑な動作を目にすることも一般的です。たとえば、Amazonのサイトは、莫大なユーザの購入履歴を覚えていたり、流通と連動して分割して荷物を送るなどたくさんの機能からなっています。しかしながら、複雑なページでも、その根本は、データベースから取り出したデータを表示し、一方で、入力したデータを書き込むといった作業が基本です。そうした処理を、極力少ない作業で実現しようとしたのがINTER-Mediatorです。\n                \n                    もちろん、Amazonのようなサイトを簡単に作れるかというとそれは無理です。しかしながら、Webアプリケーションを作るニーズは至る所にあり、その多くの場面では比較的シンプルな動作で十分なこともよくあります。Excelに記録するような業務で、一方でその情報を共有したいようなもの、たとえば小さな会社での資産管理などでは、Excelワークシートを添付メールで社員全員に送る事よりも、Webアプリケーションにする方が、即時に情報が見えるなど数多くのメリットがありますし、貸出や予約といった仕組みも有効に機能するでしょう。そうしたアプリケーションを、少ない労力で開発し、可能であれば現場の利用者がメンテナンスできるような状況を、INTER-Mediatorというフレームワークで作り出そうとしています。\n                INTER-Mediatorで作るべきもの\n                \n                    すでにデータベースが作られた状態であるとして、Webアプリケーション開発を解説します。その状態から、HTMLファイルなどのページ素材を作ると同時に、「定義ファイル」と呼ばれるデータベースの利用に関するルールなどを列挙したファイルを作り、Webアプリケーションとしての動作を行うようにします。\n                \n                    この定義ファイルの定義をベースにして、データベースからデータを取り出してページの中に埋め込むような動作をするのが、フレームワークとしてのINTER-Mediatorの重要な仕組みの1つです。HTMLで記述したタグ要素の中の特定の属性に、データベースのどのテーブルのどのフィールドと連動させるかといった記述を追加します。INTER-Mediator向けの記述を追加したHTMLファイルを「ページファイル」と呼びます。\n                \n                    これら、定義ファイルとページファイルを作る事で、INTER-Mediatorは機能します。いずれのファイルもサーバーに保存しますが、多くの部分がJavaScriptで稼働しており、データベースから取り出したデータをページに埋め込む作業はクライアントのWebブラウザ内で行います。\n                \n                    \n                \n            \n            \n                4. INTER-Mediatorでのバインディングの概念\n                定義ファイルのコンテキスト\n                \n                    INTER-Mediatorで開発するときの定義ファイルに記述する内容のうち、きわめて重要なものが「コンテキスト」と呼ばれるものです。コンテキストは単純な状況では、テーブルそのものという場合があります。つまり、テーブルのデータそのものを1つのコンテキストとして考えるということです。\n                \n                    しかしながら、多くの状況では、テーブル全体を使う事はありません。その一部分のデータを注目して利用します。具体的には一部分というのは、「一部分のレコード」になります。もし、住所録に対して、都道府県が京都府のデータだけを検索するような条件を与えてレコードを取り出すと、単なる誰かの住所録が「京都府に住む人の住所録」というように、意味が付加されます。技術的には検索条件を与えることですが、得られた結果は元のテーブルから何らかの意味が増えていることが一般的です。その意味で「コンテキスト」と名付けています。\n                \n                    コンテキストには、データを取り出すテーブル、データを書き込むテーブルを指定できます。取り出しと書き込みが別々の場合があるのだろうか？と思われるかもしれませんが、リレーショナル型データベースでは、データの扱いを柔軟にするため、「検索した状態」をテーブルのように見せるような機能（「ビュー」と呼ばれます）があり、ビューの結果を取り出して、その結果を元のテーブルに書き戻すような場合もあるので、別々の指定になっています。\n                \n                    このデータベースのテーブルの指定に加えて、コンテキストを区別するための名前が必要です。また、コンテキストには、その他のたくさんの指定が可能になっており、アプリケーションの動作に必要な機能の定義をコンテキスト内で行えるようになっています。\n                定義ファイルの記述方法\n                \n                    最初に、定義ファイルには、コンテキストがあり、名前、データを取り出すテーブル、書き込むテーブルを指定する必要があることを説明しました。それら3つが異なる名前、つまり順に「myaddress」「activeaddr」「address」にしたいとします。このとき、「何の値なのか」を示すキーワードと、指定する値つまり実際にデータベースに設定されているなどしてその時々で変わる値とを、それぞれコロンで区切って左右に並べて記述することにします。何の値に相当するかを示す決められたキーワードは、順番にname、view、tableとなっており、指定するのは次のような情報となります。\n                \n                    name: myaddress\nview: activeaddr\ntable: address\n                \n                \n                    なお、この記述を実際のファイルとしてどのように表現されているのかについては、以後の作業を「定義ファイルエディタ」を使う上ではほとんど関係ありません。name:と書かれた右のテキストフィールドに「myaddress」とキータイプするだけです。なお、上記の1つのかたまり（コンテキスト）内では、キーワードの順序は問いません。\n                \n                    ここで、viewとtableの記述を省略すると、nameをそのままテーブル名として使います。従って、データベースにaddressという名前のテーブルがある場合、単にそれを使うもっとも簡単な記述は、次のようなものです。もちろん、レコードの取り出しや変更では、いずれも、addressテーブルに対して行われます。なお、nameは省略できません。\n                \n                    name: address\n                \n                タグ要素に書き込む記述についての説明\n                \n                    データベースにあるaddressテーブルが住所録であるとして、電話番号がtelフィールドにあるとします。このとき、定義ファイルに次のようなコンテキストの定義があるとします。これまでに説明した事に加えて、keyというキーワードの値が増えています。\n                \n                    name: jusho\nview: address\ntable: address\nkey: id\n                \n                keyは、addressテーブルの主キーフィルドの名前を指定するものです。レコードを参照するだけだと主キーが何かは不要ですが、ページ上で書き直したデータを元のレコードに書き戻すのに必要になります。\n                ページファイル、つまり、HTMLファイル側で、addressテーブルのtelフィールドを表示し、かつ編集できるようにテキストフィールドを用意するとします。このとき、HTMLのタグを次のように記述します。\n                \n                    &lt;input type=\"text\" data-im=\"jusho@tel\" /&gt;\n                \n                この記述を行い、この後に説明する「ページファイルに必要な記述 」の記述を行うだけで、テキストフィールドに、addressテーブルのtelフィールドの値が表示されます。また、そこで電話番号を書き直して、tabキーを押すなどしてフォーカスを離すと、書き直した電話番号が元のフィールドに書き戻されます。\n                \n                通常のHTMLでの違いは、data-im属性が加わっていることです。この記述を「ターゲット指定」と呼びます。ターゲット指定では、コンテキストのname属性、区切り記号の@、そしてフィールド名を指定します。また、ターゲット指定が含まれている要素を「リンクノード」と呼びます。\n                もし、電話番号だけをどこかに表示したいのなら、次のような記述をHTMLの中に含めれば良いでしょう。\n                \n                    &lt;span data-im=\"jusho@tel\"&gt;&lt;/span&gt;\n                \n                たとえば、telフィールドの値が「0123-456-9876」ならば、「&lt;span data-im=\"jusho@tel\"&gt; 0123-456-9876 &lt;/span&gt;」というタグ要素があるとの同じ結果になります。つまりフィールドの値をそのタグの値として差し込みます。\n                以上のように、inputなどのフォーム要素をページ内に使いますが、INTER-Mediatorではテキストフィールドに見えている文字列を修正すると、テキストフィールドから離れるときに自動的にデータをデータベースに書き戻します。そのこともあり、FORMタグによる囲みやサブミット後の処理の記述などは一切必要はありません。FORMタグを記述してもかまいませんが、INTER-MediatorはFORMタグ要素に対して何の処理も行いません。\n                ページファイルに必要な記述\n                \n                    ページファイルでは、タグにどのフィールドと連動するのかということをターゲット指定として記述する事に加えて、INTER-Mediatorの本体をページに取り込むための設定が必要です。JavaScriptで記述した別ファイルの読み込みの設定と同様で、参照先がサーバー上の定義ファイルであるということです。ここまでの例で、定義ファイルがdef.phpというファイル名で保存されていて、ページファイルと同一のディレクトリにあるとします。このとき、ページファイルのヘッダ部に\n                \n                    &lt;script type=\"text/javascript\" src=\"def.php\"&gt;&lt;/script&gt;\n                \n                と記述します。INTER-Mediator自体の取り込みに加えて、定義ファイルに記述した内容も同時に取り込みます。\n            \n            \n                5. 繰り返しの実装\n                エンクロージャー、リピーターの概念\n                あるレコードのあるフィールドと、タグ要素に組み込まれるデータが連動できることはすでに説明しました。一方、データベースの出力が複数のレコードを持つのが一般的です。複数のレコードがある場合に、HTMLの要素とどのように合成するかという点をここでまとめておきます。\n                まず、1つの例を示します。あるデータベースaddressで、pnameフィールドに名前、telフィールドに電話番号が入力されているとします。このデータベースからデータを取り出すために、次のようなコンテキストが定義されているとします。\n                \n                    name: address\nkey: id\n                \n                通常、レコードが100個あれば、100個分のレコードがデータベースから取り出されます。このとき、ページファイルに次のようなHTMLでの記述があるとします。\n                \n                    &lt;table&gt;\n    &lt;thead&gt;\n        &lt;tr&gt;&lt;th&gt;名前&lt;/th&gt;&lt;th&gt;電話番号&lt;/th&gt;&lt;/tr&gt;\n    &lt;/thead&gt;\n    &lt;tbody&gt;\n        &lt;tr&gt;\n            &lt;td data-im=\"address@pname\"&gt;&lt;/td&gt;\n            &lt;td data-im=\"address@tel\"&gt;&lt;/td&gt;\n        &lt;/tr&gt;\n    &lt;/tbody&gt;\n&lt;/table&gt;\n                \n                INTER-Mediatorは、ターゲット指定のある要素から「address」というnameの値を持つコンテキストよりデータの取り出しが必要であると解釈します。すなわちaddressテーブルからデータを取り出しますが、その結果は複数のレコードとなるわけです。\n                \n                    INTER-Mediatorは上記のようなHTMLがある場合、TRタグ要素を一度TBODYタグ要素から取り除きます、別途保存しておきます。そして、取り出したレコードセットを順番にチェックして、正しいレコードがあれば、別途保存してあるTRタグ要素を複製してその中のリンクノードに現在のレコードのフィールドに対する値を組み込み、TBODYの子要素として追加します。つまり、レコードの数だけTRタグを複製して、それぞれのTRタグに順番にレコードの中身を埋め込みます。こうして、「ここからここまでを繰り返す」というような指定をしなくても、上記のTABLE要素の場合、1つのTR要素がレコード数だけ追加され、レコード数分の行を持つテーブルが作られます。\n                \n                    上記のTBODYのような繰り返しの親要素にあたる要素を「エンクロージャー」、そしてレコードの数だけ繰り返す要素を「リピーター」と呼びます。リピーターはここでの例のようにTRタグ要素1つといった単一のタグ要素かもしれませんが、エンクロージャー内に含まれるすべての要素をリピーターとして認識するので、リピーターは多数の要素であるという場合もあり得ます。\n                エンクロージャーとリピーターとして利用できる要素として、次の表のようなものがあります。\n                \n                    \n                        \n                            用途\n                            エンクロージャー\n                            リピーター\n                        \n                        \n                            表\n                            TBODY\n                            TR（複数のTRも可能）\n                        \n                        \n                            ポップアップ\n                            SELECT\n                            OPITON\n                        \n                        \n                            リスティング\n                            UL, OL\n                            LI\n                        \n                        \n                            汎用\n                            data-im-control属性がenclosure\n                            data-im-control属性がrepeater\n                        \n                    \n                \n                \n                    INTER-Mediatorはページファイルを解析して、ターゲットノードが見つかると、そこから上位の要素をたどり、リピーターを見つけ、その上位の要素をエンクロージャーとして特定します。そして、再度、リピーター内部についてすべてのターゲットノードを探すということを行います。\n                \n                    なお、1つのエンクロージャーにおいては、1つのコンテキストを利用してデータベースからデータを取り出すため、ターゲットノードでは単一の名前が指定されていることが必要です。前の例だと、2つのTDタグ要素のターゲット指定の最初のキーワードはaddressで同一でしたが、このように同一のコンテキスト名でターゲット指定がなされているという状態が必要です。\n                \n                    TABLEタグによる表以外では、DIVやSPANなどでもエンクロージャーとリピーターのセットを構築できるので、繰り返しの形式は表にはこだわりません。しかしながら、データベースの出力を表示する場合はTABLEを使う事が多いでしょう。TBODY要素は記述しない場合、通常はブラウザが存在するものとして扱うので明示されていない場合もあります。ただし、見出しとデータを分離するには、THEADとTBODYで分離する記述を行う必要があります。\n            \n            \n                6. コンテキストでの検索とソート\n                \n                    データベースのテーブルから単にすべてのレコードを取り出すということをすることもありますが、一般には、条件を与えて絞り込みを行い、指定したフィールドのデータをもとにしたソートを行った結果を受け取ります。データベースの処理では、レコードを取り出すときだけでなく、特定のレコードの内容を修正するような場合には、検索条件を与えます。\n                INTER-Mediatorでは、コンテキストに検索条件やソート条件を記載することで、そのコンテキストを利用したデータベースからのデータ取り出しやデータ編集で、その検索条件が必ず常に付与される仕組みを持っています。\n                \n                    \n                        \n                            id\n                            pname\n                            tel\n                            device\n                        \n                        \n                            1\n                            山田一郎\n                            0123-456-9876\n                            iphone\n                        \n                        \n                            2\n                            風下寒子\n                            0123-456-9876\n                            iphone\n                        \n                        \n                            3\n                            屋根裏夫\n                            0123-456-9876\n                            ipad\n                        \n                    \n                \n                たとえば、以下のコンテキストだと、「pname = ‘風下寒子’」という検索条件がデータベースへのデータを取り出すときに追加され、pnameフィールドがこの名前の人のレコードだけが取り出されます。ここでは、queryに対する値は複数の項目を持つので、そのような場合には、[ ] で囲って記述することにします。\n                \n                \n                    name: address\nkey: id\nquery: [field: pname, operator: =, value: 風下寒子]\n                \n                operatorは利用するデータベースエンジンに依存します。MySQLでは文字列の前方一致は次のようなコンテキストで記述します。つまり「tel like ’03%’」という検索条件になり、telフィールドが03で始まるレコードが検索条件に一致します。MySQLのlike演算子では%がワイルドカードになり演算子の右側の文字列では複数個のワイルドカードを含めることができます。\n                ソート条件についても、fieldとdirectionの2つのキーワードによる指定が必要で、fieldはもちろん基準になるフィールド名を指定します。directionは昇順か降順かを指定しますが、キーワードはデータベースエンジンに依存します。MySQLでは、ASCないしはDESCを指定します。\n                \n                \n                    name: address\nkey: id\nquery: [field: tel, operator: like, value: 03%]\nsort: [field: pname, direction: asc]\n                \n                queryやsortは複数の指定が可能です。複数の指定がある場合は、[ ]で囲まれたセットをカンマで区切って記述することにします。以下のコンテキストの場合、telフィールドが03で始まり、deviceフィールドの内容がiphoneであるレコードが抽出されます。2つの条件が両方満たすAND条件として解釈されます。そしてレコードをpnameフィールドを基準に昇順でソートした結果を返します。\n                \n                \n                    name: address\nkey: id\nquery: [field: tel, operator: like, value: 03%],[field: device, operator: =, value: iphone]\nsort: [field: pname, direction: asc]\n                \n                MySQLでは、次のような演算子（operatorに記述できる記号）が代表的なものです。\n                =：等しい、!=：等しくない、&lt;：より小さい、&gt;：より大きい、&lt;=：以下、&gt;=：以上、like：マッチング\n            \n            \n                7. マスター参照の組み込み\n                \n                    マスターにあるデータを使う\n                    \n                        住所録では名前や電話番号を記録するだけでなく、「友人」「会社関連」などといった分類を入力したいと思うかもしれません。通常、そうした情報を文字列で入れていても役に立つ場合がありますが、常に一定の情報を入れないと意味がない場合もあります。たとえば、売り上げを記録するのに同じ商品であれば、すべて同じ商品名である必要があります。そうしないと、商品ごとの集計が簡単にはできなくなります。\n                    \n                        このように、常に決まっているデータを入力したい場合、その決まったデータを単独のテーブルに入力し、そのテーブルの情報を参照する情報を入力をします。こうした決まったデータを入れておくテーブルを「マスターテーブル」と一般には呼ばれています。\n                    住所録をaddressテーブルで作っているとして、分類を記録するconnectionテーブルがデータベースに用意されているとします。connectionテーブルにはidとcnameの2つのフィールドがあり、idフィールドが主キーフィールドです。\n                    \n                        \n                            \n                                id\n                                cname\n                            \n                            \n                                1\n                                親戚\n                            \n                            \n                                2\n                                友人\n                            \n                            \n                                3\n                                会社関係\n                            \n                        \n                    \n                    \n                        ここで、住所録の各レコードで、種類を記録したいとします。そのような場合、以下のように、addressテーブルに、con_idフィールドを設けて、connectionテーブルのidフィールドと対応づけます。つまり、風下寒子さんは、「会社関係」の友人であることが記録されたわけです。\n                    \n                        \n                            \n                                id\n                                pname\n                                tel\n                                con_id\n                            \n                            \n                                1\n                                山田一郎\n                                0123-456-9876\n                                1\n                            \n                            \n                                2\n                                風下寒子\n                                0123-456-9876\n                                3\n                            \n                            \n                                3\n                                屋根裏夫\n                                0123-456-9876\n                                1\n                            \n                        \n                    \n                    \n                        このような、数字で突き合わせて2つのテーブルの値を合成するのは、一見すると分かりにくく、余分なことをしていると思うかもしれません。con_idというフィールドに直接「会社関係」と入力した方が手っ取り早いと思うかもしれません。\n                    \n                        まず、この方法の利点を説明しましょう。住所録にたくさんのデータが蓄積された後、「親戚」ではなくて「親類」に変更したいとします。上記のようなデータ構造を取っていれば、connectionフィールドのid=1のレコードのcnameフィールドを変更するだけですべて変更が完了します。addressフィールドのいくつかのレコードのあるフィールドに「親戚」という文字列が入っていたら、それらを検索して特定して、不定数のレコードに対する更新を正しく行う必要があり、より多くの作業が発生することになります。このように、表現や情報そのものを別途管理するということで、確実に同一の値を記録管理できるということです。\n                    このような複数のテーブルでデータを管理して突き合わせなどを行う仕組みを持っているのがリレーショナルデータベースの特徴です。マスターテーブルを使う手法はその代表的な利用方法です。\n                    \n                        この住所録が、顧客管理的なものだったとします。そして、各顧客に対するコンタクト（訪問、問い合わせ、電話連絡といったもの）を記録したい場合、addressテーブル以外に、コンタクトをいつ誰がどのような方法で行い、どうだったのかを記録するcontactテーブルを作ります。このとき、1人の顧客に対しては複数のコンタクト結果が発生することが想定されます。一方、1回のコンタクトは1顧客だけという運用をします。このような場合、顧客とコンタクトの関係は「1対多」と呼ばれます。contactテーブルには、対応するaddressテーブルのid値を入れるフィールド（たとえば、address_idフィールド）を用意して、そこに対応するレコードのidフィールドの値を入力します。逆に、addressフィールドには対応するcontactテーブルの主キー値を記録するフィールドは設けません。2つ以上かもしれないという数が決まらない問題もさることながら、contactテーブルのaddress_idフィールドの値から組み合わせは特定できることから、それ以上の対応付けのための情報は不要になります。\n                    コピーをする場合もある\n                    \n                        なお、ここで、マスターテーブルの値をコピーした方がいいような場合もあります。売り上げをテーブルで記録する場合、商品を別のテーブルで管理するといった「商品マスター」を確保する方法は典型的な設計手法です。商品マスター側では、商品名や単価を記録します。売り上げのテーブルでは、商品テーブルの特定のレコードを参照する情報をだけを記録するということができます。商品名や単価は売り上げのテーブルでは記録しないというわけです。\n                    \n                        しかしながら、そうなると、あるときある商品の単価が変わった場合、不都合が起きるかもしれません。商品マスターの単価を書き換えれば、過去の売り上げデータはすべて新しい単価で売ったという結果になります。このように、変更があるような情報については、商品マスターの単価の値を、売り上げのテーブルにもつどつどコピーして記録するのが一般的です。それでも「現在の単価」を記録する意味で商品テーブルを別に用意するのは、間違いなく入力できるなどのメリットをもたらすものです。\n                    ポップアップメニューで入力\n                    \n                        addressテーブルのcon_idフィールドに入力するためにポップアップメニューを利用したいとします。このとき、addressテーブルのためのコンテキストだけではなく、connectionテーブルのためのコンテキストも必要になります。定義ファイルでは複数のコンテキストを定義でき、それらは並べて記述します。以下のように、区切りに線を入れて、2つのコンテキストが定義されていることを示します。なお、connectionコンテキストについてはkeyの指定はあってもなくてもかまいません。connectionテーブルにクライアントから更新をすることがないので、ここでの利用では必要ないのです。\n                    \n                        name: address\nkey: id\n    -\nname: con\nview: connection\n                    \n                    そして、ページファイルでは次のようなターゲット指定を持った要素が加わります。\n                    \n                        &lt;table&gt;\n    &lt;thead&gt;\n        &lt;tr&gt;&lt;th&gt;名前&lt;/th&gt;&lt;th&gt;電話番号&lt;/th&gt;&lt;th&gt;分類&lt;/th&gt;&lt;/tr&gt;\n    &lt;/thead&gt;\n    &lt;tbody&gt;\n        &lt;tr&gt;\n            &lt;td data-im=\"address@pname\"&gt;&lt;/td&gt;\n            &lt;td data-im=\"address@tel\"&gt;&lt;/td&gt;\n            &lt;td&gt;\n                &lt;select data-im=\"address@con_id\"&gt;\n                    &lt;option data-im=\"con@id@value con@cname\"&gt;&lt;/option&gt;\n                &lt;/select&gt;\n            &lt;/td&gt;\n        &lt;/tr&gt;\n    &lt;/tbody&gt;\n&lt;/table&gt;\n                    \n                    \n                        これで、テーブルには3つ目の「分類」列が追加され、各レコードに対してポップアップメニューが表示されます。すでにconn_idフィールドにデータがあれば、それに対応する選択肢が選択されているはずです。また、ポップアップメニューを選択すれば、その選択結果で、conn_idの値が更新されます。\n                    \n                        ページファイルのターゲット指定をあらためて解説をします。まず、addressコンテキストの展開中に、conという別のコンテキストが登場しています。ここでは、まず、TBODY/TRによるエンクロージャー/リピーターが識別されますが、そのとき、さらに内部にSELECT/OPTIONによるエンクロージャー/リピーターが存在しています。リピーター内部のエンクロージャー以下の要素は、データベースの結果を合成するときには特に何もしません。その代わり、データベースから得られたデータを合成した後、さらに内部のエンクロージャー/リピーターの展開に入ります。ここでは、名前と電話番号をTD要素の値に組み込んだ後、conというnameを持つコンテキストを見て、connectionテーブルへアクセスをしてレコードを受け取り、レコードの数だけOPTIONタグを複製して、OPTIONタグ要素内部にconnectionテーブルから得られた結果を合成します。\n                    \n                        OPTIONタグ要素では、2つの新しい内容が含まれています。まず、ターゲット指定は、半角スペースによって区切る事で1つの要素に複数の指定を入れる事ができ、それぞれの合成が行われます。ターゲット指定では@で区切られた3つ目の項目があります。3つ目の項目は、データベースのデータを設定する先を指定します。\n                    \n                        この場合だと、「con@id@value」という指定により、conコンテキスト（connectionテーブル）のidフィールドの値を、OPTIONタグ要素のvalue属性の値にします。続いて「con@cname」により、conコンテキストのcnameフィールドの値がOPTIONタグの値として設定され、その文字列が選択肢として見るようになります。結果として、ポップアップメニュー部分はデータベースから得れた結果を合成すると、次のようなHTMLと同じ結果になります。\n                    \n                        &lt;select data-im=\"address@conn_id\"&gt;\n    &lt;option data-im=\"con@id@value con@cname\" value=\"1\"&gt;親類&lt;/option&gt;\n    &lt;option data-im=\"con@id@value con@cname\" value=\"2\" &gt;友人&lt;/option&gt;\n    &lt;option data-im=\"con@id@value con@cname\" value=\"3\" &gt;会社関係&lt;/option&gt;\n&lt;/select&gt;\n                    \n                    ターゲット指定において、@で区切った場合の3つ目の項目には、以下のような仕組みを利用できます。\n                    \n                        省略：要素の値。ただし、フォーム要素は種類に応じて適切な属性へ設定\n                        属性名：その属性の値\n                        style.スタイル名：指定したスタイルの値（スタイル名はJavaScriptでのプロパティ名）\n                        innerHTML：要素のinnerHTML属性にフィールドの値を設定\n                        （$を最初に付加）：現在の値の中の$をフィールドの値に置き換える\n                        （#を最初に付加）：現在の値の後にフィールドの値を追加する\n                    \n            \n            \n                8. 関連レコードの展開\n                1対多の展開とリレーションシップ\n                \n                    前のページの例では、2つのテーブルを利用しましたが、2つ目のconnectionテーブルは、あるフィールドに入力する値を記録するものであり、その中の1つが選択されれるという関係でしたが、さらに複雑な関係がある場合について説明をします。\n                まず、住所録のaddressテーブルとして以下のようなものがあったとします。ここでの例は、con_idは利用しません。\n                \n                    \n                        \n                            id\n                            pname\n                            tel\n                            con_id\n                        \n                        \n                            1\n                            山田一郎\n                            0123-456-9876\n                            1\n                        \n                        \n                            2\n                            風下寒子\n                            0123-456-9876\n                            3\n                        \n                        \n                            3\n                            屋根裏夫\n                            0123-456-9876\n                            1\n                        \n                    \n                \n                \n                    addressテーブルが顧客を記録していて、営業部員が顧客に対するコンタクト内容を以下のようなcontactテーブルで記録していたとします。idフィールドが主キーになりますが、address_idには該当する顧客に関して、addressテーブルのその顧客のレコードのidフィールド値を記録します。たとえば、以下のid=2のテーブルは、address_idの値が「3」なので、「屋根裏夫」さんに関して、9月14日にメールで展示会の案内をしたということを記録していることになります。\n                \n                    \n                        \n                            id\n                            address_id\n                            dt\n                            memo\n                        \n                        \n                            1\n                            2\n                            2013-9-12 10:00\n                            電話したが不在\n                        \n                        \n                            2\n                            3\n                            2013-9-14 14:00\n                            メールで展示会の案内をした\n                        \n                        \n                            3\n                            2\n                            2013-9-15 17:00\n                            電話で展示会の案内をした\n                        \n                        \n                            4\n                            1\n                            2013-9-16 13:00\n                            訪問して商品説明した\n                        \n                    \n                \n                この2つのテーブルで、顧客ごとに、コンタクト情報を一覧するようなページを作るとします。定義ファイルは以下のような記述となります。ここで新たにrelationというキーワードが登場します。\n                \n                    name: address\nkey: id\n    -\nname: contact\nkey: id\nrelation: [foreign-key: address_id, join-field: id, operator: =]\n                \n                このrelationキーの値は、複数の項目からなっており、[ ] でその1つの項目を記述することにします。\n                ここで、 addressという名前のコンテキストがページファイル内で利用されるようなターゲット指定があるとします。このとき、addressテーブルからデータを取り出すのですが、階層関係にある上位のリピータに関して、join-fieldで指定したidフィールドの値を取り出し、addressテーブルでforeign-keyに指定したaddress_idの値とイコールなレコードだけに絞り込みます。この動作は実際のデータを考えた方が分かりやすいので、この後で動作を見ながらが説明します。\n                \n                ページファイルについては、次のようなものを作成したとします。前のページの例との違いは、外側のテーブルの3列目に、さらにテーブルがあって、そこにcontactテーブルの内容が展開されるという点です。\n                \n                    &lt;table&gt;\n    &lt;thead&gt;\n        &lt;tr&gt;&lt;th&gt;名前&lt;/th&gt;&lt;th&gt;電話番号&lt;/th&gt;&lt;th&gt;分類&lt;/th&gt;&lt;/tr&gt;\n    &lt;/thead&gt;\n    &lt;tbody&gt;\n        &lt;tr&gt;\n            &lt;td data-im=\"address@pname\"&gt;&lt;/td&gt;\n            &lt;td data-im=\"address@tel\"&gt;&lt;/td&gt;\n            &lt;td&gt;\n                &lt;table&gt;\n                    &lt;thead&gt;\n                        &lt;tr&gt;&lt;th&gt;日時&lt;/th&gt;&lt;th&gt;連絡内容&lt;/th&gt;&lt;/tr&gt;\n                    &lt;/thead&gt;\n                    &lt;tbody&gt;\n                        &lt;tr&gt;\n                            &lt;td data-im=\"contact@dt\"&gt;&lt;/td&gt;\n                            &lt;td data-im=\"contact@memo\"&gt;&lt;/td&gt;\n                        &lt;/tr&gt;\n                    &lt;/tbody&gt;\n                &lt;/table&gt;\n            &lt;/td&gt;\n        &lt;/tr&gt;\n    &lt;/tbody&gt;\n&lt;/table&gt;\n                \n                実際にテーブルが作られる様子を、手順を追って説明します。ページ上に存在するテーブル部分を示します。\n                \n                    BODY要素から探索されて、外側のTBODYとTRが、addressコンテキストを使用するエンクロージャー/リピーターとして識別されます。\n                        \n                            \n                                \n                                    名前\n                                    電話番号\n                                    連絡内容\n                                \n                                \n                                    &nbsp;\n                                    &nbsp;\n                                    \n                                        \n                                            \n                                                \n                                                    日時\n                                                    連絡内容\n                                                \n                                            \n                                            \n                                                \n                                                    &nbsp;\n                                                    &nbsp;\n                                                \n                                            \n                                        \n                                    \n                                \n                            \n                        \n                    \n                    エンクロージャーからリピーターを取り除き、外側のテーブルのボディ部分がない状態になります。\n                        \n                            \n                                \n                                    名前\n                                    電話番号\n                                    連絡内容\n                                \n                            \n                        \n                    \n                    addressテーブルにアクセスして、データを取り出します。\n                    最初のid=1のレコードがあるので、リピーターを複製し、エンクロージャーの子要素に追加します。\n                        \n                            \n                                \n                                    名前\n                                    電話番号\n                                    連絡内容\n                                \n                                \n                                    &nbsp;\n                                    &nbsp;\n                                    \n                                        \n                                            \n                                                \n                                                    日時\n                                                    連絡内容\n                                                \n                                            \n                                            \n                                                \n                                                    &nbsp;\n                                                    &nbsp;\n                                                \n                                            \n                                        \n                                    \n                                \n                            \n                        \n                    \n                    \n                        レコードの中にあるデータが、フィールドに応じてリピーター内部のaddressコンテキストのターゲット指定のある要素内に合成されます。つまり、最初のtdに「山田一郎」、次のtdに「0123-456-9876」という文字列データが埋め込まれます。\n                        \n                            \n                                \n                                    名前\n                                    電話番号\n                                    連絡内容\n                                \n                                \n                                    山田一郎\n                                    0123-456-9876\n                                    \n                                        \n                                            \n                                                \n                                                    日時\n                                                    連絡内容\n                                                \n                                            \n                                            \n                                                \n                                                    &nbsp;\n                                                    &nbsp;\n                                                \n                                            \n                                        \n                                    \n                                \n                            \n                        \n                    \n                    リピータ内部を探索すると、新たに3列目にさらにエンクロージャー/リピーターとなるTBODY/TRタグ要素が見つかります。ここでもリピーターを一度削除してエンクロージャの中身を空にします。\n                        \n                            \n                                \n                                    名前\n                                    電話番号\n                                    連絡内容\n                                \n                                \n                                    山田一郎\n                                    0123-456-9876\n                                    \n                                        \n                                            \n                                                \n                                                    日時\n                                                    連絡内容\n                                                \n                                            \n                                            \n                                            \n                                        \n                                    \n                                \n                            \n                        \n                    \n                    現在作業中のリピーターはcontactコンテキストを使用する事が中身を解析する事で判別できます。\n                    \n                        contactコンテキストの定義に従ってcontactテーブルにアクセスします。このとき、relationキーの指定があるので、まず、その中のjoin-fieldを参照し「id」というフィールド名となっています。そこで、上位のリピーターについて、手順5で得ているようにidの値は「1」です。この値をforeign-keyに指定したaddress_idに持つレコードだけを取り出します。operatorは=なので、つまりは、contactテーブルを取り出すときに、address_id=1のレコードだけを取り出します。\n                    \n                    contactテーブルから、id=4の1つのレコードだけが取り出されました。\n                    手順5で切り出したリピーターを複製し、contactテーブルから得られたデータを合成します。ここではテーブルのTBODYに1行分のTRタグ要素が追加され、1列目には「2013-9-16 13:00」、2列目には「訪問して商品説明した」という文字が追加されます。\n                        \n                            \n                                \n                                    名前\n                                    電話番号\n                                    連絡内容\n                                \n                                \n                                    山田一郎\n                                    0123-456-9876\n                                    \n                                        \n                                            \n                                                \n                                                    日時\n                                                    連絡内容\n                                                \n                                            \n                                            \n                                                \n                                                    2013-9-16 13:00\n                                                    訪問して商品説明した\n                                                \n                                            \n                                        \n                                    \n                                \n                            \n                        \n                    \n                    内側のコンテキストによる展開はこれでいったん終了します。また、外側のリピーターに関してはエンクロージャー/リピータのセットは1つだけですので、これで最初のレコードに関する合成が終わります。\n                    外側のコンテキストは、2つ目のレコード、つまりid=2のレコードの展開を行います。\n                    外側のリピーターの複製を作り、エンクロージャーの子要素に追加します。そして、id=2のレコードのフィールドをリンクノードに合成します。\n                        \n                            \n                                \n                                    名前\n                                    電話番号\n                                    連絡内容\n                                \n                                \n                                    山田一郎\n                                    0123-456-9876\n                                    \n                                        \n                                            \n                                                \n                                                    日時\n                                                    連絡内容\n                                                \n                                            \n                                            \n                                                \n                                                    2013-9-16 13:00\n                                                    訪問して商品説明した\n                                                \n                                            \n                                        \n                                    \n                                \n                                \n                                    風下寒子\n                                    0123-456-9876\n                                    \n                                        \n                                            \n                                                \n                                                    日時\n                                                    連絡内容\n                                                \n                                            \n                                            \n                                                \n                                                    &nbsp;\n                                                    &nbsp;\n                                                \n                                            \n                                        \n                                    \n                                \n                            \n                        \n                    \n                    内部を探索すると手順6と同様に、エンクロージャーとリピーターのセットが存在します。リピーターを取り除きます。\n                        \n                            \n                                \n                                    名前\n                                    電話番号\n                                    連絡内容\n                                \n                                \n                                    山田一郎\n                                    0123-456-9876\n                                    \n                                        \n                                            \n                                                \n                                                    日時\n                                                    連絡内容\n                                                \n                                            \n                                            \n                                                \n                                                    2013-9-16 13:00\n                                                    訪問して商品説明した\n                                                \n                                            \n                                        \n                                    \n                                \n                                \n                                    風下寒子\n                                    0123-456-9876\n                                    \n                                        \n                                            \n                                                \n                                                    日時\n                                                    連絡内容\n                                                \n                                            \n                                            \n                                            \n                                        \n                                    \n                                \n                            \n                        \n                    \n                    手順8と同様に、ここではid=2のaddressテーブルのレコードが上位のリピーター内に展開されているので、contactテーブルに対してaddress_id=2となるレコードに絞り込んでレコードを取り出します。\n                    id=1とid=3の2つのレコードが取り出されました。\n                    contactテーブルのid=1のレコードについて、手順14で取り出したリピーターを複製してレコード内のデータを合成して、エンクロージャーに追加します。\n                        \n                            \n                                \n                                    名前\n                                    電話番号\n                                    連絡内容\n                                \n                                \n                                    山田一郎\n                                    0123-456-9876\n                                    \n                                        \n                                            \n                                                \n                                                    日時\n                                                    連絡内容\n                                                \n                                            \n                                            \n                                                \n                                                    2013-9-16 13:00\n                                                    訪問して商品説明した\n                                                \n                                            \n                                        \n                                    \n                                \n                                \n                                    風下寒子\n                                    0123-456-9876\n                                    \n                                        \n                                            \n                                                \n                                                    日時\n                                                    連絡内容\n                                                \n                                            \n                                            \n                                                \n                                                    2013-9-12 10:00\n                                                    電話したが不在\n                                                \n                                            \n                                        \n                                    \n                                \n                            \n                        \n                    \n                    contactテーブルのid=3のレコードについて、手順14で取り出したリピーターを複製してレコード内のデータを合成して、エンクロージャーに追加します。\n                        \n                            \n                                \n                                    名前\n                                    電話番号\n                                    連絡内容\n                                \n                                \n                                    山田一郎\n                                    0123-456-9876\n                                    \n                                        \n                                            \n                                                \n                                                    日時\n                                                    連絡内容\n                                                \n                                            \n                                            \n                                                \n                                                    2013-9-16 13:00\n                                                    訪問して商品説明した\n                                                \n                                            \n                                        \n                                    \n                                \n                                \n                                    風下寒子\n                                    0123-456-9876\n                                    \n                                        \n                                            \n                                                \n                                                    日時\n                                                    連絡内容\n                                                \n                                            \n                                            \n                                                \n                                                    2013-9-12 10:00\n                                                    電話したが不在\n                                                \n                                                \n                                                    2013-9-15 17:00\n                                                    電話で展示会の案内をした\n                                                \n                                            \n                                        \n                                    \n                                \n                            \n                        \n                    \n                    内側のコンテキストの展開はこれで終了し、addressテーブルのid=2に対する展開は終了しました。\n                    addressテーブルのid=3に対する展開も同様に行います。\n                        \n                            \n                                \n                                    名前\n                                    電話番号\n                                    連絡内容\n                                \n                                \n                                    山田一郎\n                                    0123-456-9876\n                                    \n                                        \n                                            \n                                                \n                                                    日時\n                                                    連絡内容\n                                                \n                                            \n                                            \n                                                \n                                                    2013-9-16 13:00\n                                                    訪問して商品説明した\n                                                \n                                            \n                                        \n                                    \n                                \n                                \n                                    風下寒子\n                                    0123-456-9876\n                                    \n                                        \n                                            \n                                                \n                                                    日時\n                                                    連絡内容\n                                                \n                                            \n                                            \n                                                \n                                                    2013-9-12 10:00\n                                                    電話したが不在\n                                                \n                                                \n                                                    2013-9-15 17:00\n                                                    電話で展示会の案内をした\n                                                \n                                            \n                                        \n                                    \n                                \n                                \n                                    屋根裏夫\n                                    0123-456-9876\n                                    \n                                        \n                                            \n                                                \n                                                    日時\n                                                    連絡内容\n                                                \n                                            \n                                            \n                                                \n                                                    2013-9-14 14:00\n                                                    メールで展示会の案内をした\n                                                \n                                            \n                                        \n                                    \n                                \n                            \n                        \n                    \n                    \n                \n            \n            \n                9. テキスト以外のUI要素の利用\n                チェックボックスの利用\n                \n                    フィールドのデータと連動させたいチェックボックスを作る場合は、チェックボックスのタグ記述を通常通り行い、class属性にターゲット指定を記述します。そして、value属性についても空文字列でない何らかのデータを記述します。\n                \n                    &lt;input type=\"checkbox\" value=\"1\"\n    data-im=\"address@check\"/&gt;\n                \n                上記のタグ要素の場合、addressコンテキストのテーブルのcheckフィールドと連動します。チェックが入るとcheckフィールドの値はvalue属性の値の「1」になり、checkをはずすと \"\"（長さ0の文字列ないしはNULL） となります。なお、数値フィールドの場合はチェックを外すと0になるので、value属性は0以外の値を指定します。ページ合成時には、checkフィールドの値とvalueの値が同じならチェックが入るようになります。\n                \n                ラジオボタンの利用\n                \n                    ラジオボタンもチェックボックスと同様に、inputタグ要素で記述します。本来はname属性が同一のものを1つのセットとして扱いますが、INTER-Mediatorでは、同一リピーター内の同一ターゲット指定の物を1つのセットにするので、name属性は不要です。展開時に自動的に属性は設定されます。\n                \n                    &lt;input type=\"radio\" value=\"1\" data-im=\"address@kind\"/&gt;\n&lt;input type=\"radio\" value=\"2\" data-im=\"address@kind\"/&gt;\n&lt;input type=\"radio\" value=\"3\" data-im=\"address@kind\"/&gt;\n                \n                選択したボタンのvalue属性が記録され、また、ページ表示時にはフィールドの値に対応したラジオボタンが選択されています。\n                画像の利用\n                \n                    INTER-Mediatorでは画像を扱ういくつかの方法に対応していますが、代表的な手法は、Webサイト上で公開されている画像ファイルへのアクセスです。HTMLページと同一ディレクトリにある「img」ディレクトリに画像ファイルがあるとします。そして、あるテーブルで「picfile」フィールドがあり、画像ファイルのファイル名があるとします。このとき、以下のimgタグ要素はターゲット指定となって、picfileフィールドの値をsrc属性に合成します。\n                \n                    &lt;img src=\"img/\" data-im=\"product@picfile@#src\" /&gt;\n                \n                \n                    テーブルはproductコンテキストから取り出されるとします。picfileの値が「goods1.jpg」だとすると、コンテキスト指定の3つ目の記述「#src」により、src属性にフィールドの値を追加します。結果として、src属性の値は「img/goods1.jpg」となり、クライアントが指定されたURIをダウンロードして画像として表示するようになります。\n                ページネーションとナビゲーション\n                \n                    検索して得られたレコードが複数ある場合、レコードの数だけリピーターが複製されますが、何百もあると時間もかかりますし、参照する方も大変です。Webページではそのような場合、一定数のレコードごとにページ表示を切り替える「ページネーション」の仕組みを組み込みます。\n                INTER-Mediatorでは、1つのページにつき、1つのコンテキストに対してページネーションが可能です。addressテーブルが数百件あるような場合、たとえばコンテキストとして次のように記述します。\n                \n                    name: address\nkey: id\nrecords: 10\npaging: true\n                \n                まず、recordsキーの値により、レコードは10件ずつ表示されます。いちばん最初は最初の10件のみとなります。ページネーションの表示には、pagingキーワードに対する値をtrueにします。そして、ページネーションコントロールを表示するには、たとえばTABLEタグのすぐ上に、次のようなタグを記述します。\n                \n                    &lt;div id=\"IM_NAVIGATOR\"&gt;&lt;/div&gt;\n                \n                \n                    すると、このDIVタグ要素の中に、前後のレコードに移動したり、最初や最後のレコードに移動するコントロールを作成できます。例えば、次のようなものが表示されます。ページネーションはHTMLで記述されたものですが、スタイル設定が自動的に機能するので、テーマで指定したスタイルが最初から設定されています。なお、ボタンの背景や文字などにはすべてスタイルを設定できるようにclass属性が適用されているので、ページごとに表示形態は任意にカスタマイズできます。\n                \n                    \n                \n                レコード作成や削除のボタン配置\n                \n                    データベースのテーブルでは、新規作成や削除はレコード単位で行います。フィールドの作成や削除もできますが、データの入力や検索を行うときにはフィールド単位の処理は行いません。新規レコードを作ると、定義してあるフィールドは、中身が空かもしれませんがすべて用意され、フィールドの中にあるデータを修正することができるようになります。空のフィールドに何か数値を入れるのも、「修正」とみなします。\n                INTER-Mediatorでは、コンテキストで、 repeat-controlというキーに対する値を設定することで、そのコンテキストの検索結果をHTMLに埋め込む段階で、レコード削除や作成のボタンを作ります。このキーの値は、「insert」「insert-top」「delete」「confirm-insert」「confirm-insert-top」「confirm-delete」のいずれかで、insertは新規レコード、deleteは削除に関する機能です。confirmが付くと削除や作成前にダイアログボックスで確認します。新規レコードボタンで-topが付くものは、繰り返されるリピーターの前にボタンを作成し、-topが付いていない場合には繰り返されるリピータの後にボタンを作成します。なお、削除ボタンは各リピーターの末尾に追加され、レコードの数だけ表示されます。ただし、ページネーションが機能している場合、新規レコード作成のボタンは、ページネーションの要素の中に、テキストのボタンとして追加されます。\n                \n                    たとえば、以下のようなコンテキストだと、addressテーブルの内容を表示するとき、一連のリピーターの最後に「挿入」ボタンが作られます。また、レコードごとに「削除」ボタンが作られますが、削除ボタンをクリックすると削除していいかどうかをたずねるダイアログボックスが表示されます。\n                \n                    name: address\nkey: id\nrepeat-control: confirm-delete insert\n                \n            \n            \n                10. INTER-Mediatorのその他の機能\n                \n                    このページでは、INTER-Mediatorの機能について、ここまでのところでは触れていないことについてまとめておきます。プログラミングなどの技術的な知識背景がないと理解がしづらい事柄が中心です。それでも、ここまでの解説を読んで、他にどんな機能があるのかを興味を持っていただけたのであれば、INTER-Mediatorの全体像を知るのに有用な情報になると思われます。\n                \n                    以下、（設定）は定義ファイルの設定やページファイル内のターゲット指定で実現できるものです。（JavaScript）はJavaScript言語でプログラムを記述する場合に利用できる機能です。（PHP）はサーバーサイドでのPHP言語によるプログラムの追加が必要な機能です。\n                \n                    日付・時刻を書式を整えた形式で表示したり、数値フィールドのデータをカンマ付きの数字や通貨記号付きで表示したりする機能があります。また、修正結果を元のフィールドに書き戻すこともできます。（設定）\n                    \n                        データベースから得れた文字列について文字実体参照にして、HTMLとしてテキストエリア等で編集できるようにする仕組みがあります。加えてタグ要素のinnerHTMLにデータベースから得られたデータを代入することもできます。（設定）\n                    \n                    \n                        新規レコードを作成するための専用のページを構築でき、その中のポップアップメニュー等はマスターテーブルから構築する事ができます。ボタンを押た後にボタンを消してメッセージを表示し、別のページに自動的に移動します。（設定）\n                    \n                    検索条件では、ANDやOR条件の設定も可能です。（設定）\n                    対応ブラウザを定義し、ブラウザを判別して対応外の場合にはメッセージを表示して処理を行わないようにする仕組みがあります。（設定＋JavaScript）\n                    JavaScriptのライブラリをパーツとして使用する機能があり、ファイルのアップロードやHTMLエディなど一部はプログラミングなしに使えます。（設定+JavaScript）\n                    \n                        認証や認可の仕組みを利用できます。認証では、ユーザテーブルをデータベースに確保し、グループの設定もできます。またデータベースエンジンのネイティブユーザでの認証もできます。認可ではコンテキスト単位の処理の可否や認証の要求ができます。さらにレコード単位に特定のユーザやグループに対してのみ利用できるような設定もできます。認証のためのログインパネルをカスタマイズすることもできます。画像などのメディアファイルに対する認可の仕組みの適用もできます。（設定）\n                    \n                    データベースへの要求や応答結果を変換する仕組みを追加できます。この仕組みにより検索条件をデータに合わせて変更したり、得られた検索結果を集計して戻すなどの処理ができます。（PHP）\n                    クライアント側のプログラムでは、エンクロージャーやリピーターの合成時に割り込み処理を入れる事などが可能です。（JavaScript）\n                    クライアント側のプログラミングをサポートするために、データベースのデータを織り込んだ結果から、特定のフィールドと関連付けられている要素を参照するためのid属性を得るメソッドなどが用意されています。\n                    修正時に値のチェックができ、内容に応じてメッセージを出すことができます。（設定）\n                    楽観的ロックにより、同一フィールドを同時に2人で変更した場合、後から保存しようとしたユーザの側に警告メッセージを表示し、更新をキャンセルすることもできます。\n                \n            \n        "
    },
    {
        "id": 10,
        "parent": "/ja/for-novices/",
        "path": "/ja/for-novices/handson.html",
        "title": "ハンズオンセッション手順書",
        "breadcrumb": "ハンズオンセッション手順書",
        "body": "\n            \n                はじめに\n                この手順書は、2015年4月11日の勉強会で利用するために当初作成したものを、その後に改定してきたものです。個人で進めることもできますが、この手順書を利用して、2〜3時間のハンズオンをオフラインで開催することもできます。INTER-Mediatorをまったく触ったことがないが、どんな感じなのかを知りたい方、あるいはINTER-Mediator普及のために、活用していただけます。\n                2016/8/6用PDF資料なお、本ページの内容はこのPDFの内容から、細かな点では変わっています。\n                「ビデオで始めるINTER-Mediator」のページでは、ハンズオンを実際に行なったところをビデオでご覧いただけます。\n            \n            \n                使用までの準備\n                INTER-Mediatorがインストールされた動くサーバのVirtual Machineを参照して、INTER-Mediatorが稼働するVMを用意してください。ダウンロードしてすぐにINTER-Mediatorを稼働することができます。\n                MySQLをご利用される方は、上記のVMで準備完了です。FileMaker Serverを利用される方は、ホストOS側に、FileMaker Serverをインストールしてください。加えて、こちらのリンク先のデータベースファイルTestDBをダウンロードして、FileMaker Serverで公開をしておいてください。\n                なお、以下の手順では、VirtualBoxのホストオンリーアダプターが、既定の設定（ホストのIPアドレスが192.168.56.1、ゲストが192.168.56.101）になっていることを前提として記述しています。\n                VMの準備が整ったら、VMを起動します。そして、ホストOS側では、ブラウザを起動して、http://192.168.56.101/ に接続します。\n                http://192.168.56.101/ で表示されるページ＝「VMのホーム」と呼びます。\n            \n            \n                セッション1：入力専用ページ\n                1-1：質問の入力ページを作る\n                定義ファイルの作成（ファイル名：def01.php）\n                \n                    VMのホームで、「def01.phpを編集」をクリックします。\n                    Queryの下にある行の右側の「削除」をクリックして、Queryの下に行がないようにします。\n                    Sortingの下にある行の右側の「削除」をクリックして、Sortingの下に行がないようにします。\n                    nameに「survey」、keyに「id」と入力します。Contextsセクションには、この2つのテキストフィールドだけがあるようにします。\n                    Optionsセクションには何も入力されていない状態のままでかまいません。\n                    Database Settingsセクションには以下のように入力します。\n                    \n                        \n                            [FileMaker Server] Database Settingsセクションのdb-classには「FileMaker_FX」、databaseには「TestDB」、userには「web」、passwordには「password」、serverには「192.168.56.1」、portには「80」、protocolには「http」、datatypeには「FMPro12」と入力します。\n                            [MySQL] Database Settingsセクションのdb-classには「PDO」、dsnには\n                                「mysql:host=localhost;dbname=test_db;charset=utf8mb4」\n                                userには「web」、passwordには「password」と入力します。\n                        \n                    \n                    Debugのところは「false」と入力します。\n                \n                ページファイルの作成（ファイル名：page01.html）\n                \n                    VMのホームで、「page01.htmlを編集」をクリックします。\n                    ページファイルエディターが起動します。以下のソースコードを入力します。\n                \n                \n                    &lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" /&gt;\n    &lt;title&gt;INTER-Mediator Demo&lt;/title&gt;\n    &lt;script type=\"text/javascript\" src=\"def01.php\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;table&gt;\n    &lt;tbody data-im-control=\"post\"&gt;\n    &lt;tr&gt;&lt;th&gt;名前&lt;/th&gt;&lt;td&gt;&lt;input type=\"text\" data-im=\"survey@Q5\"/&gt;&lt;/td&gt;&lt;/tr&gt;\n    &lt;tr&gt;&lt;th&gt;質問1&lt;/th&gt;&lt;td&gt;&lt;input type=\"text\" data-im=\"survey@Q1\"/&gt;&lt;/td&gt;&lt;/tr&gt;\n    &lt;tr&gt;&lt;th&gt;&lt;/th&gt;&lt;td&gt;&lt;button data-im-control=\"post\"&gt;Answer&lt;/button&gt;&lt;/td&gt;&lt;/tr&gt;\n    &lt;/tbody&gt;\n&lt;/table&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n                \n                コード内で変更や追加をする箇所は、下線で示します。\n                ページを表示してフォーム入力を行う\n                \n                    VMのホームで、「page01.htmlを表示する」をクリックします。\n                    フォームが表示されます。適当に入力して、Answerボタンをクリックします。\n                    \n                        \n                            [FileMaker Server] TestDBのsurveyレイアウトを確認して、データが入力されていることを確認します。\n                            [MySQL] test_dbのsurveyテーブルを確認して、データが入力されていることを確認します。以下、いちばん手軽な手順を示します。\n                                \n                                    VirtualBoxのVMのウインドウ（真っ黒のウインドウ）をクリックして、ユーザ名「developer」、パスワード「im4135dev」でログインをします。\n                                    プロンプトで、「mysql -u web -p test_db -e 'select * from survey;'」と入力します。\n                                    パスワードをたずねられるので「password」と入力します。\n                                \n                            \n                        \n                    \n                    適当にいくつかフォーム入力して、レコードが増えることを確認します。\n                \n                1-2：入力フォームらしい感じにする\n                \n                    VMのホームで、「def01.phpを編集」をクリックするか、すでに開いている定義ファイルエディターのページを参照します。\n                    右上のShow Allボタンをクリックします。\n                    post-reconstructに「true」と入力します。\n                    post-dismiss-messageに「送信しました」と入力します。\n                    post-move-urに「http://inter-mediator.org/」と入力します。URLは別のものでもかまいません。その後、入力を確定するために、Tabキーを押しておきます。\n                    VMのホームで、「page01.htmlを表示する」をクリックするか、すでに開いているpage01.htmlを更新します。\n                    フォームが表示されます。適当に入力して、Answerボタンをクリックします。今度は、Answerボタンが消え、数秒後に別のページにジャンプしました。\n                    \n                        \n                            [FileMaker Server] TestDBのsurveyレイアウトを確認して、データが入力されていることを確認します。\n                            [MySQL] test_dbのsurveyテーブルを確認して、データが入力されていることを確認します。（手順はすでに説明しました。）\n                        \n                    \n                \n                1-3：テキストフィールド以外のフォーム要素\n                チェックボックス\n                page01.htmlの中のTABLEタグの内容を以下の様に変更して、フォームを表示すると、チェックボックスが追加されます。フォームに入力して、Answerボタンを押してみて、データベースにどのように入力されるのかを確認しましょう。\n                \n                    &lt;table&gt;\n    &lt;tbody data-im-control=\"post\"&gt;\n    &lt;tr&gt;&lt;th&gt;名前&lt;/th&gt;&lt;td&gt;&lt;input type=\"text\" data-im=\"survey@Q5\"/&gt;&lt;/td&gt;&lt;/tr&gt;\n    &lt;tr&gt;&lt;th&gt;質問1&lt;/th&gt;&lt;td&gt;&lt;input type=\"text\" data-im=\"survey@Q1\"/&gt;&lt;/td&gt;&lt;/tr&gt;\n    &lt;tr&gt;&lt;th&gt;質問2&lt;/th&gt;\n    &lt;td&gt;&lt;input type=\"checkbox\" value=\"1\" data-im=\"survey@Q2\"/&gt;はい&lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;tr&gt;&lt;th&gt;&lt;/th&gt;&lt;td&gt;&lt;button data-im-control=\"post\"&gt;Answer&lt;/button&gt;&lt;/td&gt;&lt;/tr&gt;\n    &lt;/tbody&gt;\n&lt;/table&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n                \n                ラジオボタン\n                page01.htmlの中のTABLEタグの内容を以下の様に変更して、フォームを表示すると、ラジオボタンが追加されます。フォームに入力して、Answerボタンを押してみて、データベースにどのように入力されるのかを確認しましょう。\n                \n                    &lt;table&gt;\n    &lt;tbody data-im-control=\"post\"&gt;\n    &lt;tr&gt;&lt;th&gt;名前&lt;/th&gt;&lt;td&gt;&lt;input type=\"text\" data-im=\"survey@Q5\"/&gt;&lt;/td&gt;&lt;/tr&gt;\n    &lt;tr&gt;&lt;th&gt;質問1&lt;/th&gt;&lt;td&gt;&lt;input type=\"text\" data-im=\"survey@Q1\"/&gt;&lt;/td&gt;&lt;/tr&gt;\n    &lt;tr&gt;&lt;th&gt;質問2&lt;/th&gt;\n    &lt;td&gt;&lt;input type=\"checkbox\" value=\"1\" data-im=\"survey@Q2\"/&gt;はい&lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;tr&gt;&lt;th&gt;質問3&lt;/th&gt;\n    &lt;td&gt;&lt;div&gt;\n    &lt;input type=\"radio\" value=\"11\" name=\"q3\" data-im=\"survey@Q3\"/&gt;東\n    &lt;input type=\"radio\" value=\"12\" name=\"q3\" data-im=\"survey@Q3\"/&gt;西\n    &lt;input type=\"radio\" value=\"13\" name=\"q3\" data-im=\"survey@Q3\"/&gt;南\n    &lt;input type=\"radio\" value=\"14\" name=\"q3\" data-im=\"survey@Q3\"/&gt;北\n    &lt;/div&gt;&lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;tr&gt;&lt;th&gt;&lt;/th&gt;&lt;td&gt;&lt;button data-im-control=\"post\"&gt;Answer&lt;/button&gt;&lt;/td&gt;&lt;/tr&gt;\n    &lt;/tbody&gt;\n&lt;/table&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n                \n                チェックボックスセット\n                page01.htmlの中のTABLEタグの内容を以下の様に変更して、フォームを表示すると、チェックボックスセットが追加されます。フォームに入力して、Answerボタンを押してみて、データベースにどのように入力されるのかを確認しましょう。\n                \n                    &lt;table&gt;\n    &lt;tbody data-im-control=\"post\"&gt;\n    &lt;tr&gt;&lt;th&gt;名前&lt;/th&gt;&lt;td&gt;&lt;input type=\"text\" data-im=\"survey@Q5\"/&gt;&lt;/td&gt;&lt;/tr&gt;\n    &lt;tr&gt;&lt;th&gt;質問1&lt;/th&gt;&lt;td&gt;&lt;input type=\"text\" data-im=\"survey@Q1\"/&gt;&lt;/td&gt;&lt;/tr&gt;\n    &lt;tr&gt;&lt;th&gt;質問2&lt;/th&gt;\n    &lt;td&gt;&lt;input type=\"checkbox\" value=\"1\" data-im=\"survey@Q2\"/&gt;はい&lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;tr&gt;&lt;th&gt;質問3&lt;/th&gt;\n    &lt;td&gt;&lt;div&gt;\n    &lt;input type=\"radio\" value=\"11\" name=\"q3\" data-im=\"survey@Q3\"/&gt;東\n    &lt;input type=\"radio\" value=\"12\" name=\"q3\" data-im=\"survey@Q3\"/&gt;西\n    &lt;input type=\"radio\" value=\"13\" name=\"q3\" data-im=\"survey@Q3\"/&gt;南\n    &lt;input type=\"radio\" value=\"14\" name=\"q3\" data-im=\"survey@Q3\"/&gt;北\n    &lt;/div&gt;&lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;tr&gt;&lt;th&gt;質問4&lt;/th&gt;\n    &lt;td&gt;&lt;div data-im-group=\"survey@Q4\"&gt;\n    &lt;input type=\"checkbox\" value=\"21\"/&gt;Docomo\n    &lt;input type=\"checkbox\" value=\"22\"/&gt;au\n    &lt;input type=\"checkbox\" value=\"23\"/&gt;Softbank\n    &lt;input type=\"checkbox\" value=\"24\"/&gt;Willcom\n    &lt;/div&gt;&lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;tr&gt;&lt;th&gt;&lt;/th&gt;&lt;td&gt;&lt;button data-im-control=\"post\"&gt;Answer&lt;/button&gt;&lt;/td&gt;&lt;/tr&gt;\n    &lt;/tbody&gt;\n&lt;/table&gt;\n                \n                1-4：回答を一覧表示する\n                定義ファイルの作成（ファイル名：def02.php）\n                \n                    VMのホームで、「def02.phpを編集」をクリックします。\n                    Queryの下にある行の右側の「削除」をクリックして、Queryの下に行がないようにします。\n                    Sortingの下にある行の右側の「削除」をクリックして、Sortingの下に行がないようにします。\n                    nameに「survey」、keyに「id」と入力します。recordsには「10」、maxrecordsにも「10」と入力します。\n                    Optionsセクションには何も入力されていない状態のままでかまいません。\n                    \n                        \n                            [FileMaker Server] Database Settingsセクションのdb-classには「FileMaker_FX」、databaseには「TestDB」、userには「web」、passwordには「password」、serverには「192.168.56.1」、portには「80」、protocolには「http」、datatypeには「FMPro12」と入力します。\n                            [MySQL] Database Settingsセクションのdb-classには「PDO」、dsnには「mysql:host=localhost;dbname=test_db;charset=utf8mb4」、userには「web」、passwordには「password」と入力します。\n                        \n                    \n                    Debugのところは「false」と入力します。\n                \n                ページファイルの作成（ファイル名：page02.html）\n                \n                    VMのホームで、「page02.htmlを編集」をクリックします。\n                    ページファイルエディターが起動します。以下のソースコードを入力します。\n                \n                \n                    &lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" /&gt;\n    &lt;title&gt;INTER-Mediator Demo&lt;/title&gt;\n    &lt;script type=\"text/javascript\" src=\"def02.php\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;table&gt;\n    &lt;thead&gt;\n        &lt;tr&gt;&lt;th&gt;id&lt;/th&gt;&lt;th&gt;名前&lt;/th&gt;\n        &lt;th&gt;質問1&lt;/th&gt;&lt;th&gt;質問2&lt;/th&gt;\n        &lt;th&gt;質問3&lt;/th&gt;&lt;th&gt;質問4&lt;/th&gt;&lt;/tr&gt;\n    &lt;/thead&gt;\n    &lt;tbody&gt;\n        &lt;tr&gt;\n            &lt;td data-im=\"survey@id\"&gt;&lt;/td&gt;\n            &lt;td data-im=\"survey@Q5\"&gt;&lt;/td&gt;\n            &lt;td data-im=\"survey@Q1\"&gt;&lt;/td&gt;\n            &lt;td data-im=\"survey@Q2\"&gt;&lt;/td&gt;\n            &lt;td data-im=\"survey@Q3\"&gt;&lt;/td&gt;\n            &lt;td data-im=\"survey@Q4\"&gt;&lt;/td&gt;\n        &lt;/tr&gt;\n    &lt;/tbody&gt;\n&lt;/table&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n                \n                \n                    VMのホームで、「page02.htmlを表示する」をクリックします。回答一覧が表示されました。\n                \n                ページネーション、追加、削除\n                \n                    VMのホームで、「def02.phpを編集」をクリックするか、すでに開いている定義ファイルエディターのページを参照します。\n                    pagingに「true」、repeat-controlに「confirm-insert confirm-delete」と入力します。\n                    VMのホームで、「page02.htmlを編集」をクリックするか、あるいはすでに開いているページファイルエディターを表示して。以下のソースコードを入力します。「名前」の列はテキストフィールドにします。\n                \n                \n                    &lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" /&gt;\n    &lt;title&gt;INTER-Mediator Demo&lt;/title&gt;\n    &lt;script type=\"text/javascript\" src=\"def02.php\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;div id=\"IM_NAVIGATOR\"&gt;&lt;/div&gt;\n&lt;table&gt;\n    &lt;thead&gt;\n        &lt;tr&gt;&lt;th&gt;名前&lt;/th&gt;&lt;th&gt;質問1&lt;/th&gt;&lt;th&gt;質問2&lt;/th&gt;\n        &lt;th&gt;質問3&lt;/th&gt;&lt;th&gt;質問4&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;/tr&gt;\n    &lt;/thead&gt;\n    &lt;tbody&gt;\n        &lt;tr&gt;\n            &lt;td&gt;&lt;input type=\"text\" data-im=\"survey@Q5\"/&gt;&lt;/td&gt;\n            &lt;td data-im=\"survey@Q1\"&gt;&lt;/td&gt;\n            &lt;td data-im=\"survey@Q2\"&gt;&lt;/td&gt;\n            &lt;td data-im=\"survey@Q3\"&gt;&lt;/td&gt;\n            &lt;td data-im=\"survey@Q4\"&gt;&lt;/td&gt;\n            &lt;td&gt;&lt;/td&gt;\n        &lt;/tr&gt;\n    &lt;/tbody&gt;\n&lt;/table&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n                \n                \n                    VMのホームで、「page02.htmlを表示する」をクリックするか、すでに表示されているのならそのページを更新します。回答一覧が表示されました。\n                    レコードの追加削除ができることを確認します。\n                    名前の文字列を修正して、Tabキーを押し、データベースの内容を確認して、データの修正ができることを確認します。\n                    10レコード以上に増やしてみて、10レコードずつ表示されることを確認します。\n                \n            \n            \n                セッション2：住所録\n                定義ファイルの作成（ファイル名：def03.php）\n                \n                    VMのホームで、「def03.phpを編集」をクリックします。\n                    Queryの下にある行の右側の「削除」をクリックして、Queryの下に行がないようにします。\n                    Sortingの下にある行の右側の「削除」をクリックして、Sortingの下に行がないようにします。\n                    \n                        \n                            [FileMaker Server] nameに「person_list」、tableを「person_layout」、viewに「person_layout」、keyに「-recid」、pagingに「true」、repeat-controlに「insert」、recordsに「10」、maxrecordsに「100」と入力します。他は空白にします。\n                            [MySQL] nameに「person_list」、keyに「id」、viewに「person」、pagingに「true」、repeat-controlに「insert」、recordsに「10」、maxrecordsに「100」と入力します。他は空白にします。\n                        \n                    \n                    Optionsセクションには何も入力されていない状態のままでかまいません。\n                    \n                        \n                            [FileMaker Server] Database Settingsセクションのdb-classには「FileMaker_FX」、databaseには「TestDB」、userには「web」、passwordには「password」、serverには「192.168.56.1」、portには「80」、protocolには「http」、datatypeには「FMPro12」と入力します。\n                            [MySQL] Database Settingsセクションのdb-classには「PDO」、dsnには「mysql:host=localhost;dbname=test_db;charset=utf8mb4」、userには「web」、passwordには「password」と入力します。\n                        \n                    \n                    Debugのところは「false」と入力します。\n                \n                ページファイルの作成（ファイル名：page03.html）\n                \n                    VMのホームで、「page03.htmlを編集」をクリックします。\n                    ページファイルエディターが起動します。以下のソースコードを入力します。\n                \n                \n                    &lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" /&gt;\n    &lt;title&gt;INTER-Mediator Demo&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" type=\"text/css\" href=\"INTER-Mediator/Samples/sample.css\"&gt;\n    &lt;script type=\"text/javascript\" src=\"def03.php\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;div id=\"IM_NAVIGATOR\"&gt;&lt;/div&gt;\n&lt;table&gt;\n    &lt;tbody&gt;\n        &lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;td data-im=\"person_list@name\"&gt;&lt;/td&gt;&lt;/tr&gt;\n    &lt;/tbody&gt;\n&lt;/table&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n                \n                \n                    VMのホームで、「page03.htmlを表示する」をクリックします。適当な一覧が見えています。\n                \n                コンテキストの追加（ファイル名：def03.php）\n                \n                    VMのホームで、「def03.phpを編集」をクリックするか、すでに開いている定義ファイルエディターのページを参照します。\n                    Contextsの下の「追加」ボタンをクリックします。nameが「= new context =」の項目が増えました。\n                    \n                        \n                            [FileMaker Server] 増えた項目で、nameを「person_detail」、tableを「person_layout」、viewを「person_layout」、keyを「-recid」、recordsを「1」、maxrecordsを「100」として、あとは空白のままにします。\n                            [MySQL] 増えた項目で、nameを「person_detail」、viewを「person」、keyを「id」、recordsを「1」、maxrecordsを「100」として、あとは空白のままにします。\n                        \n                    \n                \n                ページファイルの作成（ファイル名：page03.html）\n                \n                    VMのホームで、「page03.htmlを編集」をクリックするか、すでに開いている場合にはそのページを更新します。\n                    ページファイルエディターで、以下のソースコードを変更します。\n                \n                \n                    &lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" /&gt;\n    &lt;title&gt;INTER-Mediator Demo&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" type=\"text/css\" href=\"INTER-Mediator/Samples/sample.css\"&gt;\n    &lt;script type=\"text/javascript\" src=\"def03.php\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;div id=\"IM_NAVIGATOR\"&gt;&lt;/div&gt;\n  &lt;table&gt;\n    &lt;tbody&gt;\n        &lt;tr&gt;&lt;td data-im=\"person_list@name\"&gt;&lt;/td&gt;&lt;/tr&gt;\n    &lt;/tbody&gt;\n  &lt;/table&gt;\n  &lt;table&gt;\n    &lt;tbody&gt;\n      &lt;tr&gt;\n        &lt;th&gt;名前&lt;/th&gt;\n        &lt;td&gt;&lt;input type=\"text\" data-im=\"person_detail@name\"/&gt;&lt;/td&gt;\n      &lt;/tr&gt;\n      &lt;tr&gt;\n        &lt;th&gt;住所&lt;/th&gt;\n        &lt;td&gt;&lt;input type=\"text\" data-im=\"person_detail@address\"/&gt;&lt;/td&gt;&lt;/tr&gt;\n      &lt;tr&gt;\n        &lt;th&gt;メール&lt;/th&gt;\n        &lt;td&gt;&lt;input type=\"text\" data-im=\"person_detail@mail\"/&gt;&lt;/td&gt;\n      &lt;/tr&gt;\n      &lt;tr&gt;\n        &lt;th&gt;地域&lt;/th&gt;\n        &lt;td&gt;&lt;input type=\"text\" data-im=\"person_detail@location\"/&gt;&lt;/td&gt;\n      &lt;/tr&gt;\n      &lt;tr&gt;\n        &lt;th&gt;分類&lt;/th&gt;\n        &lt;td&gt;&lt;input type=\"text\" data-im=\"person_detail@category\"/&gt;&lt;/td&gt;\n      &lt;/tr&gt;\n      &lt;tr&gt;\n        &lt;th&gt;メモ&lt;/th&gt;\n        &lt;td&gt;&lt;textarea data-im=\"person_detail@memo\"&gt;&lt;/textarea&gt;&lt;/td&gt;\n      &lt;/tr&gt;\n    &lt;/tbody&gt;\n  &lt;/table&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n                \n                \n                    VMのホームで、「page03.htmlを表示する」をクリックするか、すでに表示されているページを更新します。一覧の下に、なんとなく、編集フォームのようなものが登場しました。\n                \n                iPadのようなナビゲーションを実現する\n                \n                    page03.htmlの編集ページを表示します。以下の様に、2つあるTABLEタグにstyle属性を設定します。また、最後のTABLE閉じタグのあとに、BRタグを追加します。\n                \n                \n                    &lt;table style=\"float: left\"&gt;\n    :\n&lt;/table&gt;\n&lt;table style=\"float: left; margin-left: 12px\"&gt;\n    :\n&lt;/table&gt;\n&lt;br clear=\"all\"/&gt;\n                \n                \n                    VMのホームで、「page03.htmlを表示する」をクリックするか、すでに表示されているページを更新します。一覧と詳細が左右に分離しました。\n                    VMのホームで、「def03.phpを編集」をクリックするか、すでに開いている定義ファイルエディターのページを参照します。\n                    nameが「person_list」の方のnavi-controlを「master-hide」にします。\n                    nameが「person_detail」の方のnavi-controlを「detail」にします。\n                    VMのホームで、「page03.htmlを表示する」をクリックするか、すでに表示されているページを更新します。一覧と詳細を行き来するユーザインタフェースができあがりました。\n                    nameが「person_list」の方のnavi-controlを「master」にします。\n                    VMのホームで、「page03.htmlを表示する」をクリックするか、すでに表示されているページを更新します。スプリットビュー的な表示になりました。\n                \n            \n            \n                セッション3：伝票とリレーションシップ\n                \n                    def04.phpに、以下の様に3つのコンテキストの定義を行います。このセッションから、細かな手順の説明は行いません。定義ファイルエディターで開き、Show Allボタンを押して、全項目を表示しながら作業をしましょう。\n                \n                \n                    name: invoice\nkey: id\npaging: true\nrepeat-control: confirm-insert confirm-delete\nrecords: 1\nmaxrecords: 100\nCalculation:\n    [field: total_calc, expression: format(sum(item@amount_calc), 0)]\n\nname: item\nkey: id\nrepeat-control: confirm-insert confirm-delete\nrecords: 100\nmaxrecords: 100\nRelationship:\n    [foreign-key: invoice_id, join-field: id, operator: =] 　// ←[MySQL]の場合\n    [foreign-key: invoice_id, join-field: id, operator: eq]  // ←[FileMaker Server]の場合\nCalculation:\n    [field: amount_calc, expression: format(qty * product@unitprice, 0)]\n\nname: product\nkey: id\nrecords: 100\nmaxrecords: 100\nRelationship:\n    [foreign-key: id, join-field: product_id, operator: =] 　// ←[MySQL]の場合\n    [foreign-key: id, join-field: product_id, operator: eq]  // ←[FileMaker Server]の場合\n                \n                \n                    Database Settingsの設定は、前のセッションと同一にします。\n                    \n                        [FileMaker Server] Database Settingsセクションのdb-classには「FileMaker_FX」、databaseには「TestDB」、userには「web」、passwordには「password」、serverには「192.168.56.1」、portには「80」、protocolには「http」、datatypeには「FMPro12」と入力します。\n                        [MySQL] Database Settingsセクションのdb-classには「PDO」、dsnには「mysql:host=localhost;dbname=test_db;charset=utf8mb4」、userには「web」、passwordには「password」と入力します。\n                    \n                \n                \n                    page04.htmlは以下の様に入力します。\n                \n                \n                    &lt;!DOCTYPE html&gt;\n&lt;html lang=\"ja\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\"&gt;\n    &lt;title&gt;&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" type=\"text/css\" href=\"INTER-Mediator/Samples/sample.css\"&gt;\n     &lt;script type=\"text/javascript\" src=\"def04.php\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;div id=\"IM_NAVIGATOR\"&gt;&lt;/div&gt;\n&lt;table border=\"1\"&gt;\n    &lt;tbody&gt;\n    &lt;tr&gt;\n        &lt;th&gt;id&lt;/th&gt;\n        &lt;td&gt;&lt;input type=\"text\" data-im=\"invoice@id\"&gt;&lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;tr&gt;\n        &lt;th&gt;issued&lt;/th&gt;\n        &lt;td&gt;&lt;input type=\"text\" data-im=\"invoice@issued\" value=\"\"&gt;&lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;tr&gt;\n        &lt;th&gt;title&lt;/th&gt;\n        &lt;td&gt;&lt;input type=\"text\" data-im=\"invoice@title\" value=\"\"&gt;&lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;tr&gt;\n        &lt;td colspan=\"2\"&gt;\n            &lt;table border=\"1\"&gt;\n                &lt;thead&gt;\n                &lt;tr&gt;\n                    &lt;th&gt;product&lt;/th&gt;\n                    &lt;th&gt;qty&lt;/th&gt;\n                    &lt;th&gt;unitprice (master)&lt;/th&gt;\n                    &lt;th&gt;amount&lt;/th&gt;\n                    &lt;th&gt;&lt;/th&gt;\n                &lt;/tr&gt;\n                &lt;/thead&gt;\n                &lt;tbody&gt;\n                &lt;tr&gt;\n                    &lt;td&gt;\n                       &lt;input type=\"text\" data-im=\"item@product_id\" size=\"2\"&gt;\n                       &lt;span class=\"inline\" data-im-control=\"enclosure\"&gt;\n                            &lt;span class=\"inline\" data-im-control=\"repeater\" data-im=\"product@name\"&gt;&lt;/span&gt;\n                        &lt;/span&gt;\n                    &lt;/td&gt;\n                    &lt;td&gt;&lt;input class=\"price\" type=\"text\" data-im=\"item@qty\" size=\"5\"&gt;&lt;/td&gt;\n                    &lt;td&gt;\n                        &lt;span class=\"inline\" data-im-control=\"enclosure\"&gt;\n                            &lt;span class=\"inline\" data-im-control=\"repeater\" data-im=\"product@unitprice\"&gt;&lt;/span&gt;\n                        &lt;/span&gt;\n                      &lt;/td&gt;\n                   &lt;td align=\"right\"&gt;\n                      &lt;span align=\"right\" data-im=\"item@amount_calc\"&gt;&lt;/span&gt;\n                  &lt;/td&gt;\n                  &lt;td&gt;&lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;/tbody&gt;\n            &lt;/table&gt;\n        &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;tr&gt;\n        &lt;th&gt;Total:&lt;/th&gt;\n        &lt;td data-im=\"invoice@total_calc\"&gt;&lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;/tbody&gt;\n&lt;/table&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n                \n                \n                    実行します。以下の点を確認しましょう。\n                \n                \n                    伝票での明細行に相当する仕組みがリレーションシップにより取り出されています。\n                    明細の各行では、商品マスターからの商品名と単価の取り出しが行われています。\n                    productの数字を書き換えると、商品マスターの違うレコードが取り出されます。\n                    qtyを変更すると、単価x個数が計算され直され、トータルも再計算されています。\n                \n            \n            \n                セッション4：資産管理\n                アプリケーションの動作の確認\n                このセッションでは、INTER-Mediatorのサンプルにあるアプリケーションの動作を調べて、アプリケーションの改変を行います。\n                \n                    VMのホーム（http://192.168.56.101/ で表示されるページ）開きます。\n                    「リンク」の中に、「サンプルプログラム」というリンク文字列があります。こちらをクリックします。\n                    「INTER-Mediator Samples」というページが表示されます。この中の、Asset Management Sampleという行を特定します。\n                    MySQLあるいはFileMakerの列の「Improved」というリンクをクリックします。\n                    どこかの会社の機材の管理データベースのようです。まず、このファイルのファイル名をメモしてください。\n                        ＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿\n                    「詳細」ボタンを押してみます。詳細部分が表示されました。\n                    その機材の貸出履歴が出てきました。\n                    「追加」ボタンをクリックすると、現在の日付が「貸出日」に設定されて新たなレコードが追加されます。担当者やメモは適当に設定します。\n                    「本日返却」ボタンをクリックすると、返却日が空欄の貸出履歴に、本日の日付が設定されました。\n                    いくつかのレコードをみて、動作を確認します。\n                \n                ページファイルの確認\n                \n                    このアプリケーションのソースプログラムは、こちらで参照できます。\n                    ページファイルを開いて内容を参照してください。\n                    定義ファイルのファイル名はなんでしょうか？\n                        ＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿\n                    それぞれのTABLEタグによるテーブル内で使用されているコンテキスト名はなんでしょうか？\n                        1つ目のTABLEタグ内＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿\n                        2つ目のTABLEタグ内＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿\n                        上記の内部のTABLEタグ内＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿\n                        上記の内部のSELECTタグ内＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿\n                    JavaScriptのプログラムにあるsetBackDate関数は、「本日返却」ボタンをクリックしたときに呼び出されます。以下の情報手掛かりにプログラムを解析しましょう。\n                        \n                            generateToday関数は現在の日付を文字列で返す関数です。\n                            IMLibContextPool.getContextFromName(contextName)は、引数に指定したコンテキスト名のコンテキストオブジェクトを返します。コンテキストオブジェクトは、そのコンテキストに対する取得したデータを保持している「モデル」相当のオブジェクトです。\n                            コンテキストオブジェクトに対して、setDataAtLastRecord(field, value)を実行すると、コンテキストの最後のレコードのfieldの値をvalueにして、それを参照している箇所を更新するとともに、データベースへの書き込みを行います。\n                        \n                    \n                \n                定義ファイルの確認\n                \n                    こちらのページに戻ります。\n                    前に調べた名称の定義ファイルを開きます。定義ファイルエディターで開く場合には、こちらをクリックします。\n                    navi-controlキーが設定されているコンテキストを確認します。実際の動作と比べて、このキーによる設定がどのように適用されているのかを検討してみましょう。\n                    使用されていないコンテキストがあります。どれでしょうか？\n                        ＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿\n                    使用されていないコンテキストがあります。どれでしょうか？\n                        ＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿\n                    nameキーがrentのコンテキストの定義を参照してください。ここにあるrelationの設定により上位のコンテキストの値を元に検索を行っています。\n                    rentコンテキストのcalculationキーにある計算式を参照してください。計算式の意味を考えてください。そして、そのfieldキーの値を書き出しておきます。\n                        fieldキー：＿＿＿＿＿＿＿＿式の意味：＿＿＿＿＿＿＿＿＿＿\n                    assetdetailコンテキストのcalculationキーにある計算式を参照してください。計算式の意味を考えてください。そして、そのfieldキーの値を書き出しておきます。\n                        fieldキー：＿＿＿＿＿＿＿＿式の意味：＿＿＿＿＿＿＿＿＿＿\n                \n                アプリケーションの改造\n                \n                    ページファイルエディターで開きます。こちらより開くことができます。\n                    これまでに調べたことを応用して、次の設定を行ってください。\n                        \n                            貸出履歴のそれぞれの項目に、貸出期間の日数を表示してください。\n                            それぞれの機材に対する平均貸出日数を表示してください。\n                        \n                    \n                \n            \n            \n                セッション5：BBS\n                \n                    def05.phpに2つのコンテキストの定義を行います。定義ファイルエディターで開き、Show Allボタンを押して、全項目を表示しながら作業をしましょう。\n                \n                \n                    name: message\ntable: chat\nview: chat\nkey: id\npost-reconstruct: true\npost-dismiss-message: 投稿しました\nquery: \n    [field: groupname , operator: IS NULL, value:]　// ←[MySQL]の場合\n    [field: groupname, operator: eq, value: =]  // ←[FileMaker Server]の場合\nsorting:\n    [field: postdt, direction: desc]\nvalidation: \n    [field: user, rule: value !=  '', message: 入力してください。]\n    [field: message, rule: value !=  '', message: 入力してください。]\n\nname:comment\ntable: chat\nview: chat\nkey: id\npost-reconstruct: true\npost-dismiss-message: 投稿しました\nrelationship:\n    [foreign-key: groupname, join-field: id, operator: =]　// ←[MySQL]の場合\n    [foreign-key: groupname, join-field: id, operator: eq]　// ←[FileMaker Server]の場合\nsorting:\n    [field: postdt, direction: desc]\nvalidation: \n    [field: user, rule: value !=  '', message: 入力してください。]\n    [field: message, rule: value !=  '', message: 入力してください。]\n                \n                \n                    定義ファイルエディターで開いたdef05.phpに対して、以下のようにOptionsの設定を行います。\n                \n                \n                    formatters:\n   [field: chat@message, converter-class: HTMLString]\n                \n                \n                    Database Settingsの設定は、前のセッションと同一にします。\n                        \n                            [FileMaker Server] Database Settingsセクションのdb-classには「FileMaker_FX」、databaseには「TestDB」、userには「web」、passwordには「password」、serverには「192.168.56.1」、portには「80」、protocolには「http」、datatypeには「FMPro12」と入力します。\n                            [MySQL] Database Settingsセクションのdb-classには「PDO」、dsnには「mysql:host=localhost;dbname=test_db;charset=utf8mb4」、userには「web」、passwordには「password」と入力します。\n                        \n                    \n                \n                \n                    page05.htmlは以下の様に入力します。\n                \n                \n                    &lt;!DOCTYPE html&gt;\n&lt;html lang=\"ja\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\"&gt;\n    &lt;title&gt;&lt;/title&gt;\n    &lt;script type=\"text/javascript\" src=\"def05.php\"&gt;&lt;/script&gt;\n    &lt;script type=\"text/javascript\"&gt;\n        INTERMediatorOnPage.processingBeforePostOnlyContext = function (node) {\n            var dtString, nodeIds, idValue, aNode;\n            dtString = INTERMediatorLib.dateTimeStringISO();　// ←[MySQL]の場合\n            dtString = INTERMediatorLib.dateTimeStringFileMaker(); // ←[FileMaker Server]の場合\n            nodeIds = INTERMediatorOnPage.getNodeIdsHavingTargetFromNode(node, \"message@postdt\");\n            if (nodeIds.length &gt; 0) {\n                document.getElementById(nodeIds[0]).value = dtString;\n            }\n            nodeIds = INTERMediatorOnPage.getNodeIdsHavingTargetFromNode(node, \"comment@message\");\n            if (nodeIds.length &gt; 0) {\n                aNode = node.parentNode.parentNode.parentNode;\n                nodeIds = INTERMediatorOnPage.getNodeIdsHavingTargetFromNode(aNode, \"message@id\");\n                idValue = document.getElementById(nodeIds[0]).value;\n                INTERMediator.additionalFieldValueOnNewRecord = {};\n                INTERMediator.additionalFieldValueOnNewRecord['comment'] = [\n                    {field: \"groupname\", value: idValue},\n                    {field: \"postdt\", value: dtString}\n                ];\n            }\n            return true;\n        };\n    &lt;/script&gt;\n    &lt;style&gt;\n        TEXTAREA {\n            width: 400px;\n            height: 60px;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;table&gt;\n    &lt;tbody data-im-control=\"post\"&gt;\n    &lt;tr&gt;\n        &lt;th&gt;From:&lt;/th&gt;\n        &lt;td&gt;\n            &lt;input type=\"text\" data-im=\"message@user\"&gt;\n            &lt;input type=\"hidden\" data-im=\"message@postdt\"&gt;\n        &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;tr&gt;\n        &lt;td colspan=\"2\"&gt;\n            &lt;textarea data-im=\"message@message\"&gt;&lt;/textarea&gt;\n            &lt;button data-im-control=\"post\"&gt;投稿&lt;/button&gt;\n        &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;/tbody&gt;\n&lt;/table&gt;\n&lt;table&gt;\n    &lt;tbody&gt;\n    &lt;tr&gt;\n        &lt;td colspan=\"4\"&gt;\n            &lt;hr/&gt;\n        &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;tr&gt;\n        &lt;th&gt;From:&lt;/th&gt;\n        &lt;td data-im=\"message@user\"&gt;&lt;/td&gt;\n        &lt;th&gt;Date:&lt;/th&gt;\n        &lt;td data-im=\"message@postdt\"&gt;&lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;tr&gt;\n        &lt;td colspan=\"4\" data-im=\"message@message@innerHTML\"\n            style=\"background-color: #CCCCCC\"&gt;&lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;tr&gt;\n        &lt;td style=\"width: 50px; background-color: gray\"&gt;Comment&lt;/td&gt;\n        &lt;td colspan=\"3\"&gt;\n            &lt;input type=\"hidden\" data-im=\"message@id\"/&gt;\n            &lt;table&gt;\n                &lt;tbody data-im-control=\"post\"&gt;\n                &lt;tr&gt;\n                    &lt;th&gt;From:&lt;/th&gt;\n                    &lt;td&gt;\n                        &lt;input type=\"text\" data-im=\"comment@user\"&gt;\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td colspan=\"2\"&gt;&lt;textarea data-im=\"comment@message\"&gt;&lt;/textarea&gt;\n                        &lt;button data-im-control=\"post\"&gt;投稿&lt;/button&gt;\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;/tbody&gt;\n            &lt;/table&gt;\n            &lt;table&gt;\n                &lt;tbody&gt;\n                &lt;tr&gt;\n                    &lt;th&gt;From:&lt;/th&gt;\n                    &lt;td data-im=\"comment@user\"&gt;&lt;/td&gt;\n                    &lt;th&gt;Date:&lt;/th&gt;\n                    &lt;td data-im=\"comment@postdt\"&gt;&lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;tr&gt;\n                    &lt;td colspan=\"4\" data-im=\"comment@message@innerHTML\"\n                        style=\"background-color: #CCCCCC\"&gt;&lt;/td&gt;\n                &lt;/tr&gt;\n                &lt;/tbody&gt;\n            &lt;/table&gt;\n        &lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;/tbody&gt;\n&lt;/table&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n                \n                \n                    実行します。以下の点を確認しましょう。\n                \n                \n                    最初は単にフォームだけが表示されています。「投稿」ボタンをクリックしても、何も入力しないと警告が表示され、メッセージは追加されません。\n                    Fromに自分の名前、messageに適当なメッセージを入力して「投稿」ボタンをクリックします。入力したメッセージが表示されましたが、同時に投稿ボタンを押した日時も設定されています。\n                    ページの最初のテキスト領域を利用して、メッセージを3つほど入力します。メッセージは、日付の逆順に表示されています。\n                    2つ目のメッセージの直後にも、Formとメッセージの記入部分があります。こちらにも入力をして「投稿」ボタンをクリックします。こちらは、該当メッセージへのコメントになります。いくつかコメントを追加してください。コメントも、日付が自動的に設定され、日付の逆順で表示されます。異なるルートメセージにコメントを記入し、正しいメッセージの後に付随していることを確認します。\n                    メッセージはテキストエリアです。改行を含むメッセージを入力してみてください。正しく、改行も表示されています。\n                    メッセージにJavaScriptのプログラムを、たとえば「&lt;script&gt;alert(9)&lt;/script&gt;」のように記述して投稿してみます。タグはHTMLのタグとして解釈はされず、記述した通りの文字列で表示されます。\n                    ページファイルには少し長いプログラムが入力されています。INTERMediatorOnPage.processingBeforePostOnlyContextは、「投稿」ボタンを押した直後で、データベース処理を行う前に呼び出されます。何をしているのかを以下の手がかりをもとに検討してみましょう。\n                        \n                            INTERMediatorLib.dateTimeStringISO()、INTERMediatorLib.dateTimeStringFileMaker()：現在の日時を返す\n                            INTERMediatorOnPage.getNodeIdsHavingTargetFromNode(node, target)：node以下、指定されたtargetを持つ要素のid属性値を配列で返す\n                            document.getElementById(idValue)：指定したid属性値の要素への参照を得る\n                            node.parentNode：nodeの親ノードへの参照を得る\n                            INTERMediator.additionalFieldValueOnNewRecord：新規レコードを作ったときの既定値を定める。最初のプロパティはコンテキスト名で、それに対してフィールド名と値を指定したオブジェクトの配列を与える\n                        \n                    \n                    \n                        最小限の機能ですが、あっという間にBBSが完成しました。HTMLコードはコピペして作っていただきましたが、15分から30分くらいでできたのではないでしょうか？　INTER-Mediatorを使えば、Webアプリケーションが簡単に構築できることがお分かりいただけたでしょうか？\n                    \n                \n                アプリケーションの改造\n                コメントの並び方を改良\n                先ほど作ったBBSのページを開きます。こちらより開くことができます。試しにメッセージを二つ以上投稿し、さらに、一番上に表示されているメッセージに二つ以上のコメントを投稿してみてください。\n                どうでしょうか。投稿されたコメントは読みやすい並びに表示されていますか？　\n                メッセージは新しいものほど上の方に表示されていて話の流れについて行きやすくなっていますが、コメントも同じように上から新しいものが並んでいます。誰かの発言に関連するコメントは、古いものから順番に読んで行かなければ話の流れをつかむことができません。Facebookなどのタイムラインも、メッセージは新しいものから、コメントは古いものから順に並んでいますよね。\n                では、これまで学んだことから、どこをどのようの修正すればいいか、考えてみてください。\n                コメントを表示させているコンテキストは何でしょう？＿＿＿＿＿＿＿＿＿＿＿＿\n                Sortingの方向（direction）を降順に指定するパラメーターは英語のdescendingを略したdescでした。昇順は英語でascendingと言います。パラメータはどう指定すればいいでしょうか？＿＿＿＿＿＿＿＿＿＿＿＿\n                実際に改修作業を進めて行きましょう。\n                     あるコンテキストの中に表示されるデータベース項目の順序は定義ファイルを設定することでコントロールできます。\n                \n                \n                    INTER-Mediatorトライアルのトップページに戻ります。\n                    定義ファイル def05.php を特定し、クリックします。定義ファイルエディターが開きます。 \n                    コンテキスト「name: comment」を特定し、Sorting項目のdirectionを昇順を意味するascに変更します。タブキーを押して変更したことを定義ファイルエディターにしっかりと伝えてください。\n                    では、再びBBSのページを表示させてください。一旦画面をリフレッシュします。\n                         どうでしょうか、メッセージの並びは登録日時の降順に、コメントは昇順になったでしょうか？\n                    \n                \n                簡単な作業でデータベースから取得した項目の表示順を切替えることができましたね。他に何か不都合なことはありませんでしょうか？\n                コメント入力の位置をコメントの後に移動\n                メッセージにコメントを付け加えるための入力フィールドが、コメントの並びの一番上に位置しています。これはちょっと不便ですね。コメントは通常、たくさん付いたコメントの一番最新のコメントに対してさらに続けるという使い方が一般的です。そのような使い方をするときに、たくさん付いたコメントの一番先頭にコメント入力フィールドがあると、上下にスクロールさせながら入力しなければならなくなります。\n                これも、少し改造してみましょう。\n                コメントの入力フィールドの位置を、コメントの並びの最下段に移動させてみましょう。画面の表示場所などの指定はページファイルで行います。\n                \n                    INTER-Mediatorトライアルのトップページに戻ります。\n                    ページファイル page05.html を特定し、クリックします。ページファイルエディターが開きます。\n                    HTMLファイルの中身をざーっと眺めて、どの部分がどこの表示を担当しているのか、確認してください。コメントの詳細を表示している部分がどこなのか、分かりますね？　ヒントはコメントを投稿するためのテーブルタグ内に納められている、というところです。\n                         見つけましたか？　ではそのテーブルタグごと、位置を移動させてください。\n                    \n                    さて、作業完了しましたね？　再びBBSのページを表示させてください。一旦ブラウザーに見えている画面をリフレッシュします。\n                         どうでしょうか、コメントの入力フィールドはコメントの並びの最下段になったでしょうか？\n                \n                INTER-Mediatorを使ったWebアプリケーション開発はいかがだったでしょうか？\n                     このようにして基本の骨格を作り上げ、要望に応じて徐々に改良していく。とても効率的な開発プラットフォームですね。\n                \n                今日学んだことをベースに、こんなことはできないだろうか、あんな形式に変更はできないだろうか、といろいろと工夫をしながら開発スキルを深めて行ってください。\n            \n        "
    },
    {
        "id": 11,
        "parent": "/ja/for-novices/",
        "path": "/ja/for-novices/movies.html",
        "title": "ビデオで始めるINTER-Mediator",
        "breadcrumb": "ビデオで始めるINTER-Mediator",
        "body": "\n            \n                はじめに\n                INTER-MediatorあるいはWeb開発をこれから学習しようという方々に向けて、ビデオで画面操作をみながら学習可能なコンテンツを用意しました。それぞれ、QiitaのページとYouTubeのビデオを参照していただきます。\n            \n            \n                INTER-Mediatorを始めよう！\n                \n                    (TBD)\n                \n            \n            \n                VMを準備して試用できるようになるまで\n                \n                    INTER-Mediatorをはじめよう - バーチャルマシンの準備\n                    INTER-Mediatorをはじめよう - Webページを探索しよう\n                    INTER-Mediatorをはじめよう - INTER-Mediatorのアップデート\n                \n            \n            \n                ハンズオンを進めてみる\n                \n                    INTER-Mediatorのハンズオン - セッション1: 入力専用ページ\n                    INTER-Mediatorのハンズオン - セッション2: 住所録\n                    INTER-Mediatorのハンズオン - セッション3: 伝票とリレーション\n                    INTER-Mediatorのハンズオン - セッション4: 資産管理\n                    INTER-Mediatorのハンズオン - セッション5: ブログ\n                \n            \n        "
    },
    {
        "id": 12,
        "parent": "/ja/practices/",
        "path": "/ja/practices/practice-searchnp.html",
        "title": "検索をしてその結果を一覧表示する（プログラムなし版）",
        "breadcrumb": "検索結果の一覧表示（プログラムなし版）",
        "body": "\n            \n                はじめに\n                検索結果を一覧するというユーザーインタフェースはWebアプリケーションでは一般的に見られる仕組みです。その仕組みを、宣言的な記述のみで構築できるようになっています。\n                前提知識\n                INTER-Mediatorに関して、以下の内容をすでに知っている事を前提とします。\n                \n                    data-im属性への記述によりフィールドの内容が表示されること\n                    TABLEタグを使った表の中で、複数のレコードが繰り返し表示されるようになっていること\n                    一定数ごとのレコードを表示する仕組みと、表示範囲を切り替えるページネーションの仕組みがあること\n                    定義ファイルのコンテキストには、検索条件が指定できること\n                \n            \n            \n                作成例について\n                利用するデータベースは、郵便番号と地名が含まれているもので、サンプルのデータベースにあるpostalcodeという名称のものです。レポジトリ内では、Samples/Practices/search_page1.htmlを開く事で、実際に稼働させることができます。Samples/index.htmlにあるサンプルの一覧では「Practices」にある「search」の「search(no JavaScript)」のリンクをクリックして表示できます。\n                まず、どのような動作になるのかを見て行くことにしましょう。最初にページを開くと、郵便番号と地名がともかく一覧されています。サンプルのデータベースには、ある時期の東京都のデータのみを収録しています。検索条件は何もなく、おそらく全てのデータがリストされていると想定されます。ここで、ページネーション（ページ移動）の「&gt;」ボタンをクリックすると、次々と10件ずつレコードが表示されます。また、何件目のデータを現在表示しているのかという情報も見えています。\n                \n                \n                ここで、「検索条件」に適当な地名（ここでは「市谷」）を入力してReturnキーを押します（「Search」ボタンをクリックしてもかまいません）。すると、一覧表には、「市谷」を含む地名やビル名のものだけに絞り込まれました。全部で68件の地名があることが分かります。「&gt;」ボタンでページ移動ができますが、ページ移動後にも、検索条件はそのまま見えていることにも注意を払いましょう。\n                \n                \n                「表示件数」のポップアップメニューから「4」を選択すると、これまで10件ごとに表示されていた一覧表が、4件ごとの表示に切り替わります。切り替えると、以後、ずっと4件ずつ表示されるようになります。\n                \n                \n                検索条件に「171」と入力してReturnキーを押しました。すると、郵便番号に171が含まれる地名だけが絞り込まれています。また、ここで、「郵便番号」と書かれた右側の▼をクリックすると、郵便番号の逆順で表示されるようになりました。つまり、一覧表示が「郵便番号」の逆順にソートされて表示されるようになっています。「&lt;&lt;」ボタンを押して最初のページを表示すると、いちばん大きな数値になる郵便番号の地名が、リストの最初の行に見えています。\n                \n                \n                検索条件に、「市ヶ谷」という文字列を指定して検索してみます。検索結果が0件のときに表示する行が見えています。なお、東京には、市ヶ谷という駅はありますが、地名では「市谷」と記述しており、この名前の地名がないこともわかります。\n                \n                \n            \n            \n                定義ファイル\n                定義ファイルのSamples/Practices/search_def.phpの内容は以下の通りです。コンテキストは、postalcodeという名前のものが1つだけあり、これはテーブル名と同様なので、tableやviewキーの値は指定していません。1ページあたりのレコード数は20で、後からの変更をしても30より多くの数を一度にページに出す事はできません。そして、pagingキーがtrueなので、ページネーションのコントロールがページ上に表示されます。\n                データベースはMySQLを使うのでdb-classは「PDO」を指定していますが、FileMaker Server向けには設定が変わります。それ以外の接続情報、アカウント、パスワードは、INTER-Mediator/params.phpファイルにあるものをそのまま使います。\n                \n                    require_once(dirname(__FILE__) . '/../../INTER-Mediator.php');\n\nIM_Entry(\narray(\n    array(\n        'name' =&gt; 'postalcode',\n        'records' =&gt; 20,\n        'maxrecords' =&gt; 30,\n        'paging' =&gt; true,\n    ),\n),\nnull,\narray('db-class' =&gt; 'PDO'),\n    false\n);\n                \n            \n            \n                ページファイル\n                ページファイルについては、ボディ部のみを示します。もちろん、ヘッダ部で、前述の定義ファイルSCRIPTタグで読み込んだ状態になっています。このほかに何も読み込みは行っていません。つまり、このページは、プログラムとしては、BODYタグ要素のonload属性にあるINTERMediatorを動作させる1行だけなのです。\n                \n                    &lt;body onload=\"INTERMediator.construct()\"&gt;\n&lt;div&gt;\n    検索条件:\n    &lt;input type=\"text\" data-im=\"_@condition:postalcode:f3,f7,f8,f9:*match*\"&gt;\n    表示件数：\n    &lt;select type=\"text\" data-im=\"_@limitnumber:postalcode\"&gt;\n        &lt;option value=\"4\"&gt;4&lt;/option&gt;\n        &lt;option value=\"10\"&gt;10&lt;/option&gt;\n        &lt;option value=\"20\" selected&gt;20&lt;/option&gt;\n    &lt;/select&gt;\n    &lt;button data-im=\"_@update:postalcode\"&gt;search&lt;/button&gt;\n&lt;/div&gt;\n&lt;div id=\"IM_NAVIGATOR\"&gt;Navigation Controls by INTER-Mediator&lt;/div&gt;\n&lt;table border=\"1\" id=\"resultTable\"&gt;\n    &lt;thead&gt;\n    &lt;tr&gt;\n        &lt;th&gt;郵便番号\n            &lt;span style=\"cursor: pointer\" data-im=\"_@addorder:postalcode:f3:asc\"&gt;▲&lt;/span&gt;\n            &lt;span style=\"cursor: pointer\" data-im=\"_@addorder:postalcode:f3:desc\"&gt;▼&lt;/span&gt;\n        &lt;/th&gt;\n        &lt;th&gt;都道府県&lt;/th&gt;\n        &lt;th&gt;市区町村&lt;/th&gt;\n        &lt;th&gt;町域名\n            &lt;span style=\"cursor: pointer\" data-im=\"_@addorder:postalcode:f9:asc\"&gt;▲&lt;/span&gt;\n            &lt;span style=\"cursor: pointer\" data-im=\"_@addorder:postalcode:f9:desc\"&gt;▼&lt;/span&gt;\n        &lt;/th&gt;\n    &lt;/tr&gt;\n    &lt;/thead&gt;\n    &lt;tbody&gt;\n    &lt;tr&gt;\n        &lt;td&gt;&lt;div data-im=\"postalcode@f3\"&gt;&lt;/div&gt;&lt;/td&gt;\n        &lt;td&gt;&lt;div data-im=\"postalcode@f7\"&gt;&lt;/div&gt;&lt;/td&gt;\n        &lt;td&gt;&lt;div data-im=\"postalcode@f8\"&gt;&lt;/div&gt;&lt;/td&gt;\n        &lt;td&gt;&lt;div data-im=\"postalcode@f9\"&gt;&lt;/div&gt;&lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;tr data-im-control=\"noresult\"&gt;\n        &lt;td colspan=\"4\"&gt;検索結果はありません。あるいは検索前です。&lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;/tbody&gt;\n&lt;/table&gt;\n\n&lt;/body&gt;\n                \n            \n            \n                それぞれの動作の実現\n                一覧表示の実現\n                postalcodeテーブルでは、f3フィールドに郵便番号、f7〜f9フィールドに都道府県、市区町村、町域名が収められています。ページファイル内のTABLE要素によるテーブル部分で、その一覧表示を行っています。TBODYタグ要素の中には2つのTR要素があり、その最初の方の要素の子要素にTDがいくつかあり、そこにf3、f7〜f9のそれぞれのフィールドを示すターゲット指定がdata-im属性に設定されています。\n                postalcodeコンテキストに対して検索して得られた郵便番号と地名の情報に対して、TBODYの最初のTR要素がレコードの数だけ繰り返されて、そしてそれぞれDIVタグ要素のテキストとしてフィールドの値が設定されて表示されます。初期状態では、定義ファイルのコンテキストにあるrecordsキーの値に応じて最大10レコードまでとなります。この仕組みによって、一覧表が作成されています。\n                検索結果が0のときの一覧表\n                TBODYの内容を解析して、このTBODYがエンクロージャーとして機能します。そして、postalcodeコンテキストに対して検索処理を行います。このとき、検索結果が0件の場合、data-im-control属性が「noresult」のものを残して、エンクロージャー内の他のリピーターは削除され、その結果を表示します。また、一方で、検索結果が0件でない場合、data-im-control属性が「noresult」のものを削除して残った結果をリピーターとして識別して、そのリピーターをレコードの数だけ複製してページを表示します。\n                ページネーションのコントロールの表示\n                postalcodeコンテキストでは、pagingキーの値がtrueなのでページネーションコントロールによるページ切り替えが可能です。そして、ページネーションのコントロールを表示するためには、id属性が「IM_NAVIGATOR」の要素を配置しておく必要があります。TABLEタグのすぐ上にその要素が見えており、この場所にページネーションコントロールを自動的に構築します。\n                検索のユーザインタフェース\n                ページファイルの最初の方に、検索条件を指定するINPUTタグ要素があります。この要素はデータベースとは関係なく、ページ上で存在するものです。そのため、id属性（値はcondition）を設定していますが、加えて、data-im属性にローカルコンテキストを示す「_@condition:postalcode:f3,f7,f8,f9:*match*」という記述があります。この属性名を持つテキストフィールドは、コロンで区切られていて、最初の「condition」は決められたキーワードです。次の「postalcode」はどのコンテキストに対して検索をかけるのかということを指定しています。3つ目は検索対象のフィールドをカンマで書き並べると、それぞれのフィールドに対するOR検索が行われます。4つ目の「*match*」は、テキストフィールドに入力した文字列がどこかに含まれるという条件で検索することを示しています。このようなdata-im属性の指定により、ユーザーインタフェース上のテキストフィールドの値がコンテキストのデータベースへのクエリーに条件として付加され、検索結果が一覧されます。\n                このテキストフィールドに文字カーソルがある状態でReturnキーなどを押すと、コンテキストへの更新処理とみなして再度検索し、テーブルの一覧を作り直します。ユーザーは「検索によって更新された」ように見えるということです。\n                Searchボタンをクリックして検索する\n                ページファイルでは、BUTTONタグを使って「Search」ボタンを作成しています。ボタンのdata-im属性に「_@update:postalcode」と指定されています。この記述により、ボタンをクリックすると、postalcodeコンテキストに対する更新を行うので、現状の設定での検索がその場で行われます。\n                フィールド名の横の▲▼をクリックして、そのフィールドで並べ替える\n                例えば、郵便番号の▲ボタンは、spanタグ要素として記述して、data-im属性値は「_@addorder:postalcode:f3:asc」となっています。この記述があると、要素をクリックしたときにpostalcodeコンテキストに対する更新を行うと同時に、その後の記述から明らかなように、f3フィールドの昇順で並べ替えるという条件を付加します。\n            \n            \n                まとめ\n                検索して一覧するというユーザーインタフェースは当たり前のように作成されていますが、INTER-Mediatorはこのように、手続き的なプログラミングをまったくしなくても、ある程度仕組みのページを作成できるようになりました。AND条件で検索したいときには、テキストフィールドを並べます。そのとき、空白のフィールドは検索条件として含めないといった動作も、一切のプログラミングなく動作します。なお、これ以上の複雑な検索条件指定が必要な場合には、『プラクティス：検索をしてその結果を一覧表示する（JavaScript版）』の記事を参照してください。\n            \n        "
    },
    {
        "id": 13,
        "parent": "/ja/practices/",
        "path": "/ja/practices/practice-search.html",
        "title": "検索をしてその結果を一覧表示する（JavaScript版）",
        "breadcrumb": "検索結果の一覧表示（JavaScript版）",
        "body": "\n            \n                前提知識\n                INTER-Mediatorに関して、以下の内容をすでに知っている事を前提とします。\n                \n                    data-im属性への記述によりフィールドの内容が表示されること\n                    TABLEタグを使った表の中で、複数のレコードが繰り返し表示されるようになっていること\n                    一定数ごとのレコードを表示する仕組みと、表示範囲を切り替えるページネーションの仕組みがあること\n                    定義ファイルのコンテキストには、検索条件が指定できること\n                    JavaScriptによるページ機能の拡張\n                \n            \n            \n                作成例について\n                利用するデータベースは、郵便番号と地名が含まれているもので、サンプルのデータベースにあるpostalcodeという名称のものです。レポジトリ内では、Samples/Practices/search_page2.htmlを開く事で、実際に稼働させることができます。Samples/index.htmlにあるサンプルの一覧では「Practices」にある「search」の「search(using JavaScript)」のリンクをクリックして表示できます。\n                まず、どのような動作になるのかを見て行くことにしましょう。最初にページを開くと、郵便番号と地名がともかく一覧されています。サンプルのデータベースには、ある時期の東京都のデータのみを収録しています。検索条件は何もなく、おそらく全てのデータがリストされていると想定されます。ここで、ページネーション（ページ移動）の「&gt;」ボタンをクリックすると、次々と10件ずつレコードが表示されます。また、何件目のデータを現在表示しているのかという情報も見えています。\n                \n                \n                ここで、「検索条件」に適当な地名（ここでは「池袋」）を入力して「Search」ボタンをクリックします。すると、一覧表には、池袋を含む地名やビル名のものだけに絞り込まれました。全部で68件の地名があることが分かります。「&gt;」ボタンでページ移動ができますが、ページ移動後にも、検索条件はそのまま見えていることにも注意を払いましょう。\n                \n                \n                検索条件に、ここでは「171」と入力しました。すると、郵便番号が171で始まる地名だけが絞り込まれています。また、ここで、「郵便番号」と書かれた右側の▼をクリックすると、郵便番号の逆順で表示されるようになりました。つまり、一覧表示が「郵便番号」の逆順にソートされて表示されるようになっています。\n                \n                \n                検索条件に、東京都に明らかになさそうな「大阪」という文字列を指定して検索してみます。もちろん、大阪を含む地名は存在しませんが、検索結果が0件のときに表示する行が見えています。\n                \n                \n                「表示件数」については、ここでは省略します。\n            \n            \n                定義ファイル\n                定義ファイルのSamples/Practices/search_def.phpの内容は以下の通りです。コンテキストは、postalcodeという名前のものが1つだけあり、これはテーブル名と同様なので、tableやviewキーの値は指定していません。1ページあたりのレコード数は10で、後からの変更をしても30より多くの数を一度にページに出す事はできません。そして、pagingキーがtrueなので、ページネーションのコントロールがページ上に表示されます。\n                データベースはMySQLを使うのでdb-classは「PDO」を指定します。それ以外の接続情報、アカウント、パスワードは、INTER-Mediator/params.phpファイルにあるものをそのまま使います。INTER-Mediatorのサンプルファイルをそのまま参照できる状態であれば、特に変更する必要はありません。\n                \n                    require_once(dirname(__FILE__) . '/../../INTER-Mediator.php');\n\nIM_Entry(\narray(\n    array(\n        'name' =&gt; 'postalcode',\n        'records' =&gt; 10,\n        'maxrecords' =&gt; 30,\n        'paging' =&gt; true,\n    ),\n),\nnull,\narray('db-class' =&gt; 'PDO'),\n    false\n);\n                \n            \n            \n                ページファイル\n                ページファイルについては、ボディ部のみを示します。もちろん、ヘッダ部で、前述の定義ファイルSCRIPTタグで読み込んだ状態になっています。\n                \n                    &lt;div&gt;\n    検索条件:\n    &lt;input type=\"text\" id=\"condition\" data-im=\"_@condition\"&gt;\n    表示件数：\n    &lt;input type=\"text\" id=\"number\" data-im=\"_@_im_pagedSize\" size=\"3\"&gt;\n    &lt;button id=\"search\"&gt;search&lt;/button&gt;\n&lt;/div&gt;\n&lt;div id=\"IM_NAVIGATOR\"&gt;Navigation Controls by INTER-Mediator&lt;/div&gt;\n&lt;table border=\"1\" id=\"resultTable\"&gt;\n    &lt;thead&gt;\n        &lt;tr&gt;\n            &lt;th&gt;郵便番号\n                &lt;span id=\"sort1a\"&gt;▲&lt;/span&gt;\n                &lt;span id=\"sort1d\"&gt;▼&lt;/span&gt;\n            &lt;/th&gt;\n            &lt;th&gt;都道府県&lt;/th&gt;\n            &lt;th&gt;市区町村&lt;/th&gt;\n            &lt;th&gt;町域名\n                &lt;span id=\"sort2a\"&gt;▲&lt;/span&gt;\n                &lt;span id=\"sort2d\"&gt;▼&lt;/span&gt;\n            &lt;/th&gt;\n        &lt;/tr&gt;\n    &lt;/thead&gt;\n    &lt;tbody&gt;\n        &lt;tr&gt;\n            &lt;td&gt;\n                &lt;div data-im=\"postalcode@f3\"&gt;&lt;/div&gt;\n            &lt;/td&gt;\n            &lt;td&gt;\n                &lt;div data-im=\"postalcode@f7\"&gt;&lt;/div&gt;\n            &lt;/td&gt;\n            &lt;td&gt;\n                &lt;div data-im=\"postalcode@f8\"&gt;&lt;/div&gt;\n            &lt;/td&gt;\n            &lt;td&gt;\n                &lt;div data-im=\"postalcode@f9\"&gt;&lt;/div&gt;\n            &lt;/td&gt;\n        &lt;/tr&gt;\n        &lt;tr data-im-control=\"noresult\"&gt;\n            &lt;td colspan=\"4\"&gt;検索結果はありません。あるいは検索前です。&lt;/td&gt;\n        &lt;/tr&gt;\n    &lt;/tbody&gt;\n&lt;/table&gt;\n                \n            \n            \n                それぞれの動作の実現\n                一覧表示の実現\n                postalcodeテーブルでは、f3フィールドに郵便番号、f7〜f9フィールドに都道府県、市区町村、町域名が収められています。一覧表に表示をしつつ、そこでの変更の必要がない場合には、INPUTタグ要素でフィールドの内容を表示する必要はありません。ページファイル内のTBODYタグ要素の中には2つのTR要素がありますが、その最初の方の要素の子要素にTDがいくつかあり、さらに各TDはDIV要素があります。そこに、f3、f7〜f9のそれぞれのフィールドを示すターゲット指定がdata-im属性に設定されています。\n                postalcodeコンテキストに対して検索して得られた郵便番号と地名の情報に対して、TBODYの最初のTR要素がレコードの数だけ繰り返されて、そしてそれぞれDIVタグ要素のテキストとしてフィールドの値が設定されて表示されます。初期状態では、定義ファイルのコンテキストにあるrecordsキーの値に応じて最大10レコードまでとなります。この仕組みによって、一覧表が作成されています。\n                検索結果が0のときの一覧表\n                TBODYの内容を解析して、このTBODYがエンクロージャーとして機能します。そして、postalcodeコンテキストに対して検索処理を行います。このとき、検索結果が0件の場合、data-im-control属性が「noresult」のものを残して、エンクロージャー内の他のリピーターは削除され、その結果を表示します。また、一方で、検索結果が0件でない場合、data-im-control属性が「noresult」のものを削除して残った結果をリピーターとして識別して、そのリピーターをレコードの数だけ複製してページを表示します。\n                ページネーションのコントロールの表示\n                postalcodeコンテキストでは、pagingキーの値がtrueなのでページネーションコントロールによるページ切り替えが可能です。そして、ページネーションのコントロールを表示するためには、id属性が「IM_NAVIGATOR」の要素を配置しておく必要があります。TABLEタグのすぐ上にその要素が見えており、この場所にページネーションコントロールを自動的に構築します。\n                ページの合成処理\n                実際にページを表示する処理は、window.onloadへの関数の代入で実現しています。Samples/Practices/search.jsにプログラムが置いてあります。そこにある以下の部分が、実際にページを合成します。window.onloadに代入した関数は、ページの要素を読み込んだ後、つまりページが表示された直後に呼び出され、INTERMediator.construct(true);によって実際にページの生成を行います。この関数のそれまでの部分については、この後に説明をします。\n                \n                    window.onload = function () {\n        :\n    INTERMediator.construct(true);\n};\n                \n                検索のユーザインタフェース\n                ページファイルの最初の方に、検索条件を指定するINPUTタグ要素があります。この要素はデータベースとは関係なく、ページ上で存在するものです。そのため、id属性（値はcondition）を設定していますが、加えて、data-im属性にローカルコンテキストを示す「_@condition」という記述があります。これにより、クライアント内部でのデータ記憶領域とバインドされます。アンダーラインはローカルコンテキストを示す記号で、「condition」がそのコンテキストでのキーとなります。このINPUT要素から値を取り出すのではなく、ローカルコンテキストより、このテキストフィールドに入力した値が取り出せるようになります。\n                実際の検索処理\n                検索処理は、Samples/Practices/search.jsにある以下の関数として、汎用的に記述しました。つまり、doSearch()の呼び出しで、検索条件を取り出してそれを設定した上で、ページの再合成を行うことで検索結果を反映させた一覧を取得します。INTERMediator.additionalConditionには、コンテキストとして定義ファイルに記述した検索条件に、さらに新たな検索条件を付加するプロパティです。\n                \n                    function doSearch() {\n    INTERMediator.additionalCondition = {};\n    var c1 = IMLibLocalContext.getValue(\"condition\");\n    if (c1 &amp;&amp; c1.length &gt; 0) {\n        INTERMediator.additionalCondition = {\"postalcode\": [\n            {field: 'f3', operator: 'LIKE', value: c1 + '%'},\n            {field: 'f7', operator: 'LIKE', value: '%' + c1 + '%'},\n            {field: 'f8', operator: 'LIKE', value: '%' + c1 + '%'},\n            {field: 'f9', operator: 'LIKE', value: '%' + c1 + '%'},\n            {field: '__operation__', operator: 'ex'}\n        ]};\n    }\n    INTERMediator.startFrom = 0;\n    IMLibLocalContext.archive();\n    INTERMediator.construct(true);\n}\n                \n                最初に、付加条件をいったんクリアします。IMLibLocalContext.getValueメソッドにより、検索条件のテキストフィールドの値を取り出します。そのテキストフィールドは、直前に説明した通り、ローカルコンテキストのconditionキーの値とバインドしていて、テキストフィールドの値はキーの値を指定して取り出すことができます。つまり、変数c1には、テキストフィールドの値が取り出されます。\n                もし、検索条件が指定されていれば、INTERMediator.additionalConditionに付加検索条件を追加します。ここでは、f3が検索条件で始まり、f7〜g9については検索条件を含むという検索設定をMySQLの文法に従って記述しています。__operation__という記述により、それまでの並びをANDではなくOR条件で結びます。結果として、4つの条件がどれか1つでも満たすようなレコードが検索されて取り出されることになります。\n                INTERMediator.startFromは、検索結果の何番目から表示するかを示すプロパティで、ページネーションによりINTER-Mediatorによって自動的に更新されるものです。最初なので0にしておきます。IMLibLocalContext.archive()により、ローカルコンテキストを記憶しています。最後に、INTERMediator.construct(true);によってページの合成を行っています。\n                Searchボタンをクリックして検索する\n                ページファイルでは、BUTTONタグを使って「Search」ボタンを作成していますが、その要素の記述内では、特にプログラムの呼び出しなどを行っていません。onclick属性に記述する方法でももちろん動作しますが、別の方法も用意しています。INTERMediator.construct( ) でページ合成をする前に、IMLibMouseEventDispatch.setExecuteメソッドを利用して、イベントに対応する処理を記述できます。このメソッドの最初の引数は要素のid属性で、2番目にその要素をクリックしたときの処理を関数で記述します。Searchボタンのid属性値はsearchなので、以下のような記述を行えば、クリックしたときにdoSearch関数を実行します。なお、IMLibMouseEventDispatch.setExecuteは、実際にはdocumentオブジェクトでのclickコマンドを受け付けます。従って、オブジェクトに直接プログラムを記述するような場合や、オブジェクトにイベントリスナを設定する場合には、そのまま両方動くことになります。このサンプルプログラムでは、HTML側に一切の処理を書かないという方針でまとめています。\n                \n                    window.onload = function () {\n        :\n    IMLibMouseEventDispatch.setExecute('search', function () {\n        doSearch();\n    });\n        :\n    INTERMediator.construct(true);\n};\n                \n                Returnキーで検索をする\n                INPUTタグ要素は、原則としてReturnキーあるいはEnterキーによるサブミット処理は、FORMタグを使っている場合にしか適用されません。INTER-MediatorではFORMを使っていないので、簡単に言えばテキストフィールドでReturnキーを押しても「何も起こらない」ということになります。\n                そこで、ページ合成前に、IMLibKeyEventDispatch.setExecuteメソッドを利用すれば、第1引数の値をid属性に持つ要素に対して、2番目の引数の文字コードが入力されれば、3つ目の引数の関数を実行します。つまり、以下の記述により、テキストフィールドに入力中にEnterキーを押すと、doSearch関数が実行されて検索が行われるということになります。IMLibLocalContext.updateメソッドは、引数にローカルコンテキストのキーを指定し、現在の要素の値をローカルコンテキストへ反映させます。通常はこの作業は自動的に行われるのですが、要素のchangeイベントをもとにしており、キータイプだけでは同期処理が実行されません。そこで、このような記述で明示的に要素の値をコンテキストに反映させています。\n                \n                    window.onload = function () {\n    IMLibKeyEventDispatch.setExecute('condition', 13, function () {\n    IMLibLocalContext.update('condition');\n        doSearch();\n    });\n        :\n    INTERMediator.construct(true);\n};\n                \n                フィールド名の横の▲▼をクリックして、そのフィールドで並べ替える\n                例えば、郵便番号の▲ボタンは、spanタグ要素として記述して、id属性値は「sort1a」となっています。そして、window.onloadに代入している関数内で以下のようにIMLibMouseEventDispatch.setExecuteメソッドが記述されています。つまりは、▲ボタンをクリックすると、まず、INTERMediator.additionalSortKeyというプロパティに、追加のソート条件を設定します。右辺にあるように、postalcodeコンテキストに対してf3フィールドを昇順で並べ替えるという設定を追加します。このサンプルでは、フィールドに応じた並べ替えのクリックポイントが4カ所あるので、4つの要素に対してクリックイベントの実行時に処理を行うように記述をしています。\n                \n                    window.onload = function () {\n        :\n    IMLibMouseEventDispatch.setExecute('sort1a', function () {\n        INTERMediator.additionalSortKey\n            = {\"postalcode\": {field: 'f3', direction: 'ASC'}};\n        doSearch();\n    });\n    IMLibMouseEventDispatch.setExecute('sort1d', function () {\n        INTERMediator.additionalSortKey\n            = {\"postalcode\": {field: 'f3', direction: 'DESC'}};\n        doSearch();\n    });\n    IMLibMouseEventDispatch.setExecute('sort2a', function () {\n    INTERMediator.additionalSortKey\n            = {\"postalcode\": {field: 'f9', direction: 'ASC'}};\n        doSearch();\n    });\n    IMLibMouseEventDispatch.setExecute('sort2d', function () {\n        INTERMediator.additionalSortKey\n        = {\"postalcode\": {field: 'f9', direction: 'DESC'}};\n        doSearch();\n    });\n    INTERMediator.construct(true);\n};\n                \n            \n        "
    },
    {
        "id": 14,
        "parent": "/ja/practices/",
        "path": "/ja/practices/practice-masterdetail.html",
        "title": "一覧と詳細",
        "breadcrumb": "一覧と詳細",
        "body": "\n            \n                前提知識\n                INTER-Mediatorに関して、以下の内容をすでに知っている事を前提とします。\n                \n                    data-im属性への記述によりフィールドの内容が表示されること\n                    TABLEタグを使った表の中で、複数のレコードが繰り返し表示されるようになっていること\n                    一定数ごとのレコードを表示する仕組みと、表示範囲を切り替えるページネーションの仕組みがあること\n                    定義ファイルのコンテキストには、検索条件が指定できること\n                \n            \n            \n                作成例について\n                たくさんのレコード、そしてたくさんのフィールドがある場合、そのデータの一覧を表示して、ボタンをクリックするなどして移動したページで詳細を表示したり編集したりするような作りのユーザーインタフェースはよく利用されます。この種のユーザーインタフェースをマスター/ディテール、あるいは一覧と詳細といった呼び方をします。\n                サンプルデータベースには、商品マスターのテーブルがあります。その内容を一覧と詳細形式で表示したいとします。一般的なWebアプリケーションだと、それぞれ異なるページを用意して、ページ移動などの必要な機能を実装するということになります。一方、INTER-Mediatorでは、そうしたユーザーインタフェースを作りやすくした仕組みを組み込んでいます。一覧も詳細も、同一のページに表示して、必要に応じて表示と非表示を行うことで、一覧と詳細の動作を行っています。\n                サンプルの一覧のページからは「Practices」の「Master/Detail」にある「alternative navigation」をクリックすると、以下のようなページが表示されます。最初は、商品マスターの商品名と単価が見えている一覧が表示されています。ここで、「詳細」ボタンをクリックすると、クリックした商品に関する他のフィールドを、そのレコードだけ表示します。「一覧表示」ボタンをクリックすると、元の一覧のページが表示されます。\n                \n                \n                サンプルの一覧のページからは「Practices」の「Master/Detail」にある「split master/detail」をクリックすると、以下のようなページが表示されます。一覧と詳細が同時に表示されています。CSSの仕組みを利用して、それぞれのテーブルを左右に並ぶように配置しています。\n                \n                \n                左側の一覧で「詳細」ボタンをクリックすると、該当するレコードが右側に表示されます。つまり、右側は、左側のリストでクリックしたレコードの情報に逐次切り替わります。\n                \n                \n                ここで、右側の詳細表示の方が、テキストフィールドになっています。たとえば、単価を1200に修正したとします。修正をしてTabキーを押すなどすると、このレコードのunitpriceフィールドの値は1200に更新されます。\n                \n                \n                テキストフィールドからフォーカスが外れると同時に、左側の対応するフィールドも値が置き換わっています。このように、同一のフィールドがページ内の複数の箇所に見えている場合には、1つの修正が他の要素へ自動的に反映されるようになっています。（書式の反映に関しては、Ver.5.0より後に修正をおこなう予定です。）\n                \n                \n            \n            \n                定義ファイル\n                定義ファイルのSamples/Practices/nav1.phpの内容は以下の通りです。一覧と詳細が切り替わるnavi1.phpと、左右に表示されるnavi2.phpの2つの定義ファイルがありますが、1箇所の設定を除いて同一のものです。\n                まず、一覧と詳細は、基本的には同一のテーブルがデータソースになるはずです。しかしながら、INTER-Mediatorでは、それぞれ、異なるコンテキストして定義します。productテーブルをもとに、一覧用のproductlistコンテキストと、詳細用のproductdetailコンテキストを用意します。いずれも、viewキーの値がproductとなっており、同じproductテーブルから得られるコンテキストであることがわかります。一覧と詳細を構成するには、それぞれのコンテキストにnavi-controlキーに値を指定します。一覧側は「master」、詳細側は「detail」と指定するのが基本です。masterだけだと、一覧と詳細は同時に表示され、詳細側にはマスターに切り替わるボタンは表示されません。master-hideだと、一覧と詳細が切り替わり、詳細側に一覧を表示するボタンが追加されます。detail、あるいはdetail-downなら詳細の末尾に、detail-topなら詳細の冒頭に、一覧に移動するボタンを表示します。なお、master側のコンテキストでは、必ず「詳細」ボタンが追加されます。\n                データベースはMySQLを使うのでdb-classは「PDO」を指定します。それ以外の接続情報、アカウント、パスワードは、INTER-Mediator/params.phpファイルにあるものをそのまま使います。INTER-Mediatorのサンプルファイルをそのまま参照できる状態であれば、特に変更する必要はありません。\n                \n                    require_once(dirname(__FILE__) . '/../../INTER-Mediator.php');\n\nIM_Entry(\n    array(\n        array(\n            'records' =&gt; 10,\n            'name' =&gt; 'productlist',\n            'view' =&gt; 'product',\n            'key' =&gt; 'id',\n            'sort' =&gt; array(array('field' =&gt; 'name', 'direction' =&gt; 'ASC'),),\n            'navi-control' =&gt; 'master-hide',\n        ),\n        array(\n            'records' =&gt; 1,\n            'name' =&gt; 'productdetail',\n            'view' =&gt; 'product',\n            'table' =&gt; 'product',\n            'key' =&gt; 'id',\n            'navi-control' =&gt; 'detail-top',\n        ),\n    ),\n    array(\n        'formatter' =&gt; array(\n            array('field' =&gt; 'product@unitprice', 'converter-class' =&gt; 'Number', 'parameter' =&gt; '0'),\n        ),\n    ),\n    array('db-class' =&gt; 'PDO'),\n    false\n);\n                \n            \n            \n                ページファイル\n                ページファイルについては、ボディ部のみを示します。もちろん、ヘッダ部で、前述の定義ファイルSCRIPTタグで読み込んだ状態になっています。一覧を表示するTABLEと詳細を表示するTABLEが定義されているだけです。左右のレイアウトをしやすいように、それぞれDIVタグ要素に含めてあります。それぞれのTABLEタグ要素内では、productlistコンテキストと、productdetailコンテキストを利用したターゲット指定があるだけで、特に何も特別な記述はありません。\n                \n                    &lt;body onload=\"INTERMediator.construct(true);\"&gt;\n&lt;!-- Table for the list view --&gt;\n&lt;div id=\"listarea\" style=\"float:left; margin-right: 24px;\"&gt;\n    &lt;table border=\"1\"&gt;\n        &lt;thead&gt;\n        &lt;tr&gt;\n            &lt;th&gt;&lt;/th&gt;&lt;th&gt;name&lt;/th&gt;&lt;th&gt;unitprice&lt;/th&gt;\n        &lt;/tr&gt;\n        &lt;/thead&gt;\n        &lt;tbody&gt;\n        &lt;tr&gt;\n            &lt;td&gt;&lt;/td&gt;\n            &lt;td data-im=\"productlist@name\"&gt;&lt;/td&gt;\n            &lt;td class=\"price\" data-im=\"productlist@unitprice\"&gt;&lt;/td&gt;\n        &lt;/tr&gt;\n        &lt;/tbody&gt;\n    &lt;/table&gt;\n&lt;/div&gt;\n&lt;!-- Table for the detail view --&gt;\n&lt;div id=\"detailarea\"&gt;\n    &lt;table border=\"1\"&gt;\n        &lt;tbody&gt;\n        &lt;tr&gt;\n            &lt;th&gt;id&lt;/th&gt;\n            &lt;td data-im=\"productdetail@id\"&gt;&lt;/td&gt;\n        &lt;/tr&gt;\n        &lt;tr&gt;\n            &lt;th&gt;name&lt;/th&gt;\n            &lt;td&gt;&lt;input type=\"text\" size=\"60\" data-im=\"productdetail@name\"&gt;&lt;/td&gt;\n        &lt;/tr&gt;\n        &lt;tr&gt;\n            &lt;th&gt;unitprice&lt;/th&gt;\n            &lt;td&gt;&lt;input type=\"text\" size=\"60\" data-im=\"productdetail@unitprice\"&gt;&lt;/td&gt;\n        &lt;/tr&gt;\n        &lt;tr&gt;\n            &lt;th&gt;photofile&lt;/th&gt;\n            &lt;td&gt;&lt;input type=\"text\" size=\"60\" data-im=\"productdetail@photofile\"&gt;&lt;/td&gt;\n        &lt;/tr&gt;\n        &lt;tr&gt;\n            &lt;th&gt;acknowledgement&lt;/th&gt;\n            &lt;td&gt;&lt;input type=\"text\" size=\"60\" data-im=\"productdetail@acknowledgement\"&gt;&lt;/td&gt;\n        &lt;/tr&gt;\n        &lt;tr&gt;\n            &lt;th&gt;ack_link&lt;/th&gt;\n            &lt;td&gt;&lt;input type=\"text\" size=\"60\" data-im=\"productdetail@ack_link\"&gt;&lt;/td&gt;\n        &lt;/tr&gt;\n        &lt;tr&gt;\n            &lt;th&gt;photofile&lt;/th&gt;\n            &lt;td&gt;&lt;img src=\"../Sample_products/images/\" data-im=\"productdetail@photofile@#src\"&gt;&lt;/td&gt;\n        &lt;/tr&gt;\n        &lt;/tbody&gt;\n    &lt;/table&gt;\n&lt;/div&gt;\n&lt;div style=\"clear: both\"/&gt;\n&lt;/body&gt;\n                \n            \n            \n                まとめ\n                一覧と詳細を実装するときには、それぞれを異なるコンテキストで1ページ内に配置します。そして、コンテキストにnavi-controlキーの値を指定することで、それぞれが連携して、一覧と詳細の動作を行うようになります。そのように動作させるためにプログラムを記述する必要はまったくありません。\n            \n        "
    },
    {
        "id": 33,
        "parent": "/ja/practices/",
        "path": "/ja/practices/practice-step.html",
        "title": "モバイルでよく見られるステップ動作のサイト",
        "breadcrumb": "ステップ",
        "body": "\n            \n                前提知識\n                INTER-Mediatorに関して、以下の内容をすでに知っている事を前提とします。\n                \n                    data-im属性への記述によりフィールドの内容が表示されること\n                    TABLEタグを使った表の中で、複数のレコードが繰り返し表示されるようになっていること\n                    一定数ごとのレコードを表示する仕組みと、表示範囲を切り替えるページネーションの仕組みがあること\n                    定義ファイルのコンテキストにJavaScriptを利用して、検索条件が指定できること\n                \n                また、Webサイト作成について、以下の知識も知っていることを前提とします。\n                \n                    CSSに関する知識\n                    モバイルサイトの作成方法とタッチイベントの処理\n                \n            \n            \n                作成例について\n以下のビデオをご覧ください。Chromeのモバイル画面シミュレーションで見ています。データベースはサンプルにある東京都の郵便番号を使っているので、日本郵便が配布しているデータを単に1つのテーブルに入れたものです。最初の画面では東京都しかありませんが、都道府県を選択します。そして、セルをタップすると、タップした都道府県に存在する市区町村が一覧されます。そして、いずれかをタップすると、選択した市区町村に存在する町域名が一覧されます。さらにタップすると、その郵便番号が見えます。ここでは、4つの一覧画面があり、順次タップで進めたり、戻ったりができるということです。戻って異なる郵便番号を参照することもできます。\n                \n\nこのページはサンプルに用意してありますので、そちらでもご覧いただけます。サンプルのページでは「Practices」の「Mobile」にある「step」から参照できます。デモサイトでのリンクはこちらです。PCでご覧の方は、例えばChromeのデバッガをoption+command+Iなどで呼び出し、デバイスツールバーを表示してモバイルモードにして参照してみてください。ページファイルは/samples/Sample_Mobile/step_MySQL.html、定義ファイルは/samples/Sample_Mobile/step_MySQL.phpです（リンク先はレポジトリ）。\n            \n\nサイト設計\nモバイルサイトでステップ動作をさせたい場合は、１画面で１つの項目を選択するのが一般的です。要求内容から基本的なナビゲーションの設計を行い、各ステップでどのようにデータをデータベースから取り出すかを検討します。そして、それらのコンテキストを定義ファイルに定義します。ここまでは、他のINTER-Mediatorで作成するサイトと変わりません。\nステップ動作をさせたい場合、それぞれのコンテキスト定義に、navi-controlキーを指定します。最初のページは「step」、以降のページは「step-hide」とします。したがって、stepが指定されたページは1つだけにするようにしてください。加えて、定義ファイルの中での順序が非常に重要になります。定義ファイル内でのコンテキスト定義の上から順番にステップ動作の遷移に対応するように並べてください。\n定義ファイルでのnavi-controlと順序\n定義ファイルへのリンクはすでに掲載しているので、そちらから定義ファイルを開いて参照してください。nameキーがprefecture、city、town、wrapupという4つのコンテキストがあり、いずれもnavi-controlキーの指定があります。最初にprefectureコンテキストの一覧が表示されように、順序としては最初にあり、そしてstepという値がnavi-controlキーに指定されています。\nいずれも、aggrregation-*キーがあり、やや複雑なSQLステートメントの生成を行なっていますが、基本的にはいずれもpostalcodeテーブルから、それぞれの値を取り出しているということです。例えば、市区町村フィールドからデータを取り出すとき、日本郵便のデータのままだと、「中央区」のレコードはたくさんあります。DISTINCTを使う方法もありますが主キー値をどれかのレコードで代表させたいため、ここではGROUP BYで同じ名前の市区町村をまとめて1つにして、主キー値は同一市区町村のレコードの中の最小値を取得するようにしました。\nページファイルの構築\nページファイルへのリンクをクリックして、ページファイルを確認してください。それぞれのコンテキストは、並べて定義するのが混乱がなくて良いでしょう。ここではTABLEタグでテーブルとして作成しましたが、もちろん、div等を利用しても構いません。data-im属性でターゲット指定を行う点は大きな違いはありません。モバイルデバイスでは、セルをタップしますが、PCの場合は「詳細」ボタンが出てきます。このように、デバイスによってナビゲーション動作を呼び出すイベントはINTER-Mediatorの側で自動的に設定されます。\nステップ動作のページで追加で必要なことは、クラスが「IM_Button_StepBack」の「戻る」ボタンを作成することです。単に、このクラスの要素が配置されて入ればよく、BUTTONタグでも構いませんが、サンプルのようにSPANタグでも構いません。このボタンの表示/非表示や、クリック時の動作についてはINTER-Mediatorが全て自動的に処理をします。最初のページでは表示しないなどの作業は自動的に行われています。\nページファイルの作成で悩むところは、そのデザインでしょう。サンプルでは、ヘッダとフッタが固定された状態で、選択のためのリストだけがその間でスクロールするといった動作になりように、CSSを調整しています。このデザイン部分はINTER-Mediatorは関係なく、普通にモバイルサイトとして動作するように構築します。\nナビゲーション動作のカスタマイズ\nここまでの設定で、選択リクトを表示して、ステップ動作や戻る操作は実装できました。しかしながら、それだけでは望むサイトにはならないことが多いでしょう。そこで、タップ直後に独自に定義したメソッドを呼び出すことで汎用的な動作ができるようにしました。\n例えば、name属性が「prefecture」のコンテキストにあるbefore-move-nextstepキーには、「doAfterPrefSelection」という文字列が設定されています。このキーがあれば、「INTERMediatorOnPage.doAfterPrefSelection()」という呼び出しをタップ直後に行います。このメソッドの定義は、ページファイルのヘッダ部にあるscriptタグ内で記述されています。つまり、「東京都」をクリックすると、その情報を保持して、このメソッドを呼び出すということになります。\nINTERMediatorOnPage.doAfterPrefSelectionメソッドを見てみましょう。IMLibPageNavigation.getStepLastSelectedRecord()により、最後に選択した項目に対応するレコードが得られます。ここでは、prefプロパティを参照することにより、選択した項目の都道府県名が得られます。その値を利用して、次に表示されるcityコンテキストに対して、f7（都道府県名のフィールド）が選択した都道府県名と同一になるような検索条件を指定しています。その結果、cityコンテキストは、「SELECT MIN(id) AS city_id, f8 AS city FROM postalcode WHERE f7 = '東京都' GROUP BY f8」というSQLによって得られたリレーションを元に構築され、東京都の市区町村名だけが重複なくリストアップされます。\nwrapupコンテキストのセルをタップしても、何も起こりません。最後のステップでは先には進みませんが、before-move-nextstepキーで指定したメソッドの呼び出しだけは行います。IMLibPageNavigation.stepNavigationは、順番にタップした内容が得られます。東京都→世田谷区→上馬と選択して、最後のページでいずれかをタップした場合、IMLibPageNavigation.stepNavigationの値は以下のようになっています。\n\n[\n  {context: IMLibContext {contextName: \"prefecture\",  …},\n   key: \"pref_id=1\"},\n  {context: IMLibContext {contextName: \"city\", …},\n   key: \"city_id=2317\"},\n  {context: IMLibContext {contextName: \"town\", …}\n   key: \"town_id=2329\"}\n]\n\nつまり、ステップで動作してきた各ページのコンテキストオブジェクトと、選択した項目のキーが得られます。コンテキストオブジェクトは、storeプロパティで一覧の値が全て得られます。例えば、以下のコードを実行すると、record変数には、{town_id: \"2329\", town: \"上馬\", _im_repeater: \"\"}という値が得られます。ここから、新たにデータベース処理をしたり、別のページに遷移するなどは、さらにプログラムを作成する必要があります。\n\nvar key = IMLibPageNavigation.stepNavigation[2].key;\nvar record = IMLibPageNavigation.stepNavigation[2].context.store[key];\n\n            \n            \n                まとめ\n                ステップ動作を行うページを、コンテキストと絡めて作成する方法を説明しました。なお、選択時の処理は一般化しづらい点もあるため、ページ遷移以上の機能はJavaScriptでの実装を必要とします。\n            \n        "
    },
    {
        "id": 15,
        "parent": "/ja/for-developers/",
        "path": "/ja/for-developers/manual.html",
        "title": "INTER-MediatorによるWebアプリケーションの概要",
        "breadcrumb": "INTER-MediatorによるWebアプリの概要",
        "body": "\n            \n                はじめに\n                データベースにMySQLなど、PHPのPDOに対応したものを利用することを想定します。データベースが稼働しており、INTER-Mediatorがインストールされている状況であるとします。このとき、以下の2つのファイルを作成します。\n                \n                    ブラウザにロードするHTMLファイル（「ページファイル」と名付けます）\n                    データベース接続など設定を記述したPHPファイル（「定義ファイル」と名付けます\n                \n                定義ファイルの記述\n                定義ファイルは、PHPのファイルにします。したがって、PHPの処理が可能なサーバーに配置しないといけません。定義ファイルでは、以下のように、INTER-Mediator.phpを読み込み、IM_Entry関数をコールします。この関数の引数の指定方法は、後で記述します。サンプルで言えば、sample_form_FMS_include.phpやsample_form_MySQL_include.phpなどのファイルが、定義ファイルに相当します。定義ファイルに記述できる内容はこちら のページにまとめてあります。\n                &lt;?php\nrequire_once ('INTER-Mediator/INTER-Mediator.php');\nIM_Entry( $tableDefs, $optionDefs, $dbDefs, true );\n?&gt;\n                \n                ページファイルの記述\n                ページファイルでは、定義ファイルを、ヘッダエリアのscriptタグで読み込みます。定義ファイルは、JavaScriptのソースを返します。サンプルで言えば、sample_form_FMS.htmlや、sample_form_MySQL.htmlのファイルが、ページファイルに相当します。\n                &lt;html&gt;\n&lt;head&gt;\n&lt;script src=\"sample_form_MySQL_include.php\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n                :                \n&lt;td&gt;&lt;input type=\"text\" data-im=\"contact@datetime\"/&gt;&lt;/td&gt;\n                \n                以上の準備をすれば、ページファイル内のタグのdata-im属性に記述を加えることで、そのタグの値や他の属性に対してデータベースから取り出したデータが設定されることになります。属性の値は「contact@datetime」といった記述を行います。この記述を「ターゲット指定」と呼ぶ事にします。また、ターゲット指定のあるタグのことを「リンクノード」と呼びます。ターゲット指定の詳細は、後で説明をします。\n                ページの表示\n                以上のような準備をした上で、ブラウザより、ページファイルにアクセスをします。そうすれば、リンクノードのターゲット指定や、定義ファイルでの指定に基づいて、データベースのデータを取り込んでページを構成します。データベースの内容を表示しますが、複数のレコードがあれば繰り返して一覧表示などを行います。\n            \n            \n                INTER-MediatorによるWebページ生成\n                INTER-Mediatorは、WebページのDOM構造をたどり、データベースとリンクするノード（以後「リンクノード」と記述）をさがします。そして、そのリンクノードの上位のノードをたどり、「エンクロージャ」と「リピータ」となるノードを探します。リピータ自身あるいはリピータに含まれるリンクノードをすべて集めてデータベースにアクセスします。そして、レコードの数だけリピータを繰り返して、データベースの内容をページに表示します。\n                リンクノードでのターゲット指定\n                \n                    任意の要素をリンクノードにすることができます。\n                    data-im属性に「table@field@target」の記述で記載されいているものをリンクノードとみなします。現在はこの記述方法が推奨されます。\n                    複数の設定を行う場合、値には「table@field@target table@field@target...」のように空白で区切って記述します。\n                \n                ターゲット指定について\n                「table@field@target」がひとまとまりのターゲット指定となります。\n                \n                    tableはテーブル名を記述します。IM_Entry関数の第一引数に指定した配列のname属性の値を記述できます。\n                    fieldはフィールド名を指定します。IM_Entry関数の第一引数に指定した配列の中で、name属性に対応したテーブルアクセスの中にフィールドが含まれていれば、そのフィールドの値を利用して、リンクノードの値を変更あるいは設定します。\n                    targetはノードのどの属性にフィールド値を差し込むかを指定します。\n                \n                targetの指定は以下のようなルールになります。\n                \n                    省略すると、ノードの値として設定します。\n                    「innerHTML」の場合は、ノードのinnerHTML属性にフィールドの値を設定します。\n                    「nodeText」の場合はテキストノードを作成して子ノードとして追加します。\n                    「style.STYLENAME」の場合は、STYLENAMEで指定したスタイルに値として追加します。たとえば、「style.backgroundColor」は背景色のスタイル属性に値を指定します。\n                    targetの最初の文字が「#」の場合、innerHTMLないしは属性を指定していれば、既存のノードのデータに追加します。\n                    targetの最初の文字が「$」の場合、既存のノードのデータに含まれる$の部分を、データベースのフィールドの値に置き換えます。\n                \n                エンクロージャとリピータ\n                エンクロージャとリピータとなり得るノードの組み合わせを以下の表に示します。\n                \n                    \n                        \n                            \n                                形態\n                                Enclosure\n                                Repeater\n                                Linked Element\n                            \n                        \n                        \n                            \n                                表\n                                TBODY\n                                TR\n                                any elements\n                            \n                            \n                                番号リスト\n                                OL\n                                LI\n                                LI itself or inside of LI elements\n                            \n                            \n                                箇条書き\n                                UL\n                                LI\n                                LI itself or inside of LI elements\n                            \n                            \n                                ポップアップ、リスト\n                                SELECT\n                                OPTION\n                                OPTION itself\n                            \n                            \n                                汎用\n                                data-im-control=\"enclosure\"の指定があるタグ\n                                data-im-control=\"repeater\"の指定があるタグ\n                                any elements\n                            \n                        \n                    \n                \n                テーブルの場合で説明します。たとえば、テーブルのあるセル、つまりTDタグで囲まれた中に、DIVタグ等で記述されたリンクノードがあったとします。そのリンクノードから上位のノードにたどって、TRをリピータとします。TRの1つ上位のノードはTBODYに必ずなります。そのTBODYがエンクロージャとなります。リンクノードに記述された情報からテーブルがわかり、そのテーブルへアクセスします。そして、レコードの値をリンクノードの定義に従って、ノードに反映されます。もし、レコードが複数あれば、リピータを複製して、その複製した一連のノードに対してリンクノードの処理を行います。ページファイルを作るときは、通常、TRタグによる要素が1つのテーブルを作りますが、レコードの数だけ行数が増えるということになります。なお、リピータとなるTRタグの要素は複数個あってもかまいません。レコードの数だけ複数のTRのセットが複製されて、データの反映が行われます。\n                Ver.5.3-devの段階で、任意のタグについて、data-im-control属性を指定することで、エンクロージャーやリピーターになることできるように機能を拡張しました。つまり、TBOD/TR、OL/LI、UL/LI、SELECT/OPTIONについては、属性の指定がなく、リンクノードが含まれていればエンクロージャー／リピーターとして機能します。それ以外のタグの組み合わせについては、data-im-control属性を指定します。なお、エンクロージャーの直下の子要素としてリピーターを記述する必要があります。\n                レコードがない場合の表示\n                レコードがあれば、リピーターを複製していくつかのオブジェクトがページに見えますが、そのままだと、レコードがない場合、リピーターが全くない状態になってしまいます。そこで、リピーターの1つのdata-im-control属性を「noresult」にするか、あるいはclass属性を「_im_for_noresult_」とします。すると、このリピータはレコードが存在すれば単に消しさられますが、レコードがないときにはこのリピータが1つだけエンクロージャーの中に配置されます。「レコードがありません」などの記述をこの方法で組み込めます。\n                エンクロージャやリピーターの動作をキャンセルする\n                リンクノードを含むテーブルは、自動的に展開してしまいます。その展開をさせないようにするには、data-im-control属性の値を「ignore_enc_rep」とします。たとえば、1つのテーブルの中に複数のコンテキストからのフィールドを展開したい場合は、次のように記述して、TRをリピータとして認識しないようにします。\n                &lt;table&gt;\n&lt;tr data-im-control=\"ignore_enc_rep\"&gt;\n    &lt;td&gt;\n        &lt;span data-im-control=\"enclosure\"&gt;\n            &lt;span data-im-control=\"repeater\"&gt;\n                &lt;input data-im=\"context1@field1\" /&gt;\n            &lt;/span&gt;\n        &lt;/span&gt;\n    &lt;/td&gt; \n&lt;/tr&gt;\n&lt;tr data-im-control=\"ignore_enc_rep\"&gt;\n    &lt;td&gt;\n        &lt;span data-im-control=\"enclosure\"&gt;\n            &lt;span data-im-control=\"repeater\"&gt;\n                &lt;input data-im=\"context2@field2\" /&gt;\n            &lt;/span&gt;\n        &lt;/span&gt;\n    &lt;/td&gt;\n&lt;/tr&gt;\n&lt;/table&gt;\n\n                \n                特殊なリピーター\n                data-im-control属性が「header」「separator」「footer」のタグ要素も指定できます。headerに続いて、レコードの数だけリピーターが繰り返されますが、リピーターの間にはseprartorのタグ要素が付加され、最後にfooterのタグ要素が表示されます。\n                更新しないHTML要素\n                HTMLのフォーム要素では、ターゲット指定があれば、フィールドの値を表示するとともに、通常はその値を変更すると、変更結果をデータベースに更新して上書きします。しかしながら、その要素にdata-im-control=\"unbind\"という属性を記述すれば、フィールドの値は表示しますが、更新は行いません。データベースの中身を要素に反映させたいけど、後の処理は独自にJavaScript等で記述したいときにこの方法が使えます。\n            \n            \n                検索や並べ替えの動作と指定\n                INTER-Mediatorは、検索に関して以下の3つの設定個所があります。あるいは、以下のような検索条件が付与されて、データベースの読み出しが行われます。\n                \n                    定義ファイルのコンテキストの中のqueryの設定\n                    INTERMediatorオブジェクトのadditionalConditionプロパティ（JavaScript）\n                    リレーションによって決まる外部キーと対応キーとの対応（定義ファイルのコンテキストの中のrelationの設定）\n                \n                定義ファイルのqueryでの設定は、「常に適用されたい検索条件」を与えるのに便利です。たとえば、あるフィールドの値が「3」のものだけをいつも選択するとか、消し込みのフィールドがあって消し込まれていないレコードだけをとってくるというような場合です。\n                一方、ユーザが入力した検索条件のようなデータは、INTERMediatorオブジェクトのadditionalConditionプロパティを使って指定ができます。テキストフィールドに入力したテキストやあるいは計算結果などを検索条件に与えたい場合は、この方法で指定をします。\n                そして、リレーションは、エンクロージャーとリピーターによる展開中に、さらに内包するエンクロージャーとリピーターが見つかったとき、内側のコンテキストのrelation設定を参照して、外側のレコードに対応した、つまり関連のあるレコードを取り出すための条件を与えます。\n                これら3つの条件は、無条件にANDで合成されます。\n                コンテキストのqueryの指定方法\n                定義ファイルのコンテキストのqueryは、キーとして、field、operator、valueを持つ配列を指定します。その指定を複数できるので、結果として、queryキーに対する値は配列の配列となります。\n                PDO対応のデータベースアクセスクラスを利用すると、単に「field operator 'value'」という形式での式が構築されます。値についてはquoteメソッドで処理をしてあります。従って、array('field'=&gt;'age', 'operator'=&gt;'&gt;', 'value'=&gt;'19') のような指定が一例です。文字列のワイルドカードを使う場合には、データベースエンジンに従った記述が必要です。たとえば、MySQLで前方一致させるには、array('field'=&gt;'name','operator'=&gt;'LIKE', 'value'=&gt;'%田太郎') のような配列を指定します。operatorを省略すると、= とみなします。\n                'field' の値が '__operation__' の項目があれば、そこで区切りを入れます。そして区切りで分割したそれぞれについて、AND条件が適用された式が作られ、区切りで分割された固まりについてはOR演算となります。また、'field' の値が'__operation__' の項目の 'operator' が 'ex'なら、ORとANDを入れ替えます。'field' の値が'__operation__' の項目はいくつあってもかまいません。\n                'query' =&gt; array(\n&nbsp;&nbsp;&nbsp;&nbsp;array( 'field'=&gt;'age', 'operator'=&gt;'&gt;', 'value'=&gt;'19' ),\n&nbsp;&nbsp;&nbsp;&nbsp;array( 'field'=&gt;'year', 'operator'=&gt;'&gt;', 'value'=&gt;'1980' ))\n生成される条件文：age &gt; '19' AND year &gt; '1980'\n\n                \n                'query' =&gt; array(\n&nbsp;&nbsp;&nbsp;&nbsp;array( 'field'=&gt;'age', 'operator'=&gt;'&gt;', 'value'=&gt;'19' ),\n&nbsp;&nbsp;&nbsp;&nbsp;array( 'field'=&gt;'year', 'operator'=&gt;'&gt;', 'value'=&gt;'1980' ),\n&nbsp;&nbsp;&nbsp;&nbsp;array( 'field'=&gt;'__operation__' ),\n&nbsp;&nbsp;&nbsp;&nbsp;array( 'field'=&gt;'age', 'operator'=&gt;'&lt;', 'value'=&gt;'39' ),\n&nbsp;&nbsp;&nbsp;&nbsp;array( 'field'=&gt;'year', 'operator'=&gt;'&lt;', 'value'=&gt;'2006' ))\n生成される条件文：(age &gt; '19' AND year &gt; '1980') OR (age &lt; '39' AND year &lt; '2006')\n\n                \n                'query' =&gt; array(\n&nbsp;&nbsp;&nbsp;&nbsp;array( 'field'=&gt;'age', 'operator'=&gt;'&gt;', 'value'=&gt;'19' ),\n&nbsp;&nbsp;&nbsp;&nbsp;array( 'field'=&gt;'year', 'operator'=&gt;'&gt;', 'value'=&gt;'1980' ),\n&nbsp;&nbsp;&nbsp;&nbsp;array( 'field'=&gt;'__operation__', 'operator'=&gt;'ex' ),\n&nbsp;&nbsp;&nbsp;&nbsp;array( 'field'=&gt;'age', 'operator'=&gt;'&lt;', 'value'=&gt;'39' ),\n&nbsp;&nbsp;&nbsp;&nbsp;array( 'field'=&gt;'year', 'operator'=&gt;'&lt;', 'value'=&gt;'2006' ))\n生成される条件文：(age &gt; '19' OR year &gt; '1980') AND (age &lt; '39' OR year &lt;'2006')\n\n                \n                'query' =&gt; array(\n&nbsp;&nbsp;&nbsp;&nbsp;array( 'field'=&gt;'age', 'operator'=&gt;'&gt;', 'value'=&gt;'19' ),\n&nbsp;&nbsp;&nbsp;&nbsp;array( 'field'=&gt;'year', 'operator'=&gt;'&gt;', 'value'=&gt;'1980' ),\n&nbsp;&nbsp;&nbsp;&nbsp;array( 'field'=&gt;'__operation__', 'operator'=&gt;'ex' ))\n生成される条件文：age &gt; '19' OR year &gt; '1980'\n\n                \n                つまり、2つ以上の設定があれば、それらはANDで結ばれます。もし、__operation__の設定があれば、そこを区切りとして1つの塊の中のいくつかの設定はANDで結合され、そして区切り部分にORを入れた条件式になります（論理和標準形）。__operation__の設定にexがあれば、全面的にANDとORが入れ替わります。1つの塊についてはORで結び、その塊をANDで結びます（論理積標準形）。__operation__はいくつあっても構いませんが、そのうち1つでもexがあれば、全面的にAND/ORが入れ替わります。つまり、exはあるかないかだけの設定で、位置は関係ありません。\n                なお、ANDとORの組み合わせしかできないのかと思われるかもしれませんが、すべての論理式が論理和標準形ないしは論理積標準形で表現できるという定理があるので、この仕様ですべての論理式が記述できると言えるかと思われます。ただし、標準形にすると条件式によっては冗長な感じになり、かえって見づらい場合もあるでしょう。その場合は、テーブルをもとにすることだけを考えず、適当な中間段階のビューを作るなどして、効率よく条件設定を行うことも検討してください。\n                FileMaker Serverの場合、FileMaker側の仕様の制限として、検索条件は全部ANDか全部ORかで結ぶしかできません。ANDとORを組み合わせることはできないのです。コンテキストのqueryキーの値、あるいはaddtionalConditionに「array('field'=&gt;'__operation__', 'operator'=&gt;'or')」を加えれば、OR演算を行います。この指定がなければAND演算になります。OR演算を指定した場合、外部キーの検索条件もORになってしまい、リレーションが正確にとれませんので、その点は十分に注意が必要です。\n                INTERMediatorオブジェクトのadditionalConditionプロパティに指定する検索条件\n                JavaScriptのプログラムで、INTERMediator.construct(true) を実行するよりも前に、例えば以下のようなプログラムを実行します。additionalConditionプロパティは配列で、最初のインデックスはコンテキスト名、つまり定義ファイルでのnameキーに対応する値を指定します。ただし、セッタを定義したプロパティであるため、値の設定には、INTERMediatorクラスのaddConditionメソッドを利用します。右辺の条件は、もちろん、該当するコンテキストにしか適用されません。オブジェクトの値については前のqueryについての説明とおおむね共通です。OR条件とAND条件がどちらも出てくるような条件も記述できます。条件が一組の場合はオブジェクトとして記述できます。2つ以上あるときはオブジェクトの配列として記述します。\n                \nINTERMediator.addCondition(コンテキスト名, {field:'age', operator:'&gt;', value: 19});\nINTERMediator.addCondition(コンテキスト名, [\n    {field:'age', operator:'&gt;', value: 19},\n    {field:'year', operator:'&gt;', value: 1999}\n]);\n\n                \n                コンテキストのrelationキーの値\n                こちらもqueryと同様、配列の配列という形式をとります。キーはqueryと違います。外側のエンクロージャー／リピータとその内側のエンクロージャー／リピーターがあるとします。外側はmaster、内側はdetailというコンテキスト名で定義されているとします。\n                array(\n    array(\n        'name' =&gt;'master',\n        'key' =&gt;'id'\n    ),\n    array(\n        'name' =&gt;'detail',\n        'relation' =&gt;array(\n            array( 'foreign-field' =&gt;'master_id','join-field' =&gt;'id', 'operator' =&gt;'=' )\n        )\n    ), ....\n                外側のコンテキストの1レコードを処理すると、その内部にあるエンクロージャー／リピーターが見つかります。そのとき、コンテキスト名がdetailのrelationキーの値を参照します。そして、join-fieldキーについては、外側の1レコードに存在する値を取り出し、foreign-fieldキーの値とoperatorキーの値を使って検索条件を作ります。たとえば、外側のレコードのidフィールドの値が34だった場合、「master_id = '34'」という条件を作成し、AND条件として追加します。relationの配列は配列が複数あってもかまいません。その場合、すべての指定で生成される条件式のANDをとります。\n                なお、join-fieldの指定は必須です。不要と思われるかもしれませんが、必ずしも主キーとリンクしているとは限らないので指定は必須としました。\n                検索結果の並べ替えに関して\n                INTER-Mediatorは、検索結果の並べ替え関して以下の2つの設定個所があります。検索のクエリに対して、並べ替えの順序を決める基準となるフィールドを指定できます。\n                \n                    定義ファイルのコンテキストの中のsortの設定\n                    INTERMediatorオブジェクトのadditionalSortKeyプロパティ（JavaScript）\n                \n                定義ファイルのsortでの設定は、常に適用されるソートキーです。一方、additionalSortKeyプロパティはプログラムで状況に応じて設定されるソートキーです。検索時にはこれらが合成されて、並べ替えを行います。優先順位は、additionalSortKeyプロパティの方が上位になります。また、それぞれの設定の中で、指定した順序で上位の並べ替えフィールドとなります。いずれも、配列の形式で指定をし、fieldとdirectionというキーを指定します。fieldキーに対する値は1つのフィールド名を指定します。directionに対する値はデータベースエンジンに従います。たとえば、MySQLだと、ASCあるいはDESCを指定しますが、FileMaker Serverはascendあるいはdescendを指定します。additionalSortKeyプロパティについては、addtionalConditionプロパティと同様、最初のインデックスはコンテキスト名を指定し、その後にオブジェクトあるいはオブジェクトの配列を指定します。\n            \n            \n                ページ移動ナビゲーションの構築\n                ページ移動のナビゲーションは、ページの中に、idが「IM_NAVIGATOR」のノードがあれば、そのノードの内容を置き換えてナビゲーションを作成します。「IM_NAVIGATOR」のidのノードがない場合には、ナビゲーションは表示されません。通常は、divタグの要素を「&lt;div id=\"IM_NAVIGATOR\"&gt;&lt;/div&gt;」のように作っておくのがいいでしょう。\n                INTER-Mediator.constructメソッドは、ノードを見つけて自動的にページナビゲーションにしますが、それらの要素に以下のようなクラス設定をしています。つまり、ページで、これらのクラスに対してスタイルシートで定義を行えば、見栄えについては自由に設定ができます。\n                \n                    \n                        \n                            要素名.クラス名\n                            設定先\n                        \n                        \n                            .IM_NAV_panel\n                            ナビゲーションそのもの。つまり、idが「IM_NAVIGATOR」のノードに設定される\n                        \n                        \n                            span.IM_NAV_info\n                            文字情報を表示する部分に設定される\n                        \n                        \n                            span.IM_NAV_button\n                            クリックできるボタンに対して設定される\n                        \n                        \n                            span.IM_NAV_disabled\n                            クリックできないボタンに対して設定される\n                        \n                    \n                \n                ナビゲーション領域の文言等は、INTERMediator.navigationLabelに配列を設定することで、任意に設定できます。配列のインデックスと対応する箇所は以下の表に示します。INTERMediator.navigationLabelに何も設定しない場合には、表の既定値が画面に見えます。\n                \n                    \n                        \n                            インデックス\n                            設定対象\n                            既定値\n                            非表示\n                        \n                        \n                            0\n                            最初のレコードに戻る\n                            &lt;&lt;\n                            インデックス0〜3\n                        \n                        \n                            1\n                            前のページに戻る\n                            &lt;\n                            無関係\n                        \n                        \n                            2\n                            次のページに進む\n                            &gt;\n                            無関係\n                        \n                        \n                            3\n                            最後のレコードに進む\n                            &gt;&gt;\n                            無関係\n                        \n                        \n                            4\n                            レコード番号の直前\n                            レコード番号\n                            インデックス4〜7\n                        \n                        \n                            5\n                            レコード番号の範囲の間の文字列\n                            -\n                            無関係\n                        \n                        \n                            6\n                            レコード番号範囲と全レコード数の間の文字列\n                            /\n                            無関係\n                        \n                        \n                            7\n                            全レコード数の後の文字列\n                            （空文字列）\n                            無関係\n                        \n                        \n                            8\n                            更新ボタンの名称\n                            更新\n                            インデックス8\n                        \n                        \n                            9\n                            レコード作成などのボタンの表示の有無\n                            作成や削除などレコード操作のボタン\n                            インデックス9\n                        \n                        \n                            10\n                            まとめ保存のボタン\n                            保存\n                            インデックス10\n                        \n                        \n                            11\n                            ログアウトボタンの名称\n                            ログアウト\n                            インデックス11\n                        \n                    \n                \n                INTERMediator.navigationLabelに指定する配列は12の要素を指定します。それぞれ、インデックスに要素が対応します。要素がnullだと既定値のままになります。文字列を指定すると、その文字列に置き換わります。インデックスが0、4,、8、9、10、11の要素に関しては、値をfalseにすると「非表示」の列に示したものが非表示になります。たとえば、以下の記述だと、更新ボタンのみが消えて他は既定とおりのものが表示されます。インデックス9の「レコード作成」などのボタンのカスタマイズは、コンテキスト定義にあるbutton-namesキーで行います。\n                INTERMediator.navigationLabel = [null, null, null, null, null, null, null, null, false];\n            \n            \n                HTMLのUIコンポーネントの扱い\n                テキストフィールド\n                INPUTタグ要素のtype属性がtextの場合、ターゲット指定の3つ目の指定は省略できます。その場合、value属性に値が設定されます。テキストを編集すれば、テキストフィールドの内容がデータベースに書き戻されます。書き戻しは、フォーカスを外した時や、あるいは入力してから5秒後に行われます。\n                テキストエリア\n                ターゲット指定の3つ目の指定は省略できます。すると、TEXTAREAタグ要素のテキストとして設定されます。テキストフィールドと同様、テキストを編集すれば、テキストフィールドの内容がデータベースに書き戻されます。書き戻しは、フォーカスを外した時や、あるいは入力してから5秒後に行われます。\n                ポップアップメニュー／リスト\n                SELECTタグの要素自体が値を持つコンポーネントです。SELECTタグ要素のターゲット指定の3つ目の項目を省略すると、SELECT要素の選択値として指定されます。また、OPTIONタグは決められたものでもかまいませんが、データベースからも値を設定できます。このとき、自動的に、SELECT/OPTIONタグがエンクロージャー／リピータとなります。OPTIONタグはSELECTタグ要素の選択値に対応するvalue属性と、実際にメニュー項目として見えるOPTIONタグ要素のテキストの2つの設定が必要になるでしょう。従って、「&lt;option data-im=\"contact_way@id@value contact_way@name\"&gt;&lt;/option&gt;」のようなターゲット指定が2つあるようなタグ要素をSELECTの中に1つだけ作っておき、ターゲット指定の1つ目の名前のコンテキスト定義を定義ファイルに記述しておきます。\n                チェックボックス\n                データベースから読み出された特定のフィールドのデータがチェックボックスのINPUTタグ要素とリンクされている場合、そのタグのvalue属性を調べます。そして、データとvalue属性が一致していればチェックを入れます。データの有無ではなく、valueとの一致を調べます。また、書き戻す場合は、チェックが入ったときはvalue属性の値、チェックがなくなった場合には空文字列を書き戻します。通常、数値フィールドで、1ならチェックあり、それ以外ならチェックなしといったデータの持たせ方をするのが順当でしょう。\n                ラジオボタン\n                ラジオボタンに展開したい場合、同一のターゲット指定のINPUTタグでtype属性が「radio」のものを並べます。すると、name属性を自動的に設定し、複数レコードが繰り返されたときでも、問題なく処理できるようになります。それぞれのINPUTタグ要素のvalue属性はおのおのが自分の値を持ちます。データベースのフィールドの値とvalue属性の値を比べて同一のものが選択されます。\n            \n            \n                入力フォーム型ページの作成\n                アンケートの回答のような、入力フォームがあってその内容に従った新規レコードを作るだけのようなページの作り方をここで説明します。そのようなページを作るのに必要なことは以下の通りです。\n                \n                    HTMLでフォームを作るが、FORMタグは不要。必要なテキストフィールドと、登録ボタンを作成する。ただし、テキストフィールドなどは、1つのエンクロージャにまとめておく。\n                    定義ファイルに、レコードの作成が可能なコンテキストを定義する。\n                    入力フォームにしたいエンクロージャのdata-im-control属性を「post」とする。\n                    HTMLのフォームの入力要素をリンクノードにします。つまり、コンテキストの名前（context）と対応するテーブルのフィールド名（field）に対して、data-im=\"context@field\" をタグの中に記述する。\n                    「登録」ボタンはBUTTONタグで作成し、data-im-control属性に「post」を指定する。ボタン名は任意。\n                \n                登録ボタンは、テーブルのヘッダやフッタに配置することもできます。登録ボタンを押した後の動作については、コンテキストに定義できる「post-」で始まる3つの項目が用意されています。ボタンを何度も押す事を避けるために、ボタンをメッセージで置き換えたり、別のページに移動したり、ページの再描画ができます。コンテキストに指定したバリデーションの設定についても機能します。\n                この機能を使う場合、data-im-control属性に「post」を指定したエンクロージャーの外部にあるエンクロージャーに対しては、普通にページ合成ができるので、データベースアクセスの結果と、入力フォームを混在させることもできます。また、入力フォームの内部のエンクロージャーも同様に通常通り処理されるので、マスターの内容からポップアップを構築する事ができます。\n                登録ボタンをクリックした後に独自のプログラムを追加したい場合は、以下のような記述の関数を定義します。メッセージ表示、ページ再合成、ページ移動が定義されていた場合、それらよりも前に、以下に定義した関数を実行します。processingBeforePostOnlyContextは、データベースへの書き込み前に実施され、返り値がfalseだとデータベース処理を行わず、ページ移動なども行いません。processingAfterPostOnlyContextはデータベース処理後に実行され、返り値は指定しません。\n                INTERMediatorOnPage.processingBeforePostOnlyContext = function(node){\n            // any program here.\n};\nINTERMediatorOnPage.processingAfterPostOnlyContext = function(node){\n// any program here.\n};\n\n                \n            \n            \n                ブラウザのバージョンを調べる仕組み\n                ブラウザのバージョンを調べて、一定のもの以外は表示できないようにしたいと思うこともあります。この機能を、必要に応じて利用できるようにしました。\n                まず、INTER-Mediator.phpと同じディレクトリにある$paramsファイルに、変数名$browserCompatibilityという変数を定義し、配列記述します。配列の記述方法は表に示します。作成例も紹介します。。\n                \n                    \n                        \n                            次元\n                            指定内容\n                            指定する値の例\n                        \n                        \n                            第1次元\n                            ブラウザの種類\n                            msie, firefox, safari, chrome, opera\n                        \n                        \n                            第2次元\n                            配列（OSを示すキー）\n                            mac, win\n                        \n                        \n                            \n                            バージョン記述文字列\n                            3+, 4-\n                        \n                        \n                            第3次元\n                            バージョン記述文字列（第2次元が配列のとき）\n                            3+, 4-\n                        \n                    \n                \n                $browserCompatibility = array(\n    'chrome' =&gt;'1+',\n    'msie' =&gt;'7+',\n    'firefox' =&gt;'2+',\n    'safari' =&gt;array( 'win' =&gt;'4+', 'mac' =&gt;'3+' ),\n    'opera' =&gt;'1+',\n);\n\n                \n                「バージョン記述文字列」は、数字とプラスないしはマイナスで指定します。「3+」は3以上、「3-」は3以下のバージョンで利用できることを示します。プラスあるいはマイナスを付けないと、その数値のバージョンのみです。ブラウザ名やOSは、大文字小文字は関係ありません。\n                前の例だと、Safariのみ、OSごとに分岐しています。WindowsならVer.4以上、MacならVer.3以上は利用可能であることを示しています。\n                ブラウザの互換性をメッセージとして表示する\n                JavaScriptベースで動くINTER-Mediatorにとって、これがいちばん難しい仕事かもしれません。ブラウザによっては、JavaScriptが動かないこともあるかもしれないのです。こうした状況をうまく処理するために、以下のような点を考慮します。\n                \n                    ページファイルの中の、bodyタグ要素の直下あたりに、INTER-Mediatorが一切しない場合のメッセージを付けておく。たとえば、サンプルファイルの「WebSite」のindex.htmlにあるid=nonsupportedmessageのdivタグ要素。INTER-Mediatorの動作が成功すれば、このノードを削除するか表示しないようにする。これにより、JavaScriptが一切動かない状態でも、何らかのメッセージが見えるようになる。\n                    ページファイルの構築を以下のようなプログラムにする。INTERMediatorCheckBrowser関数で前に説明した$paramsファイルの変数の定義に従って、ブラウザの互換性をチェックする。もし、対応でないならfalseを返すので、ページ構築はしない。また、その場合は、body要素の中身をいちど全部クリアして、メッセージだけを表示する。もし、対応しているならnodeで示したノードを削除する。nodeはnullあるいは未指定でも構わない。\n                \n                上記の2つのうち、一方だけでもかまいませんし、両方をやってもかまいません。また、チェックは不要ということなら、単にINTERMediator.construct(true);を呼び出すだけでもいいでしょう。\n                &lt;!DOCTYPE html&gt;\n&lt;html&gt;\n    &lt;head&gt;\n        &lt;meta http-equiv=\"content-type\" content=\"text/html;charset=UTF-8\"/&gt;\n        &lt;title&gt;Page Title&lt;/title&gt;\n        &lt;script type=\"text/javascript\" src=\"context.php\"&gt;&lt;/script&gt;\n        &lt;script type=\"text/javascript\"&gt;\n            INTERMediatorOnPage.doAfterConstruct = function () {\n                var contentNode = document.getElementById('container');\n                contentNode.style.display = \"block\" \n            }\n        &lt;/script&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n        &lt;div id=\"nonsupportmessage\" style=\"background-color:#333333\"&gt;\n            &lt;div style=\"text-align:center;color:yellow\"&gt;\n                If you see this, you must use any unsupported web browser. Or constructing the page.\n            &lt;/div&gt;\n            &lt;div style=\"text-align:center;color:yellow\"&gt;\n                この表示が見えている場合、描画処理中です。しばらくお待ちください。長時間見えている場合は、非対応ブラウザで参照しています。\n            &lt;/div&gt;\n        &lt;/div&gt;\n        &lt;div id=\"container\" style=\"display: none\"&gt;\n            // ページコンテンツ\n        &lt;/div&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n\n                \n            \n        "
    },
    {
        "id": 16,
        "parent": "/ja/for-developers/",
        "path": "/ja/for-developers/reference.html",
        "title": "定義ファイルの記述方法",
        "breadcrumb": "定義ファイルの記述方法",
        "body": "\n        \n            はじめに\n            \n                定義ファイルに記述するIM_Entry関数の引数に、データベースに関する情報を与えておきます。4つの引数があり、うち3つは配列を指定します。配列の内容を記載します。以下の表で、次元の列にキーワードがあれば、「'キーワード'\n                =&gt; '値' 」で該当する値を与えます。次元が「（なし）」というのは、その次元では、単に要素が並ぶということを意味します。サンプルファイルの例などを見ながら解読してください。\n        \n        \n            第1引数、テーブルとそれに関連した属性\n            \n                テーブルと、テーブル間を関連づけるフィールドを指定します。この引数の第2次元にまとめられた1つの配列の設定を「コンテキスト定義」と呼ぶことにします。つまり、name、keyなどのキーを持った連想配列の1つ1つがコンテキスト定義です。もちろん、コンテキスト定義は複数を定義することが可能です。ここでのnameが、ターゲット指定のテーブル名で使用します。テーブル間の結合における相手のテーブル名がないと思われるかもしれませんが、相手のテーブル名は、ページファイル側の記述で自動的に決まってきます。\n            \n                \n                    [第1引数, コンテキスト定義]\n                    コンテキスト名とエンティティ情報\n                \n                \n                    \n                    \n                        キー\n                        値\n                    \n                    \n                    \n                    \n                        'name'\n                        \n                            テーブル名[必須]。'view'がなければすべての処理を適用する「テーブル名」、'view'があれば書き込みや更新処理のときの「テーブル名」\n                        \n                    \n                    \n                        'table'\n                        \n                            指定すると更新時の「テーブル名」に使用される。指定しないと、nameで指定した名前のテーブルに書き込む\n                        \n                    \n                    \n                        'view'\n                        \n                            指定すると読み込みのときの「テーブル名」に使用される。指定しないと、nameで指定した名前のテーブルから読み込む\n                        \n                    \n                    \n                        'count'\n                        \n                            通常はレコード数のカウントをviewキーで指定したエンティティに対して行うが、この定義を追加すると個数を求めるときだけviewの代わりにcountで指定したエンティティを使用する。ビューの応答が遅い場合、同一条件で結果が得られるテーブルを指定できる場合にはパフォーマンス向上が期待できる\n                        \n                    \n                    \n                        'source'\n                        \n                            1ページに複数のコンテキストが展開されている時、あるコンテキストでのレコード作成や削除結果を、同一のテーブルから構成された別のコンテキストにも反映させるための設定。この名前が同じコンテキスト群では、レコードの作成や削除結果が同期される。指定がなければ、table、view、nameの順にさかのぼって設定を得る。ビューをviewキーで指定したときにその主要テーブルを指定するような場合に使用する。\n                        \n                    \n                    \n                        'key'\n                        \n                            レコードを特定するためのキーフィールドの名前を指定する。表示のみの場合には不要だが、更新処理にはこのフィールドは必要。単一のフィールドの指定しかできない。FileMaker\n                            Serverでは「-recid」と指定することで、システムが管理するレコード識別のための値を利用できる。\n                        \n                    \n                    \n                        'sequence'\n                        \n                            PostgreSQLにおいて、レコード追加を行うためには、シーケンスを利用してキーフィールドに連番を設定する必要がある。そのシーケンス名をここで指定をする。\n                        \n                    \n                    \n                        'cache'\n                        \n                            trueを指定するとキャッシュが機能する。同一ページ内で、１つのコンテキストを複数箇所で利用する場合、それぞれが同一の検索結果の場合に利用できる。例えば、ポップアップメニューの選択など。\n                        \n                    \n                    \n                        'data'\n                        \n                            読み込み時のみ、サーバーへのデータ処理は行わず、この値がそのままデータベースから得られたものとしてペー上に展開する。データ形式は、1レコードを示す連想配列を、さらに配列に含めたもの。編集可能なコンテキストでは利用しないのが原則とする。\n                        \n                    \n                    \n                        'appending-data'\n                        \n                            読み込み時に、サーバーへクエリー結果の末尾に、さらにこの値を追加する。データ形式は、1レコードを示す連想配列を、さらに配列に含めたもの。\n                        \n                    \n                    \n                        'ignoring-field'\n                        \n                           フィールド名の文字列の配列を値に指定する。デバッグモード=2で稼働させると、検索結果に要求されたフィールド（つまりページファイルに展開した計算フィールド以外のフィールド）が存在しない場合はエラーとして処理を停止させる。ここに名前を設定すれば、検索結果にないフィールドがあってもエラーを出さない。extending-classで全く異なるフィールド構成のデータを生成している場合、デバッグモードでのエラーを回避できる。\n                        \n                    \n                    \n                        'numeric-fields'\n                        \n                           数値型として見做して欲しいフィールドについて、フィールド名の文字列の配列を値に指定する。INTER-Mediatorはスキーマ情報から型を自動的に取得するが、SQLiteでViewに記述した計算結果のフィールドについては型が得られない。そのフィールドを数値として解釈させるために利用する。そうしないと、検索条件に応じた検索がうまくできない。\n                           \n                    \n                    \n                \n                \n                    [第1引数, コンテキスト定義]\n                    レコード繰り返しとページング\n                \n                \n                    \n                    \n                        キー\n                        値\n                    \n                    \n                    \n                    \n                        'records'\n                        \n                            1ページに何レコード分表示するか。最初のテーブルの設定のみ有効。未指定の場合は100000000、つまり十分に大きな値\n                        \n                    \n                    \n                        'maxrecords'\n                        \n                            1ページ内の最大表示レコード数。INTERMediator.pagedSizeの値を調整することで1ページ内の表示レコード数を変更できるが、その際にこのキーで指定した値を超えて表示することはできない。未指定の場合は100000000、つまり十分に大きな値\n                        \n                    \n                    \n                        'paging'\n                        recordsで指定したレコード数ずつ表示するとき、前後のページに移動するナビゲーションを表示する場合、trueを指定する。既定値はfalse\n                    \n                    \n                        'soft-delete'\n                        \n                            コンテキストに対する削除において、論理削除を行う。検索時には、論理的に削除されたレコードは検索対象外とする。値をtrueにすると、レコード削除時に、deleteフィールドに1を代入する。deleteフィールドのタイプは数値を想定している。delete以外のフィールドを利用したい場合には、値をフィールド名にする。\n                        \n                    \n                    \n                \n                \n                    [第1引数, コンテキスト定義]\n                    リレーションシップ、検索条件、並べ替え、初期値\n                \n                \n                    \n                    \n                        配列指定\n                        値\n                    \n                    \n                        キー\n                        インデックス\n                        下位のキー\n                    \n                    \n                    \n                    \n                        'relation'\n                        (なし)\n                        'foreign-key'\n                        \n                            リレーションの外部キーフィールド名（この設定は事実上データ取り出し時のみ有効）\n                        \n                    \n                    \n                        'join-field'\n                        \n                            外部キーフィールドに対応するテーブル側の関連フィールド\n                        \n                    \n                    \n                        'operator'\n                        \n                            外部キーフィールドと対応するフィールドの比較演算子\n                        \n                    \n                    \n                        'portal'\n                        \n                            FileMaker Serverを利用しているときに、このコンテキストのデータを、親コンテキストのレイアウト上にあるポータルから取得する場合にtrueを値に指定する\n                        \n                    \n                    \n                        'query'\n                        (なし)\n                        'field'\n                        検索条件のフィールド名（この設定はデータ取り出し時のみ有効）\n                    \n                    \n                        'value'\n                        検索値\n                    \n                    \n                        'operator'\n                        検索値の解釈\n                    \n                    \n                        'sort'\n                        (なし)\n                        'field'\n                        ソート条件のフィールド名（この設定はデータ取り出し時のみ有効）\n                    \n                    \n                        'direction'\n                        昇順か降順か\n                    \n                    \n                        'default-values'\n                        (なし)\n                        'field'\n                        新規レコード作成時、およびレコードコピー時の初期値指定のフィールド名\n                    \n                    \n                        'value'\n                        初期値\n                    \n                    \n                        'portals'\n                        \n                            FileMaker Data APIを利用しているときに、コンテキストに含まれるポータル名を配列で指定する。なくても動作するが、その場合ポータル名の取得のためのアクセスが発生し、パフォーマンスに少し影響する。\n                        \n                    \n                    \n                \n                \n                    [第1引数, コンテキスト定義]\n                    計算プロパティ\n                \n                \n                    \n                    \n                        配列指定\n                        値\n                    \n                    \n                        キー\n                        インデックス\n                        下位のキー\n                    \n                    \n                    \n                    \n                        'calculation'\n                        (なし)\n                        'field'\n                        計算結果を表示するリンクノードのターゲット指定。コンテキスト名は現在のコンテキスト名を使うため指定しない。属性やスタイル等の指定は可能\n                    \n                    \n                        'expression'\n                        計算式。同一コンテキストのフィールド参照はフィールド名のみ記述する。他のコンテキストのフィールド参照は「コンテキスト名@フィールド名」の形式で記述する\n                        \n                    \n                    \n                \n                \n                    [第1引数, コンテキスト定義]\n                    Post Onlyモードの動作定義\n                \n                \n                    \n                    \n                        キー\n                        値\n                    \n                    \n                    \n                    \n                        'post-reconstruct'\n                        \n                            trueなら、入力型フォームにおいて、登録ボタンを押した後にページの再合成を行う。post-dismiss-messageが指定されていれば、4秒後待って再合成する。falseあるいは指定なしなら何もしない\n                        \n                    \n                    \n                        'post-dismiss-message'\n                        \n                            入力型フォームにおいて、登録ボタンを押した後に、ボタンを消してここに記述したメッセージの文字列を表示する。文字列はSPANタグでclass属性が「IM_POSTMESSAGE」となる。\n                        \n                    \n                    \n                        'post-move-url'\n                        \n                            入力型フォームにおいて、登録ボタンを押した後に、ここで指定したURLにページを移動させる。指定しない場合にはページ移動はない。post-dismiss-messageが指定されていれば、4秒後に移動する\n                        \n                    \n                    \n                \n                \n                    [第1引数, コンテキスト定義]\n                    ユーザーインタフェース生成\n                \n                \n                    \n                    \n                        配列指定\n                        値\n                    \n                    \n                        キー\n                        下位のキー\n                    \n                    \n                    \n                    \n                        'repeat-control'\n                        \n                        \n                            繰り返し表示する部分に、レコードの追加や削除の機能を追加する。値には以下の文字列を与える。confirmがあれば確認ダイアログが表示される。複数を指定する場合はそれぞれの文字列を空白で区切って書き並べる。\n\n使用できるキーワード動作説明\ninsertレコード追加ボタンレコード追加ボタンを、レコードリストの直下、あるいは1レコード単位の場合はページネーションバーに表示する\ninsert-topレコード追加ボタン同上だが、レコードリストの直上にボタンが表示される\nconfirm-insertレコード追加ボタンボタンを押すと、本当にレコード作成して良いかをダイアログボックスでたずねる\nconfirm-insert-topレコード追加ボタン同上、かつボタンはリストの場合その直上に配置\ndeleteレコード削除ボタンレコード削除ボタンをリピータの最後の要素に追加する\nconfirm-deleteレコード削除ボタンボタンを押すと、本当にレコード削除して良いかをダイアログボックスでたずねる\ncopyレコード複製ボタンレコード複製ボタンをリピータの最後の要素に追加する\nconfirm-copyレコード複製ボタンボタンを押すと、本当にレコード複製して良いかをダイアログボックスでたずねる\ncopy-xxxxレコード複製ボタンxxxxには関連レコードのコンテキストを指定する。これにより、関連レコード群も外部キーを考慮して複製される\nconfirm-copy-xxxxレコード複製ボタンボタンを押すと、本当にレコード複製して良いかをダイアログボックスでたずねる\n\n                        \n                    \n                    \n                        'navi-control'\n                        \n                        \n                            2つのコンテキストを利用して、マスター/ディテール形式のユーザインタフェースを構築する。マスター側は複数のレコードを表示し、それぞれ対応するディテール側を表示するボタンが追加される。ディテール側では1レコードを表示する。2つのコンテキストは、原則として同一のテーブルを元にした異なるコンテキストである必要がある。FileMaker Serverを利用する時には、detailを指定したコンテキストのidキーの値は「-recid」にする必要がある。さらに、コンテキストを次々に移動できるステップ動作をするコンテキストも定義できる。\n\n使用できるキーワード動作説明\nmasterマスター側のコンテキストマスターとディテールを同時に表示\nmaster-hideマスター側のコンテキストディテール側に移動時にマスター側は非表示\nmaster-nonaviマスター側のコンテキストマスターとディテールを同時に表示\nmaster-nonavi-hideマスター側のコンテキストディテール側に移動時にマスター側は非表示\nmaster-fullnaviマスター側のコンテキストマスターとディテールを同時に表示\nmaster-fullnavi-hideマスター側のコンテキストディテール側に移動時にマスター側は非表示\ndetailディテール側のコンテキストdetail-topと同じ動作\ndetail-topディテール側のコンテキストマスターに戻るボタンを上部に表示（マスター側がmaster-hide）\ndetail-bottomディテール側のコンテキストマスターに戻るボタンを下部に表示（マスター側がmaster-hide）\ndetail-updateディテール側のコンテキストdetail-topと同じ動作に加えて、マスター側を更新\nstepステップ動作の1つのコンテキストページ表示時に見えている\nstep-hideステップ動作の1つのコンテキストページ表示時には見えていない\nstep-nonaviステップ動作の1つのコンテキストページ表示時に見えている\nstep-nonavi-hideステップ動作の1つのコンテキストページ表示時には見えていない\nstep-fullnaviステップ動作の1つのコンテキストページ表示時に見えている\nstep-fullnavi-hideステップ動作の1つのコンテキストページ表示時には見えていない\n付加文字列適用先意味\n-hideマスターディテール側に切り替えるとマスターは非表示\n-hideステップページ表示時には見えていない\n-nonaviマスター及びステップ自動化のナビゲーションは表示しない、背景応答もしない、デスクトップとモバイルは同一動作\n-fullnaviマスター及びステップあらゆるナビゲーションを表示し背景応答もする、デスクトップとモバイルは同一動作\n\n                        \n                    \n                    \n                        'navi-title'\n                        \n                        ターゲット指定が「_@navi_title」の要素に、このキーで指定した文字列を設定する。\n                    \n                    \n                        'before-move-nextstep'\n                        \n                        ステップのセルをタップした時に呼び出されるメソッド名。INTERMediatorOnPageオブジェクトに、ここで指定した名前のメソッドを定義する\n                    \n                    \n                        'just-move-thisstep'\n                        \n                        ステップのエリアを生成した直後、つまりデータベース処理をしてページ合成が終わった直後に呼び出されるメソッド名。INTERMediatorOnPageオブジェクトに、ここで指定した名前のメソッドを定義する\n                    \n                    \n                        'just-leave-thisstep'\n                        \n                        このステップから別のステップに以降する直前に呼び出されるメソッド名。INTERMediatorOnPageオブジェクトに、ここで指定した名前のメソッドを定義する\n                    \n                    \n                        'button-names'\n                        'insert'\n                        repeat-controlに「insert」を指定したときに追加されるボタンのボタン名\n                    \n                    \n                        'delete'\n                        repeat-controlに「delete」を指定したときに追加されるボタンのボタン名\n                    \n                    \n                        'copy'\n                        repeat-controlに「copy」を指定したときに追加されるボタンのボタン名\n                    \n                    \n                        'navi-detail'\n                        navi-controlに「master」あるいは「step」を指定したときに追加されるボタンのボタン名。マスター側に追加されるディテール側へ移動するボタン、あるいは次のステップに移動するためのボタンの名前\n                    \n                    \n                        'navi-back'\n                        navi-controlに「detail」を指定したときに追加されるボタンのボタン名。ディテール側に追加されるマスター側へ移動するボタンの名前\n                    \n                     \n                        'confirm-messages'\n                        'insert'\n                        repeat-controlに「insert-confirm」を指定したときに表示されるダイアログボックス内のメッセージ\n                    \n                    \n                        'delete'\n                        repeat-controlに「delete-confirm」を指定したときに表示されるダイアログボックス内のメッセージ\n                    \n                    \n                        'copy'\n                        repeat-controlに「copy-confirm」を指定したときに表示されるダイアログボックス内のメッセージ\n                    \n                    \n                \n                \n                    [第1引数, コンテキスト定義]\n                    バリデーション\n                \n                \n                    \n                    \n                        配列指定\n                        値\n                    \n                    \n                        キー\n                        インデックス\n                        下位のキー\n                    \n                    \n                    \n                    \n                        'validation'\n                        (なし)\n                        'field'\n                        データ確認を行うフィールド名（バリデーションはVer.2.1以降で実装）\n                    \n                    \n                        'rule'\n                        \n                            確認処理。JavaScriptの式を記述する。コンポーネントの値は変数value、ノードへの参照は変数targetに入っているものとして、式を組み立てることができる。式の結果がtrueならそのまま処理を進めるが、falseならmessageの文字列をダイアログボックスで表示して、コンポーネントの値を元に戻す\n                        \n                    \n                    \n                        'message'\n                        正しくない場合に表示するメッセージ（ruleがfalseのときに表示される）\n                    \n                    \n                        'notify'\n                        \n                            'inline'なら直後、'end-of-sibling'なら兄弟ノードの最後にメッセージのテキストを追加する。このとき、ノードのクラス名は'_im_alertmessage'となる。これ以外の表記あるいは、notifyを省略すると、ダイアログボックスで表示される。\n                        \n                    \n                    \n                \n                \n                    [第1引数, コンテキスト定義]\n                    合成処理やデータベース処理の拡張\n                \n                \n                    \n                    \n                        キー\n                        値\n                    \n                    \n                    \n                    \n                        'post-repeater'\n                        ページ合成時に1つのリピータの処理が終わった後に呼び出される関数名を記述する。その関数自体は、INTERMediatorOnPageオブジェクトのメソッドとして定義する。なお、INTERMediatorOnPage.postRepeater_[コンテキスト名]でメソッドを定義すれば、コンテキスト定義にこのエントリーは不要。\n                    \n                    \n                        'post-enclosure'\n                        ページ合成時に1つのエンクロージャーの処理が終わった後に呼び出される関数名を記述する。その関数自体は、INTERMediatorOnPageオブジェクトのメソッドとして定義する。なお、INTERMediatorOnPage.postEnclosure_[コンテキスト名]でメソッドを定義すれば、コンテキスト定義にこのエントリーは不要。\n                    \n                    \n                        'extending-class'\n                        データアクセス時にサーバー側で処理プログラムを追加するクラスのクラス名を指定する\n                    \n                    \n                \n                \n                    [第1引数, コンテキスト定義]\n                    スクリプト実行\n                \n                \n                    \n                    \n                        配列指定\n                        値\n                    \n                    \n                        キー\n                        インデックス\n                        下位のキー\n                    \n                    \n                    \n                    \n                        'script'\n                        (なし)\n                        'db-operation'\n                        \n                            データベース処理の前後に行う処理の指定。スクリプトを実行する場面で、値は'read', 'update', 'create', 'delete'のいずれか\n                        \n                    \n                    \n                        'situation'\n                        \n                            スクリプトの実行を行うタイミングで、'pre', 'presort', 'post'のいずれかの値を取る（'presort'はFileMaker Serverのみサポート）\n                        \n                    \n                    \n                        'definition'\n                        \n                            MySQLは指定したSQLコマンドを実行、FileMaker Serverはスクリプト名を指定。（FileMaker\n                            Serverでforeign-keyの指定されたテーブルの読み込み時の設定はすべて無視される）\n                        \n                    \n                    \n                        'parameter'\n                        FileMaker Serverを利用しているときにスクリプト引数を指定する。バージョン5.4以降で利用可能。\n                    \n                    \n                \n                \n                    [第1引数, コンテキスト定義]\n                    FileMakerでのグローバル変数設定\n                \n                \n                    \n                    \n                        配列指定\n                        値\n                    \n                    \n                        キー\n                        インデックス\n                        下位のキー\n                    \n                    \n                    \n                    \n                        'global'\n                        (なし)\n                        'db-operation'\n                        \n                            設定する場面で、値は 'read', 'update', 'create', 'delete'のいずれか（グローバルの設定はFileMaker Serverのみ）\n                        \n                    \n                    \n                        'field'\n                        グローバルフィールド名\n                    \n                    \n                        'value'\n                        グローバルフィールドに与える値\n                    \n                    \n                \n                \n                    [第1引数, コンテキスト定義]\n                    認証・認可とセキュリティ\n                \n                設定情報については、こちらのページにまとめました。\n                \n                    [第1引数, コンテキスト定義]\n                    ファイルアップロード\n                \n                \n                    \n                    \n                        配列指定\n                        値\n                    \n                    \n                        キー\n                        インデックス\n                        下位のキー\n                    \n                    \n                    \n                    \n                        'file-upload'\n                        （なし）\n                        'field'\n                        コンテキスト内のここで指定したフィールドに対してファイルアップロードのコンポーネントが設定されている場合\n                    \n                    \n                        'context'\n                        \n                            この指定があると、指定したコンテキストのpathフィールドにファイルパスを値として指定する新規レコードを作成する。こちらのコンテキストとのリレーションが設定されていれば正しく外部キーが設定される\n                        \n                    \n                    \n                        'container'\n                        アップロードしたファイルの置き場所を指定する。指定可能なキーワードは、\"FileSystem\"、\"FileMakerContainer\"、\"S3\"で、指定なしの場合は\"FileSystem\"が利用される。過去との互換性のために、値がTRUEの場合には\"FileMakerContainer\"が選択される。Amazon S3の場合は、params.phpファイルへの設定が必要になります。FileMakerについては、FileMaker Serverのバージョン13以降が必要、かつデータベースのフィールドオプションにおいて［入力値の自動化］オプションをあらかじめ設定しておく必要があります。詳細はファイルのアップロードコンポーネントの「FileMakerのオブジェクトフィールドにファイルをアップロードする」を参照\n                        \n                    \n                    \n                \n                Amazon S3の場合にparams.phpファイルに指定する変数\n                \n                    \n                    \n                        変数名\n                        既定値\n                        指定内容\n                    \n                    \n                    \n                     \n                        $accessRegion\n                        (設定なし)\n                        接続するAWSのエンドポイントを指定する。東京なら\"ap-northeast-1\"。一覧はこちら\n                    \n                     \n                        $rootBucket\n                        (設定なし)\n                        S3のバケット名\n                    \n                     \n                        $applyingACL\n                        (設定なし)\n                        オブジェクトをPutObjectメソッドで書き込むときに指定するオブジェクトのACL。指定できる値は次の通り：private、public-read、public-read-write、authenticated-read、aws-exec-read、bucket-owner-read、bucket-owner-full-control。例えば、アップロードしたファイルが即座に誰でも参照できるようにした場合はpublic-read、INTER-Mediatorでアクセス権管理をする場合にはbucket-owner-read。\n                    \n                     \n                        $s3AccessProfile\n                        (設定なし)\n                        S3へのアクセスのための認証情報としては、一般にIAMを使ってユーザーを作成し、AmazonS3FullAccessのポリシーをユーザあるいはグループに設定し、そのユーザに対するアクセスキーとシークレットを生成し、それらを利用します。認証情報を記録するために、AWSのクライアントのプロファイルを利用する場合は、ここにプロファイル名を記入します。変数がないあるいはプロファイル名が\"\"など、プロファイル名が指定されていない場合、以下のアクセスキーとシークレットを利用します。このparams.phpファイルにアクセスキーとシークレットを記述する方法については、パブリックなレポジトリではもちろん、共用レポジトリでも問題になるかもしれません。つまり、レポジトリ外にセンシティブな情報を記録する方法として、プロファイルを活用できるようになっています。\n                    \n                     \n                        $s3AccessKey\n                        (設定なし)\n                        $s3AccessProfileを参照してください。アクセスキーを直接指定する場合にはここに指定しますが、こちらの値を使うには、$s3AccessProfileの値を\"\"にします。\n                    \n                     \n                        $s3AccessSecret\n                        (設定なし)\n                        $s3AccessProfileを参照してください。シークレットを直接指定する場合にはここに指定しますが、こちらの値を使うには、$s3AccessProfileの値を\"\"にします。\n                    \n                     \n                        $s3urlCustomize\n                        TRUE\n                        アップロード後にオブジェクトにアクセスするためのURLがS3より返されます。ファイルの読み出しを無制限に行う場合にはそのままのURLをフィールドに保存しますが、INTER-Mediatorのアクセス権設定を有効にするために、MediaAccessクラスを使う場合（「定義ファイル.php?media=URL」でメディア参照ができる仕組み）は、この設定をTRUEにします。すると、S3から得られたURLの冒頭のhttps://をs3://に変えます。変わったURLをそのままフィールドに保存し、mediaパラメータの値として指定すると、S3へはGetObjectメソッドを使って認証アクセスを行うようになります。つまり、INTER-Mediatorでアクセス権の管理を完全に行なっている状態になっています。\n                    \n                   \n                \n                \n                    [第1引数, コンテキスト定義]\n                    データベース接続設定\n                \n                \n                    \n                    \n                        キー\n                        値\n                    \n                    \n                    \n                    \n                        'db-class'\n                        \n                            このコンテキストで使うデータアクセスクラスの名前（例：PDO、FileMaker_FX、FileMaker_DataAPI）この指定がなければ、IM_Entry関数の第3引数あるいはparams.phpの値が使われます。以下、'cert-verifying'まで同様\n                        \n                    \n                    \n                        'dsn'\n                        [PDO]このコンテキストで使う接続時に指定するDSN\n                    \n                    \n                        'option'\n                        [PDO]このコンテキストで使うオプション指定。array型で指定\n                    \n                    \n                        'database'\n                        [FileMaker_FX][FileMaker_DataAPI]このコンテキストで使うデータベース名\n                    \n                    \n                        'user'\n                        [PDO][FileMaker_FX][FileMaker_DataAPI]このコンテキストで使うユーザ名\n                    \n                    \n                        'password'\n                        [PDO][FileMaker_FX][FileMaker_DataAPI]このコンテキストで使うパスワード\n                    \n                    \n                        'server'\n                        [FileMaker_FX][FileMaker_DataAPI]このコンテキストで使うサーバーアドレス（例：127.0.0.1）\n                    \n                    \n                        'port'\n                        [FileMaker_FX][FileMaker_DataAPI]このコンテキストで使うサーバーポート（例：80）\n                    \n                    \n                        'protocol'\n                        [FileMaker_FX][FileMaker_DataAPI]このコンテキストで使うサーバーへの接続プロトコル（例：HTTP）\n                    \n                    \n                        'datatype'\n                        [FileMaker_FX]このコンテキストで使うサーバーがサポートするデータ形式（例：FMPro12）\n                    \n                    \n                        'cert-verifying'\n                        [FileMaker_DataAPI]接続時に証明書の検証が必要かどうかを論理値で指定（例：true）。未指定時はtrue\n                    \n                    \n                \n                \n                    [第1引数, コンテキスト定義]\n                    メール送信\n                \n                メール送信については、メール送信(Ver.5)あるいはメール送信(Ver.6)のページに記載しました。\n                Slackによるメッセージングについては、Slackにメッセージを追加するのページに記載しました。\n\n                 \n                    [第1引数, コンテキスト定義]\n                    複雑なSQL文によるビュー生成\n                \n                \n                    \n                    \n                        キー\n                        値\n                    \n                    \n                    \n                    \n                        'aggregation-select'\n                        \n                            PDOのデータベースクラスのみで利用できます。これらの3つの設定と、sort、queryの設定を加えて、集計処理などのSQLを構成できます。このコンテキストは読み出しのみとなります。なお、INTER-Mediatorは内部ではFROMに指定するテーブルやクエリーの情報を得て、数値フィールドの場合とそうでない場合で検索条件の適用方法を変えています。これらのキーでSQLを構築した場合、フィールド情報を得ることが現状ではできないため、検索条件がうまく当たらない可能性があります。その場合、'numeric-fields'キーで数値データのフィールドのフィールド名を与えると正しく検索されます。\n                        \n                    \n                    \n                        'aggregation-from'\n                    \n                    \n                        'aggregation-group-by'\n                    \n                    \n                \n            \n            認証についは別項目「ユーザ認証とアクセス権の動作について」も参照してください。\n            'relation'、'query'、'sort'、'script'については、配列の配列を指定します。サンプルのソース等で具体例を見てください。\n            それぞれのパラメータの解釈は、データベースドライバによって異なる場合があります。\n        \n        \n            第2引数、オプション設定\n            こちらは、「定義ファイルのオプション設定」と呼ぶことにします。該当する設定がparams.phpでも設定できる場合はその変数名も記載しています。その変数名でparams.phpを検索すれば、コメント等で記述例があるはずです。\n            \n                \n                    [第2引数, オプション設定]\n                    各種動作設定\n                \n                \n                    \n                    \n                        キー\n                        値\n                    \n                    \n                    \n                    \n                        'separator'\n                        テーブル名とフィールド名を区切る文字（既定値は「@」）\n                    \n                    \n                        'transaction'\n                        \n                            編集可能コンポーネントの変更時の書き戻しについて、'none'なら行わない、'automatic'ならchangeイベントが発生するたびに書き戻す。省略するとautomaticが指定されたものとみなす\n                        \n                    \n                    \n                        'media-root-dir'\n                        \n                            メディアアクセスに対して定義ファイルにリダイレクトの設定をWebサーバーで行う。そうすれば、この設定に指定したディレクトリにある画像などのメディアファイルを読み出す。\n                        \n                    \n                    \n                        'credit-including'\n                        INTER-Mediatorのクレジットをページ末尾に表示するのが通常の動作であるが、このキーにHTMLのid属性値を指定すると、そのタグ要素の内部の末尾にクレジットを付加する。他に末尾に付与する仕組みを使うような場合の回避策\n                    \n                    \n                \n                \n                    [第2引数, オプション設定]\n                    アプリケーションのロカール\n                \n                \n                    \n                    \n                        キー\n                        値\nparams.phpで変数名\n                    \n                    \n                    \n                    \n                        'app-locale'\n                        アプリケーション全体の言語およびカントリーコード（例えば、en、ja_JP）。これがあれば、ブラウザーのカントリーコードよりも優先される\n$appLocale\n                    \n                    \n                        'app-currency'\n                        通貨に関する国コード（例えば、US、JP）。指定なしの場合、app-localeの指定を利用\n$appCurrency\n                    \n                    \n                \n                \n                    [第2引数, オプション設定]\n                    テーマ\n                \n                \n                    \n                    \n                        キー\n                        値\nparams.phpで変数名\n                    \n                    \n                    \n                    \n                        'theme'\n                        使用するテーマ名。省略するとdefaultを使用。INTER-Mediatorに付属するテーマセットは他に最小限のleast、以前のバージョンの初期設定に近いthosedaysがある\n$themeName\n                    \n                    \n                \n                \n                    [第2引数, オプション設定]\n                    ローカルコンテキストの初期値\n                \n                \n                    \n                    \n                        配列指定\n                        値\nparams.phpで変数名\n                    \n                    \n                        第1次元\n                        第2次元\n                        第3次元\n                    \n                    \n                    \n                    \n                        'local-context'\n                        （なし）\n                        'key'\n                        ローカルコンテキストのキー（_@以降のキーワード）\n$valuesForLocalContext\n                    \n                    \n                        'value'\n                        コンテキストの初期値\n                    \n                    \n                \n                \n                    [第2引数, オプション設定]\n                    エイリアス\n                \n                \n                    \n                    \n                        配列指定\n                        値\n                    \n                    \n                        第1次元\n                        第2次元\n                        第3次元\n                    \n                    \n                    \n                    \n                        'aliases'\n                        エイリアス名\n                        置き換える定義\n                        エイリアスに対応する値。この値は正しい1つのターゲット指定である必要がある。この指定があれば、ターゲット指定の代わりに、エイリアス名をリンクノードに指定できる。\n                    \n                    \n                \n                \n                    [第2引数, オプション設定]\n                    フォーマッター（サーバーサイドでの値変換）\n                \n                \n                    \n                    \n                        配列指定\n                        値\n                    \n                    \n                        第1次元\n                        第2次元\n                        第3次元\n                    \n                    \n                    \n                    \n                        'formatter'\n                        (なし)\n                        'field'\n                        データコンバータを適用するフィールド名\n                    \n                    \n                        'converter-class'\n                        データコンバータクラス名\n                    \n                    \n                        'parameter'\n                        コンバータクラスに与えるパラメータ\n                    \n                    \n                \n                \n                    [第2引数, オプション設定]\n                    ブラウザの判定\n                \n                \n                    \n                    \n                        配列指定\n                        値\nparams.phpで変数名\n                    \n                    \n                        第1次元\n                        第2次元\n                        第3次元\n                    \n                    \n                    \n                    \n                        'browser-compatibility'\n                        (なし)\n                        文字列\n                        キーにブラウザを示す文字列（safari,\n                            msieなど）を指定し、値にはバージョン番号を指定する。バージョン番号の後に+や-をつけて、以上あるいは以下をのバージョンを示すことができる\n                        \n$browserCompatibility\n                    \n                    \n                        配列\n                        要素にはキーにOSを指定し、その要素に前の行に説明のあるバージョン番号とプラス／マイナス記号を指定する。\n                    \n                    \n                \n                \n                    [第2引数, オプション設定]\n                    認証・認可\n                \n                設定情報については、こちらのページにまとめました。\n                \n                    [第2引数, オプション設定]CSVファイル等からのインポート\n                \n                ファイルのインポートを行うユーザーインタフェースは『INTER-MediatorによるWebアプリケーションの概要』にある『入力フォーム型ページの作成』に従ったページを作成してください。その時、ファイルアップロードを受け付ける要素で、deta-im属性を「コンテキスト@_im_csv_upload」にします。@以下は固定のキーワードです。そうすると、CSVファイルの1行ずつをコンテキストに対してレコード追加します。作成方法は、INTER-Mediatorのレポジトリにあるサンプルのうち、samples/Sample_webpage/fileuploadCSV_MySQL.html（定義ファイルは同じフォルダのinclude_MySQL.php）を参考にしてください。\n                \n                    \n                    \n                        配列指定\n                        値\nparams.phpで変数名\n                    \n                    \n                        第1次元\n                        第2次元\n                    \n                    \n                    \n                    \n                        'import'\n                        '1st-line'\n                        指定なし、あるいはtrueなら1行目をフィールド指定行と見なす。フィールド指定行がない場合には、'フィールド1,フィールド2, ....'といった文字列を指定する。フィールド指定行あるいはテキストファイルの1行目で、_ という名前のフィールドの場合はその列のデータは読み込みしない。\n                        $import1stLine\n                    \n                    \n                        'skip-lines'\n                        先頭から指定した数の行数を無視する。指定なしの場合は0と見なす。フィールド指定行は、ここで指定した行数を省いた最初の行と見なす。\n                        $importSkipLines\n                    \n                    \n                        'format'\n                        読み込むファイルのフォーマットとして\"CSV\"あるいは\"TSV\"を指定する。省略すると\"CSV\"\n                        $importFormat\n                    \n                    \n                        'use-replace'\n                        データベースがMySQLの場合、trueにすると、INSERTではなくREPLACEコマンドを利用してファイルの各行のレコードを挿入あるいは更新する。MySQLでない場合は常にINSERTを利用する。省略するとfalseと見なす。\n                        $useReplace\n                    \n                    \n                        'convert-number'\n                        数値変換を行うフィールド名を配列で指定する。\n                        $comvert2Number\n                    \n                    \n                        'convert-date'\n                        日付への変換を行うフィールド名を配列で指定する。\n                        $comvert2Date\n                    \n                    \n                        'convert-datetime'\n                        日付時刻への変換を行うフィールド名を配列で指定する。\n                        $convert2DateTime\n                    \n                    \n                \n                \n                    [第2引数, オプション設定]Pusherの設定\n                \n                Pusher対応はVer.5までです。\n                \n                    \n                    \n                        配列指定\n                        値\nparams.phpで変数名\n                    \n                    \n                        第1次元\n                        第2次元\n                    \n                    \n                    \n                    \n                        'pusher'\n                        'app_id'\n                        Pusherで定義したAppのapp_id\n                        $pusherParameters\n                    \n                    \n                        'key'\n                        Pusherで定義したAppのkey\n                    \n                    \n                        'secret'\n                        Pusherで定義したAppのsecret\n                    \n                    \n                \n                [第2引数, オプション設定]メール送信サーバー\n                メール送信については、メール送信(Ver.5)あるいはメール送信(Ver.6)のページに記載しました。\n                Slackによるメッセージングについては、Slackにメッセージを追加するのページに記載しました。\n            \n            \n                認証についは別項目「ユーザ認証とアクセス権の動作について」も参照してください。\n            \n            \n                browser-compatibilityは、params.phpファイルでも指定できますが、ここに指定をした方が有効になります。この指定に含まれているブラウザで通常処理を行い、含まれていないブラウザでは処理を行わないようにします。\n            \n            \n                以前「trigger」というキーワードを書いていましたが、この設定は不要で、普通にノードに対してJavaScriptの記述をすればいいので、設定としては組み込まないこととします。\n            \n        \n        \n            第3引数、データベースへの接続情報\n            \n                データベースヘの接続情報を設定します。この設定を「定義ファイルのデータベース接続設定」と呼ぶことにします。なお、INTER-Mediator.phpと同じフォルダに入れておく「params.php」でも、データベース接続に関する指定が可能です。ページごとに接続情報が違うなら、この引数に指定してもいいのですが、たくさんのファイルで同じ設定ならparams.phpで指定をしてもいいでしょう。さらに、IM_Entry関数の第一パラーメータで指定する配列のコンテキストに対しても設定できます。params.php内で指定できる変数についてもまとめておきます。なお、必要な情報は、データベースクラスごとに異なります。以下の表には、値を必要とするクラスも記述してあります。\n            \n            \n                \n                    \n                        \n                            インデックス\n                        \n                        \n                            値\n                        \n                        \n                            params.phpで変数名\n                        \n                    \n                    \n                        \n                            'db-class'\n                        \n                        \n                            データアクセスクラスの名前（例：PDO、FileMaker_FX、FileMaker_DataAPI）\n                        \n                        \n                            $dbClass\n                        \n                    \n                    \n                        \n                            'dsn'\n                        \n                        \n                            [PDO]接続時に指定するDSN\n                        \n                        \n                            $dbDSN\n                        \n                    \n                    \n                        \n                            'option'\n                        \n                        \n                            [PDO]オプション指定。array型で指定\n                        \n                        \n                            $dbOption\n                        \n                    \n                    \n                        \n                            'database'\n                        \n                        \n                            [FileMaker_FX][FileMaker_DataAPI]データベース名\n                        \n                        \n                            $dbDatabase\n                        \n                    \n                    \n                        \n                            'user'\n                        \n                        \n                            [PDO][FileMaker_FX][FileMaker_DataAPI]ユーザ名\n                        \n                        \n                            $dbUser\n                        \n                    \n                    \n                        \n                            'password'\n                        \n                        \n                            [PDO][FileMaker_FX][FileMaker_DataAPI]パスワード\n                        \n                        \n                            $dbPassword\n                        \n                    \n                    \n                        \n                            'server'\n                        \n                        \n                            [FileMaker_FX][FileMaker_DataAPI]サーバーアドレス（例：127.0.0.1）\n                        \n                        \n                            $dbServer\n                        \n                    \n                    \n                        \n                            'port'\n                        \n                        \n                            [FileMaker_FX][FileMaker_DataAPI]サーバーポート（例：80）\n                        \n                        \n                            $dbPort\n                        \n                    \n                    \n                        \n                            'protocol'\n                        \n                        \n                            [FileMaker_FX][FileMaker_DataAPI]サーバーへの接続プロトコル（例：HTTP）\n                        \n                        \n                            $dbProtocol\n                        \n                    \n                    \n                        \n                            'datatype'\n                        \n                        \n                            [FileMaker_FX]サーバーがサポートするデータ形式（例：FMPro12）\n                        \n                        \n                            $dbDataType\n                        \n                    \n                    \n                        'cert-verifying'\n                        [FileMaker_DataAPI]接続時に証明書の検証が必要かどうかを論理値で指定（例：true）。未指定時はtrue\n                      $certVerifying\n                    \n                \n            \n        \n        \n            第4引数、デバッグ情報の表示\n            \n                数値かfalseかを指定します。false以外だと、デバッグ情報をページの最初に表示します。1ないしは2を指定でき、2の方が多くの情報を出します。\n            \n        \n    "
    },
    {
        "id": 17,
        "parent": "/ja/for-developers/",
        "path": "/ja/for-developers/migration.html",
        "title": "バージョン移行ガイド",
        "breadcrumb": "バージョン移行ガイド",
        "body": "\n            \n                はじめに\n                INTER-Mediatorもバージョンを重ねてきており、以前の動作を引き継がなくなってしまった箇所が出てきています。Ver.3 (2012/12/10) 以降の大きな変更点、つまりアプリケーション側を書き換えないといけないような変更をここにまとめておきます。\n            \n            \n                Ver.10での変更\n                params.phpで定義される変数$sendMailCompatibilityModeの初期値をfalseにしました。元はtrueだったので、何も変数定義をしないと、古いアーキテクチャーでのメール送信になっていました。デフォルトを変えたので、この変数をtrueにしない限りは新しいアーキテクチャーのメール送信機能が利用されます。以前のアプリケーションを移行する場合には気をつけてください。\n                package.jsonから、flatpickrの定義をなくしたので、node_modules内にはflatpickrは存在しません。CDNからダウンロードするのが良いかと思われます（samples/Sample_webpage/flatpickr_MySQL.htmlを参照）。\n             \n            \n                Ver.9での変更\n                LDAP認証、ネイティブ認証をサポートしなくなりました。おそらく、Ver.8で、SAML認証に対応する段階で動いていない状態だったかと思われます。機能を復活するのではなく、LDAPサーバを使いたい場合は、SAMLのIdPがLDAPを使うように設定して利用してください。ネイティブ認証については、需要がなかったということで一旦機能を落とします。なお、SAMLを始めマニュアルテストを行う場合に、その確認記録を残すようにしました。\n                処理中を示す「ギア」のアイコンのページがあり、画面全体をグレーで覆うので操作はできないと思われるかもしれませんが、実際にはできていました。しかしながら、連打するとおかしいとかいうクレームがあり、ギアアイコンが出ている間は操作できないようにしました。若干操作性が悪くなると思われますが、操作できるようにするには、CSSで#_im_progress {pointer-events: none;} を記述してください。\n             \n            \n                Ver.8での変更\n                認証の手法をかなり見直しましたが、従来のアプリケーションは、従来の設定のまま稼働するようになっています。しかしながら、そのままでは認証関連は、以前のバージョンの状態のまま稼働することになります。\n                まず、クレデンシャル情報をhttp-onlyのクッキーに残すようにするには、IM_Entry関数の2つ目のオプション変数等で、/authentication/storingキーに対して、credentialというキーワードを設定してください。\n                パスワードのハッシュをSHA-2ベースにするには、params.phpで定義している$passwordHash変数の値を\"2\"などにしてください。ただし、この編集だけだと、ユーザーごとにSHA-2あるいはSHA-1ベースでのハッシュを利用するため、従来のユーザーはパスワードを変更しても、SHA-1のままです。そこで、$alwaysGenSHA2 = true;とすれば、パスワードを変更する時点でSHA-2ベースのハッシュに切り替えることができます。また、$migrateSHA1to2 = true;とすれば、ログイン時など認証が通った時に、SHA-2ベースのハッシュに置き換えます。なお、従来のSHA-1のハッシュをさらにSHA-2でハッシュした、パスワード変更なくハッシュの形式だけSHA-2になるような移行措置もあります。こちらはパスワードのハッシュをまとめて変更できるような場合に有効であると考えられます。今までSHA-1ベースでの認証を行なってきていて、今後SHA-2ベースでの認証を行う場合は、authuser、issuedhashテーブルのスキーマ変更が必要になります。いくつかのフィールドの文字数を増やす必要があります。dist-docsにあるサンプルのデータベーススキーマを参照して、ご利用されているデータベースに反映させてください。\n                認証に関する情報は、こちらのページをご覧ください。\n           \n           \n                Ver.7での変更\n                inter-mediator-plugin-fileuploadは稼働しないと思われます（Ver.8では認証部分が確実に動かないことに気づき、アナウンスはVer.8の途中となりました）。このプラグインはメンテナンスしないことにしました。ファイルのアップロードは、inter-mediator-plugin-jqueryfileuploadの方を使ってください。\n           \n           \n                Ver.6での変更\n                対応ブラウザなどの変更\n                Internet Explorerはサポートしません。Edgeをご利用ください。PHPはVer.7以降です。\n                ファイル構成の変更\n                Ver.5までは、INTER-Mediatorのフォルダに原則として必要なものが入っていて手軽に始められるということを目指していましたが、Ver.6からは、composerを使ってライブラリを集める方式に変更します。そのため、ダウンロード即動くとはなっていません。詳細な文書を用意しましたので、こちらをご一読ください。\n                サービスサーバーの導入\n                サービスサーバーは、Node.jsベースで動くサーバー側の常駐プロセスです。Ver.6ではサーバー側でのバリデーションの評価のために使用していますが、今後、一般的なWebアプリケーション以外の機能をこの常駐プロセスサーバー上で構築する予定です。ただし、セットアップがやや込み入っているので、前述のセットアップに関する文書をご覧ください。\n                完全非同期化に伴い使用できなくなるメソッド\n                Ver.6.0より前は、一部の通信が同期通信でしたが、完全に非同期通信だけになったことから、同期通信関連のメソッドは非実装の状態にします。以下のメソッドがなくなります。これらのメソッドを呼び出しても該当する処理は行わず、エラーログ（ページ上部に赤いバックグランドで表示される）にメッセージ（例「INTERMediator_DBAdapter.server_access method was discontinued in Ver.6」）が追加されるだけになります。\n\nINTERMediator_DBAdapter.server_access\nINTERMediator_DBAdapter.db_query\nINTERMediator_DBAdapter.db_queryWithAuth\nINTERMediator_DBAdapter.db_update\nINTERMediator_DBAdapter.db_updateWithAuth\nINTERMediator_DBAdapter.db_delete method\nINTERMediator_DBAdapter.db_deleteWithAuth\nINTERMediator_DBAdapter.db_createRecord\nINTERMediator_DBAdapter.db_createRecordWithAuth\nINTERMediator_DBAdapter.db_copy method\nINTERMediator_DBAdapter.db_copyWithAuth\n\n                廃止されるPHPのグローバル変数\n                Ver.6.0ではINTER-Mediator.phpで定義されているグローバル変数（$g_dbInstanceと$g_serverSideCall）が廃止される予定です。\n                データベース関連クラスのクラス名の変更\n                Ver.6のPHPのコードは、namespaceに対応しました。その時に、データベース関連のクラスが多数あったので、階層的なネームスペースに分類しました。その結果、コンテキストのextending-classに記述する名前のクラス（データベースアクセス処理の拡張クラス）について、以下のような変更が必要になります。インタフェース名として利用するものは、→の右側のように名前が変わります。インタフェースで定義されていたメソッドに変更はありません。移行時は、シンプルに、ネームスペースの絶対パスでのクラス名に置き換えれば良いでしょう。\n\nExtending_Interface_BeforeRead → \\INTERMediator\\DB\\Extending\\BeforeRead\nExtending_Interface_AfterRead → \\INTERMediator\\DB\\Extending\\AfterRead\nExtending_Interface_AfterRead_WithNavigation → \\INTERMediator\\DB\\Extending\\AfterRead_WithNavigation\nExtending_Interface_BeforeUpdate → \\INTERMediator\\DB\\Extending\\BeforeUpdate\nExtending_Interface_AfterUpdate → \\INTERMediator\\DB\\Extending\\AfterUpdate\nExtending_Interface_BeforeCreate → \\INTERMediator\\DB\\Extending\\BeforeCreate\nExtending_Interface_AfterCreate → \\INTERMediator\\DB\\Extending\\AfterCreate\nExtending_Interface_BeforeDelete → \\INTERMediator\\DB\\Extending\\BeforeDelete\nExtending_Interface_AfterDelete → \\INTERMediator\\DB\\Extending\\AfterDelete\nExtending_Interface_BeforeCopy → \\INTERMediator\\DB\\Extending\\BeforeCopy\nExtending_Interface_AfterCopy → \\INTERMediator\\DB\\Extending\\AfterCopy\n\nそのほかのデータベース関連クラスも名称変更があります。拡張クラス内で利用するようなクラスについて、ネームスペースの絶対パスを紹介しておきます。\n\nDB_Proxy → \\INTERMediator\\DB\\Proxy\nDB_UseSharedObject → \\INTERMediator\\DB\\UseSharedObject\nDB_PDO → \\INTERMediator\\DB\\PDO\nIM_Util → \\INTERMediator\\IM_Util\n\nデータコンバータークラスも、クラス名は変わっています。DataConverter_AppendPrefixだったものは、\\INTERMediator\\Data_Converter\\AppendPrefixになりました。ただし、通常はクラス名を正確に指定する必要はなく、IM_Entry関数の第２引数（オプション引数）で、formatterキーの後の連想配列で指定することになります。そこでの設定は、従来通りの名前を記述するだけです。つまり、「AppendPrefix」と指定していた箇所は、Ver.6でも「AppendPrefix」で機能します。\nその他\n'data-im-group'属性は、Ver.6以降利用できません。type=radioのINPUTタグについては、同一のdata-im属性のものを自動的にグループ化します。\n            \n            \n                Ver.5.12での変更\n                動作条件の変更\n                INTER-Mediator Ver.5系統ではVer.5.12でPHP 8.0に対応しましたが、PHP 5.2とPHP 5.3はサポート対象外となりました。PHP 5.4以降が必要です（推奨はPHP 7.3以降）。これに伴い、FileMaker Serverについてはバージョン13以前はサポート対象外となりました。\n            \n            \n                Ver.5.8での変更\n                要求されるプライベートキーの鍵長\n                セキュリティ上の理由から、プライベートキーの鍵長が2048bit未満のものを非推奨にしました。ネイティブ認証やLDAP認証を利用している場合には、プライベートキー（params.phpファイル内の変数 $generatedPrivateKey の値）を更新する必要があります。\n            \n            \n                Ver.5.7での変更\n                データベース更新処理の排他制御の変更\n                Ver.5.4で、IMLibUI.lockUIElementなどのメソッドを用意して、独自に排他制御をかけていましたが、ある状況でうまく機能していない場合があることがわかり、データベースへの更新処理をキューを使ってシリアライズするように変更しました。キューを使うことで、キューに登録したタスクは1つ1つが完全に終了するまで、次のタスクは実行できなくなります。データベースへの更新処理をユーザーインタフェースから呼び出すときには、必ずキューを使うので、2つの更新処理が同時に発生してしまうなどの不具合は理屈の上では発生しなくなります。また、更新前のクエリーもキューに登録されて実行されるようになります。\n自分でJavaScriptでプログラムを作る場合には、キューへの登録を適切に行ってください。IMLibQueue.setTaskメソッドを使います。引数は実行するタスクを関数で指定しますが、関数には必ず引数を1つ設定してください。その引数はクロージャーが渡され、キューのタスクの終了をシステムに知らせるために、その引数のクロージャーを実行します。実行するタスクが非同期の処理を含む場合には、タスクの最後に引数のクロージャーを実行するのではなく、非同期処理の完了処理で呼び出すなどしないと、更新処理の前後が交錯して、認証の継続がうまく行かないなどのトラブルになります。以下はコードの例です。\n\nIMLibQueue.setTask(function (completeTask) {\n     INTERMediator_DBAdapter.db_query_async(\n         {\n             name: \"execute\",\n             conditions: [{field: \"id\", operator: \"=\", value: id}],\n             uselimit: false,\n             records: 1\n         },\n         function (result) {\n             document.getElementById(\"result\").innerHTML = result.dbresult[0].result;\n             INTERMediator.flushMessage();\n             completeTask();\n         },\n         function () {\n             INTERMediator.flushMessage();\n             completeTask();\n         });\n});\n\nなお、JavaScriptの以下のAPIは、内部でIMLibQueue.setTaskを呼び出しているので、キューへの設定は自動的に行われます。以下に含まれないようなINTERMediator_DBAdapter.db_query_asyncメソッドでは、上記のように、自分でキューへの登録やタスク終了の呼び出しを行う必要が発生します。\n\nIMLibUI.valueChange\nIMLibUI.copyButton\nIMLibUI.deleteButton\nIMLibUI.insertButton\nIMLibContext.prototype.setDataAtLastRecord\nIMLibContext.prototype.setDataWithKey\nIMLibPageNavigation.copyRecordFromNavi\nIMLibPageNavigation.deleteRecordFromNavi\nIMLibPageNavigation.insertRecordFromNavi\n\n                データベースクラスに関してのリファクタリング\n                DB_PDO.phpファイルなどのように、データベースクラスは非常に行数が大きくなり、保守しづらい状況になっていました。そこで、DB_Supportフォルダにいくつかのファイルを作り、異能の分離をしています。一般のアプリケーションに影響はないようになっているはずですが、自分でデータベースクラスを作っているような場合には、DB_Interface.phpに記述されたインタフェースに基づいて機能を分離している点をご理解いただきプログラムに反映させてください。データベースクラスからは、publicなポインタを利用して、別途定義された「ハンドラ」を参照するといった仕組みです。なお、例えば認証に関連する部分はDB_Auth_Handler_PDO.phpファイルに記述されていますが、あるデータベースクラスが認証の機能を使わないのなら、このハンドラは定義不要で、ポインタとなるプロパティはnullのままで構いません。\n                一部プロパティの変更\n                内部的にINTERMediatorLogオブジェクトを導入したことで、プログラミングガイドでは言及されていなかった一部のプロパティが変更されています。もしもこれらのプロパティを個別のJavaScriptで利用している場合には書き換えが必要になります。\n                \n                    （変更前） INTERMediator.debugMode （変更後） INTERMediatorLog.debugMode\n                    （変更前） INTERMediator.supressDebugMessageOnPage （変更後） INTERMediatorLog.suppressDebugMessageOnPage\n                    （変更前） INTERMediator.supressErrorMessageOnPage （変更後） INTERMediatorLog.suppressErrorMessageOnPage\n                    （変更前） INTERMediator.errorMessages （変更後） INTERMediatorLog.errorMessages\n                    （変更前） INTERMediator.debugMessages （変更後） INTERMediatorLog.debugMessages\n                    （変更前） INTERMediator.errorMessageByAlert （変更後） INTERMediatorLog.errorMessageByAlert\n                    （変更前） INTERMediator.errorMessageOnAlert （変更後） INTERMediatorLog.errorMessageOnAlert\n                \n            \n            \n                Ver.5.6での変更\n                テーマの新設と既存の開発物について\n                このバージョンより、一切のスタイル設定をしなくてもそれなりに見栄えの良いページが作成できるように、デフォルトのテーマを構築しました。また、テーマを入れ替えることで、手軽に見栄えを変更できるような機能にもなっています。しかしながら、独自にCSSを全面的に定義しているようなサイトにおいては、デフォルトのテーマの設定と当たってしまう場合もあります。その場合、「least」テーマに切り替えてください。IM_Entry関数の第2引数（オプション設定）に、\"theme\"がキーで、値が\"least\"という定義を加えまます。params.phpでは$themeName = \"least\"; と指定します。このテーマは、ログインパネルとページネーションの要素に適用される設定しかしていませんので、多くの場合テーマと自分のCSSが当たるということはないと思います。また、テーマのCSSは、独自のCSSファイルへのlinkタグより前に配置されるため、通常は、独自のCSSファイルでテーマの内容を上書きできるはずです。\n                イベント取得\n                キーボード関連のイベントに対する応答を登録できるグローバル変数IMLibKeyEventDispatchは、IMLibKeyDownEventDispatchとIMLibKeyUpEventDispatchに変更になりました。\n                ログインパネルのカスタマイズプロパティの廃止\n                 INTERMediatorOnPage.defaultBackgroundImage、INTERMediatorOnPage.defaultBackgroundColorの2つのプロパティを廃止しました。設定しても何も起こりません。\n            \n            \n                Ver.5.5での変更\n                アドバイス定義クラスでメールの送信内容を修正する場合\n                データベースに対する処理のうち、Read/Update/Createの3つの処理が終了後にメールを送信する設定をコンテキスト定義に記述します。このとき、データベースで処理したレコードの配列を元にメールを送信するので、フィールドに送信時に使用する宛先や文面などのデータがあれば、コンテキスト定義上で使用するフィールドあるいは固定値を記述することでメールの送信ができます。しかしながら、状況によってはレコードにない情報を追加したり、あるいは変更してメール送信に利用したい場合もあります。その場合は、コンテキスト定義にextending-classキーの値を追加して、アドバイス定義クラスを実装します。そのクラスに、レコード作成直後にメールを送りたい場合の修正を組み込むため、doAfterCreateToDB($result)メソッドを実装します。このとき、書き直したフィールドや、追加したいフィールドは、データベースクラスのsetUpdatedRecordを利用して追加してください。通常、アドバイス定義クラスは、DB_UseSharedObjectsクラスを継承しているので、現在使用しているデータベース定義クラスは、dbClassプロパティで得られます。したがって、n番目のレコードのフィールドfに値vを書き込む場合は、「$this-&gt;dbClass-&gt;setUpdatedRecord（f, v, n）」というプログラムを書きます。これで、メール処理クラスに変更されたり追加されたフィールドを持つレコードが送信されます。なお、doAfterCreateToDBなどのメソッドは、基本は引数と同じレコードを返してください。メールの送信は、これらのメソッドの返り値ではなく、データベースクラスのインスタンスが管理して「結果のレコード」を利用します。返り値は、例えば、クエリー結果だと、ページ上に表示される値として利用されるものです。したがって、表示側もメール側も変更するのなら、setUpdatedRecordメソッドだけでなく、返り値の配列も変更が必要です。\n                なお、このように、setUpdatedRecordを使用する必要があるのは、これまでのバージョンは新規レコード作成時だけだったのですが、操作ごとに処理方法がバラついてしまっていたので、読み出しや更新処理も、同様にsetUpdatedRecordでメール処理に渡すレコード群の変更をするようにしました。\n            \n            \n                Ver.5.4での変更\n                サーバーサイドのPHPのAPIを整理\n                データベースアクセスクラスの基本メソッド\n                データベースアクセスクラスでは、CRUDおよびその関連処理のためのメソッドを既定しています。従来は、そのメソッドに処理しているコンテキスト名を引数として渡していましたが、それをやめました。また、メソッドの名称もCRUDの各単語に対応したものとなりました。現在処理しているコンテキスト名は、DB_SettingsクラスのメソッドgetDataSourceName()で取得できます。Ver.5.4-dev以降は、getFromDBは呼び出されず、readFromDBが呼び出されるようになるので、必要な修正をしてください。\n                従来の定義\n                \n                    interface DB_Interface extends DB_Spec_Behavior\n{\n    public function getFromDB($contextName);\n    public function countQueryResult($contextName);\n    public function getTotalCount($contextName);\n    public function setToDB($contextName);\n    public function newToDB($contextName, $bypassAuth);\n    public function deleteFromDB($contextName);\n    public function copyInDB($contextName);\n}\n                \n                新しい定義\n                \n                    interface DB_Interface extends DB_Spec_Behavior\n{\n    public function readFromDB();         // former getFromDB\n    public function countQueryResult();\n    public function getTotalCount();\n    public function updateDB();           // former setToDB\n    public function createInDB($bypassAuth);  // former newToDB\n    public function deleteFromDB();\n    public function copyInDB();\n}\n                \n                データベースアクセス処理の拡張クラス\n                コンテキストにextending-classキーで指定したクラス名にインプリメントするインタフェースを以下のように変更しました。名前をCRUDに対応するものにすると同時に、データソース名の引数は渡しません。拡張処理クラスがDB_UseSharedObjectsを継承している場合は、DB_SettingsクラスのインスタンスへdbSettingsプロパティでアクセスできます。これを利用すると、現在処理しているコンテキスト名は、DB_SettingsクラスのメソッドgetDataSourceName()で取得できます。Ver.5.4-dev以降は、従来の名称のメソッドは呼び出されず、新しいメソッドしか呼び出されませんので、必要な修正をしてください。\n                従来の定義\n                \n                    interface Extending_Interface_BeforeGet {\n    public function doBeforeGetFromDB($dataSourceName);\n}\ninterface Extending_Interface_AfterGet {\n    public function doAfterGetFromDB($dataSourceName, $result);\n}\ninterface Extending_Interface_AfterGet_WithNavigation {\n    public function doAfterGetFromDB($dataSourceName, $result);\n    public function countQueryResult($dataSourceName);\n    public function getTotalCount($dataSourceName);\n}\ninterface Extending_Interface_BeforeSet {\n    public function doBeforeSetToDB($dataSourceName);\n}\ninterface Extending_Interface_AfterSet {\n    public function doAfterSetToDB($dataSourceName, $result);\n}\ninterface Extending_Interface_BeforeDelete {\n    public function doBeforeDeleteFromDB();\n}\ninterface Extending_Interface_AfterDelete {\n    public function doAfterDeleteFromDB($result);\n}\ninterface Extending_Interface_BeforeNew {\n    public function doBeforeNewToDB($dataSourceName);\n}\ninterface Extending_Interface_AfterNew{\n    public function doAfterNewToDB($dataSourceName, $result);\n}\n                \n                新しい定義\n                \n                    interface Extending_Interface_BeforeRead {\n    public function doBeforeReadFromDB();\n}\ninterface Extending_Interface_AfterRead {\n    public function doAfterReadFromDB($result);\n}\ninterface Extending_Interface_AfterRead_WithNavigation {\n    public function doAfterReadFromDB( $result);\n    public function countQueryResult();\n    public function getTotalCount();\n}\ninterface Extending_Interface_BeforeUpdate {\n    public function doBeforeUpdateDB();\n}\ninterface Extending_Interface_AfterUpdate {\n    public function doAfterUpdateToDB($result);\n}\ninterface Extending_Interface_BeforeCreate {\n    public function doBeforeCreateToDB();\n}\ninterface Extending_Interface_AfterCreate {\n    public function doAfterCreateToDB($result);\n}\ninterface Extending_Interface_BeforeDelete {\n    public function doBeforeDeleteFromDB();\n}\ninterface Extending_Interface_AfterDelete {\n    public function doAfterDeleteFromDB($result);\n}\ninterface Extending_Interface_BeforeCopy {\n    public function doBeforeCopyInDB();\n}\ninterface Extending_Interface_AfterCopy {\n    public function doAfterCopyInDB($result);\n}\n                \n                DB_Settingsクラスの整理統合\n                以下のメソッドはVer.5.4-devでは定義されていません。代替メソッドを使ってください。\n                \n                    function getTargetName()\nfunction getTargetDataSource()\nfunction setTargetDataSource($targetDataSource)\nfunction getIndexOfDataSource($dataSourceName)\nfunction setTargetFields($fields)\n                \n                getTargetName/getTargetDataSource/setTargetDataSourceメソッドは、ほぼ同一の動きをするgetDataSourceName/setDataSourceNameメソッドに置き換えました。setTargetFieldsとgetIndexOfDataSourceメソッドは使われていないので、削除しました。\n            \n            \n                Ver.5.3での変更\n                CSRF攻撃対策の追加\n                params.phpファイルで$webServerNameという変数を設定することでCSRF攻撃対策を実施することができるようになりました。Webサーバーのドメイン名もしくはFQDN（完全修飾ドメイン名）を配列で設定するようにしてください。\n                    設定例1：array('inter-mediator.com');\n                    設定例2：array('www.inter-mediator.com', 'inter-mediator.org');\n            \n            \n                Ver.5.2での変更\n                データベースクラスでのメソッド定義の変更\n                Auth_Interface_DBインタフェースで定義しているauthSuportCreateUserメソッドの引数が、LDAP対応に伴い2つから4つに増えました。 データベースクラス（DB_PDO.phpなど）については、機能を組み込んでいなくても、メソッドの引数をインタフェースでの定義に揃えなければなりません。 定義内容は、DB_Interfaces.phpファイルを参照してください。\n                \n            \n            \n                Ver.4.7での変更\n                Internet Explorer Ver.8対応に関して\n                これまでは、Internet Explorerの最低サポートバージョンをVer.8としてきましたが、Ver.4.7現在、いくつかの機能が動かない状態になっています。これらについては、今後サポートする予定はありません。しかしながら、主要な機能はVer.4.7でも動いているので、IE8のサポートバージョンとして、最後のものがVer.4.7とします。Ver.4.7でIE8で動作に問題があるものとして、以下のものがわかっています。\n                \n                    フィールドの文字列中に改行がある場合、TEXTAREAに正しく表示されない。これは、改行をBRタグに変更してinnerHTMLに設定するという手段が、IE8ではエラーになってしまうためです。\n                    Pusherをベースにしたクライアント間同期の仕組みのうち、レコード削除後の処理でエラーが出る。フィールドの更新や新規レコードは稼働します。\n                    ローカルコンテキストを利用して、検索パラメータを指定する機能のうち、1ページの件数の制限と、並べ替えに使用するフィールドの指定が正しく動作しません。検索条件と、「検索」ボタンは動作します。\n                \n                なお、Ver.5以降は、IE8のためのコードを削除する可能性もあり、動かない機能がより増える可能性もあります。また、Ver.5以降は、Internet Explorerでの確認は、主として最新バージョンでのみ行うことにします。Firefox、Chrome、Safariと同様な扱いにします。なお、特定のバージョンでの不具合について、対応を希望する場合には、Facebookのグループ等でリクエストを出してください。\n            \n            \n                Ver.4.6での変更\n                setExeucteメソッド\n                グローバル変数のIMLibChangeEventDispatch、IMLibKeyEventDispatch、IMLibMouseEventDispatchの初期化は、constructメソッドを呼び出す後になりました。これらのオブジェクトで利用できていた、setExeucteなどのメソッドは、constructを呼び出した後に設定してください。具体的には、INTERMediatorOnPage.doAfterConstruct = function() { } という関数の定義と代入を行い、関数内でIMLibChangeEventDispatch、IMLibKeyEventDispatch、IMLibMouseEventDispatchを利用してください。\n                INTERMediator.additionalCondition, additionalSortKeyプロパティ\n                コンテキストを利用して読み出しを行うとき、JavaScriptで検索条件や並べ替え条件を付加できるプロパティadditionalConditionとadditionalSortKeyがあります。これらは、従来までは単純にオブジェクトを記録していただけですが、Ver.4.4あたりでローカルコンテキストに記録して、ページを改めて呼び出した時にローカルコンテキストを復活させることで元に戻すという仕様を組み込みました。しかしながら、その動作を見直している時にバグが見つかりましたが、結果的に、additionalConditionとadditionalSortKeyの参照は変更ありませんが、追加や書き換えには以下のような変更が必要になります。これらの2つのプロパティにセッタとゲッタを設定しているため、セッタを稼働させるために、プロパティそのものへの代入が必要になります。あるいは、新しいAPIのaddConditionやaddSortKeyメソッドを利用してください。追加した条件を消去するclearConditions、clearSortKeysメソッドも利用できます。\n                \n                    INTERMediator.additionalCondition[\"acontext\"] = [];\nINTERMediator.additionalCondition[\"acontext\"].push({field: \"afield\", operator: \"=\", value: \"1001\"});\nINTERMediator.additionalCondition[\"acontext\"].push({field: \"live\", operator: \"=\", value: \"1\"});\n\n    ↓\n\n（修正方法A）\nINTERMediator.addCondition(\"acontext\", {field: \"afield\", operator: \"=\", value: \"1001\"});\nINTERMediator.addCondition(\"acontext\", {field: \"live\", operator: \"=\", value: \"1\"});\n\n（修正方法B）\nvar conditions = INTERMediator.additionalCondition;\nconditions[\"acontext\"] = [];\nconditions[\"acontext\"].push({field: \"afield\", operator: \"=\", value: \"1001\"});\nconditions[\"acontext\"].push({field: \"live\", operator: \"=\", value: \"1\"});\nINTERMediator.additionalCondition = conditions\n                \n                検索条件が1つだけの場合も、同様に、次のように書き換えが必要になります。\n                \n                    INTERMediator.additionalCondition[\"acontext\"] = {field: \"afield\", operator: \"=\", value: \"1001\"};\n\n    ↓\n\n（修正方法A）\nINTERMediator.addCondition(\"acontext\", {field: \"afield\", operator: \"=\", value: \"1001\"});\n\n（修正方法B）\nvar conditions = INTERMediator.additionalCondition;\nconditions[\"acontext\"].push({field: \"afield\", operator: \"=\", value: \"1001\"});\nINTERMediator.additionalCondition = conditions\n                \n            \n            \n                Ver.4.5での変更\n                valueChangeメソッド\n                INTERMediator.valueChange(idValue)はIMLibUI.valueChange(idValue)に変更されました。もしもJavaScriptのプログラム内でvalueChangeメソッドを使用している場合には書き換えが必要です。\n            \n            \n                Ver.4.1 (2014/2/7) での変更\n                ターゲット指定をclass属性に独自の記述方法で書いていましたが、Ver.4.1より、HTML5のdata属性での記述に移行しました。なお、従来の記述も基本的にはそのまま利用できるはずですが、大した手間にならないので、書き直すのがいいかと思います。\n                \n                    \n                        \n                            以前の表記法\n                            Ver.4.1以降の表記法\n                            利用場所\n                        \n                        \n                            class=\"IM[...]\"\n                            data-im=\"...\"\n                            ページファイルのターゲット指定\n                        \n                        \n                            class=\"IM_WIDGET[...]\"\n                            data-im-widget=\"...\"\n                            JavaScriptコンポーネントの指定\n                        \n                        \n                            class=\"_im_enclosure\"\n                            data-im-control=\"enclosure\"\n                            エンクロージャにしたいDIV, SPANタグ\n                        \n                        \n                            class=\"_im_repeater\"\n                            data-im-control=\"repeater\"\n                            リピータにしたいDIV, SPANタグ\n                        \n                        \n                            class=\"_im_ignore_enc_rep\"\n                            data-im-control=\"ignore_enc_rep\"\n                            リピータあるいはエンクロージャでなくする\n                        \n                        \n                            class=\"_im_for_noresult_\"\n                            data-im-control=\"noresult\"\n                            検索結果が0レコードの時に表示されるリピータ\n                        \n                        \n                            class=\"_im_post\"\n                            data-im-control=\"post\"\n                            ポストオンリーモードのエンクロージャおよび書き込みボタン\n                        \n                        \n                            name=\"IM[...]\"\n                            data-im-group=\"....\"\n                            ポストオンリーモードでのラジオボタンのグループ指定\n                        \n                    \n                \n                以下は書き換え例です。\n                \n                    &lt;input class=\"IM[mytable@anyfield]\" /&gt;\n    ↓\n&lt;input data-im=\"mytable@anyfield\" /&gt;\n                \n                IM[]に複数のターゲット指定を書いていた場合、|で区切っていましたが、空白で区切れるようになりました。\n                \n                    &lt;option class=\"IM[mytable@myvalue@value|mytable@myname]\" /&gt;\n    ↓\n&lt;option data-im=\"mytable@myvalue@value mytable@myname\" /&gt;\n                \n            \n            \n                Ver.4.0 (2013/12/4) での変更\n                INTER-Mediatorの配布ファイルのファイル構成が変わりました。ルート直下にフレームワークがあり、サンプルファイルはSamplesの下に配備しました。同時に、dist-docs/buildup.shを利用して、運用向けのフレームワークを用意する機能を加えています。こちらをごらんください。\n            \n            \n                Ver.3.8 (2013/8/22) での変更\n                params.phpファイルにおいて記述できていた$scriptPathPrefix、$scriptPathSufixを利用して、クライアントから呼び出すURLをコントロールできていましたが、$callURLという変数で完全にURLで指定できるようにしています。$scriptPathPrefix、$scriptPathSufixも使用できます。\n            \n        "
    },
    {
        "id": 18,
        "parent": "/ja/for-developers/",
        "path": "/ja/for-developers/docker.html",
        "title": "Dockerの利用",
        "breadcrumb": "Dockerの利用",
        "body": "\n            \n                INTER-MediatorをDockerで動かす\n            \n            \n                Dockerとは\n                \n                    Docker（ドッカー[2]）はソフトウェアコンテナ内のアプリケーションのデプロイメントを自動化するオープンソースソフトウェアである。\n                        Wikipediaより\n                    \n                \n                \n                    Dockerを使うことにより、例えば同じ設定内容のWebサーバーを素早く追加して並列化したり、プロダクション環境と同じWebサーバーを開発環境に用意することが迅速にできます。\n                     もちろんWebサーバーに限らずDBサーバーにも使うことが出来ます。\n                     ここではそんなDockerをINTER-Mediatorを動かす環境としてセットアップしてみます。\n                \n            \n            \n                Dockerのインストール\n                \n                    まずはローカルに Docker が実行できる環境を作りましょう。以下のドキュメントを参考にしてください。\n                     Mac では Docker Toolbox をインストールする方法と Docker for Mac をインストールする方法の2通りがあります。\n                     Windows では Docker Toolbox をインストールする方法と Docker for Windows をインストールする方法の2通りがあります。\n                     OSのバージョンによってはインストールの選択肢がDocker Toolboxのみとなります。\n                \n                macOSにDockerをセットアップする場合\n                \n                    macOSの場合、Docker Toolboxを入れる方法とDocker for Macを入れる方法があります。\n                     既にVirtualBoxを使用している場合は\n                    Docker Toolboxをダウンロードしてインストールします(ダウンロードに結構時間がかかるかもしれません...)。\n                     仮想化ソフトウェアを一度もインストールしたことがないのでしたらDocker Toolboxを入れてもいいですし、Docker for Macを入れても構いません。\n                     ※Docker Toolboxのインストーラの中でVirtualboxのインストールが行われます。\n                    \n                    \n                    Docker for Mac は、macOSのxhyveを使っています。\n                     よく分からない場合やxhyveが信用ならない場合はDocker Toolboxでのセットアップを採用してください。\n                     ここではDockerの詳しい説明は行いません。\n                \n                WindowsにDockerをセットアップする場合\n                \n                    Windows7(64bit)以降であればWindowsでもDockerを動かすことが出来ます。\n                    \n                    Docker Toolboxのwindows版をインストールします(ダウンロードに結構時間がかかるかもしれません...)。\n                     ※Docker Toolboxのインストーラの中でVirtualboxのインストールが行われます。\n                     Windows10 Proに限ってはHyper-Vを利用するDocker for Windowsのインストールが簡単です。\n                     ※Docker for Windowsは2016/07/05時点ではWindows 10 Pro、Enterprise、Educationのみ対応ですが将来的には他のWindows10もサポートする予定だそうです。\n                     ※Docker for WindowsではHyper-Vを使います。お使いのPCの構成によってはHyper-Vの構成と再起動が入ります。\n                     ※Windows用のインストールでウィザード内でKitematicのインストールチェックボックスは外さないようにしてください。後で使います。\n                    \n                    \n                    \n                \n                KitematicでDockerを試す\n                \n                    Dockerの便利ツールの中にKitematicというものがあります。\n                     Dockerのお手軽さを体験するために、Kitematicを使ってみましょう。\n                     KitematicはDockerをGUIで操作するツールです。Dockerのインストール時に一緒に入ってるはずです。\n                    \n                    \n                    ※Docker for mac の場合は別途ダウンロードが必要です。ダウンロードしたものをアプリケーションフォルダに入れてください。\n                    \n                    \n                    \n                    ※Docker for Windowsの場合は別途ダウンロードが必要な場合があります。ダウンロードしたものを任意の場所に解凍(展開)してください。\n                    \n                    \n                    \n                    \n                    ※WindowsでDocker Toolboxをインストールした場合でKitematicの最初の起動に失敗した場合、Hyper-Vを使おうとしている時があります、選択肢にVirtualboxを使うがありますので、そちらで再度起動を試してください。\n                     Kitematicを起動すると真ん中にDockerHubで公開されているDockerイメージのお薦めなどが表示されています。\n                    \n                    \n                    ここでは検索して任意のDockerイメージを探すことも出来ます。\n                     虫眼鏡マークの検索欄に\n                \n                sakadonohito/im\n                \n                    と入力して検索してみましょう。INTER-Mediatorを動かすDockerのサンプルが出てきます。これをNewしましょう。\n                     ローカルにDockerイメージがダウンロードされますのでそれを起動してみましょう。\n                     起動したらブラウザでアクセスしてみましょう。\n                     http://localhost/im/Samples\n                     INTER-MediatorのサンプルTOPページが表示されましたでしょうか。\n                \n                一体何がどうなったのでしょうか？仕組みを説明します。\n                \n                    INTGER-Mediatorが動く状態のPHP、MySQL、Apacheが組み込まれたDockerイメージがDockerHubにホストされていた。\n                    手元の環境にDockerやDockerのGUIツールKitematicをインストールした。\n                    KitematicからDOckerHubにアクセスし、INTER-MediatorのDockerイメージをダウンロードした。\n                    KitematicからダウンロードしたDockerイメージを起動した。\n                    ブラウザから起動したDockerイメージ上のINTER-Mediatorにアクセスした。\n                \n                という流れです。\n                     なぜ、先述のURLでDocker上のINTER-Mediatorにアクセス出来たのかは、そうなるようにDocker上のApacheの設定を行っているからです。\n                     お手軽ですね。\n                \n            \n            \n                IMを動かすDockerイメージの作成\n                \n                    前の項でKitematicを使って作成済みのDockerイメージを起動することが出来ました。\n                     次に自作のINTER-MediatorアプリをDockerイメージ化するにはどうしたらよいでしょうか。\n                     簡単に説明します。\n                \n                Dockerイメージの設計書？Dockerfile\n                詳しくはDockerの公式を参照して欲しいのですが、Dockerfileという名前のテキストファイルに\n                \n                    ベースとなるLinuxディストリビューションやDockerイメージ名の指定\n                    作成者の名前\n                    Dockerイメージにインストールしたいライブラリ等のインストールコマンド、事前に用意したファイルを取り込むコマンドなど\n                \n                といった内容を記述します。\n                     INTER-Mediator用のイメージを作りには\n                \n                \n                    ベースとなるLinuxディストリビューションやDockerイメージ名の指定\n                    作成者の名前\n                    PHPのインストールと設定\n                    MySQLのインストールと設定\n                    Apacheのインストールと設定\n                    INTER-MediatorディレクトリをWeb公開用の場所に配置\n                \n                のようになります。\n                     終わったら記述したDockerfileからイメージを作成します。\n                     Dockerfileのあるディレクトリで以下のようなコマンドでイメージを作成します。\n                    \n                    参考Dockerfile\n                \n                docker build -t &lt;name&gt;/&lt;app&gt;:&lt;tag&gt;\n                nameはDockerHubの登録アカウント名、appは今回ならINTER-Mediatorと分かるような名称がいいでしょう。\n                     tagはバージョン番号になります。\n                \n                注意点としては、Dockerは仮想サーバーではありません。Dockerイメージを起動したからといって、自動起動のサービスが勝手に起動したりはしません。\n                     Dockerイメージの起動時に渡すコマンドで目的のサービスを起動します。\n                \n                作成したDockerイメージは例として以下の様なコマンドで起動できます。\n                docker run -d --name im -p 18880:80 myhoge/im:1.0\n                例はDocker(以降 コンテナ)を「im」という名前でバックグラウンドプロセスで起動。ローカルの18880ポートをコンテナの80ポートにマッピング、Dockerイメージは「myhoge/im:1.0」という意味になります。\n                     正しくDockerイメージが作成できていれば http://localhost:18880/ でコンテナ内で起動したApacheのルートが表示されます。\n                \n                これでいつでも手元でINTER-Mediatorを起動できるようになりました。\n            \n            \n                DockerHubの登録手順\n                手元でDockerのイメージが作成出来るようになって、ローカルで起動もできるようになりました。\n                     このイメージを他の環境でも使いたい場合はどうしたらよいでしょうか？\n                     DockerfileをGithubに置いておいて、都度DockerfileをpullしてDockerイメージをbuildして構いません。\n                     ですが、作成したイメージをDockerHubに登録しておいて、使いたい環境でpullするのが使う時はお手軽です。\n                \n                \n                    Docker Hubにアクセスし、アカウントを持っていない人は登録します。\n                     アカウントの登録ができていれば後は手元からDockerイメージをpushするだけです。\n                     手元のターミナルで\n                \n                docker login\n                してでまずはターミナルでDockerHubにログインします。次に\n                docker push myhoge/im:1.0\n                のようにコマンドを入力します。myhoge/im:1.0は前項の例の流用です。\n                     dockerイメージ名:tagという構文です。\n                     ※latestというtagでイメージを作成してpushした場合はDockerHubからpullする際にtagを省略してDockerイメージをpull出来るようになります。\n                \n            \n            \n                Dockerコンテナの中身を分割する\n                \n                    1つのDockerイメージに全てを詰め込むのはポータビリティが高いですが、本当はDockerの思想に反します。\n                     1つのDockerコンテナには一つの役割にするのが理想とされています。\n                     Webサーバー、DBサーバー、さらに分割するなら永続データとコンテナを分けてみましょう。\n                     ※PHPをApacheで動かす前提で説明しますので、ここではPHPとWebサーバー(Apache)は分けません。\n                \n                docker-composeを使う\n                \n                    上記のコンテナ分割を行うと、1つのアプリのために幾つものDockerコンテナをセットアップして起動しないといけなくなりちょっと煩雑になります。\n                     Dockerにはその煩雑さを解消するため、docker-composeというツールが有りますので、使ってみましょう。\n                     Dockerをインストールすると一緒についてきます。\n                     ※docker-composeのバージョンが1.7未満の場合はバージョンを上げてください。\n                \n                \n                    細かい内容説明はドキュメントを参照してください。完成形をpullしましょう。\n                     任意のディレクトリで以下のコマンドを実行し、githubからサンプルのdocker-composeファイルをcloneします。\n                \n                git clone https://github.com/sakadonohito/im-compose.git \n                \n                    cloneした内容にdocker-compose.ymlという設定ファイルがあります。\n                     ここにどういったDockerコンテナの起動に関する設定を連携させたいコンテナ分だけ記述します。\n                     YAMLファイルについての説明はここでは割愛します。\n                     このdocker-compose.ymlで扱うMySQLとPHP(with Apache)のDocker起動設定を記載しています。\n                     また、データボリュームの設定も書いてあります。\n                     実はこのcloneした内容には2つ足りないものが有りますので、別途用意してください、\n                \n                \n                    \n                        INTER-Mediatorで使うMySQLのサンプルデータを流し込むSQLファイル(sample_schema_mysql.sql)\n                        \n                            INTER-Mediatorをダウンロードした際に内包しているsample_schema_mysql.txtファイルをsample_schema_mysql.sqlに拡張子変更してください。\n                            mysql/tmpというディレクトリがない場合は作成してください。\n                            sample_schema_mysql.sqlをmysql/tmpディレクトリに配置してください。\n                        \n                    \n                    \n                        INTER-Mediatorそのもの。\n                        \n                            INTER-Mediatorをapache/webrootディレクトリにimという名前に変更して配置してください。\n                        \n                    \n                \n                上記の追加作業を行ったら、以下のコマンドを実行してください。\n                docker-compose up -d\n                設定ファイルの内容に従って、イメージをpullしてデーモンで起動してくれます。\n                    \n                    http://192.168.99.100/im/Samples にアクセスしてみてください。サンプルの画面が見えると思います。\n                     今回の設定では、ローカルに配置したINTER-MediatorをDockerコンテナにマウントして使っていますので、ローカル上でINTER-Mediatorを編集すると、それが反映されます。htmlファイルを編集して画面を更新してみてください。\n                \n                コンテナを停止して削除するには以下のコマンドを実行します。\n                docker-compose down -v\n                コンテナの停止と削除、それからネットワーク設定とボリュームの削除が行われます。\n            \n            \n                さいごに\n                \n                    INTER-MediatorのDockerイメージの作成についての説明は以上になります。\n                     さてこうして作成したDockerイメージはどこで使えるのでしょうか？\n                     以下の様な使い方ができます。\n                \n                \n                    手元でデモ環境として起動する。\n                    他の人にINTER-Mediatorを手軽に体験してもらうためにDockerHubに登録しておく\n                    作成したDockerイメージを本番用Linuxサーバー上で起動して使う\n                    AWSのElasticBeanstalk上で起動する。\n                    AWSのElasticContainerService上で起動する。\n                    HerokuというPaaSサービス上で起動する。\n                    ArukasというDocker専用のPaaSサービス上で起動する。\n                    Microsoft Azure上でDockerを起動する。\n                    Google Cloud Platform上でDockerを起動する。\n                \n                \n                    他にも、開発環境やテスト環境として利用することも可能です。INTER-Mediatorの開発ではCIでDockerを使っているそうです。\n                     手軽にINTER-Mediatorを動かす環境としてDockerを是非活用してください。\n                \n            \n        "
    },
    {
        "id": 19,
        "parent": "/ja/for-developers/",
        "path": "/ja/for-developers/db.html",
        "title": "データベース特有の設定",
        "breadcrumb": "データベース特有の設定",
        "body": "\n            \n                FileMaker Server\n                FileMakerは、テーブル、TO（テーブルオカレンス）、レイアウトといったオブジェクトを利用する。Web共有からテーブルを直接指定はできない。また、TOも指定できない。指定できるのはレイアウトのみである。レイアウトが事実上のテーブルに相当するエンティティとなる。したがって、定義ファイルのnameキー、viewキー、tableキーには、レイアウト名を指定する。たまたま、同じ名前のテーブルやTOがあっても、FileMakerのWebアクセス時に実際に利用するのはその名前のレイアウトである。\n                フィールドのタイプで、日時の記録用に「日付」「時刻」「タイムスタンプ」の3つがある。Web経由では、「月/日/年 時:分:秒」のフォーマットにしなければならない。また、日付フィールドに時刻を含む文字列を入力したり、時刻フィールドに日付を含む文字列を入力すると、エラーになり処理は何もなされない。その「日付等の書式エラー」の番号が500なので、余計なことを考えてしまいそうだが、この500はFileMakerが規定したエラー番号である。\n                データベース側の設定\n                FileMaker Serverでは、INTER-MediatorからはFileMaker ServerのXML Web公開機能もしくはFileMaker Data APIを使用しているため、XML Web公開もしくはFileMaker Data APIでのアクセスを許可する必要があります。INTER-Mediatorが使用するアカウントを用意し、XML Web公開もしくはFileMaker Data APIでのアクセスを許可するようにしてください（XML Web公開の拡張アクセス権のキーワードは「fmxml」、FileMaker Data APIの拡張アクセス権のキーワードは「fmrest」）。\n                FileMaker Data APIを利用する場合\n                INTER-Mediator 5.8以降でFileMaker Data APIに対応しています。FileMaker Data APIを利用するにはFileMaker Server 17以降が必要であり、Data API ライセンスが必要になるほか、Admin ConsoleでFileMaker Data APIを有効にする必要があります。db-classキーで指定するデータアクセスクラスの名前は「DB_FileMaker_FX」の代わりに「DB_FileMaker_DataAPI」を使用します。serverキーで「127.0.0.1」や「localhost」を指定していた場合には「localserver」を指定するように変更します。\n                Windows版FileMaker Serverにおける注意点\n                Windows版FileMaker Serverではmbstring拡張モジュールが標準で有効になっていません。FileMaker Serverフォルダ内のWeb Publishing &gt; publishing engine &gt; phpフォルダ以下にある「php.ini」ファイルにおいて「;extension=php_mbstring.dll」を「extension=php_mbstring.dll」に変更した上でIISの再起動を行い、mbstring拡張モジュールを有効にする必要があります。\n                定義ファイルに記述するテーブル名\n                FileMaker Serverでは、定義ファイルに記述するテーブル名（nameキーの値）は、FileMakerデータベースのレイアウト名を指定する必要があります。\n                各コンテキストにはレイアウトが必要\n                FileMaker Serverでは、カスタムWeb公開機能の仕様上、各テーブル／コンテキストごとにレイアウトを用意して、表示や更新に必要なフィールドを各レイアウト上に配置する必要があります。\n                主キーを省略できる場合\n                リレーションを設定していない場合、テーブル内の主キーや定義ファイルでの主キーの指定（keyキー）は不要です。リレーションを設定している場合、下記で説明するポータルアクセスモードを有効にすることで主キーの指定を省略できる場合があります。\n                内部レコードIDのフィールド名\n                内部レコードIDのフィールド名は、XML Web公開では「-recid」、FileMaker Data APIでは「recordId」です。\n                FileMaker Data APIでスクリプトを利用する場合\n                実行するFileMakerスクリプトの最後に、「Get (対象レコード数) &amp; \"/\" &amp; Get (レコード総数)」を結果として返すように［現在のスクリプト終了］スクリプトステップを入れる必要があります。こうすることでスクリプトが複数回実行されないようになります。\n                FileMaker Data APIでグローバルフィールドを利用する場合\n                FileMaker Data APIでグローバルフィールド値を設定する場合、レイアウト名とTO名が一致しない場合には、globalキー内のfieldキーの値は「TO名::フィールド名」の形式で指定する必要する必要があります。\n                ポータルアクセスモード\n                関連テーブルのデータをレイアウト上にあるポータルから取得する場合、定義ファイルでrelationキーの下位キーでportalキーの値をtrueとすることで、ポータルアクセスモードを利用できます。ポータルアクセスモードを利用することで、関連テーブル用の別レイアウトを作成する必要がなくなり、動作が若干高速化されます。\n                定義ファイルでは、relationキーのあるコンテキストのnameキーにテーブルオカレンス名（リレーションシップグラフで確認できる名称）を、viewキーにはポータルがあるレイアウト名を指定します。ページファイルでフィールドを指定する際には、「(nameキーの値)@(nameキーの値)::(フィールド名)」という形式で記述する必要があります。\n                なお、関連テーブルのレコードを追加できるようにするためには、FileMakerデータベースのレイアウト上においてポータル内に関連テーブルの主キーフィールドを配置した上で、FileMakerデータベースのリレーションシップグラフにおいて「このリレーションシップを使用して、このテーブルでのレコードの作成を許可」にチェックをつける必要があります。\n                未サポートの機能\n                以下の機能は、現在のバージョンでは未サポートです。\n                \n                    繰り返しフィールド\n                \n            \n            \n                PostgreSQL\n                PostgreSQLのサンプルを動かすためのデータベースのスキーマファイルは、INTER-Mediatorのレポジトリでは、\n                dist-docs/sample_schema_pgsql.txt\n                というファイルにあります。冒頭にコマンド例がありますが、PostgreSQLがどのOSのどのディストリビューションで動いているかによって、いろいろ違いがあると思います。例えばOS X Serverの場合：PostgreSQLの稼働ユーザはpostgresではなく、_postgresです。-Uの引数を_postgresにします。\n                INTER-Mediatorとの絡みについては、MySQLとほとんど同じなのですが、1点違いがあります。PostgreSQLでは、主キーフィールドにシリアル値を入力する方法として、SEQUENCEオブジェクトを利用する方法と、SERIAL型を利用する方法があります。どちらの方法も、原則として、定義ファイルのIM_Entry関数の第1引数にあるコンテキストに、'sequence' =&gt; 'xxxx' として、SEQUENCEオブジェクトを指定する必要があります。ただし、省略可能な場合もあります。\n                sequenceキーに対する値がない場合の問題は、ページネーションコントロールを表示して1レコードずつ表示しているとき、「レコード追加」ボタンをクリックしてレコードを作成した場合、新たに作られたレコードが現在のレコードになっておらず、レコードの移動をしないといけません。他は問題ないのですが、これだけの問題ではありますが、使い勝手が変わるので注意が必要です。なお、検索して参照するだけなら、sequenceキーの指定はなくてもいいのかもしれません。\n                SEQUENCEオブジェクトを使用する場合\n                SEQUENCEオブジェクトを使用する場合、スキーマは以下のようになると思います。SCHEMAはim_sample、アクセスユーザはwebを想定しています。テーブルとシーケンスの両方のオブジェクトにアクセス権を与えるのを忘れないようにしましょう。\n                CREATE SEQUENCE serial START 1000;\nCREATE TABLE person (\n    id INTEGER DEFAULT nextval('serial'),\n    :\n}\nGRANT ALL PRIVILEGES ON im_sample.serial TO web;\nGRANT ALL PRIVILEGES ON im_sample.person TO web;\n                \n                そして、定義ファイルでは、次のように、sequeceキーで、シーケンスオブジェクトの名前を指定します。\n                \n                    array(\n    'records' =&gt; 1,\n    'paging' =&gt; true,\n    'name' =&gt; 'person',\n    'view' =&gt; 'im_sample.person',\n    'table' =&gt; 'im_sample.person',\n    'key' =&gt; 'id',\n    'repeat-control' =&gt; 'insert delete',\n    'sequence' =&gt; 'im_sample.serial',\n),\n                \n                SERIAL型を利用する場合\n                SERIAL型を利用する場合、以下のように、主キーフィールドの型をSERIALにすると思われます。このとき、背後では、「テーブル名_フィールド名_seq」というシーケンスオブジェクトが自動的に作られて、初期値が1になっています。自動的に作られるオブジェクトとは言え、アクセス権の設定は記述する必要があるのが一般的でしょうから、im_sample.person_id_seqに対してwebアカウントのアクセス権も設定しなければなりません。\n                \n                    CREATE TABLE person (\n    id SERIAL PRIMARY KEY,\n}\nGRANT ALL PRIVILEGES ON im_sample.serial TO web;\nGRANT ALL PRIVILEGES ON im_sample.person_id_seq TO web;\n                \n                SERIAL型を使った場合、INSERTでレコードを新規に作るときに、ここでのidフィールドへの値を代入はしないようにします。もし、自分で値を設定したい場合は、シーケンスの値と当たらないようにしないといけませんが、そこまでの状況でSERIAL型を使う事はほぼないと思われます。\n                そして、定義ファイルでは、このときも、次のように、sequeceキーで、シーケンスオブジェクトの名前を指定できます。しかしながら、sequenceキーの値が存在しない場合は、tableキーとkeyキーの値から自動的に標準のシーケンス名を生成するので、原則、sequenceキーの指定は不要です。SEQUENCEオブジェクトが正しく機能しないと、1レコード表示時に新規レコードを作成しても、新規レコードが編集状態で開いてくれません。\n                \n                    array(\n    'records' =&gt; 1,\n    'paging' =&gt; true,\n    'name' =&gt; 'person',\n    'view' =&gt; 'im_sample.person',\n    'table' =&gt; 'im_sample.person',\n    'key' =&gt; 'id',\n    'repeat-control' =&gt; 'insert delete',\n    'sequence' =&gt; 'im_sample.person_id_seq',\n),\n                \n            \n        "
    },
    {
        "id": 20,
        "parent": "/ja/for-developers/",
        "path": "/ja/for-developers/exp.html",
        "title": "計算式",
        "breadcrumb": "計算式",
        "body": "\n            \n                定義ファイルのコンテキスト中に、calculationキーで指定する計算式の規則をこのページで紹介します。計算式自体はさらに配列中のexpressionキーの文字列で指定します。\n                \n                    以下の演算子や関数を使い、フィールド名や「コンテキスト名@フィールド名」の形式で別のデータを参照できます。ただし、calculationキーがあるコンテキストでは、keyキーによる主キーの指定が必要です。また、文字列はシングルクォーテーションによる囲みのみです。ダブルクォートは利用できません。言い換えれば、expressionキーに対応する文字列は \"\" で囲い、式の中の文字列リテラルはシングルクォートを利用します。\n            \n            \n                項\n                \n                    \n                    \n                        \n                            種類\n                            例\n                            説明\n                        \n                        \n                            数値リテラル\n                            10.3\n                            \n                        \n                        \n                            文字列リテラル\n                            'abc'\n                            シングルクォートでの囲みのみ。シングルクォートは\\で要エスケープ\n                        \n                        \n                            定数\n                            PI\n                            EとPIが定義されている\n                        \n                        \n                            ターゲット指定\n                            person@住所\n                            展開されている対応するノードを参照。同一のコンテキスト内ならフィールド名のみ\n                        \n                    \n                \n            \n            \n                定数\n                \n                    \n                    \n                        \n                            定数\n                            対応するJavaScript\n                            解説\n                        \n                        \n                            E\n                            Math.E\n                            エクスポーネンシャル\n                        \n                        \n                            PI\n                            Math.PI\n                            円周率\n                        \n                    \n                \n            \n            \n                演算子\n                \n                    \n                        \n                            対象データ\n                            演算子\n                            記述例\n                            解説\n                        \n                        \n                            数値\n                            ^\n                            2^3 の結果は 8\n                            べき乗\n                        \n                        \n                            \n                            +\n                            2+3 の結果は 5\n                            加算\n                        \n                        \n                            \n                            -\n                            3-2 の結果は 1\n                            減算（あるいは負の数）\n                        \n                        \n                            \n                            *\n                            3*2 の結果は 6\n                            乗算\n                        \n                        \n                            \n                            /\n                            3/2 の結果は 1.5\n                            除算\n                        \n                        \n                            \n                            %\n                            3%2 の結果は 1\n                            剰余\n                        \n                        \n                            文字\n                            +\n                            'a'+'b' の結果は 'ab'\n                            結合\n                        \n                        \n                            \n                            ⊕\n                            3⊕5 の結果は '35'\n                            結合（文字列として）\n                        \n                        \n                            \n                            -\n                            'abc'-'c' の結果は 'ab'\n                            除去\n                        \n                        \n                            \n                            ∩\n                            'abcdef' ∩ 'bdfx' の結果は 'bdf'\n                            共通の文字\n                        \n                        \n                            \n                            ∪\n                            'abcdef' ∪ 'bdfx' の結果は 'abcdefx'\n                            両方の文字\n                        \n                        \n                            \n                            ⊁\n                            'abcdef' ⊁ 'bdfx' の結果は 'ace'\n                            文字の除去\n                        \n                        \n                            論理演算\n                            =\n                            10=9 の結果は false\n                            等号\n                        \n                        \n                            \n                            ==\n                            10==9 の結果は false\n                            等号\n                        \n                        \n                            \n                            !=\n                            10!=9 の結果は true\n                            不等号\n                        \n                        \n                            \n                            \n                                &lt;&gt;\n                            \n                            10&lt;&gt;9 の結果は true\n                            \n                            不等号\n                        \n                        \n                            \n                            &gt;\n                            10&gt;9 の結果は true\n                            より大\n                        \n                        \n                            \n                            &lt;\n                                    10&lt;9 の結果は false \n                                            より小\n                        \n                        \n                            \n                            &gt;=\n                            10&gt;=9 の結果は true\n                            以上\n                        \n                        \n                            \n                            \n                                &lt;=\n                                    10\n                                        &lt;=9 の結果は false \n                                            以下\n                        \n                        \n                            \n                            ==\n                            10==9 の結果は false\n                            等号\n                        \n                        \n                            \n                            ||\n                            true || false の結果は true\n                            論理和\n                        \n                        \n                            \n                            &amp;&amp;\n                            true &amp;&amp; false の結果は false\n                            論理積\n                        \n                        \n                            \n                            !\n                            ! true の結果は false\n                            論理否定\n                        \n                        \n                            \n                            →\n                            true → false の結果はfalse、それ以外はtrue\n                            論理包含\n                        \n                        \n                            文字リスト\n                            ⋀\n                            'abc¶dff¶ghi' ⋀ 'dff¶stu¶' の結果は 'dff¶'\n                            共通項\n                        \n                        \n                            \n                            ⋁\n                            'abc¶dff¶ghi' ⋁ 'xyz¶stu¶' の結果は 'abc¶dff¶ghi¶xyz¶stu¶'\n                            合同\n                        \n                        \n                            \n                            ⊬\n                            'abc¶dff¶ghi' ⊬ 'ghi¶dkg¶' の結果は 'abc¶dff¶'\n                            差演算\n                        \n                    \n                \n                加算について\n                \n                    2つの項がいずれも数値なら、数値として計算します。\n                    2つの項がいずれかでも数値に変換できないか文字列なら、文字列として計算します。\n                \n                減算について\n                \n                    2つの項がいずれも数値なら、数値として計算します。\n                    2つの項がいずれかでも数値に変換できないか文字列なら、文字列として計算します。\n                \n                文字リストの改行の扱いについて\n                \n                    引数の最後に改行があってもなくてもかまいません。\n                    結果の最後には改行が付きます。\n                    最後の改行の扱いも含めて、長さが0の項目は項目として扱わず無視します。\n                    3種類ある改行のどれも同じように扱いますが、結果の改行は最初の引数の最初に出てくる改行になります。\n                \n            \n            \n                関数\n                数値\n                \n                    \n                        \n                            関数\n                            例（数値は丸めています）\n                            説明\n                        \n                        \n                            abs(x)\n                            abs(-3.1) の結果は 3.1\n                            絶対値\n                        \n                        \n                            ceil(x)\n                            ceil(-3.1) の結果は -3\n                            引数よりも大きな整数のうちの最小値\n                        \n                        \n                            floor(x)\n                            floor(-3.1) の結果は -4\n                            引数よりも小さな整数のうちの最大値\n                        \n                        \n                            round(x,y)\n                            round(3.1415, 2) の結果は 3.14\n                            1つ目の引数を四捨五入、2つ目の引数は少数以下の桁数で、正の数なら10の位から上位に上がる\n                        \n                        \n                            format(x,y)\n                            format(12345, 0) の結果は 12,345\n                            xを数値として、小数以下y桁目で四捨五入する。0以上の値は3桁ごとにカンマを付与する。\n                        \n                        \n                            sqrt(x)\n                            sqrt(3) の結果は 1.73\n                            平方根\n                        \n                        \n                            exp(x)\n                            exp(0.5) の結果は 1.65\n                            ネイピア数eのx乗\n                        \n                        \n                            log(x)\n                            log(0.5) の結果は -0.69\n                            ネイピア数を底とする自然対数\n                        \n                        \n                            random()\n                            random() の結果は 0.254\n                            0〜1の範囲の乱数\n                        \n                        \n                            pow(x, y)\n                            pow(2,3) の結果は 8\n                            べき乗、xのy乗\n                        \n                        \n                            fac(x)\n                            fac(5) の結果は 120\n                            累乗、x!の値\n                        \n                        \n                            pyt(x)\n                            pyt(3,4) の結果は 5\n                            x^2+y^2の平方根\n                        \n                    \n                \n                集計\n                \n                    \n                        \n                            関数\n                            例（数値は丸めています）\n                            説明\n                        \n                        \n                            sum(x,...)\n                            sum(1,2,3,4,5) の結果は 15\n                            合計。引数は可変\n                        \n                        \n                            min(x,...)\n                            min(3,1,2,1,5,1) の結果は 1\n                            引数の最小値。引数は可変\n                        \n                        \n                            max(x,...)\n                            max(3,1,2,1,5,1) の結果は 5\n                            引数の最大値。引数は可変\n                        \n                    \n                \n                判断\n                \n                    \n                        \n                            関数\n                            例（数値は丸めています）\n                            説明\n                        \n                        \n                            if(x,y,z)\n                            if(10 &gt;= 1,'b','c') の結果は 'b'\n                            最初の引数の結果がtrueなら2番目、falseなr3番目を返す\n                        \n                        \n                            choice(x, a1, a2, ..., an)\n                            choice(2,'a','b','c','d','e') の結果は 'c'\n                            \n                                最初の引数の結果が0以上なら引数のいずれかを返す。0なら1番目の引数の値、1なら2番目の引数の値、....nなら(n+1)番目の引数の値を返す。最初の引数が範囲0〜nを越えるとundefinedを返す。最初の引数がnullあるいはundefinedなら、それぞれnullあるいはundefinedを返す\n                            \n                        \n                        \n                            condition(x1, a1, x2, a2, ..., xn, an)\n                            condition(3&gt;10, 'a', 13&gt;10, 'b', 23&gt;10, 'c') の結果は 'b'\n                            奇数番目の引数の値を1番目から調べて、最初にtrueになった引数の次の引数を返す。奇数番目の引数にtrueのものがないとundefinedを返す\n                        \n                        \n                            accumulate(x1, a1, x2, a2, ..., xn, an)\n                            accumulate(3&gt;10, 'a', 13&gt;10, 'b'', 23&gt;10, 'c') の結果は 'b¶c¶'\n                            \n                                奇数番目の引数の値を1番目から調べ、すべてのtrueになる奇数番目の引数に対し、その次の引数をLF(0x10)を改行とした文字列リストの形式で返す。奇数番目にtrueのものがない場合には''を返す。\n                            \n                        \n                    \n                \n                文字列\n                \n                    \n                        \n                            関数\n                            例\n                            説明\n                        \n                        \n                            length()\n                            length('test') の結果は 4\n                            引数の文字列の長さを求める。nullが引数なら0を返す\n                        \n                        \n                            substr(x,y,z)\n                            substr('abcdefg', 3, 2) の結果は 'de'\n                            xの文字列に対して、y番目からz文字分のみを取り出す。最初の文字は0だが、文字位置は文字間の隙間をカウントするものとするので、最初の文字の前は0、次の隙間が1。yとzは負の数も受け付ける。yが負の数の場合は、最後の文字の前が-1、その前の文字の前が-2。zが負の数の場合はその文字より前にカウントする。\n                        \n                        \n                            substring(x,y,z)\n                            substring('abcdefg', 3, 5) の結果は 'de'\n                            xの文字列に対して、y番目からz文字目までを取り出す。最初の文字は0だが、文字位置は文字間の隙間をカウントするものとするので、最初の文字の前は0、次の隙間が1。yとzが負の数の場合は、最後の文字の前が-1、その前の文字の前が-2。\n                        \n                        \n                            left(x,y)\n                            left('abcdefg', 3) の結果は 'abc'\n                            xの文字列に対して、最初からy文字目までを取り出す\n                        \n                        \n                            mid(x,y,z)\n                            mid('abcdefg', 3, 2) の結果は 'de'\n                            xの文字列に対して、y文字目からz文字分を取り出す。最初の文字は0です。\n                        \n                        \n                            right(x,y)\n                            right('abcdefg', 3) の結果は 'efg'\n                            xの文字列に対して、最後からy文字分を取り出す\n                        \n                        \n                            indexof(x, y, fr)\n                            indexof('abcdefg','cd') の結果は 2\n                            \n                                xの文字列の最初からyの文字列を探し、最初に見つかった場所を返す。引数frを指定するとその文字以降を探すが、省略すると最初から。JavaScriptのString.indexOfを利用。最初の文字は0です。\n                            \n                        \n                        \n                            lastindexof(x,y)\n                            indexof('abcdefg','cd') の結果は 2\n                            \n                                xの文字列の最後からyの文字列を探し、最初に見つかった場所を返す。引数frを指定するとその文字以降を探すが、省略すると最初から。JavaScriptのString.lastIndexOfを利用。最初の文字は0です。\n                            \n                        \n                        \n                            replace(x,y,z,w)\n                            replace('abcdefgabc', 5, 8, 'yz') の結果は 'abcdeyzbc'\n                            xの文字列のy番目からz文字分を、文字列wに置き換える。最初の文字は0です。\n                        \n                        \n                            substitute(x,y,z)\n                            substitute('abcdefgabc', 'bc', 'yz') の結果は 'ayzdefgayz'\n                            xの文字列内にあるすべての文字列yを文字列zに置き換える。最初の文字は0です。\n                        \n                        \n                            basename(path)\n                            basename('dir/subdir/afile.txt') の結果は 'afile.txt'\n                            引数の文字列をパスとして認識して、ファイル名を求める\n                        \n                        \n                            extname(path)\n                            extname('dir/subdir/afile.txt') の結果は 'txt'\n                            引数の文字列をパスとして認識して、拡張子を求める\n                        \n                        \n                            dirname(path)\n                            dirname('dir/subdir/afile.txt') の結果は 'dir/subdir'\n                            引数の文字列をパスとして認識して、ディレクトリ名を求める\n                        \n                        \n                            decodeURI(str)\n                            decodeURI('%28Z%29') の結果は '(Z)'\n                            JavaScriptのdecodeURI関数と同一の動作\n                        \n                        \n                            encodeURI(str)\n                            encodeURI('(Z)') の結果は'%28Z%29' \n                            JavaScriptのencodeURI関数と同一の動作\n                        \n                        \n                            decodeURIComponent(str)\n                            decodeURIComponent('%28Z%29') の結果は '(Z)'\n                            JavaScriptのdecodeURIComponent関数と同一の動作\n                        \n                        \n                            encodeURIComponent(str)\n                            encodeURIComponent('(Z)') の結果は'%28Z%29' \n                            JavaScriptのencodeURIComponent関数と同一の動作\n                        \n                    \n                \n                正規表現\n                \n                    \n                        \n                            関数\n                            例\n                            説明\n                        \n                        \n                            test(str, reg)\n                            test('123a456', '[^0-9]') の結果はtrue\n                            文字列strに対して、文字列regで表現した正規表現の検査を行い、マッチすればtrueを返す\n                        \n                        \n                            match(str, reg)\n                            match('123a456', '[0-9]([^0-9])([0-9]') の結果は['3a4', 'a', '4']\n                            文字列strに対して、文字列regで表現した正規表現の検索を行う。マッチすれば配列を返す。要素0は正規表現に対する最後にマッチングした文字列、要素1以降は、( ) の部分に対応する文字列\n                            \n                        \n                    \n                \n                文字リスト\n                \n                    \n                        \n                            関数\n                            例\n                            説明\n                        \n                        \n                            items(x,y,z)\n                            items(x,0,1) の結果は'abc¶'\n                            文字列リストxに対して、y番目からz項目分を文字列リストとして取り出す。最初の文字は0です。\n                        \n                        \n                            itemIndexOf(x,y)\n                            items(x,'abc') の結果は0\n                            文字列リストxに対して、yの文字列が何番目の項目かを求めて返す。 見つからない場合は、-1を返す。空行の連続では '' が要素として存在するものとして判定する。最初の文字は0です。\n                            \n                        \n                    \n                \n                三角関数\n                \n                    \n                        \n                            関数\n                            例（数値は丸めています）\n                            説明\n                        \n                        \n                            sin(x)\n                            sin(PI/4) の結果は 0.71\n                            \n                        \n                        \n                            cos(x)\n                            cos(PI/4) の結果は 0.71\n                            \n                        \n                        \n                            tan(x)\n                            tan(PI/4) の結果は 1\n                            \n                        \n                        \n                            tan2(x,y)\n                            tan2(0.5, 0.5) の結果は PI/4\n                            \n                        \n                        \n                            asin(x)\n                            asin(0.71) の結果は PI/4\n                            \n                        \n                        \n                            acos(x)\n                            acos(0.71) の結果は PI/4\n                            \n                        \n                        \n                            atan(x)\n                            atan(1) の結果は PI/4\n                            \n                        \n                    \n                \n                日付時刻の関数\n                \n                    \n                        \n                            関数\n                            例\n                            説明\n                        \n                        \n                            date(str)\n                            date('2014-02-18') の結果は\n                            引数に指定した文字列の日付に対応する整数を返す。数値は1970/1/1からの日数。引数をそのままJavaScriptのDateクラスで処理をする\n                        \n                        \n                            datetimestr)\n                            datetime('2014-02-17 09:00:01') の結果は\n                            引数に指定した文字列の日時に対応する整数を返す。数値は1970/1/1からの秒数。引数をそのままJavaScriptのDateクラスで処理をする\n                        \n                        \n                            datecomponents(y,m,d)\n                            datecomponents(2014,2,17) の結果は\n                            引数に、年月日を指定して、その日付に対応する整数を返す。数値は1970/1/1からの日数\n                        \n                        \n                            datetimecomponents(y,m,d,h,i,s)\n                            datetimecomponents(2014,2,17,9,0,0) の結果は\n                            引数に、年月日時分秒を指定して、その日時に対応する整数を返す。数値は1970/1/1からの秒数\n                        \n                        \n                            today()\n                            today() の結果は\n                            今現在の日付を指定する整数を返す。数値は1970/1/1からの日数\n                        \n                        \n                            now()\n                            now() の結果は\n                            今現在の日時を指定する整数を返す。数値は1970/1/1からの秒数\n                        \n                        \n                            year(x)\n                            year(datetime('2014-02-17')) の結果は 2014\n                            日付ないしは日時から年を求める\n                        \n                        \n                            month(x)\n                            month(datetime('2014-02-17')) の結果は 2\n                            日付ないしは日時から月を求める\n                        \n                        \n                            day(x)\n                            day(datetime('2014-02-17')) の結果は 17\n                            日付ないしは日時から日を求める\n                        \n                        \n                            weekday(d)\n                            weekday(datetime('2014-02-17 09:23:49') の結果は 1\n                            日付ないしは日時からから曜日を求める\n                        \n                        \n                            hour(x)\n                            hour(datetime('2014-02-17 09:23:49') の結果は 9\n                            日付ないしは日時から時を求める\n                        \n                        \n                            minute(x)\n                            minute(datetime('2014-02-17 09:23:49') の結果は 23\n                            日付ないしは日時から分を求める\n                        \n                        \n                            second(x)\n                            second(datetime('2014-02-17 09:23:49') の結果は 49\n                            日付ないしは日時から秒を求める\n                        \n                        \n                            yeardt(d)\n                            yeardt(datetime('2014-02-17')) の結果は 2014\n                            日時から年を求める\n                        \n                        \n                            monthdt(d)\n                            monthdt(datetime('2014-02-17')) の結果は 2\n                            日時から月を求める\n                        \n                        \n                            daydt(d)\n                            daydt(datetime('2014-02-17')) の結果は 17\n                            日時から日を求める\n                        \n                        \n                            weekdaydt(d)\n                            weekdaydt(datetime('2014-02-17 09:23:49') の結果は 1\n                            日時から曜日を求める\n                        \n                        \n                            hourdt(d)\n                            hourdt(datetime('2014-02-17 09:23:49') の結果は 9\n                            日時から時を求める\n                        \n                        \n                            minutedt(d)\n                            minutedt(datetime('2014-02-17 09:23:49') の結果は 23\n                            日時から分を求める\n                        \n                        \n                            seconddt(d)\n                            seconddt(datetime('2014-02-17 09:23:49') の結果は 49\n                            日時から秒を求める\n                        \n                        \n                            yeard(d)\n                            yeard(date('2014-02-17')) の結果は 2014\n                            日付から年を求める\n                        \n                        \n                            monthd(d)\n                            monthd(date('2014-02-17') の結果は 2\n                            日付から月を求める\n                        \n                        \n                            dayd(d)\n                            dayd(date('2014-02-17') の結果は 17\n                            日付から日を求める\n                        \n                        \n                            weekdayd(d)\n                            weekdayd(date('2014-02-17') の結果は 1\n                            日付から曜日を求める\n                        \n                        \n                            addyear(d, x)\n                            addyear(datetime('2014-02-17 09:23:49'), 2) の結果は '2016-02-17 09:23:49'\n                            日付ないしは日時に指定した年を加える\n                        \n                        \n                            addmonth(d, x)\n                            addmonth(datetime('2014-02-17 09:23:49'), 2) の結果は '2014-04-17 09:23:49'\n                            日付ないしは日時に指定した月を加える\n                        \n                        \n                            addday(d, x)\n                            addday(datetime('2014-02-17 09:23:49'), 2) の結果は '2014-02-19 09:23:49'\n                            日付ないしは日時に指定した日を加える\n                        \n                        \n                            addhour(d, x)\n                            addhour(datetime('2014-02-17 09:23:49'), 2) の結果は '2014-02-17 11:23:49'\n                            日付ないしは日時に指定した時を加える\n                        \n                        \n                            addminute(d, x)\n                            addminute(datetime('2014-02-17 09:23:49'), 2) の結果は '2014-02-17 09:25:49'\n                            日付ないしは日時に指定した分を加える\n                        \n                        \n                            addsecond(d, x)\n                            addsecond(datetime('2014-02-17 09:23:49'), 2) の結果は '2014-02-17 09:23:51'\n                            日付ないしは日時に指定した秒を加える\n                        \n                        \n                            endofmonth(d)\n                            endofmonth(datetime('2014-02-17 09:23:49') の結果は '2014-02-28'\n                            日付ないしは日時の月の最終日を求める\n                        \n                        \n                            startofmonth(d)\n                            startofmonth(datetime('2014-02-17 09:23:49') の結果は '2014-02-01'\n                            日付ないしは日時の月の最初の日を求める\n                        \n                        \n                            addyeardt(d, x)\n                            addyeardt(datetime('2014-02-17 09:23:49'), 2) の結果は '2016-02-17 09:23:49'\n                            日時に指定した年を加える\n                        \n                        \n                            addmonthdt(d, x)\n                            addmonthdt(datetime('2014-02-17 09:23:49'), 2) の結果は '2014-04-17 09:23:49'\n                            日時に指定した月を加える\n                        \n                        \n                            adddaydt(d, x)\n                            adddaydt(datetime('2014-02-17 09:23:49'), 2) の結果は '2014-02-19 09:23:49'\n                            日時に指定した日を加える\n                        \n                        \n                            addhourdt(d, x)\n                            addhourdt(datetime('2014-02-17 09:23:49'), 2) の結果は '2014-02-17 11:23:49'\n                            日時に指定した時を加える\n                        \n                        \n                            addminutedt(d, x)\n                            addminutedt(datetime('2014-02-17 09:23:49'), 2) の結果は '2014-02-17 09:25:49'\n                            日時に指定した分を加える\n                        \n                        \n                            addseconddt(d, x)\n                            addseconddt(datetime('2014-02-17 09:23:49'), 2) の結果は '2014-02-17 09:23:51'\n                            日時に指定した秒を加える\n                        \n                        \n                            endofmonthdt(d)\n                            endofmonthdt(datetime('2014-02-17 09:23:49') の結果は '2014-02-28'\n                            日時の月の最終日を求める\n                        \n                        \n                            startofmonthdt(d)\n                            startofmonthdt(datetime('2014-02-17 09:23:49') の結果は '2014-02-01'\n                            日時の月の最初の日を求める\n                        \n                        \n                            addyeard(d, x)\n                            addyeard(date('2014-02-17'), 2) の結果は '2016-02-17'\n                            日付に指定した年を加える\n                        \n                        \n                            addmonthd(d, x)\n                            addmonthd(date('2014-02-17'), 2) の結果は '2014-04-17'\n                            日付に指定した月を加える\n                        \n                        \n                            adddayd(d, x)\n                            adddayd(date('2014-02-17'), 2) の結果は '2014-02-19'\n                            日付に指定した日を加える\n                        \n                        \n                            endofmonthd(d)\n                            endofmonthd(date('2014-02-17') の結果は '2014-02-28'\n                            日付の月の最終日を求める\n                        \n                        \n                            startofmonthd(d)\n                            startofmonthd(date('2014-02-17') の結果は '2014-02-01'\n                            日付の月の最初の日を求める\n                        \n                    \n                \n            \n        "
    },
    {
        "id": 21,
        "parent": "/ja/for-developers/",
        "path": "/ja/for-developers/sendmail.html",
        "title": "メール送信(Ver.5)",
        "breadcrumb": "メール送信(Ver.5)",
        "body": "\n            \n                はじめに\n                メールはサーバーで送ります。送信方法は、PHPのmail関数を使う方法なので、UNIX系ならsendmailコマンドをたたく方法になります。一方、これだとSMTPサーバーへの転送ができないので、qdsmtpも組み込みました（Thanks to Mr. Spok）。SMTP認証はPlainのみの対応となっています。Windowsの場合はmail関数がすでにSMTPですので、php.iniにサーバー情報などを書くことで対処できます。なお、Windows環境はチェックしていないので、何かあれば知らせてもらえると助かります。（設定のリファレンスは本ページの末尾にあります。）\n                ただ、これだけではだめだろうというのはご存知の方はお分かりかと思いますが、昔作っていたOMEというメールソフトにはPHPのクラスもあったので、それをUTF-8で動くように改造してエンコードなどをさせるようにしました。ちなみに、さらにその前に『メール送信システムの作り方大全』という書籍も書いていて、その中の一部のクラスを使いやすいようにしたのがOME.phpです。この本、もう10年以上前なのですね…。\n                定義ファイルに指定可能なキーワードは以下の通り全て列挙します。しかしながら、すべてを記述することはないです。\n                \n                    IM_Entry(\n    &nbsp; &nbsp; array( &nbsp; // Contexts\n    &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;array(\n    &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;'name' =&gt; 'request',\n    &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;'send-mail' =&gt; array(\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'new' =&gt; array(\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'from' =&gt; '',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;'to' =&gt; 'email',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'cc' =&gt; '',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'bcc' =&gt; '',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'subject' =&gt; '',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'body' =&gt; '',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;'from-constant' =&gt; 'Officer &lt;info@msyk.net&gt;',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'to-constant' =&gt; 'msyk@me.com',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;'cc-constant' =&gt; 'businessmatching@cocoa-study.com',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'bcc-constant' =&gt; '',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;'subject-constant' =&gt; 'Cocoa勉強会ビジネスマッチング申し込み',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'body-constant' =&gt; 'テストメール',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;'body-template' =&gt; 'welcome.txt',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;'body-fields' =&gt; 'name,compnay,email,tel',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;'f-option' =&gt; true,\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'body-wrap' =&gt; 68,\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)\n    &nbsp; &nbsp; ),\n    &nbsp; &nbsp; array(   // Options\n    &nbsp; &nbsp; &nbsp; &nbsp; 'formatter' =&gt; array(...),\n    &nbsp; &nbsp; &nbsp; &nbsp; 'smtp' =&gt; array(\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'server' =&gt; 'mysmtp.msyk.net',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'port' =&gt; 587,\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 　　　'username' =&gt; 'msyktest@msyk.net',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'password' =&gt; 'oshienai',\n    &nbsp; &nbsp; &nbsp; &nbsp; )\n    &nbsp; &nbsp; ),\n    &nbsp; &nbsp; array('db-class' =&gt; 'PDO'),\n    &nbsp; &nbsp; false\n    );\n                \n            \n            \n                メールを送信するタイミングの指定\n                'send-mail'キーの配列の次のレベルのキーとして、'load' 'edit' 'new'のいずれかを指定できます。それぞれ、データベースからの読み込み時、更新時、新規レコード作成時を意味し、コンテキストに対するそれぞれのタイミングでメールを送信します。いずれも、データベース処理が終了してからメールの送信にかかります。上記の例では、新規レコード作成時に、メールが送信されます。\n            \n            \n                宛先や送信者の指定\n                宛先の指定は、'to'ないしは'to-constant'キーに指定します。もし、宛先が一定のものであれば、'to-constant'キーに指定をしてください。'to'キーにはフィールド名を指定します。データベース処理の結果、たとえば新規レコードの場合には新しいレコードが1つ作成されて、そのレコードの内容から'to'キーに指定したフィールドより宛先のデータが取り出されます。編集も原則は1レコードです。一方、読み出しの場合は1レコードにならないかもしれませんが、その場合は最初のレコードから取り出します。むしろ、1レコードに絞り込むコンテキストにするのがメールを送る場合には妥当だと考えられます。\n                メールアドレスは「名前 &lt;アドレス&gt;」ないしは「アドレス」の2つの形式のみのサポートになります。'to-constant'キーに対する値、あるいは'to'キーで指定されるフィールドの値は、このどちらかの形式にしてください。\n                cc、bccについてもまったく同様のルールです。'to'と'to-constant'の両方の指定があれば、'to-constant'が優先されます。cc、bccでも-constantが優先となります。\n                fromについても、fromとfrom-constantキーがあり、設定や動作等は同じです。ただし、UNIXでSMTPサーバーを使わない場合だと、通常はソース側のFrom:は無視されて、UNIXアカウントそのものをFrom:として設定してしまいます。ただし、サーバー側で許可されていれば「'f-option' =&gt; true」の指定を定義ファイル内に記述することで、sendmailコマンドの-fパラメータを指定して、送信者の指定が可能です。\n            \n            \n                件名と本文の指定\n                件名は、subjectあるいはsubject-constantのいずれかのキーに指定します。toなどと同じルールです。\n                メールの本文は、定義ファイル内に指定した通りに送信する'body-constant'、フィールドの内容をそのまま送信する'body'に加えて、テンプレートの処理も可能です。優先順はテンプレート、body-constant、bodyの順になりますので、不要なフィールドは消しておきましょう。\n                テンプレート処理をするには、テンプレートのファイル名をbody-templateキーに指定します。このとき、テンプレートのファイルは、定義ファイルのあるディレクトリを基準に検索します。つまり、定義ファイルといっしょに何らかのテキストファイルを億としたら、body-templateキーの値はファイル名だけでかまいません。\n                テンプレートのファイル内では、そのファイルの内容を本文にしますが、フィールドの値との置き換えも可能です。置き換えたい箇所に@@1@@、@@2@@のように、アットマーク2つに囲まれた1から始まる整数を指定します。テンプレートのファイルはUTF-8で保存します。\n                フィールドについては、'body-fields'キーに、半角のカンマで区切って指定します。最初が1で、順次番号が増えるようになります。例で言えば、emailフィールドの値は、テンプレート内の@@3@@と置き換わって表示されます。'body-fields'キーを省略すると、テンプレートのファイル通りにメールが送信されます。\n                本文は一定の長さで改行を入れます。既定値では72バイトですが、'body-wrap'キーで異なる値にできます。0に設定すると改行しません。ここで、バイト数ですが、実際のバイト数ではなく、日本語は2バイト、英語は1バイトと数えた結果で示しています。実際のエンコードはUTF-8なので、嘘と言えば嘘のカウントになりますが、おそらくこうして指定をすることに慣れている人が多いので、ここでは実態とは関係ない数値ではありますけども実用的という意味で「2バイトルール」でカウントしたものとします。\n            \n            \n                UNIXの場合のSMTPサーバーの指定\n                定義ファイルのIM_Entry関数の第3引数のオプション領域に'smtp'キーで配列を指定します。その他のキーは、前記の例の通りで、キーを見れば意味は分かると思います。もし、SMTP認証をしない場合は、serverとportだけを指定します。認証する場合は、server, port, username, passwordを指定します。したがって、2つないしは4つの要素があるかのどちらかになります。\n                SMTPサーバーの指定は、params.phpファイルでも指定が可能です。変数名として、$sendMailSMTPの定義し、値は'smtp'の右側の配列と同様に指定をします。params.phpファイルでの指定よりも、定義ファイルの指定が優先されます。どこにもSMTPサーバーの設定がない場合には、mail関数での送信になります。\n                Windowsの場合は、'smtp'の指定やparams.phpファイルでの指定は一般には不要ですが、もし設定すれば、mail関数ではなく、qdsmtpによるメール送信ができます。\n            \n            \n                送信されるメールの文字セット\n                基本的にはメールはUTF-8でエンコードして送られます。ISO-2022-JPの指定はOME.phpではできるのですが、必要なら定義ファイルでの指定ができるようにしようと思います。リクエストがなければUTF-8固定で行きます。\n                ヘッダについては、base64のインラインエンコードを、ASCIIコード以外の文字について行います。本文はそのままですが、ヘッダのContent-TyleのcharsetにUTF-8という文字を付けます。つまり、本文はbase64等でのエンコードは行いません。\n                ファイルの添付は実装する予定はありません。ファイルを送りたいのなら、そのリンクを送るようなアプリケーションの動作にしましょう。\n            \n            \n                Gmailのアカウントでメール送信する場合\n                \"server\"キーの値は、\"ssl://smtp.gmail.com\" としてください。\"port\"キーの値は、\"465\"としてください。\"username\"キーの値は、ユーザー名を指定しますが、メールアドレスそのものを指定します。\"password\"キーはパスワードそのものを指定します。\n                定義ファイルやparams.phpに上記の2つのSMTP送信に関するパラメータを設定するとメールが送信できますが、できない場合には、こちらの記述に従って、「安全性の低いアプリのアクセス」を有効にします。この設定が「有効」になっていないと、SMTPサーバーが受け付けません。相当以前はこれが既定値で「有効」になっていましたが、ある時期からは「無効」が既定値になっているようですので、以前は送ることができたという方も、この設定は必ず確認をしてみてください。\n            \n            \n                リファレンス\n               \n                    [第1引数, コンテキスト定義]\n                    メール送信\n                \n               \n                    \n                    \n                        配列指定\n                        値\n                    \n                    \n                        キー\n                        インデックス\n                        下位のキー\n                    \n                    \n                    \n                    \n                        'send-mail'\n                        'read'\n                        \n                        コンテキストに対してレコードの取り出しを行った後にメールを送信する。\n                    \n                    \n                        'from'\n                        送信者名や送信者アドレスが含まれるフィールド名\n                    \n                    \n                        'to'\n                        送信先が含まれるフィールド名\n                    \n                    \n                        'cc'\n                        Cc先が含まれるフィールド名\n                    \n                    \n                        'bcc'\n                        Bcc先が含まれるフィールド名\n                    \n                    \n                        'subject'\n                        件名が含まれるフィールド名\n                    \n                    \n                        'body'\n                        メール本文が含まれるフィールド名\n                    \n                    \n                        'from-constant'\n                        送信者やアドレスを文字列で指定\n                    \n                    \n                        'to-constant'\n                        送信先を文字列で指定\n                    \n                    \n                        'cc-constant'\n                        Cc先を文字列で指定\n                    \n                    \n                        'bcc-constant'\n                        Bcc先を文字列で指定\n                    \n                    \n                        'subject-constant'\n                        件名を文字列で指定。文字列内に「@@フィールド名@@」の記述があれば、フィールドのレコードに置き換わる\n                    \n                    \n                        'body-constant'\n                        本文を文字列で指定。文字列内に「@@フィールド名@@」の記述があれば、フィールドのレコードに置き換わる\n                    \n                    \n                        'body-template'\n                        本文のテンプレートとなるファイルのファイル名\n                    \n                    \n                        'body-fields'\n                        テンプレートに差し込むフィールドの順序をカンマで区切る\n                    \n                    \n                        'f-option'\n                        UNIXでSMTPサーバを経由しない場合にtrueを指定すると、fromの指定が有効\n                    \n                    \n                        'body-wrap'\n                        右端の折り返しのバイト数\n                    \n                    \n                        'update'\n                        \n                        コンテキストに対してレコードの更新処理を行った後にメールを送信する。第3次元については、readと同様。\n                    \n                    \n                        'create'\n                        \n                        コンテキストに対して新たなレコードを作るアクションを起こした後にメールを送信する。第3次元については、readと同様。\n                    \n                    \n                \n                \n                    [第2引数, オプション設定]メール送信サーバー\n                \n                \n                    \n                    \n                        配列指定\n                        値\nparams.phpで変数名\n                    \n                    \n                        第1次元\n                        第2次元\n                    \n                    \n                    \n                    \n                        'smtp'\n                        'server'\n                        メール送信時に使用するサーバのホスト\n                        $sendMailSMTP\n                    \n                    \n                        'port'\n                        メール送信時に使用するサーバのポート\n                    \n                    \n                        'username'\n                        メール送信時に認証で使用するユーザー名\n                    \n                    \n                        'password'\n                        メール送信時に認証で使用するパスワード\n                    \n                    \n                \n            \n        "
    },
    {
        "id": 34,
        "parent": "/ja/for-developers/",
        "path": "/ja/for-developers/sendmail6.html",
        "title": "メール送信(Ver.6)",
        "breadcrumb": "メール送信(Ver.6)",
        "body": "\n            \n                はじめに\n                メールはサーバーで送ります。送信方法は、PHPのmail関数を使う方法なので、UNIX系ならsendmailコマンドをたたく方法になります。一方、これだとSMTPサーバーへの転送ができないので、swiftmailerも組み込みました。Windowsの場合はmail関数がすでにSMTPですので、php.iniにサーバー情報などを書くことで対処できます。（設定のリファレンスは本ページの末尾にあります。）\n                定義ファイルでの指定例を以下に示します。なお、Ver.5の動作とVer.6の動作の兼ね合いがあるので、後半の記事もご覧ください。\n                \nIM_Entry(\n    &nbsp; &nbsp; array( &nbsp; // Contexts\n    &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;array(\n    &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;'name' =&gt; 'request',\n    &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;'send-mail' =&gt; array(\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'create' =&gt; array(\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;     'from-constant' =&gt; 'info@msyk.net',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'to' =&gt; 'email',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'cc-constant' =&gt; 'msyk@me.com',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'subject-constant' =&gt; 'ビジネスマッチング申し込み',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'body-constant' =&gt; '受け付けました。\\n本当です。',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'f-option' =&gt; true,\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'body-wrap' =&gt; 68,\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)\n    &nbsp; &nbsp; ),\n    &nbsp; &nbsp; array(   // Options\n    &nbsp; &nbsp; &nbsp; &nbsp; 'formatter' =&gt; array(...),\n    &nbsp; &nbsp; &nbsp; &nbsp; 'smtp' =&gt; array(\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'server' =&gt; 'mysmtp.msyk.net',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'port' =&gt; 587,\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;   'username' =&gt; 'msyktest@msyk.net',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'password' =&gt; 'oshienai',\n    &nbsp; &nbsp; &nbsp; &nbsp; )\n    &nbsp; &nbsp; ),\n    &nbsp; &nbsp; array('db-class' =&gt; 'PDO'),\n    &nbsp; &nbsp; false\n    );\n                \n            \n            \n                メールを送信するタイミングの指定\n                'send-mail'キーの配列の次のレベルのキーとして、'read' 'update' 'create'のいずれかを指定できます。それぞれ、データベースからの読み込み時、更新時、新規レコード作成時を意味し、コンテキストに対するそれぞれのタイミングでメールを送信します。いずれも、データベース処理が終了してからメールの送信にかかります。上記の例では、新規レコード作成時に、メールが送信されます。\n            \n            \n                宛先や送信者の指定\n                宛先の指定は、'to'ないしは'to-constant'キーに指定します。もし、宛先が一定のものであれば、'to-constant'キーに指定をしてください。'to'キーにはフィールド名を指定します。データベース処理の結果、たとえば新規レコードの場合には新しいレコードが1つ作成されて、そのレコードの内容から'to'キーに指定したフィールドより宛先のデータが取り出されます。編集も原則は1レコードです。一方、読み出しの場合は1レコードにならないかもしれませんが、その場合は最初のレコードから取り出します。むしろ、1レコードに絞り込むコンテキストにするのがメールを送る場合には妥当だと考えられます。\n                メールアドレスは「名前 &lt;アドレス&gt;」ないしは「アドレス」の2つの形式のみのサポートになります。'to-constant'キーに対する値、あるいは'to'キーで指定されるフィールドの値は、このどちらかの形式にしてください。\n                cc、bccについてもまったく同様のルールです。'to'と'to-constant'の両方の指定があれば、'to-constant'が優先されます。cc、bccでも-constantが優先となります。\n                fromについても、fromとfrom-constantキーがあり、設定や動作等は同じです。ただし、UNIXでSMTPサーバーを使わない場合だと、通常はソース側のFrom:は無視されて、UNIXアカウントそのものをFrom:として設定してしまいます。ただし、サーバー側で許可されていれば「'f-option' =&gt; true」の指定を定義ファイル内に記述することで、sendmailコマンドの-fパラメータを指定して、送信者の指定が可能です。\n            \n            \n                件名と本文の指定\n                件名は、subjectあるいはsubject-constantのいずれかのキーに指定します。toなどと同じルールです。\n                メールの本文は、定義ファイル内に指定した通りに送信する'body-constant'、フィールドの内容をそのまま送信する'body'に加えて、テンプレートの処理も可能です。優先順はテンプレート、body-constant、bodyの順になりますので、不要なフィールドは消しておきましょう。\n                テンプレート処理をするには、テンプレートのファイル名をbody-templateキーに指定します。このとき、テンプレートのファイルは、定義ファイルのあるディレクトリを基準に検索します。つまり、定義ファイルといっしょに何らかのテキストファイルを億としたら、body-templateキーの値はファイル名だけでかまいません。\n                テンプレートのファイル内では、そのファイルの内容を本文にしますが、フィールドの値との置き換えも可能です。置き換えたい箇所に@@1@@、@@2@@のように、アットマーク2つに囲まれた1から始まる整数を指定します。テンプレートのファイルはUTF-8で保存します。\n                フィールドについては、'body-fields'キーに、半角のカンマで区切って指定します。最初が1で、順次番号が増えるようになります。例で言えば、emailフィールドの値は、テンプレート内の@@3@@と置き換わって表示されます。'body-fields'キーを省略すると、テンプレートのファイル通りにメールが送信されます。\n                本文は一定の長さで改行を入れます。既定値では72バイトですが、'body-wrap'キーで異なる値にできます。0に設定すると改行しません。ここで、バイト数ですが、実際のバイト数ではなく、日本語は2バイト、英語は1バイトと数えた結果で示しています。実際のエンコードはUTF-8なので、嘘と言えば嘘のカウントになりますが、おそらくこうして指定をすることに慣れている人が多いので、ここでは実態とは関係ない数値ではありますけども実用的という意味で「2バイトルール」でカウントしたものとします。\n            \n            \n                UNIXの場合のSMTPサーバーの指定\n                定義ファイルのIM_Entry関数の第3引数のオプション領域に'smtp'キーで配列を指定します。その他のキーは、前記の例の通りで、キーを見れば意味は分かると思います。もし、SMTP認証をしない場合は、serverとportだけを指定します。認証する場合は、server, port, username, passwordを指定します。したがって、2つないしは4つの要素があるかのどちらかになります。\n                SMTPサーバーの指定は、params.phpファイルでも指定が可能です。変数名として、$sendMailSMTPの定義し、値は'smtp'の右側の配列と同様に指定をします。params.phpファイルでの指定よりも、定義ファイルの指定が優先されます。どこにもSMTPサーバーの設定がない場合には、mail関数での送信になります。\n                Windowsの場合は、'smtp'の指定やparams.phpファイルでの指定は一般には不要ですが、もし設定すれば、mail関数ではなく、qdsmtpによるメール送信ができます。\n            \n            \n                送信されるメールの文字セット\n                基本的にはメールはUTF-8でエンコードして送られます。ISO-2022-JPの指定はOME.phpではできるのですが、必要なら定義ファイルでの指定ができるようにしようと思います。リクエストがなければUTF-8固定で行きます。\n                ヘッダについては、base64のインラインエンコードを、ASCIIコード以外の文字について行います。本文はそのままですが、ヘッダのContent-TyleのcharsetにUTF-8という文字を付けます。つまり、本文はbase64等でのエンコードは行いません。\n                ファイルの添付は実装する予定はありません。ファイルを送りたいのなら、そのリンクを送るようなアプリケーションの動作にしましょう。\n            \n            \n                Gmailのアカウントでメール送信する場合\n                \"server\"キーの値は、\"smtp.gmail.com\" としてください。\"port\"キーの値は、\"587\"としてください。さらに\"encription\"キーは、\"tls\"とします。\"username\"キーの値は、ユーザー名を指定しますが、メールアドレスそのものを指定します。\"password\"キーはパスワードそのものを指定します。params.phpファイルに指定する場合の例を示します。\n$sendMailSMTP = array(\n    \"server\" =&gt; \"smtp.gmail.com\",\n    \"port\" =&gt; 587,\n    \"encryption\" =&gt; \"tls\",\n    \"username\" =&gt; \"msyk.nii83@gmail.com\",\n    \"password\" =&gt; \"himitsunopassword\",\n);\n                定義ファイルやparams.phpに上記の2つのSMTP送信に関するパラメータを設定するとメールが送信できますが、できない場合には、こちらの記述に従って、「安全性の低いアプリのアクセス」を有効にします。この設定が「有効」になっていないと、SMTPサーバーが受け付けません。相当以前はこれが既定値で「有効」になっていましたが、ある時期からは「無効」が既定値になっているようですので、以前は送ることができたという方も、この設定は必ず確認をしてみてください。\n           \n            \n                INTER-Mediator Ver.5とVer.6との相互運用\n                Ver.6の開発時に、様々な機能を追加しましたが、そのための互換性が微妙な感じになってきたので、何もしない場合はVer.5と同じ動作になることを目指し、次のようなルールでバージョン間の動作を切り分けられるようにしました。以下の方法で切り分けるのは、メールの文面を作成する動作です。メール送信は、以下の方法でVer.5の動作にしている時でも、SMTPサーバーを指定するとswiftmailerを利用するなど、送信処理はVer.6で置き換わったものになります。\n                まず、params.phpに$sendMailCompatibilityModeという変数を記述することができるようにしました。これがtrueならVer.5の動作、falseならVer.6の動作となります。この変数は省略した場合trueになります。しかしながら、コンテキストのsend-mailキーに、template-contextキーの値がある場合には、無条件にVer.6の動作になります。\n                Ver.5と6の動作の違いは以下のとおりです。\n                \n                template-contextキーによる、メール文面をデータベースから取り出す処理はVer.6動作が必須。一方、body-template、body-fieldsによるテンプレート処理は、Ver.5互換にしないと利用できない。\n                文字列中の@@フィールド名@@をフィールドの値に置き換える機能は、Ver.5ではsubject-constant、body-constantのみ。Ver.6では、from、to、bcc、cc、body、subjectについて置き換えが可能になった。\n                Ver.6では、from-constant、to-constant、cc-constant、bcc-constant、subject-constant、body-constantは無視するようにした。\n                HTMLの送信はVer.6のみ。\n                \n            \n            \n                ファイルを添付する\n                ファイルを1つだけ追加できます。添付するには、media-root-dirキーの指定が必要です。そして、media-root-dirキーと、attachmentキーから得られるパスを繋いだ絶対パスのファイルを添付します。attachmentキーにフィールド名を指定した場合、そのフィールドは、ファイルのアップロードコンポーネントを利用してアップロードした場合に自動的に設定されるパス名であることを想定していますが、状況によってはテンプレートの仕組みでパスを合成すれば良いでしょう。\n            \n            \n                送信結果をデータベースに残す\n                storeキーには、同じ定義ファイル内に定義した、レコード作成可能なコンテキストを指定します。そのコンテキストに、新たにレコードを作って送信した結果を残せます。エラーがあって送れない場合でも結果を残します。なお、指定したコンテキストには、以下のフィールドがあるものとします。フィールド名は固定でカスタマイズはできません。フィールド名から、何が入力されるかは判別可能だと思います。\n                to_field、bcc_field、cc_field、from_field、subject、body、errors\n                あるテーブルの関連テーブルに送信結果を残す場合、relationキーを指定します。すると、上位のコンテキストの主キー値を自分自身の外部キーフィールドに設定できるので、作られたメール送信レコードに元のテーブルとの関連を残すことができます。ただし、operatorが=のものだけです。また、送信結果を残すコンテキストにqueryキーがあり、operatorが=のものがある場合、その値も初期値として設定されます。\n            \n            \n                データベースに入れたテンプレートにある文面でメールを作成する\n                メールの文面や送り先などをデータベースに入れておき、それを元にメールを作成して送付するには、template-contextキーを指定します。例えば、「mail_template@id=3」のように記述します。mail_templateは、同じ定義ファイルにある読み込み可能なコンテキストで、このコンテキストから以下のようなフィールドがあるものとします。フィールド名は固定でカスタマイズはできません。フィールド名から、何が入力されているかは判別可能だと思います。\n                 to_field、bcc_field、cc_field、from_field、subject、body\n                 @以降は、コンテキストの中の検索条件を指定しますが、条件そのものではなく、=の前後で分離して、WHERE id = 3 のような検索条件で検索をします。実際には最初の1つのレコードだけを利用します。そのレコードからそれぞれのフィールドを取り出しますが、値そのままの場合もありますが、@@フィールド@@を置き換えることも可能です。\n           \n            \n                HTMLメールの送信\n                メールの文面の最初の文字列が &lt;html&gt; である場合、HTMLメールトとして送信します。添付ファイルも一緒に送れますが、添付ファイルをHTMLに埋め込みたい場合、本文の文面内で##image## と記述すればOKです。ただし、画像ファイルであるという前提で文面を作成してください。\n            \n            \n                メッセージングとしてメール送信\n                send-mailキーはVer.6でも利用できますが、メッセージ送信機能を拡張するにあたり、send-mailキーの代わりにmessagingキーを指定することもできます。その場合は、配列にdriverキーで値がmailのエントリーを入れるか、drivierキーを省略することでも構いません。\n            \n            \n                リファレンス\n               \n                    [第1引数, コンテキスト定義]\n                    メール送信\n                \n               \n                    \n                    \n                        配列指定\n                        値\n                    \n                    \n                        キー\n                        インデックス\n                        下位のキー\n                    \n                    \n                    \n                    \n                        'send-mail'あるいは'messaging'\n                        'driver'\n                        \n                        メールを送信する場合は、値は'mail'、あるいはこのエントリーごと省略する（send-mailキーの場合は記述してはいけない）\n                    \n                    \n                        'read'\n                        \n                        コンテキストに対してレコードの取り出しを行った後にメールを送信する。\n                    \n                    \n                        'from'\n                        送信者名や送信者アドレスが含まれるフィールド名、あるいはアドレスの文字列。文字列内に「@@フィールド名@@」の記述があれば、フィールドのレコードに置き換わる\n                    \n                    \n                        'to'\n                        送信先が含まれるフィールド名、あるいはアドレスの文字列。文字列内に「@@フィールド名@@」の記述があれば、フィールドのレコードに置き換わる。複数の送信先はカンマで区切る\n                    \n                    \n                        'cc'\n                        Cc先が含まれるフィールド名、あるいはアドレスの文字列。文字列内に「@@フィールド名@@」の記述があれば、フィールドのレコードに置き換わる。複数の送信先はカンマで区切る\n                    \n                    \n                        'bcc'\n                        Bcc先が含まれるフィールド名、あるいはアドレスの文字列。文字列内に「@@フィールド名@@」の記述があれば、フィールドのレコードに置き換わる。複数の送信先はカンマで区切る\n                    \n                    \n                        'subject'\n                        件名が含まれるフィールド名、あるいは件名の文字列。文字列内に「@@フィールド名@@」の記述があれば、フィールドのレコードに置き換わる\n                    \n                    \n                        'body'\n                        メール本文が含まれるフィールド名、あるいは本文の文字列。文字列内に「@@フィールド名@@」の記述があれば、フィールドのレコードに置き換わる\n                    \n                    \n                        'from-constant'\n                        送信者やアドレスを文字列で指定（Ver.5互換動作の場合のみ）\n                    \n                    \n                        'to-constant'\n                        送信先を文字列で指定（Ver.5互換動作の場合のみ）\n                    \n                    \n                        'cc-constant'\n                        Cc先を文字列で指定（Ver.5互換動作の場合のみ）\n                    \n                    \n                        'bcc-constant'\n                        Bcc先を文字列で指定（Ver.5互換動作の場合のみ）\n                    \n                    \n                        'subject-constant'\n                        件名を文字列で指定。文字列内に「@@フィールド名@@」の記述があれば、フィールドのレコードに置き換わる（Ver.5互換動作の場合のみ）\n                    \n                    \n                        'body-constant'\n                        本文を文字列で指定。文字列内に「@@フィールド名@@」の記述があれば、フィールドのレコードに置き換わる（Ver.5互換動作の場合のみ）\n                    \n                    \n                        'body-template'\n                        本文のテンプレートとなるファイルのファイル名（Ver.5互換動作の場合のみ）\n                    \n                    \n                        'body-fields'\n                        テンプレートに差し込むフィールドの順序をカンマで区切る（Ver.5互換動作の場合のみ）\n                    \n                    \n                        'f-option'\n                        UNIXでSMTPサーバを経由しない場合にtrueを指定すると、fromの指定が有効\n                    \n                    \n                        'body-wrap'\n                        右端の折り返しのバイト数\n                    \n                    \n                        'template-context'\n                        メールの文面を得られるコンテキスト名と検索条件。テーブルに文面のテンプレートをセットしているものとする\n                    \n                    \n                        'store'\n                        送信したメールをここで指定したコンテキストに対して新規レコードを作成して保存する\n                    \n                    \n                        'attachment'\n                        添付するファイルへの相対パスの文字列、あるいはそれを含むフィールド名。文字列内に「@@フィールド名@@」の記述があれば、フィールドのレコードに置き換わる\n                    \n                    \n                        'update'\n                        \n                        コンテキストに対してレコードの更新処理を行った後にメールを送信する。第3次元については、readと同様\n                    \n                    \n                        'create'\n                        \n                        コンテキストに対して新たなレコードを作るアクションを起こした後にメールを送信する。第3次元については、readと同様\n                    \n                    \n                \n                \n                    [第2引数, オプション設定]メール送信サーバー\n                \n                \n                    \n                    \n                        配列指定\n                        値\nparams.phpで変数名\n                    \n                    \n                        第1次元\n                        第2次元\n                    \n                    \n                    \n                    \n                        'smtp'\n                        'server'\n                        メール送信時に使用するサーバのホスト\n                        $sendMailSMTP\n                    \n                    \n                        'port'\n                        メール送信時に使用するサーバのポート\n                    \n                    \n                        'username'\n                        メール送信時に認証で使用するユーザー名\n                    \n                    \n                        'password'\n                        メール送信時に認証で使用するパスワード\n                    \n                    \n                        'encryption'\n                        通信処理の暗号化をする場合にその方法を指定する。'ssl'、あるいは'tls'を指定する\n                    \n                    \n                \n            \n        "
    },
    {
        "id": 35,
        "parent": "/ja/for-developers/",
        "path": "/ja/for-developers/slack.html",
        "title": "Slackにメッセージを送信する",
        "breadcrumb": "Slackにメッセージを送信する",
        "body": "\n            \n                はじめに\n                INTER-Mediatorは以前からメール送信は可能でしたが、Slackのメッセージ送信についても可能にしました。メールと同様に、データベースへの書き込み、更新、読み出しの後に、それらのデータを用いてのメッセージ送信が可能です。Slack側の仕組みは簡単で、Slack Appという設定を行い、ワークスペースにインストールするだけです。Slack Appは単にボットからの書き込みを許可する設定だけです。（設定のリファレンスは本ページの末尾にあります。）\n            \n            \n                Slackでメッセージを受け付けるようにする\n                Slackのメッセージングを行うには、ワークスペース単位にSlack Appのインストールを行います。ここで使うSlack Appは単なる設定です。Slack Appを設定すれば、認証用のトークンが発行されます。そして、メッセージを投入するときに、どのチャンネルなのかと、どんなメッセージなのかを指定します。つまり、Slack Appを作成後は、トークン、チャンネル、メッセージの3つの情報があれば、SlackのAPIコールが可能ということになります。以下、メッセージを受け付けるようにするまでのSlack側の設定を紹介します。\n                SlackのAPIのページに移動します。ログインしていない場合は、「sign in to your Slack account」の部分をクリックして、まずはログインをします。\n                \n                ログインのページで、ワークスペースにログインをします。\n                \n                \n                SlackのAPIのページに移動すると、Create New Appボタンが見えています。このボタンをクリックします。\n                \n                パネルが表示されます。ここで、App Nameを入力し、使用するワークスペースを選択します。App Nameはメッセージの送信者として、投稿したメッセージの中で見えるようになります。そして、Create Appをクリックします。\n                \n                作成したSlack Appの編集画面に入ります。以後は、必要に応じて、保存を行ってください。まず、Add features and functionalityのところにある「Permissions」のボックスをクリックします。必要ならスクロールするなどして探してください。\n                \n                \n                移動したOauth &amp; Permissionsのページで、Scopesのボックスを見つけます。そこにあるAdd an OAuth Scopeボタンをクリックします。\n                \n                ドロップダウンの枠が出てくるので、ここで、「chat:write:bot」を選択します。\n                \n                Scopsのリストに、「chat:write:bot」の項目が追加されました。\n                \n                ページをスクロールして前の方に移動すると、Install App to Workspaceというボタンがあります。このボタンをクリックします。\n                \n                OAuthでやりとりするメッセージの設定を行います。そのままAllowボタンをクリックするので構いませんが、必要ならば設定の変更を行います。\n                \n                OAuth Access Tokenとして、認証トークンが得られました。本稿では、以後はアクセストークンの例は、「xoxp-XXXXXXXXXXX-XXXXXXXXXXX-XXXXXXXXXXXX-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx」と記載します。Copyボタンをクリックするとクリップボードに文字列がコピーされます。\n                \n                設定したことがメールでも送信されています。\n                \n                Slack側の設定は以上です。\n            \n            \n                INTER-Mediatorで開発する定義ファイルの設定\n                サンプルファイルでは、samples/Sample_chatにあるinclude_MySQL.phpファイルに設定例があります。まず、こちらは、定義ファイルの設定例です。\n                \n                    &lt;?php\nrequire_once(dirname(__FILE__) . '/../../INTER-Mediator.php');\n\nIM_Entry(\n    array(\n        array(\n            'records' =&gt; 100000000,\n            'name' =&gt; 'chat',\n            'key' =&gt; 'id',\n            'sort' =&gt; array(\n                array('field' =&gt; 'postdt', 'direction' =&gt; 'desc'),\n            ),\n            'default-values' =&gt; array(\n                array('field' =&gt; 'postdt', 'value' =&gt; date(\"Y-m-d H:i:s\")),\n            ),\n            'authentication' =&gt; array(\n                'all' =&gt; array( // load, update, new, delete\n                    'target' =&gt; 'field-user',\n                    'field' =&gt; 'user',\n                ),\n            ),\n            'messaging' =&gt; [\n                'driver' =&gt; 'slack',\n                'create' =&gt; [\n                    'subject-constant' =&gt; 'message-posting-test',\n                    'body' =&gt; 'message',\n                ]\n            ]\n        ),\n    ),\n    array(\n        'authentication' =&gt; array( ... ),\n        'slack' =&gt; array(\n            'token' =&gt; 'xoxp-XXXXXXXXXXX-XXXXXXXXXXX-XXXXXXXXXXXX-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx',\n            'channel =&gt; '',\n        ),\n    ),\n    array('db-class' =&gt; 'PDO'),\n    false\n);\n                \n              \n                こちらは、params.phpファイルの例です。\n\n\n                    $slackParameters = [\n    \"token\"=&gt;'xoxp-XXXXXXXXXXX-XXXXXXXXXXX-XXXXXXXXXXXX-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx',\n    \"channel\" =&gt; 'message-posting-test',\n];\n                \n                認証トークンとチャンネルは、params.phpファイル、あるいは定義ファイルの2つ目の引数であるオプション指定に記述が可能です。両方に定義があると、params.php側が優先されます。params.phpファイルでは、変数$slackParametersに配列を代入し、配列はキーがtokenとchannelの連想配列になるようにしておきます。定義ファイルのオプション領域では、slackキーに対する連想配列で、tokenキーとchannelキーでそれぞれの指定を行います。\n                そして、定義ファイルのコンテキストと定義に、messagingキーを記述することで、データベース処理に対するメッセージング処理の動作を記述できます。messagingキーの直下は、driver、create、update、readのいずれかのキーを記述しますが、driverは必ず指定して、値はslackにしてください。これを省略するとメール送信とみなします。create、update、readの1つは必ず指定することになると思われます。そのデータベース処理が行われた後に、Slackへメッセージが飛びます。ここで、それぞれの操作の配列に使えるキーは、subject、subject-constat、body、body-constantのいずれかになります。subjectの2つのキーは、チャンネルを示します。チャンネルは3箇所に指定できますが、優先順位はコンテキスト内のものが最優先となります。bodyの2つのキーはメッセージです。subject、bodyは、いずれもコンテキストに存在するフィールド名を1つだけ記述します。一定の文字列で良い場合は、body-constantに文字列を記述します。なお、body-constantではテンプレート処理も行い、その中の「@@フィールド名@@」の記述部分が、コンテキストで得られるデータベースのフィールドの値に置き換わります。なお、コンテキストで複数のレコードが得られる場合、それぞれのレコードに対してメッセージが送信されます。\n                メッセージが送られる様子は、こちらのビデオでご確認できます。\n                以下、設定可能な項目について、まとめておきます。\n                \n                    [第1引数, コンテキスト定義]\n                    Slackメッセージ送信\n                \n                \n                    \n                    \n                        キー\n                        インデックス\n                        下位のキー\n                        値\n                    \n                   \n                    \n                    \n                        'messaging'\n                         'driver'\n                        \n                        'slack' と指定する\n                    \n                    \n                        'read'\n                        \n                        コンテキストに対してレコードの取り出しを行った後にメールを送信する。\n                    \n                    \n                        'subject'\n                        チャンネルが含まれるフィールド名\n                    \n                    \n                        'subject-constant'\n                        チャンネルを文字列で指定。文字列内に「@@フィールド名@@」の記述があれば、フィールドのレコードに置き換わる\n                    \n                    \n                        'body'\n                        メッセージが含まれるフィールド名\n                    \n                    \n                        'body-constant'\n                        メッセージを文字列で指定。文字列内に「@@フィールド名@@」の記述があれば、フィールドのレコードに置き換わる\n                    \n                    \n                        'create'\n                        \n                        コンテキストに対してレコード作成を行った後にメールを送信する。下位のキーはreadと同じ\n                    \n                    \n                        'update'\n                        \n                        コンテキストに対してレコードの更新を行った後にメールを送信する。下位のキーはreadと同じ\n                    \n                    \n                               \n                \n                    [第2引数, オプション設定]Slackメッセージング\n                \n                \n                    \n                    \n                        配列指定\n                        値\n                        params.phpで変数名\n                    \n                    \n                        第1次元\n                        第2次元\n                    \n                    \n                    \n                    \n                        'slack'\n                        'token'\n                        Slackの認証トークン\n                        $slackParameters\n                    \n                    \n                        'channel'\n                        メッセージを送信するサーバ連想配列、キーは第2次元のキーワードと同一\n                    \n                    \n                \n            \n        "
    },
    {
        "id": 22,
        "parent": "/ja/for-developers/",
        "path": "/ja/for-developers/auth.html",
        "title": "ユーザー認証とアクセス権",
        "breadcrumb": "ユーザー認証とアクセス権",
        "body": "\n            \n                ユーザ認証とアクセス権の設定をサポートします。INTER-Mediator自身がデータベースを利用して、ユーザーやグループを管理する手法を「ビルトイン認証」、データベースエンジン側に登録したユーザーを利用する認証を「ネイティブ認証」、LDAPサーバのユーザーを利用した認証を「LDAP認証」と呼びます。また、OAuth2（ただし、Googleのみ確認）やSAMLにも対応しています。INTER-Mediator Ver.8では、パスワード記録時のハッシュを従来のSHA-1から、5000ストレッチしたSHA-256にアップデートしています。従来のSHA-1でのハッシュと相互運用もできます。\n                認証動作に必要なテーブル\n                チャレンジ等を記録するテーブル\n                ユーザ認証ではセキュリティを高めるために、サーバーからクライアントに「チャレンジ」を送り、その値を利用して認証情報を作ります。そのため、サーバー側にチャレンジを残しておく必要があり、テーブルの定義が必要です。そのテーブルは、IM_Entryの第3引数あるいはparams.phpで指定したユーザで読み書きの権限が必要です。チャレンジのテーブル名は、IM_Entryの第2引数で指定するか、あるいは既定値の名前（issuedhash）のテーブルを作成します。テーブルには以下のフィールドが必要です。\n                \n                    チャレンジのテーブルに必要なフィールド\n                    \n                        \n                            フィールド名\n                            型の例\n                            説明\n                        \n                        \n                            user_id\n                            INT,\n                            ユーザテーブルのキーフィールドとなるid値（ユーザをデータベース内のテーブルで管理する場合に利用）\n                        \n                        \n                            username\n                            VARCHAR(48),\n                            ユーザテーブルのキーフィールドとなるid値（ユーザをデータベースエンジンが提供するもので運用する場合に利用）\n                        \n                        \n                            clienthost\n                            VARCHAR(64),\n                            クライアントを識別する情報。サーバーからランダムに与えられる40バイトのHEXコード。ただし、パスワードのセルフサービスのリセット時にSHA-256のハッシュ値のHEX文字列が入る。\n                        \n                        \n                            hash\n                            VARCHAR(64),\n                            チャレンジに使うハッシュ値。実際には48バイトの16進数文字列。ただし、パスワードのセルフサービスのリセット時にSHA-256のハッシュ値のHEX文字列が入る。\n                        \n                        \n                            expired\n                            DateTime,\n                            チャレンジの有効期限を示すタイムスタンプ値\n                        \n                    \n                \n                なお、このテーブルへの検索では、user_idとclienthostあるいはusernameとclienthostの2つのフィールドに対してAND演算での検索条件が与えられます。従って、高速化するためには、この2つのフィールドを合成したインデックスを作っておきます。\n                ユーザーのテーブル\n                認証のためのユーザは、データベース内にテーブルを作成する方法と、データベースエンジンが管理するユーザによる方法を利用できます。データベース内にテーブルを作る場合、そのテーブルは、IM_Entryの第3引数あるいはparams.phpで指定したユーザで少なくとも読み出しの権限が必要です。チャレンジのテーブル名は、IM_Entryの第2引数で指定するか、あるいは既定値の名前（authuser）のテーブルを作成します。テーブルには以下のフィールドが必要です。\n                \n                    ユーザテーブルに必要なフィールド\n                    \n                        \n                            フィールド名\n                            型の例\n                            説明\n                        \n                        \n                            id\n                            INT AUTO_INCREMENT,\n                            連番の数値を入れて、キーフィールドとする\n                        \n                        \n                            username\n                            VARCHAR(48)\n                            ユーザ名（特に制限はないが、重複した名前が定義されないようにするのが望ましい）\n                        \n                        \n                            hashedpasswd\n                            VARCHAR(72)\n                            パスワードのハッシュ値。SHA-256のハッシュ値と、4バイトのソルトを合成したコードのHEXが入るので、72バイト必要。\n                        \n                        \n                            email\n                            VARCHAR(48),\n                            電子メールアドレス。ユーザー名の代わりに使用したり、パスワードのリセットで利用\n                        \n                        \n                            limitdt\n                            DateTime\n                            LDAP認証ユーザーのキャッシュの期限\n                        \n                    \n                \n                ユーザの場合は、ユーザ名をキーフィールドに使えるとも考えられますが、大量のユーザになったときなどに処理速度を有利にするために、内部的にはidフィールドによる連番で与えた数値で処理をすることにします。なお、usernameを条件として検索をかけるので、高速化のためにはこのフィールドにインデックスを作成しておきます。パスワードはハッシュを保存しますが、ハッシュ値は、次の手順で計算をします。\n                \n                    パスワード（pw）と、4バイトのソルト（s）を用意します。\n                    パスワードとソルトをつなげた文字列のSHA-256を5000回のストレッチで求めます（ sha256(pw+s, 5000) → H1）\n                    H1の16進数表現した文字列と、ソルトを16進数表現した文字列をつなげます（hex(H1)+hex(s)→H2）\n                    H2をフィールドに保存します。\n                \n                コマンドで求める例としては、あまり効率良くはないですが、INTER-Mediatorのレポジトリにあるdist-docs/passwdgen.shスクリプトを利用できます。-uはユーザ名、-pはパスワード、-sはSQL文として出力するパラメータです。opensslのコマンドを内部で使っていますが、5000回のストレッチをコマンドから行う方法がわからず、シェルスクリプトで繰り返してopensslコマンドを動かしているため、ハッシュの計算に30秒から1分くらいかかると思われます。\n                % dist-docs/passwdgen.sh -u test -p TEST -s\nINSERT authuser(username,initialpass,hashedpasswd) VALUES('test','TEST','5d4b09daced104e42bc5cfc1d4db6c677afd3ffeadc950a2873b009aeba39bab45654d4b');\n\n                \n                なお、過去に開発したアプリケーションとの互換性を考慮して、SHA-1での利用も可能です。SHA-1ハッシュ値は、次の手順で計算をします。\n                \n                    パスワード（pw）と、4バイトのソルト（s）を用意します。\n                    パスワードとソルトをつなげた文字列のSHA-1求めます（ sha1(pw+s) → H1）\n                    H1の16進数表現した文字列と、ソルトを16進数表現した文字列をつなげます（hex(H1)+hex(s)→H2）\n                    H2をフィールドに保存します。\n                \n                SHA-256互換ハッシュという、SHA-1からパスワードを変更せずにハッシュそのものはSHA-256に移行できるモードも用意しています。設定を行えば、SHA-1での認証が成功した時に、データベースのhashedpasswdフィールドの内容をこの互換ハッシュで書き換えます。次回以降の認証は、互換ハッシュを使っての認証となるので、パスワードを変更せずにSHA-256を使ったハッシュでの運用に移行できます。互換ハッシュは次の手順で計算をします。\n                \n                    SHA-1で求めたHEX表現のハッシュをHとします。\n                    Hのソルトを求めてsとします（salt(H) → s）\n                    Hとsをつなげた文字列のSHA-256を5000回のストレッチで求めます（ sha256(H+s, 5000) → H1）\n                    Hの16進数表現した文字列と、ソルトを16進数表現した文字列をつなげます。このH2がSHA-256互換ハッシュです（hex(H1)+hex(s)→H2）\n                \n\n                グループを管理するテーブル\n                グループそのものを管理するテーブルと、ユーザーやグループの特定のグループへの所属を記録するテーブルの2つがあります。\n                \n                    グループテーブル（既定名：authgroup）のフィールド\n                    \n                        \n                            フィールド名\n                            型の例\n                            説明\n                        \n                        \n                            id\n                            INT AUTO_INCREMENT,\n                            グループを識別するための番号\n                        \n                        \n                            groupname\n                            VARCHAR(48),\n                            グループ名\n                        \n                    \n                \n                \n                    ユーザ・グループ対応付けテーブル（既定名：authcor）のフィールド\n                    \n                        \n                            フィールド名\n                            型の例\n                            説明\n                        \n                        \n                            user_id\n                            INT,\n                            所属するユーザのidフィールドの値\n                        \n                        \n                            group_id\n                            INT,\n                            所属するグループのidフィールドの値\n                        \n                        \n                            dest_group_id\n                            INT,\n                            所属されるグループのidフィールドの値\n                        \n                    \n                \n                アクセス権に関する設定の評価\n                認証の設定は基本的にコンテキストに行いますが、IM_Entryの2番目の引数にも行えます。記述可能な内容については、『定義ファイルでの記述方法a&gt;』を参照してください。つまり、2カ所の設定があるので、以下のように、コンテキストに設定する方を「コンテキストの認証設定」、2つ目の引数に設定するのを「オプションの認証設定」とします。また、いずれも、アクセス権の設定も行いますが、「認証とアクセス権」を合わせてここでは「認証」というネーミングをします。\n                IM_Entry(\n    array(\n        array(\n            \"name\"=&gt;\"context\",\n            \"authentication\"=&gt;array(\n                /* コンテキストの認証設定 */\n            ),\n        ),\n    ),\n    array(\n        \"authentication\"=&gt;array(\n            /* オプションの認証設定 */\n        ),\n...);\n\n                \n                \n                オプションの認証設定に設定可能な情報\n                \n                    \n                    \n                        配列指定\n                        値\n                        params.phpで変数名\n                    \n                    \n                        第1次元\n                        第2次元\n                    \n                    \n                    \n                    \n                        'authentication'\n                        'user'\n                        利用可能なユーザを配列で指定。この記述がなければすべてのユーザにアクセス権。データベースのネイティブユーザで認証する場合には、値を「array('database_native')」と指定する。\n                    \n                    \n                        'group'\n                        利用可能なグループを配列で指定。この記述がなければすべてのグループにアクセス権\n                    \n                    \n                        'user-table'\n                        ユーザ情報が保存されているテーブル名。省略すると'authuser'\n                    \n                    \n                        'group-table'\n                        ユーザ情報が保存されているテーブル名。省略すると'authgroup'\n                    \n                    \n                        'corresponding-table'\n                        ユーザとグループが対応づけられている情報が保存されているテーブル名。省略すると'authcor'\n                    \n                    \n                        'challenge-table'\n                        チャレンジが保存されているテーブル名。省略すると'issuedhash'\n                    \n                    \n                        'authexpired'\n                        認証が自動的に継続される時間を秒数で指定する。省略すると'3600'（1時間）。バージョン4.4以降では、0を指定すると有効期限はWebブラウザー終了時まで\n                    \n                    \n                        'storing'\n                        \n                            認証情報のクライアントへの保存を指定。'cookie'ならPathを指定しないでクッキーに保存（既定値）、'cookie-domainwide'ならドメイン全体で共有できるようにクッキーに保存、'session-storage'ならブラウザのセッションストレージに保存、'none'ならクッキーに保存しない。'credential'であれば認証情報をhttp-onlyのクッキーに保存する\n                        \n                    \n                    \n                        'realm'\n                        \n                            認証領域名。ログインパネルの上部に表示される。また、認証情報を記憶するクッキーの名称の末尾に付与される。\n                        \n                    \n                    \n                        'email-as-username'\n                        \n                            trueを指定すると、authuserテーブルのusernameと同時にemailフィールドも検索する。つまり、電子メールアドレスでの認証が可能になる。既定値はfalse\n                        \n$emailAsAliasOfUserName\n                    \n                    \n                        'issuedhash-dsn'\n                        \n                            issuedhashテーブルに対するDSNを指定する。たとえば、FileMakerデータベースで、issuedhashテーブルをSQLiteで運用する場合に使える\n                        \n$issuedHashDSN\n                    \n                    \n                        'password-policy'\n                        パスワード変更時に適用されるパスワードポリシー。useAlphabet useNumber useUpper useLower usePunctuation length(10)\n                            notUserNameの各単語をスペースで区切って指定する。useAlphabetはアルファベットを使用していないといけなくする。その他、同様に単語から意味が分かるはずである。length(10)はパスワードは10文字以上にする必要があるという意味で、(\n                            ) 内には任意の数値を記述できる。\n                        \n$passwordPolicy\n                    \n                    \n                        'reset-page'\n                        ログインパネルに、パスワードリセットページへのボタンを設置する。ここに、パスワードリセットページのURLを記載する。\n                        $resetPage\n                    \n                        'enroll-page'\n                        ログインパネルに、ユーザー登録ページへのボタンを設置する。ここに、ユーザー登録ページのURLを記載する。\n                        $enrollPage\n                    \n                        'is-saml'\n                        SAML認証を有効にする。なお、params.phpで、$samlAuthSourceの設定は必要。\n                        $isSAML\n                    \n                        'saml-builtin-auth'\n                        SAML認証有効時、ビルトイン認証も有効にするかどうかを指定する。\n                        $samlWithBuiltInAuth\n                    \n                    \n                        'media-context'\n                        \n                        \n                            メディアアクセスに認証を設定するとき、ここで指定したコンテキストにアクセスしたときにメディアの認証用のトークンをクライアントに届ける。このトークンをクライアントが持つ事で、メディアプロキシが認証される（Ver.6ではこの指定は不要になった）\n                        \n                    \n                    \n                \n\n                コンテキストの認証設定に設定可能な情報\n                \n                    \n                    \n                        配列指定\n                        値\n                    \n                    \n                        キー\n                        インデックス\n                        下位のキー\n                    \n                    \n                    \n                    \n                        'authentication'\n                        'media-handling'\n                        \n                        メディアアクセス時の認証を通すためのクッキー情報を、このコンテキストの読み出し時にクライアントに送り込む。必要なときに値にtrueを指定する\n                    \n                    \n                        'all'\n                        'user'\n                        \n                            すべての操作について、このコンテキストを利用可能なユーザを配列で指定。この記述がなければすべての認証ユーザにアクセス権\n                        \n                    \n                    \n                        'group'\n                        \n                            すべての操作について、このコンテキストを利用可能なグループを配列で指定。この記述がなければすべてのグループにアクセス権\n                        \n                    \n                    \n                        'target'\n                        \n                            省略あるいは'table'なら、テーブル全体に対する権限の設定、'field-user'あるいは'field-group'ならレコードごとに権限を指定できる\n                        \n                    \n                    \n                        'field'\n                        \n                            'target'に'field-user'あるいは'field-group'に指定した場合、ユーザ名やグループ名を指定するフィールドのフィールド名\n                        \n                    \n                    \n                        'noset'\n                        \n                            'noset' =&gt; trueで指定すると、レコード作成時に、fieldで指定したフィールドにユーザ名あるいはグループ名を設定する操作を行わない。例えば、認証に使うフィールドを意図的にリレーションシップにより自動的に設定するようなことを意図した場合、リレーションシップのためのフィールド設定と、fieldに指定したフィールドへの入力が重複してSQLエラーが出る。それを回避するための設定。\n                        \n                    \n                    \n                        'read'\n                        (allと同様）\n                        クエリーの操作について、このコンテキストに関する設定を行う\n                    \n                    \n                        'update'\n                        （allと同様）\n                        更新の操作について、このコンテキストに関する設定を行う\n                    \n                    \n                        'create'\n                        （allと同様）\n                        新規レコード作成の操作について、このコンテキストに関する設定を行う\n                    \n                    \n                        'delete'\n                        （allと同様）\n                        レコード削除の操作について、このコンテキストに関する設定を行う\n                    \n                    \n                        'protect-writing'\n                        \n                        \n                        この配列に指定したフィールド名に対する更新処理を禁止する\n                    \n                    \n                        'protect-reading'\n                        \n                        \n                        この配列に指定したフィールド名から読み出したデータをクライアントに送る事を禁止する\n                    \n                    \n                \n\n                コンテキストの認証設定なし、オプションの認証設定あり\n                タイトル用な条件だと、コンテキストの認証設定のuserとgroupがアクセス権の設定に関係します。もし、userもgroupも設定されていない場合は、認証が通ったユーザは何でもできると考えてください。\n                userあるいはgroupが設定されている場合、認証が通ると同時に、そのユーザあるいはそのユーザを含むグループが、userあるいはgroupの設定に含まれている必要があります。\n                コンテキストの認証設定あり、オプションの認証設定なし\n                オプションの設定のうちuserとgroupの設定がないということです。この場合、特定のコンテキストのデータベース処理に対して、コンテキストの認証設定が適用されます。\n                コンテキストの認証設定あり、オプションの認証設定あり\n                両方の認証設定があれば、先にオプションの認証設定が評価されて、その後にコンテキストの認証設定が評価されます。\n                コンテキストの認証設定の適用対象\n                適用対象として、4つのデータベース処理、read/create/update/deleteに対する処理と、それらすべてに対してまとめて設定を行うallがあります。\n                コンテキストの認証設定のtableとfleld\n                \"table\"キーに対する値がfield-userあるいはfield-groupの場合は、そのテーブルにあるfieldに指定したフィールドに、ログインが成功したユーザあるいはそのユーザが含むグループの名前が設定されちているレコードだけに絞り込まれます。検索条件にANDでユーザないしはグループの値をfieldに指定したフィールドに対する条件を付け加えます。したがって、fieldで指定したフィールドのうち、空欄ものは認証すればいっさいアクセスできないということになります。\n                \"table\"キーに対する値がfield-useやfield-groupではない場合、アクセス権はすべてのテーブルに渡って適用されます。レコードごとのアクセス権を記録するフィールドは不要です。このとき、userあるいはgroup属性に含まれていないユーザで認証した場合、いっさいのアクセスはできないようになっています。オプションの認証設定と異なる動作ですので、注意してください。\n                read/update/deleteに関しては、アクセス権は「検索条件」として集約されます。一方、createの操作に対しては、アクセス権がある場合だけ、レコードの作成が可能です。レコードの作成により、fieldで指定したフィールドに、ユーザないしはグループが設定されます。ユーザの場合は1つに決まりますが、グループの場合は、グループ名を並べ替えたときのいちばん先頭のグループ名を記録するようにします。\n                \n                params.phpファイルへの指定\n                \n                                \n                    \n                    \n                        変数名\n                        既定値\n                        指定内容\n                    \n                    \n                    \n                      \n                        $passwordHash\n                        \"1\"\n                        \"1\"なら、SHA-1、SHA-256互換、SHA-256のいずれも対応。\"2m\"なら、SHA-256互換、SHA-256のいずれも対応。\"2\"なら、SHA-256のみ対応。\n                      \n                      \n                        $alwaysGenSHA2\n                        false\n                        $passwordHashが\"1\"で、この変数がfalseの場合、パスワード変更するとSHA-1でハッシュする。この変数がtrueなら、パスワード変更時にSHA-256でハッシュする。$passwordHashが\"1\"以外の場合は、この変数に関係なく、パスワードを変更すると、SHA-256でハッシュをかける。\n                      \n                      \n                        $migrateSHA1to2\n                        false\n                        trueにすれば、SHA-1でハッシュされたパスワードでログインをした後、そのハッシュ値をSHA-256互換のハッシュにコンバートする。実質的に、SHA-1のパスワードを変更しないでSHA-256に移行できる。\n                      \n                      \n                        $resetPage\n                        なし\n                        URLを文字列で指定すると、ログインパネルに「パスワードをリセット」のボタンが表示され、クリックするとそのURLへジャンプする。ボタン名のメッセージの番号は2023\n                      \n                      \n                        $enrollPage\n                        なし\n                        URLを文字列で指定すると、ログインパネルに「ユーザー登録をする(要メールアドレス)」のボタンが表示され、クリックするとそのURLへジャンプする。ボタン名のメッセージの番号は2022\n                      \n                      \n                        $ldapServer\n                        なし\n                        LDAPサーバーのURLで、ldap://あるいはldaps://から始まる。この設定を行うと、LDAP認証が有効になる。\n                      \n                      \n                        $ldapPort\n                        なし\n                        LDAPサーバーのポート番号。通常は389\n                      \n                      \n                        $ldapBase\n                        なし\n                        ディレクトリ内のルートへのDNなど。$ldapContainerを繋げてユーザレコードが存在する場所を示す。\n                      \n                      \n                        $ldapContainer \n                        なし\n                        $ldapBaseに繋げてユーザレコードが存在する場所を示す。\n                      \n                      \n                        $ldapAccountKey\n                        なし\n                        ユーザー名として識別するデータがある属性名\n                      \n                      \n                        $ldapExpiringSeconds\n                        1800\n                        ユーザー情報をビルトインユーザとしてキャッシュするが、キャッシュの有効期間。この期間を過ぎると、再度LDAPサーバへ認証を確認する。\n                      \n                      \n                        $oAuthProvider \n                        なし\n                        OAuth認証時のプロバイダを指定する文字列で、\"Google\"のみ実装。\n                      \n                      \n                        $oAuthClientID\n                        \n                        プロバイダから供給されるクライアントID\n                      \n                      \n                        $oAuthClientSecret \n                        \n                        プロバイダから供給されるシークレット\n                      \n                      \n                        $oAuthRedirect\n                        \n                        認証後にリダイレクトされるURL\n                      \n                      \n                        $isSAML\n                        false\n                        SAML認証を有効にする。なお、SAMLのSPになるための設定については、INTER-Mediatorのレポジトリにあるsample/saml-configディレクトリの内容と説明を参照してください。\n                      \n                      \n                        $samlAuthSource\n                        なし\n                        SPの識別名\n                      \n                      \n                        $samlWithBuiltInAuth\n                        false\n                        trueにすると、SAML認証だけでなく、ビルトイン認証も並行して利用できる。そのため、INTER-Mediatorのログインパネルが表示され、そこに「SAML認証」ボタン（ボタン名のメッセージの番号は2026）が表示される\n                      \n                   \n                \nログインパネルのカスタマイズ\nログインパネルのカスタマイズについて、マイナーなものであれば、CSSの設定で行けると思います。ブラウザのデバッガで見ていただければ、ログインパネルの各要素はそれぞれclass属性が割り当てられているので、たとえば、ページのヘッダや独立したファイルでCSSを適用します。これらは、原則としてINTER-Mediatorのテーマ設定よりも優先度は高くなるので、上書きや変更は可能です。なお、ログインパネルのスタイル情報はテーマに含まれているので、テーマを作り直すという方法もあります。\nログインパネルを完全にカスタマイズしたいとう場合は、例えば、以下のようなプログラムを、INTERMediatorOnPage.doBeforeConstructに代入する関数の中などで実行します。最初の3行はプロパティ名から動作は明白と思われますが、ポイントは、ページに上乗せするログインパネル部分を、HTMLの文字列として、loginPanelHTMLプロパティに書き込みます。\nINTERMediatorOnPage.isShowChangePassword = false;\nINTERMediatorOnPage.defaultBackgroundImage = null;\nINTERMediatorOnPage.defaultBackgroundColor = \"white\";\nINTERMediatorOnPage.loginPanelHTML = '&lt;div&gt;....';\nこのloginPanelHTMLに書き込むHTMLはボディの一部となるような書き方をします。原則自由に記述できますが、この中にユーザー名を入れるテキストフィールドや、認証ボタンなどを配置する必要があります。それらは、決められたid属性を持つ必要があります。INTER-Mediatorが認識するid属性は、_im_password、_im_username、_im_authbutton、_im_changebutton、_im_oauthbuttonです。最初の2つがテキストフィールド、残りがボタンを想定しています。このid属性値を設定しておけば、例えば、認証ボタンとしての機能はINTER-Mediatorが自動的に組み込みます。\n                ネイティブ認証、LDAP認証で使う鍵データ\n                ネイティブ認証やLDAP認証では、クライアントで入力したパスワードを、サーバー側でも利用します。そのため、クライアントからサーバーにパスワードそのものを伝達しなければなりませんが、平文で流すことがないように、暗号化してクライアントからサーバーに送ります。そのために、RSAの鍵ペアを生成してサーバーに記録します。クライアントへは公開鍵だけが送られて、暗号にしたデータをサーバーに送ります。鍵ペアは例えば、「openssl rsagen -out gen.key 2048」のようなコマンドを入れてファイルをまず作ります。そして、その内容のテキストを、$params.phpファイルの変数$generatedPrivateKeyに代入します。INTER-Mediatorに含まれているparams.phpファイルで、該当する変数を探して、生成した鍵に置き換えてください。もし、鍵にパスワードが必要な場合には変数$passPhraseに記述できますが、このファイル自体はPHPが稼働していればクライアントから参照できないとはいえ、扱いには注意しましょう。\n                LDAP認証\n                LDAPサーバに関する情報を、params.phpファイルに記述をします。以下はその例です。変数ldapServerはLDAPサーバのURL、ldapPortはポート番号です。そして、ユーザーのDN（Distinguished Name）を決定するために、3つの変数を指定します。たとえば、ユーザー名がmsykなら、Open Directoryの場合はDNは「uid=msyk,cn=users,dc=homeserver,dc=msyk,dc=net」となります。「msyk」の前はldapAccountKey、後はldapContainerとldapBaseで指定した記述がつなげられて、DNを構成しています。ldapExpiringSecondsは、1回のLDAP認証後、指定した時間はLDAPサーバではなく、ネイティブ認証のためのテーブルにキャッシュした情報で認証します。これはパフォーマンスを高めるためです。最後に認証してから、変数ldapExpiringSeconds以上の時間が経過すると、改めてLDAPサーバに接続して認証を行います。\n                $ldapServer = \"ldap://homeserver.msyk.net\";\n$ldapPort = 389;\n$ldapBase = \"dc=homeserver,dc=msyk,dc=net\";\n$ldapContainer = \"cn=users\";\n$ldapAccountKey = \"uid\";\n$ldapExpiringSeconds = 1800;\n            \n            \n    "
    },
    {
        "id": 23,
        "parent": "/ja/for-developers/",
        "path": "/ja/for-developers/samples.html",
        "title": "サンプルファイル",
        "breadcrumb": "サンプルファイル",
        "body": "\n            \n                はじめに\n                \n                    PHPの稼働が可能なWebサーバーをご用意ください。データベースとしては、FileMaker ServerないしはPDOに対応したデータベース（MySQLなど）も稼働させてください。\n                    \n                        ダウンロードしたファイルを展開したフォルダの中にある「INTER-Mediator_XXXX」フォルダをWebサーバーから参照できる場所にコピーしてください。以下、このフォルダを「INTER-Mediator」フォルダと参照します。このようにフォルダ名を変更してもかまいません。\n                    \n                    PHPでは、mbstringが動作していることを確認してください。Windows版のPHPではデフォルトではmbstringのDLLがコメントされていて読み込まれていないことが一般的ですので、ご注意ください。\n                    \n                \n            \n            \n                ダウンロードしたファイルの中身\n                \n                    ダウンロードしたフォルダ内ルートにあるファイルやフォルダが、INTER-Mediatorの本体です。その中にある「Samples」フォルダはサンプルです。\n                    \n                        「INTER-Mediator」フォルダは、PHPからから参照できる場所であれば、どこにあってもかまいません。このフォルダの中にJavaScriptファイルの「INTER-Mediator.js」があるのでWebで公開していないといけないかと思うかもしれませんが、このファイルは公開されている必要はありません。\n                    \n                    しかしながら、「INTER-Mediator」フォルダごと、Webサーバーで公開する場所に配置するのがいちばん手軽な方法です。\n                \n            \n            \n                FileMaker Serverでの準備\n                \n                    FileMaker Serverで利用する場合は、FX.php(This site is neither affiliated with nor endorsed by Chris Hansen)が必要ですが、INTER-Mediatorには含まれています。「INTER-Mediator/lib/FX」フォルダがそれです。一般に配布されるものをある程度改造したものを使っています。\n                    \n                    FileMaker Serverで付属のサンプルを利用する場合、解凍したフォルダのルートにあるTestDB.fp7をFileMaker Serverにインストールしてください。このファイルの管理ユーザは「admin」でパスワードは「1234」です。\n                    \n                    FileMaker ServerではXML共有を開始していることを確認してください（FXの動作条件です）。\n                \n            \n            \n                MySQLでの準備\n                \n                    \n                        MySQLで付属のサンプルを利用する場合、「INTER-Mediator/dist_docs/sample_schema_mysql.txtをmysqlコマンド等でデータベースに読み込んで、テーブルなどを定義してください。このファイルの最初に、コマンド入力方法について簡単に記載してあります。\n                    \n                    INTER-Mediator/params.phpの値、特に、$dbDSN 変数の値を適切なものに変更してください。\n                \n            \n            \n                PostgreSQLでの準備\n                \n                    \n                        PostgreSQLで付属のサンプルを利用する場合、「INTER-Mediator/dist_docs/sample_schema_pgsql.txtをpgsqlコマンド等でデータベースに読み込んで、テーブルなどを定義してください。このファイルの最初に、コマンド入力方法について簡単に記載してあります。\n                    \n                    INTER-Mediator/params.phpの値、特に、$dbDSN 変数の値を適切なものに変更してください。\n                \n            \n            \n                SQLiteでの準備\n                \n                    \n                        SQLiteで付属のサンプルを利用する場合、「INTER-Mediator/dist_docs/sample_schema_sqlite.txtをsqliteコマンド等でデータベースに読み込んで、テーブルなどを定義してください。このファイルの最初に、コマンド入力方法について簡単に記載してあります。\n                    \n                    データベースファイルの位置は特に問いませんので、適当な場所に作成します。INTER-Mediator/params.phpの値、特に、$dbDSN 変数の値を適切なものに変更してください。\n                \n            \n            \n                サンプルファイルのチェックポイント\n                \n                    \n                        インストール等の準備が行われれば、Webブラウザからサーバーに公開した「INTER-Mediator/Samples」ディレクトリを参照してください。Webサーバーのルートに「INTER-Mediator」フォルダがある場合、http://ホスト名/INTER-Mediator/Samples/index.htmlで、各サンプルへのリンクを貼ったページが表示されます。\n                    \n                    サンプルの一覧のページが表示されます。サンプルはデータベースごとに分類されています。\n                    \"Sample Portal Page\"は、テーブル形式の画面が表示されています。テキストフィールドに何か表示されていれば、インストールは成功です。これらのデータはデータベースの中にあるものが見えています。データベースを開いてページの内容と一致していることを確認します。たとえばFileMaker Proを使って開いたFileMakerのデータベースと、Webブラウザに見えているデータベースの内容が同じであることを確認してください。\n                    \n                    \n                        サンプルは、人間１人に対するコンタクト情報を記録するようなものです。意図的にあまり凝っては作っていません（INTER-Mediatorは「きれいな表」を作るツールではないからです）。まず、テキストフィールドに、フィールドの値がそのまま表示されていることを確認します。また、テキストフィールドのデータを変更してTabを押すなどすれば、そのタイミングでデータベース側ではそのフィールドだけが更新されています。つまり、テキストフィールドでは表示して編集し、編集結果をデータベースに書き戻す事ができます。\n                    \n                    チェックボックスやラジオボタンもあります。これらも、値に応じて選択されていたり、いなかったりといった動作をします。また、選択肢を変更すると、その結果がデータベースに書き込まれています。\n                    1人の人間に対して、複数のコンタクト先があります。つまり、1対多の関係をWebページ上に展開できます。\n                    \n                        コンタクトの情報では、WayとKindという2つのフィールドでポップアップメニューがあります。Wayの選択肢に応じてKindの選択肢が変わるようになっています。WayとKindの選択肢は多対多の関係にあるため、スキーマ的には中間テーブルを定義しています。\n                    \n                    「Delete」や「Insert」ボタンがあります。おそらく、期待通りに削除や挿入ができているのではないかと思います。1対多の関係にあるレコードについても、適切に外部キーの値を設定して、レコードの挿入を行います。\n                    \n                    いずれも、「保存」や「更新」という処理をしなくても、データベースが更新されていることが分かります。\n                    \"Sample Search Page\"は、郵便番号検索のサンプルです。検索条件にあらかじめ入れられているテキストで検索してみてください。また、その後、適当にいろいろと検索をしてみてください。複数のレコードを、決められた数のレコードごとに表示することができます。このサンプルの場合は、ボタンをクリックすればページを合成するという仕組みを利用して、「検索」の動きをさせています。\n                    \n                \n            \n        "
    },
    {
        "id": 24,
        "parent": "/ja/for-developers/",
        "path": "/ja/for-developers/bindingfunc.html",
        "title": "検索ページを作成するための機能",
        "breadcrumb": "検索ページを作成するための機能",
        "body": "\n            \n                はじめに\n                データベースの内容を一覧するときに、検索結果を適用するという仕組みを一切プログラムを書かずに実現するために、ボタンやテキストフィールド、あるいは一般的なノードに対して機能を割り当てるという考え方を導入しました。要素のdata-im属性を利用して、ローカルコンテキスト（名前は「_」）に特別なキー名でバインドすることで、機能が割り当てられます。今の所、検索ページを作るための以下のものが利用できます。抽象的に記述してもわかりにくいと思いますので、具体的なタグのテキストともに紹介します。\n            \n            \n                検索条件の付加\n                テキストフィールドを「_@condition:....」のローカルコンテキストへバインドさせると、そのテキストフィールドに入れた文字列が検索条件になります。また、Enterキーで、コンテキストの更新が実行されます。\n                &lt;input type=\"text\" data-im=\"_@condition:postalcode:f3,f7,f8,f9:*match*\"&gt;\n                \n                @以降は、コロン（:）で4つのセクションに分かれます。\n                \n                    第1セクション（例：condition）：この文字列\n                    第2セクション（例：postalcode）：コンテキスト名\n                    第3セクション（例：f3,f7）：フィールド名。複数の指定も可能\n                    第4セクション（例：*match*）：演算子\n                \n                最初の2つはいいとして、3つ目のフィールドは半角のカンマで区切って複数指定も可能です。複数指定をすると、それぞれのフィールドに対して同じ値の検索条件をORで与えます。なお、FileMakerのフィールド名に含まれる「::」は、「;;」に置き換えて指定します。4つ目の演算子は、一般的なものに加えて「*match」「match*」「*match*」の3つが用意されています。データベースエンジンに関わらずに、部分一致や前方一致などをこの演算子で記述します。\n                上記のテキストフィールドに、例えば「新宿」と入れてEnterキーを押すと、以下の検索条件がコンテキストに付加されて、再度検索を行い、そのコンテキストのエンクロージャー内が更新されます。\n                (f3 LIKE '%新宿%' OR&nbsp;f7 LIKE '%新宿%' OR&nbsp;f8 LIKE '%新宿%' OR&nbsp;f9 LIKE '%新宿%')\n                \n            \n            \n                表示件数の制御\n                以下のポップアップメニューを選択すると、レコードの表示件数をポップアップの選択肢で指定でき、選択と同時にコンテキストが更新されます。「limitnumber」が決められた名前で、コロンより後にはコンテキスト名を記述します。changeイベントにより、コンテキストの更新します。\n                &lt;select type=\"text\" data-im=\"_@limitnumber:postalcode\"&gt;...&lt;/select&gt;\n                \n            \n            \n                コンテキストの更新ボタン（検索ボタン）\n                以下のボタンをクリックすると、指定したコンテキストが更新されます。つまり、「検索」ボタンとして機能するということです。「update」が決められた名前で、コロンより後にはコンテキスト名を記述します。clickイベントにより、コンテキストの更新します。\n                &lt;button data-im=\"_@update:postalcode\"&gt;search&lt;/button&gt;\n                \n            \n            \n                並べ替えフィールドの指定\n                以下のSPANタグ内の▲をクリックすると、f3フィールドの昇順で並べ替えを行います。同一のコンテキストに対する「addorder」の機能を持った要素は連動します。たとえば「f3で昇順」の後に「f9の降順」を選択すると、「f9の降順」を最優先とし、続くキーとして「f3で昇順」を設定します。最後に設定した条件が最優先になるようになっています。このバインドはclickイベントに対応しており、クリックすれば指定したコンテキストが更新されます。\n                &lt;span style=\"cursor: pointer\" data-im=\"_@addorder:postalcode:f3:asc\"&gt;▲&lt;/span&gt;\n                \n                @以降は、コロン（:）で4つのセクションに分かれます。\n                \n                    第1セクション（例：addorder）：この文字列\n                    第2セクション（例：postalcode）：コンテキスト名\n                    第3セクション（例：f3）：フィールド名。1つのみ\n                    第4セクション（例：asc）：昇順ならasc、降順ならdesc\n                \n            \n            \n            複数の検索条件に対する演算子\n                この項目の記述は、Ver.10の途中から実装した機能です。あるコンテキストtesttableに対して、以下のような3つの検索用テキストフィールドを用意したとします。ちょっと複雑ですが、これによって、どんなWHERE句が生成されるのかを具体的に紹介します。\n                \n                    \n                \n                まず、既定の状態では次のように、ローカルコンテキストを利用した検索条件などからWHERE句を生成します。このコンテキストは、num1 &gt; 0 という検索条件をコンテキストに設定しているので、まず、それらの検索条件（つまり、ローカルコンテキストではない条件）があって、続いてANDで繋がれ、その後にローカルコンテキストによる条件が並びます。既定値では、ローカルコンテキストの検索条件は全てORで結ばれます。ローカルコンテキストによる条件の前の演算子は必ずANDになります。\n                SELECT * FROM `testtable` WHERE ((`num1` &gt; 0)) \n    AND ( ((`vc1` LIKE '%test word%' OR `vc2` LIKE '%test word%' OR `vc3` LIKE '%test word%') \n         OR (`num1` &gt;= 10) \n         OR (`num2` &lt;= 99)))\n                ここでカスタマイズ可能な演算子を「OP1」「OP2」で記述すると、次のようになります。OP1は、フィールドをカンマで書き並べた場合のそれぞれの条件を結合する演算子です。一方、OP2は、異なるローカルコンテキストの値ごとに生成される条件を結合する演算子です。\n                SELECT * FROM `testtable` WHERE ((`num1` &gt; 0)) \n    AND ( ((`vc1` LIKE '%test word%' OP1 `vc2` LIKE '%test word%' OP1  `vc3` LIKE '%test word%') \n         OP2  (`num1` &gt;= 10) \n         OP2  (`num2` &lt;= 99)))\n               OP1、OP2については既定値ではORですが、プロパティへの設定で演算子をANDに切り替えることもできます。INTERMediator.lcConditionsOP1AND、あるいはINTERMediator.lcConditionsOP2ANDというプロパティに対してtrueを代入することで、それぞれ、OP1とOP2の演算子をANDに切り替えることができます。プロパティへの設定は、例えば、ページ生成前に呼びされるdoBeforeConstructメソッド等に記述します。\n               INTERMediator.lcConditionsOP3ANDは、さらに検索条件の値に半角あるいは全角のスペースがあれば、それで区切って複数の検索条件を生成することができます。例えば、次のようにプロパティを設定したとします。\n      INTERMediatorOnPage.doBeforeConstruct = function () {\n        INTERMediatorLog.suppressDebugMessageOnPage = true\n        INTERMediator.lcConditionsOP1AND = false;\n        INTERMediator.lcConditionsOP2AND = true;\n        INTERMediator.lcConditionsOP3AND = true;\n      }\n               この時、3つ目の検索条件は「test word」だったので、「test」と「word」でそれぞれで検索する条件を生成して、それらは、OP1、つまりORで検索条件を生成します。ここでのtestによる検索条件と、wordによる検索条件を結ぶ演算子はORになっていますが、INTERMediator.lcConditionsOP3ANDに代入する値を文字列の'and'にすれば、ORではなくANDで演算します。なお、INTERMediator.lcConditionsOP2ANDについてもtrueにしているので、num1 &gt;= 10などの検索条件との結合演算子はANDが設定されています。\nSELECT * FROM `testtable` WHERE ((`num1` &gt; 0))\n    AND ( (((`vc1` LIKE '%test%' OR `vc2` LIKE '%test%' OR `vc3` LIKE '%test%') \n             OR (`vc1` LIKE '%word%' OR `vc2` LIKE '%word%' OR `vc3` LIKE '%word%')) \n         AND (`num1` &gt;= 10) \n         AND (`num2` &lt;= 99)))\n                改めて、OP1、OP2、OP3の関係がわかりやすいSQL文を記述しておきます。\n                SELECT * FROM `testtable` WHERE ((`num1` &gt; 0)) \n    AND ( (((`vc1` LIKE '%test%' OP1  `vc2` LIKE '%test%' OP1  `vc3` LIKE '%test%') \n             OP3  (`vc1` LIKE '%word%' OP1  `vc2` LIKE '%word%' OP1  `vc3` LIKE '%word%')) \n         OP2  (`num1` &gt;= 10) \n         OP2  (`num2` &lt;= 99)))\n                INTERMediator.lcConditionsOP1ANDとINTERMediator.lcConditionsOP2ANDについては、trueかfalseを入力しますが、規定値がfalseになっているので、trueにしたい場合だけ代入することでも構いません。INTERMediator.lcConditionsOP3ANDは前の2つのプロパティと異なり、false/true/'and'の3つの値のどれかです。trueの場合は単語分割するというフラグになっているので、この時のOP3演算子はORにはなります。OP3演算子をANDにしたい場合は、文字列の'AND'を指定します。\n                なお、Ver.7でINTERMediator.alwaysAddOperationExchangeを導入し、これにより、前述の説明のOP2をANDにするという機能を実装しました。Ver.10での改訂時に、INTERMediator.alwaysAddOperationExchangeが設定されていれば、INTERMediator.lcConditionsOP2ANDをtrueにするようにして、互換性を保っています。\n                        \n        "
    },
    {
        "id": 25,
        "parent": "/ja/for-developers/",
        "path": "/ja/for-developers/sharing5.html",
        "title": "変更結果の即時更新をマルチクライアントで実現する(Ver.5)",
        "breadcrumb": "変更結果の即時更新をマルチクライアントで実現",
        "body": "\n            \n                はじめに\n                \n                    コンテキストの共有化をマルチクライアントで実現する仕組みが稼働します。つまり、同一のページを複数のクライアントで参照しているとき、誰かがデータを変更すると、その結果は他のユーザのページにも反映されるという動作が典型的です。従って、1つのフィールドを単一の要素にバインドしている場合でも、マルチユーザつまり複数のブラウザで同一のエンティティをバインドしているという点で「共有化」されていると言えるわけです。コンテキストの共有化を実現するために、ページファイル上でのターゲット指定や、定義ファイルでのコンテキスト定義以外に何をしなければならないかをこの文書にまとめておきます。なお、このページに記載の内容は、Ver.5まで適用できます。Ver.6ではこの機能を廃止、Ver.7以降で別の実装に移行します。\n            \n            \n                機能の概要と実現手法\n                \n                    INTER-Mediatorでは、「コンテキスト」は、データベースに対するデータの出入り口的なイメージのものであり、検索条件などでの意味づけされたデータソースを意味します。その「共有化」とは、同一エンティティが複数のページ上のオブジェクトに展開されているとき、1つのエンティティを変更すると、その結果が他のオブジェクトにも反映される仕組みと定義します。Ver.4.4までに、単一ページ内のコンテキストの共有化が実現しています。つまり、あるページ上に、同一フィールドとバインドした要素がある\bとすると、一方を変更すると、もう一方は自動的に更新します。この動作を実現するためのプログラミングは必要なく、バインドの設定（ターゲット指定の付与）だけで可能です。しかしながら、マルチクライアントでのコンテキストの共有化では、WebRTCを利用したPusherというサービスを利用することにしました。試用程度なら無償ですが、実運用には有償となってしまうものの、開発の効率化のために利用することにしました。\n                \n            \n            \n                Pusherアカウントの取得とアプリケーション登録\n                Pusherのサイトでアカウントを取得します。Pusherでは「App」という単位で管理ができるので、たとえばINTER-Mediatorで作る1つのソリューションを、1つのPusherのAppとして登録するという方法もありますし、複数のソリューションで共有してもいいかもしれません。いずれにしても、アカウントを作成し、New Appというボタンなどで新たに1つのAppを作成します。ページ上に表示されるapp_id、key、secretの3つの情報がこの後に必要となります。\n                \n            \n            \n                Pusherのサーバープログラムのインストール\n                PusherのサーバーモジュールはPHP版を利用します。こちらのレポジトリをダウンロードし、そこから得られるlibディレクトリにあるPusher.phpという1つのファイルだけをサーバーにインストールします。他は使用しません。ファイルはPHPの設定ファイル（php.iniが代表的）で、include_pathの設定で参照できるディレクトリにあればかまいません。もっとも安直な方法は、INTER-Mediatorフォルダに入れて、サーバーにコピーしておくことです。もし、設定が以下のようなものであれば、例えば/usr/lib/phpディレクトリにPusher.phpをコピーしておけば良いでしょう。\n                include_path = \".:/usr/lib/php/pear:/usr/lib/php\"\n            \n            \n                ページファイルへの追加\n                \n                    Pusherのクライアントソフトウエアを、ページファイルで組み込む必要があります。たとえば、以下のように、ヘッダ部で定義ファイル（include_MySQL.php）の読み込みの前に読み込みます。この方法だと、Pusherのサイトから直接取り出すので、ファイルを自分のサーバーにコピーする必要はありません。ソースはこの通りコピペで大丈夫ですが、Pusherのバージョンが変わった時などはそれに合わせてください。\n                &lt;html&gt;\n&lt;head&gt;\n&nbsp; &nbsp; :\n&nbsp; &nbsp;&nbsp;&lt;script src=\"http://js.pusher.com/2.2/pusher.min.js\" type=\"text/javascript\"&gt;&lt;/script&gt;\n&nbsp; &nbsp;&nbsp;&lt;script type=\"text/javascript\" src=\"include_MySQL.php\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n                \n            \n            \n                定義ファイルあるいはparams.phpへの追加\n                \n                    Pusherで定義したAppに関する指定は、定義ファイルのオプション部あるいはparams.phpで指定をします。原則的にはどちらか一方で定義をしてください。両方指定すると、定義ファイルの方が優先されます。定義ファイルでは、pusherをキーにした配列を定義し、さらにPusherのAppで示された3つの値を配列の各要素の値とします。以下は、定義ファイルでの定義例です。\n                IM_Entry(\n    array(\n　　　　　　　　　　　　　　/* コンテキストの定義 */\n　　　　　　　),\n    array(\n        :\n        'pusher' =&gt; array(\n            'app_id' =&gt; '1234',\n            'key' =&gt; '9876543210',\n            'secret' =&gt; '9876543210',\n        ),\n    ),\n    array('db-class' =&gt; 'PDO'),\n    false\n);\n                \n                params.phpファイルに記述するときには、以下のように、$pusherParameters変数に同様な配列として定義をします。\n                $pusherParameters = array(\n 'app_id' =&gt; '1234',\n 'key' =&gt; '9876543210',\n 'secret' =&gt; '9876543210',\n);\n                \n                \n                    上記のいずれかがあると、マルチクライアントのコンテキストの共有化がオンになります。定義ファイルあるいはparams.phpの指定の有無だけで、共有化の利用／不使用が決まります。指定がないと一切何も行いません。指定があるのに、Pusherのサーバーあるいはクライアントソフトウエアが利用できない状態になると、なんらかのエラーが発生します。\n            \n            \n                Ver.4.6での制約\n                \n                    レコードの追加においては、そのコンテキストの検索条件を加味して、検索条件に合わないレコードの追加は行いません。しかしながら、別のクライアントで作成したレコードが当初はコンテキストに合わないものの、フィールドの値を変更してコンテキストの検索条件に合うようになっても、現状ではそのレコードが見えるようにはなりません。\n                さらに、コンテキストのソート条件は現状では加味されておらず、一連の表示リストのサイトに常に追加されます。\n            \n            \n    "
    },
    {
        "id": 25,
        "parent": "/ja/for-developers/",
        "path": "/ja/for-developers/sharing7.html",
        "title": "変更結果の即時更新をマルチクライアントで実現する(Ver.7以降)",
        "breadcrumb": "変更結果の即時更新をマルチクライアントで実現",
        "body": "\n            \n                はじめに\n                \n                    コンテキストの共有化をマルチクライアントで実現する仕組みが稼働します。つまり、同一のページを複数のクライアントで参照しているとき、誰かがデータを変更すると、その結果は他のユーザのページにも反映されるという動作です。この仕組みを「クライアント同期」と呼ぶことにします。従って、1つのフィールドを単一の要素にバインドしている場合でも、マルチユーザつまり複数のブラウザで同一のエンティティをバインドしているという点で共有化されていると言えるわけです。コンテキストの共有化を実現するために、ページファイル上でのターゲット指定や、定義ファイルでのコンテキスト定義以外に何をしなければならないかをこの文書にまとめておきます。\n            \n            \n                機能の概要と実現手法\n                \n                    INTER-Mediatorでは、「コンテキスト」は、データベースに対するデータの出入り口的なイメージのものであり、検索条件などでの意味づけされたデータソースを意味します。クライアント同期の仕組みにより、同一エンティティが複数のページ上のオブジェクトに展開されているとき、1つのエンティティを変更すると、その結果が他のオブジェクトにも反映されます。この動作を実現するためのプログラミングは必要なく、バインドの設定（ターゲット指定の付与）とコンテキスト定義へのsync-controlキーの値の追加だけで可能です。この機能はVer.5まではPusherと言うサービスを利用して実装していましたが、Ver.7ではINTER-Mediator単体で実装しています。背後では、Node.jsによるサーバー（サービスサーバ）を稼働させ、Socket.ioやExpressなどを使って実現しています。\n                \n            \n            \n                サンプルサイト\n                INTER-Mediatorのサンプルサイトにある、「Any kinds of Saples」の「Realtime Multi-Client Update」が、クライアント同期を使ったサンプルです。2つのウインドウで開いたり、別々のクライアントで開いてみて、それぞれで編集作業をして、もう一方に反映されるのを確認できると思います。\n                動作の特徴\n                少し複雑になりますが、クライアント同期の動作をステップで記載したのが下の図です。黒い矢印線は、通常のINTER-Mediatorの処理です。クライアント同期を有効にすると、赤い矢印線や赤い点線の処理が加わります。\n                \n                    \n                \n                クライアント同期では、Webアプリケーションが利用するデータベースに2つのテーブルを定義します。テーブル定義の詳細は、INTER-Mediatorのdist-docsディレクトリにある各データベースごとのサンプルスキーマを参照してください。クライアントやコンテキストの情報を保存するregisteredcontextテーブルと、現在そのクライアントで表示しているレコードの主キー値を集めたregisteredpksテーブルを使います。もちろん、1対多でこれらのテーブルは関連しています。\n                Node.jsベースのService Serverが常駐している点もポイントです。このサーバは、クライアント同期以外に、バリデーションの設定がある場合に、クライアントからサーバに来たデータに対してチェックをかける作業もおこないます。通常、自動的に起動しますが、その辺りのポイントは、「ダウンロードとインストール(Ver.6以降)」の記載も参照してください。\n            \n            \n                定義ファイル作成\n                クライアント同期を使うためには、コンテキスト定義にsync-controlキーを追加します。Create/Update/Deleteのそれぞれのオペレーションがクライアント同期で伝達されるかを記載します。設定できる値は、create update deteleで、複数記載する場合はスペースで区切って記述しましょう。以下は設定例です。これみより、invoiceコンテキストで変更やレコード作成・削除が行われれば、それがsync-controlキーを設置したコンテキストに対して、伝達が行われます。単に同一コンテキストということではなく、そのコンテキストが使うテーブル名のレベルでマッチングを取るようにしていますが、SQLのビューの場合には必ずしもうまくいくわけではありません。そこは若干の制限があります。\n                IM_Entry(\n   [\n       [\n           'name' =&gt; 'invoice',\n           'records' =&gt; 1,\n           'paging' =&gt; true,\n           'key' =&gt; 'id',\n           'sort' =&gt; [['field' =&gt; 'id', 'direction' =&gt; 'asc'],],\n           'repeat-control' =&gt; 'insert delete',\n           'sync-control' =&gt; 'create update delete', // これがあれば同期を設定\n           'calculation' =&gt; [[\n               'field' =&gt; 'total_calc',\n               'expression' =&gt; 'format(sum(item@amount_calc) * (1 + _@taxRate ))',\n           ],],\n       ],…\nあるコンテキストに対して、現在ページ上に表示されている内容は、source、table、view、nameキーの値で識別されます。この順序で設定がある最初のものを利用します。ビュー等を利用した表示で、viewキーの値がある場合、別のコンテキストではテーブル名を利用して更新しているかもしれません。その場合、表示する側で、tableキーを指定しますが、他の動作にも影響があるので、sourceキーを揃えるということをする方法が考えられます。更新系の処理は、tableキーの値を利用して、更新するエンティティの識別を行います。\n            \n            \n                同期処理への割り込み\n                クライアント同期により、伝達してきたクライアント側では、以下の6つの関数を定義できます。メソッド名を見てわかるように、Create/Update/Deleteのそれぞれのオペレーションの前後つまりBefore/Afterに呼び出されます。クライアントでは、Beforeが呼び出され、更新処理を行い、Afterが呼び出されるようになります。Beforeが付くメソッドでは、引き続く処理を実行するためにはtrueを返します。逆にfalseを返すと、そこでクライアント同期の処理は停止します。引数dは、同期情報に関するオブジェクト（例：{entity: \"item\", field: [\"product_unitprice\"], 'justnotify: false, pkvalue: [\"3\"], value: [\"30\"]}）が設定されて呼び出されます。\n                INTERMediatorOnPage.syncBeforeUpdate = (d) =&gt; {}\nINTERMediatorOnPage.syncAfterUpdate = (d) =&gt; {}\nINTERMediatorOnPage.syncBeforeCreate = (d) =&gt; {}\nINTERMediatorOnPage.syncAfterCreate = (d) =&gt; {}\nINTERMediatorOnPage.syncBeforeDelete = (d) =&gt; {}\nINTERMediatorOnPage.syncAfterDelete = (d) =&gt; {}\n            \n            \n                params.phpファイルへの設定方法\n                クライアント同期は既定値で稼働するようになっています。その場合、sync-controlの定義がどのコンテキストにも存在しないのであれば、クライアント同期のための接続などは一切行いません。クライアント同期は、INTER-MediatorのサーバであるPHPとサービスサーバ、クライアントとサービスサーバの2つの通信経路が確立されていなければなりません。前者は、$serviceServerConnectでURL、$serviceServerPort変数でポート番号が決まります。後者は、$serviceServerProtocol、$serviceServerHost、$serviceServerPortの3つの変数で決まります。TLSを使わないのであれば、通常は既定値で動作すると思われますが、サーバのセットアップに応じて、設定を見直してください。また、クライアントからは、11478などのポートで通信をしますので、レンタルサーバなどではファイアウォールの設定を見直す必要があるのが通常です。\n                \n\n変数既定値動作\n$notUseServiceServerfalsetrueの場合Service Serverを起動しない、falseの場合起動する。逆っぽいので注意\n$activateClientServicetruetrueの場合クライアント側の同期機能を使用する、falseの場合使用しない\n$serviceServerProtocolwsService Serverを受け付けるプロトコル。wsあるいはwss\n$serviceServerHost\"\"Service Serverのホスト名で、\"\"にすると公開IPアドレスになる。クライアントから接続する先のホスト名を指定する\n$serviceServerPort11478Serviceサーバが使用するポート\n$serviceServerKey\"\"証明書のキーファイルへの絶対パス\n$serviceServerCert\"\"サーバ証明書への絶対パス\n$serviceServerCA\"\"中間証明書への絶対パス\n$serviceServerConnecthttp://localhostPHPのサーバからService Serverに接続するときのプロトコルとホスト名\n$bootWithInstalledNodefalseService Serverの起動にサーバにあるnodeを使う\n$preventSSAutoBootfalsetrueの場合Service Serverの自動起動をやらない、falseの場合自動起動する\n$foreverLog/etc以下にランダムService Serverのコンソール出力を収めるログファイル\n\nTLSベースのhttps://サーバで運用する\nWebサーバをTLSベースで運用しているならば、サービスサーバをTLSベースで稼働させる必要があります。そうしないと、httpsの中からhttpへのアクセスに相当すると判断され、ブラウザはサービスサーバへの接続を拒否します。そのためには、$serviceServerKey、$serviceServerCertそして$serviceServerCAにそれぞれ.pemファイルへの絶対パスを記述します。Let's Encryptでは、ファイルが2つですが、$serviceServerKeyにprivkey.pem、$serviceServerCertと$serviceServerCAにfullchain.pemを指定すれば良いようです。なお、その時、本来のキーファイルの位置は/etc/ca-certificates以下にあり、rootしか参照できないため、Webサーバのプロセスのユーザ（Ubuntuならwww-data、CentOSならapache2）はファイルを直接参照できません。仕方ないので、該当ファイルをどこかのディレクトリにコピーして（もちろん、キーファイルなのでWeb公開されていないなど安全な場所である必要があります）、そのファイルへのパスを指定します。$serviceServerProtocolはwssを指定します。$serviceServerHostにはクライアントから見えていて証明書に記述されているホスト名を指定しなければなりません。さらに、$serviceServerConnectは、「https://証明書のホスト名」にします。PHPのサーバと同じサーバでサービスサーバを稼働させていても、wws://でサービスサーバを運用する場合、ws://のポートは開かないですし、証明書の検証もあるので、同一ホストからでもホスト名を利用したアクセスにしなければなりません。\n            \n\n                実際の動作\n                \n                パターンA：リスト形式のトップレベルコンテキスト\n                \n                \n                \n                コンテキスト定義での設定動作\n                \n                \n                更新：update\n                \n                \n                更新：update-notify\n                \n                \n                挿入：create\n                \n                \n                挿入：create-notify\n                \n                \n                削除：delete\n                \n                \n                パターンB：カード形式のトップレベルコンテキスト\n                \n                \n                \n                コンテキスト定義での設定動作\n                \n                \n                更新：update\n                \n                \n                更新：update-notify\n                \n                \n                挿入：create\n                \n                \n                挿入：create-notify\n                \n                \n                削除：delete\n                \n                \n                パターンC：関連コンテキスト\n                \n                \n                \n                コンテキスト定義での設定動作\n                \n                \n                更新：update\n                \n                \n                更新：update-notify\n                \n                \n                挿入：create\n                \n                \n                挿入：create-notify\n                \n                \n                削除：delete\n                \n                \n            -->\n            "
    },
    {
        "id": 26,
        "parent": "/ja/for-developers/",
        "path": "/ja/for-developers/format.html",
        "title": "HTMLの属性に記述する書式を適用する機能",
        "breadcrumb": "HTMLの属性に記述する書式を適用する機能",
        "body": "\n            \n                はじめに\n                数値をカンマ区切りにしたり通貨記号をつけたり、日付を特定の書式で記述するような機能は、アプリケーション作成には必須です。Ver.5.6までは主としてDataConverterクラスによりサーバーサイドで処理をしていましたが、変更や計算結果更新に対する書式設定が適用されない場合がありました。この書式設定の仕組みをクライアントサイドで指定をするようにして、書式の適用を確実に行います。書式の適用は、HTMLの属性に記述を行います。データベースはもちろん、コンテキストにキャッシュされる内容までは「生データ」として、そこからHTML要素に書き込まれる場合に書式を適用し、逆に編集時には書式を解除して生データとして扱えるようにするのが動作の基本となります。\n            \n            \n                設定例\n                \n                \n                    数値、通貨についての設定例\n                    \n                        \n                            設定例\n                            値が「1923」の場合\n                            値が「1923.8765」の場合\n                            値が「-1923.8765」の場合\n                        \n                        \n                            data-im-format=\"number(0)\"\n                            1923\n                            1924\n                            -1924\n                        \n                        \n                            data-im-format=\"number(2)\"\n                                data-im-format-options=\"useseparator\"\n                            1,923.00\n                            1,923.88\n                            -1,923.88\n                        \n                        \n                            data-im-format=\"number(2)\"\n                                data-im-format-negative-style=\"triangle\"\n                            1923.00\n                            1923.88\n                            ▲1923.88\n                        \n                        \n                            data-im-format=\"currency(2)\"\n                                data-im-format-options=\"useseparator\"\n                            ¥1,923.00\n                            ¥1,923.88\n                            ¥-1,923.88\n                        \n                    \n                \n                \n                    論理値についての設定例\n                    \n                        \n                            設定例\n                            値が「0」の場合\n                            値が「0」でない場合\n                        \n                        \n                            data-im-format=\"boolean()\"\n                            false\n                            true\n                        \n                        \n                            data-im-format=\"boolean(T,F)\"\n                            F\n                            T\n                        \n                    \n                \n                \n                    日付時刻についての設定例\n                    \n                        \n                            設定例\n                            値が「2017-07-12 09:05:00」の場合\n                        \n                        \n                            data-im-format=\"datetime(middle)\"\n                            2017/07/12 09:05:00\n                        \n                        \n                            data-im-format=\"datetime(%m月%d日の%h時%i分)\"\n                            7月12日の9時5分\n                        \n                        \n                            data-im-format=\"datetime(%g%M月%D日)\"\n                            平成29年07月12日\n                        \n                    \n                \n            \n            \n                data-im-format\n                ターゲット指定によりコンテキストの値を要素に設定する時、その要素にdata-im-format属性があれば、書式化されるようになります。この設定は排他的なので、どれか1つが設定されていることが期待されます。\n                \n                    data-im-formatに設定可能な値\n                    \n                        \n                            分類\n                            属性値\n                            書式化の動作\n                        \n                        \n                            数値\n                            number(桁数)\n                            数値に関する書式化を行う。桁数は少数以下の桁数で、省略すると0とみなす\n                        \n                        \n                            currency(桁数)\n                            通過記号を伴う書式化を行う。桁数は少数以下の桁数で、省略すると0とみなす\n                        \n                        \n                            boolean(true表現,false表現)\n                            論理値を表現する。引数にはtrueとfalseの時の表現をそのまま記述する。引数を省略すると、true/falseになる\n                        \n                        \n                            percent(桁数)\n                            パーセント表現による書式化を行う。桁数は少数以下の桁数で、省略すると0とみなす\n                        \n                        \n                            日付\n                                時刻\n                            date(書式)\n                            引数がlong/middle/shortの場合は日付のみを書式化する。それ以外の引数は引数のパターンに従って表示される。日付がない場合は空文字列を表示する\n                        \n                        \n                            time(書式)\n                            引数がlong/middle/shortの場合は時刻のみを書式化する。それ以外の引数は引数のパターンに従って表示される。時刻がない場合には「00:00:00」とみなす。書式は別表を参照\n                        \n                        \n                            datetime(書式)\n                            引数がlong/middle/shortの場合は日付時刻を書式化する。それ以外の引数は引数のパターンに従って表示される。日付や時刻がない場合には、date、timeの動作通り。書式は別表を参照\n                        \n                    \n                \n                日付や時刻については、long/middle/shortの場合はロケールに応じた形式で表示します。それ以外のパターン（%とアルファベットの置き換え文字列）については、ロケールに応じるものとそうでないものがあります。引数にパターンを指定した場合は、date/time/datetimeのいずれの指定でも結果は同じになります。\n            \n            \n                数値に対するオプション設定のための属性\n                数値に関連したdata-im-format属性を指定した場合、書式化の動作を以下のいくつかの属性で指定することができます。\n                \n                    書式設定に関するオプション設定\n                    \n                        \n                            属性名\n                            属性値\n                            書式化の動作\n                        \n                        \n                            data-im-format-options\n                            useseparator\n                            数値の整数部で3桁ごとにカンマを入れる\n                        \n                        \n                            blankifzero\n                            数値が0の時には何も表示しない\n                        \n                        \n                            thousands\n                            千単位の整数値に四捨五入する。修正は未対応で、表示のみ\n                        \n                        \n                            millions\n                            百万単位の整数値に四捨五入する。修正は未対応で、表示のみ\n                        \n                        \n                            billions\n                            十億単位の整数値に四捨五入する。修正は未対応で、表示のみ\n                        \n                        \n                            data-im-format-negative-color\n                            (CSSのcolorプロパティに設定可能な値)\n                            負の数場合に文字に設定する色\n                        \n                        \n                            data-im-format-negative-style\n                            leading-minus\n                            負の数の記号（通常はマイナス）を数値の前に指定\n                        \n                        \n                            trailingminus\n                            負の数の記号（通常はマイナス）を数値の後に指定\n                        \n                        \n                            parenthesis\n                            負の数の場合、数値をカッコで囲む\n                        \n                        \n                            angle\n                            負の数の場合、数値を &lt; &gt;で囲む\n                        \n                        \n                            credit\n                            負の数の場合、前にCRを付加する\n                        \n                        \n                            triangle\n                            負の数の場合、前に▲を付加する\n                        \n                        \n                            data-im-format-numeral-type\n                            half-width\n                            数値を一般的なアスキーコードの数字で記述\n                        \n                        \n                            full-width\n                            数値を全角の数字で記述する\n                        \n                        \n                            kanji-numeral-modern\n                            数値を、数字を示す漢字（一二三…）で記述\n                        \n                        \n                            kanji-numeral\n                            数値を、数字を示す漢字（壱弐参…）で記述\n                        \n                        \n                            data-im-format-kanji-separator\n                            every-4th-place\n                            4桁ごと日本語表記する（例：1億2345万3456）\n                        \n                        \n                            full-notation\n                            全ての桁において日本語表記する（例：1億2千3百4十5万3千4百5十6）\n                        \n                    \n                \n            \n            \n                日付や時刻に対する引数設定\n                日付や時刻に関連したdata-im-format属性を指定する場合、引数に以下の文字列を指定できます。「単独使用」の場合には、引数にはその文字列のみを記述します。一方、「組み合わせ」の文字列については、組み合わせて指定をします。一方、更新処理に対応した書式設定は表に示す通り一部に限られます。なお、書式設定に変わらず、ISO8601形式の文字列（2017-10-12 10:04など）を入力することでデータベースへの更新が可能です。\n                \n                    日付に対する引数設定\n                    \n                        \n                            指定\n                            指定文字列\n                            意味\n                            表示例\n                        \n                        \n                            単独使用\n                            short\n                            短い形式\n                            2017/07/23 14:39\n                        \n                        \n                            middle\n                            よく利用される形式\n                            2017/07/23(日) 14:39:06\n                        \n                        \n                            long\n                            長い形式\n                            2017年07月23日 日曜日 14時39分06秒 JST\n                        \n                        \n                            組み合わせ\n                            %Y\n                            西暦4桁*1\n                            2017\n                        \n                        \n                            %y\n                            西暦2桁*1\n                            17\n                        \n                        \n                            %g\n                            ロカールによる年数\n                            平成29年\n                        \n                        \n                            %G\n                            ロカールによる年数\n                            平成二十九年\n                        \n                        \n                            %M\n                            月2桁*1\n                            07\n                        \n                        \n                            %m\n                            月数値*1\n                            7\n                        \n                        \n                            %t\n                            英語短縮月名*1\n                            Jul\n                        \n                        \n                            %T\n                            英語月名*1\n                            July\n                        \n                        \n                            %b\n                            ロカールによる短縮月名\n                            ７月\n                        \n                        \n                            %B\n                            ロカールによる月名\n                            文月\n                        \n                        \n                            %D\n                            日2桁*1\n                            12\n                        \n                        \n                            %d\n                            日数値*1\n                            12\n                        \n                        \n                            %a\n                            英語短縮曜日名\n                            Mon\n                        \n                        \n                            %A\n                            英語曜日名\n                            Monday\n                        \n                        \n                            %w\n                            ロカールによる短縮曜日名\n                            月\n                        \n                        \n                            %W\n                            ロカールによる曜日名\n                            月曜日\n                        \n                        \n                            %H\n                            時2桁*1\n                            09\n                        \n                        \n                            %h\n                            時数値*1\n                            9\n                        \n                        \n                            %K\n                            12時間制1〜12での時2桁\n                            09\n                        \n                        \n                            %k\n                            12時間制1〜12での時数値\n                            9\n                        \n                        \n                            %J\n                            12時間制0〜11での時2桁\n                            09\n                        \n                        \n                            %j\n                            12時間制0〜11での時数値\n                            9\n                        \n                        \n                            %I\n                            分2桁*1\n                            05\n                        \n                        \n                            %i\n                            分数値*1\n                            5\n                        \n                        \n                            %S\n                            秒2桁*1\n                            00\n                        \n                        \n                            %s\n                            秒数値*1\n                            0\n                        \n                        \n                            %P\n                            AM/PM\n                            AM\n                        \n                        \n                            %p\n                            am/pm\n                            am\n                        \n                        \n                            %N\n                            ロカールによる午前午後\n                            午前\n                        \n                        %Zタイムゾーン省略名JST\n%zタイムゾーンオフセット+0900\n-->\n                        \n                            %%\n                            パーセント\n                             %\n                        \n                        \n                            上記以外\n                            そのまま表示\n                            -\n                        \n                    \n*1：変更処理に対応した書式設定文字列。テキストフィールドに対して、これらの文字を使って書式設定したものが表示されている時、その文字列を変更することで、データベースへの更新が正しくできるもの。\n                \n            \n            \n    "
    },
    {
        "id": 27,
        "parent": "/ja/for-programmers/",
        "path": "/ja/for-programmers/api.html",
        "title": "JavaScriptのインタフェース",
        "breadcrumb": "JavaScriptのインタフェース",
        "body": "\n      \n        はじめに\n        クライアント側ではもちろん、JavaScriptのプログラムを記述できますが、一般的なJavaScriptの関数などを使うことに加えて、INTER-Mediatorが稼働していれば利用できるメソッドについて、ここで解説をします。\n      \n      \n        ページ合成処理\n        INTERMediator.construct(targetContext)\n        \n          解説：INTERMediator.constructMainと同じ\n        \n        INTERMediator.constructMain(targetContext)\n        \n          解説：ページ合成を行う。asyncで定義されている。\n          引数：targetContext：省略あるいはtrueで、ページファイルのすべての要素に対して合成を行う。引数にコンテキストのオブジェクト（IMLibContext）を指定すれば、そのオブジェクトに対応したエンクロージャー内部のみを合成する。\n          返り値：なし\n        \n        INTERMediatorOnPage.doBeforeConstruct = function() { }\n        ページの合成処理が実行される関数を定義します。引数のない関数を代入します。INTERMediator.constructMain(true)でページ合成を行いますが、その処理の最初に関数が実行されます。例えば、URLのパラメータを取り出して、検索条件として設定するなどの処理を組み込めます。\n        INTERMediatorOnPage.doAfterConstruct = function() { }\n        ページの合成処理が終わったときに実行される関数を定義します。引数のない関数を代入します。INTERMediator.constructMain(true)でページ合成を行いますが、非同期に処理を進めるため、このステートメントの次に書かれた命令は、通常は合成途中に実行されるなど、少なくともページを作り終える前になってしまいます。ページができていないと取得できないような情報もあるので、このようなコールバックの仕組みを用意してあります。\n        INTERMediatorOnPage.doBeforePartialConstruct = function(context) { }\n        INTERMediator.constructMain(context)のように、コンテキストを与えてページの合成処理を実施して部分的に合成する場合に、ページ合成処理よりも前に実行される関数を定義します。引数にはconstructMainの引数に指定したコンテキストへの参照が設定されます。\n        INTERMediatorOnPage.doAfterPartialConstruct = function(context) { }\n        INTERMediator.constructMain(context)のように、コンテキストを与えてページの合成処理を実施して部分的に合成する場合に、ページ合成処理よりも後に実行される関数を定義します。引数にはconstructMainの引数に指定したコンテキストへの参照が設定されます。\n        INTERMediatorOnPage.isAutoConstruct\n        このプロパティをfalseにすると、ページの合成を行わなくなります。doBeforeConstructに指定した関数の中などで、条件に応じてページ合成をしたくない場合は、このプロパティにfalseを代入してください。初期値はtrueです。\n        INTERMediatorOnPage.isFinishToConstruct\n        ページ生成中（つまり、constractMainメソッド実行中）であれば、trueになる。\n        INTERMediator.partialConstructing\n        ページ構築中に参照することで、現在の構築がページ全体なのか、ページの一部分なのかが判定できる。\n      \n      \n        検索条件やソート条件の追加\n        INTERMediator.addCondition(contextName, {field:xxx,operator:xxx,value:xxxx})\n        コンテキストに従ってデータベースのクエリを行うとき、ここで指定した検索条件が、他の条件に対してAND条件で追加される。引数contextNameにはコンテキスト名を指定する。第2引数は条件を示すオブジェクトを指定する。このオブジェクトではfield、operator、valueのプロパティを指定し、それぞれフィールド名、演算子、値を指定する。複数の条件を追加する場合には、このメソッドを繰り返し呼べば良い。additionalConditionプロパティはセッター／ゲッターで実装しているため、内部のオブジェクトへの追加はこのAPIを使うようにする。\n        INTERMediator.clearCondition(contextName)\n        検索条件に追加される設定を、引数に指定したコンテキスト名のものついて初期化して、指定なしにする。\n        INTERMediator.additionalCondition = {};\n        すべての検索条件に追加される設定を消す。\n        INTERMediator.addSortKey(contextName, {field:xxx,direction:xxxx})\n        コンテキストに従ってデータベースのクエリを行うとき、ここで指定したソート条件が設定される。コンテキストのソート条件より高い優先順になっている。引数contextNameにはコンテキスト名を指定する。第2引数はそーと条件を示すオブジェクトを指定する。このオブジェクトではfield、directionのプロパティを指定し、それぞれフィールド名、昇順か降順かをASCないしはDESCを指定する。複数の条件を追加する場合には、このメソッドを繰り返し呼べばよく、先に指定した方が優先順位が高い。\n        INTERMediator.clearSortKey(contextName)\n        ソート条件に追加される設定を、引数に指定したコンテキスト名のものついて初期化して、指定なしにする。\n        INTERMediator.additionalSortKey = {};\n        すべてのソート条件に追加される設定を消す。\n        INTERMediator.additionalFieldValueOnNewRecord\n        新規レコードを作った時のフィールドの既定値を、JavaScript上で追加定義する。INTERMediator.additionalFieldValueOnNewRecord[\"コンテキスト名\"] = [{field: フィールド名, value: 値}, ...] の形式で利用する。\n        INTERMediator.additionalFieldValueOnUpdate\n        レコード更新時に変更するフィールドとその値を、JavaScript上で追加定義する。INTERMediator.additionalFieldValueOnUpdate[\"コンテキスト名\"] = [{field: フィールド名, value: 値}, ...] の形式で利用する。\n        INTERMediator.additionalFieldValueOnDelete\n        レコード削除時の検索条件を、JavaScript上で追加定義する。INTERMediator.additionalFieldValueOnDelete[\"コンテキスト名\"] = [{field: フィールド名, value: 値}, ...] の形式で利用する。\n        INTERMediator_DBAdapter.eliminateDuplicatedConditions = logical_value (default is false)\n        trueの場合検索条件で同一の検索式を自動的に取り除く。既定値はfalse。\n      \n      \n        ページ合成処理に割り込む処理の記述\n        INTERMediatorOnPage.additionalExpandingEnclosureFinish = {コンテキスト名: function (target) { }},\n        INTERMediatorOnPage.expandingEnclosureFinish = function (name, target) { } \n        INTERMediatorOnPage.postEnclosure_《コンテキスト名》 (target) \n        INTERMediatorOnPage.《コンテキストで指定した名前》 (target) \n        \n          引数：name：展開が終わった箇所で利用した定義ファイルのコンテキストのname属性の値\n          引数：target：展開が終わったエンクロージャのノード\n          返り値：なし\n        \n         エンクロージャの展開が終わる度に呼び出されます。4つメソッドがあり、前述の順序で呼び出されますが、3番目が存在すれば4番目は呼び出されません。2つ目は全てのコンテキストで呼び出され、その他のものはコンテキストごとに呼び出すかどうかを制御できます。最初のものは呼び出すプログラム自体をプログラムで指定できます。そこまで複雑ではない場合には3ないしは4番目の手法が良いでしょう。2番目の手法は、全てのエンクロージャの展開後に実行したい処理を記述します。4番目の《コンテキストで指定した名前》は、定義ファイルのコンテキストの指定で、'post-enclosure'というキーに対応する文字列で、メソッド名を指定します。1〜3番目はメソッドの定義をすればそれで呼び出されますが、3番目の手法がいちばん手軽だと思われます。\n        INTERMediatorOnPage.additionalExpandingRecordFinish: {コンテキスト名: function (repeaters) { }},\n        INTERMediatorOnPage.expandingRecordFinish(name, repeaters)\n        INTERMediatorOnPage.postRepeater_《コンテキスト名》(repeaters)\n        INTERMediatorOnPage.《コンテキストで指定した名前》(repeaters)\n        \n          引数：name：展開が終わった箇所で利用した定義ファイルのコンテキストのname属性の値\n          引数：repeaters：1レコード分の展開をしたリピーターの配列\n          返り値：なし\n        \n         リピータの展開時に、1レコード分の処理が終わった度に呼び出されます。4つメソッドがあり、前述の順序で呼び出されますが、3番目が存在すれば4番目は呼び出されません。2つ目は全てのコンテキストで呼び出され、その他のものはコンテキストごとに呼び出すかどうかを制御できます。最初のものは呼び出すプログラム自体をプログラムで指定できます。そこまで複雑ではない場合には3ないしは4番目の手法が良いでしょう。2番目の手法は、全てのリピーターの展開後に実行したい処理を記述します。4番目の《コンテキストで指定した名前》は、定義ファイルのコンテキストの指定で、'post-repeater'というキーに対応する文字列で、メソッド名を指定します。そのメソッドを以下のように定義して、プログラムを記述します。1〜3番目はメソッドの定義をすればそれで呼び出されますが、3番目の手法がいちばん手軽だと思われます。\n        INTERMediatorOnPage.notShowHeaderFooterOnNoResult\n        trueの場合、data-im-control属性の値がfooter、headerのリピーターについて、検索結果にレコードが存在しない場合に表示しなくする。既定値はfalse。\n        INTERMediator.noRecordClassName: '_im_for_noresult_',\n        INTERMediatorLib.ignoreEnclosureRepeaterClassName: '_im_ignore_enc_rep',\n        INTERMediatorLib.ignoreEnclosureRepeaterControlName: 'ignore_enc_rep',\n        INTERMediatorLib.roleAsRepeaterClassName: '_im_repeater',\n        INTERMediatorLib.roleAsEnclosureClassName: '_im_enclosure',\n        INTERMediatorLib.roleAsRepeaterDataControlName: 'repeater',\n        INTERMediatorLib.roleAsEnclosureDataControlName: 'enclosure',\n        INTERMediatorLib.roleAsSeparatorDataControlName: 'separator',\n        INTERMediatorLib.roleAsHeaderDataControlName: 'header',\n        INTERMediatorLib.roleAsFooterDataControlName: 'footer',\n        INTERMediatorLib.roleAsNoResultDataControlName: 'noresult',\n        リピーターやエンクロージャーに指定するクラス名やdata-im-control属性に指定する文字列を定義したプロパティ。通常は変更する必要はないが、どうしても名前を変えたい場合にはプロパティへの書き込みによって変更は可能であるが、この仕組みは厳密にはデバッグされていないので、使用するときは注意が必要である。\n      \n      \n        アプリケーション動作のための様々なプロパティ\n        INTERMediatorOnPage.dbCache\n        cacheキーの値がtrueのコンテキストによって集積されたキャッシュデータがこのオブジェクトに設定される。\n        INTERMediatorOnPage.creditIncluding: null,\n        INTER-Mediatorのクレジットサイン（ページ下部に表示されるもの）を挿入するノードのid値。nullだとbodyタグ直下の最後に追加\n        INTERMediatorOnPage.getEditorPath\n        定義ファイルエディタやページファイルエディタが使える場合、エディタへのパス。\n        INTERMediatorOnPage.getEntryPath\n        定義ファイルへのパス。\n        INTERMediatorOnPage.getDataSources\n        定義ファイルのIM_Entry関数の第1引数に指定したデータソースを記述したオブジェクト。\n        INTERMediatorOnPage.getOptionsAliases: null,\n        定義ファイルのIM_Entry関数の第2引数に指定したaliasesキーの値。\n        INTERMediatorOnPage.getOptionsTransaction: null,\n        定義ファイルのIM_Entry関数の第2引数に指定したtransactionキーの値。\n        INTERMediatorOnPage.dbClassName: null,\n        定義ファイルのIM_Entry関数の第3引数に指定したデータベースクラス名。例えば「PDO」。\n        INTERMediatorOnPage.serviceServerStatus\n        サービスサーバーが起動しているかどうか。\n        INTERMediatorOnPage.appLocale\n        サーバーで設定あるいは識別したロケールのコード。例えば「ja_JP」\n        INTERMediatorOnPage.appCurrency\n        サーバーで設定あるいは識別した通貨の国コード。例えば「JP」\n        INTERMediatorLocale\n        このオブジェクトに、サーバーで設定あるいは識別したロケールに基づく小数点の記号などの情報が設定されている。\n        INTERMediatorOnPage.metadata\n        composer.jsonから得られたINTER-Mediatorに関する情報で、キーはversionとreleasedate\n        INTERMediatorOnPage.showProgress()\n        処理中を示すギアが回るアニメーションを表示する。\n        INTERMediatorOnPage.hideProgress()\n        処理中を示すギアが回るアニメーションを非表示にする。\n        INTERMediatorOnPage.isShowProgress\n        trueの場合、処理中を示すギアが回るアニメーションを表示する。既定値はtrue。\n        INTERMediatorOnPage.buttonClassCopy\n        INTERMediatorOnPage.buttonClassDelete\n        INTERMediatorOnPage.buttonClassInsert\n        INTERMediatorOnPage.buttonClassMaster\n        INTERMediatorOnPage.buttonClassBackNavi\n        これらのプロパティに設定した文字列が、「複製」ボタンや「削除」ボタン等にclass属性に追加される。例えば、Bootstrapを使っている場合には、doBeforeConstructプロパティの関数内で、これらのプロパティに\"btn btn-info\"を代入するなどができる。\n\n      \n      \n        ブラウザのバージョンや種類の判定\n        INTERMediator.isTablet\n        クライアントのUserAgentから判定したタブレットかどうかのチェック結果。\n        INTERMediator.isMobile\n        クライアントのUserAgentから判定したモバイルデバイスかどうかのチェック結果。\n        INTERMediator.isIE\n        クライアントのUserAgentから判定したInternet Explorerかどうかのチェック結果。「MSIE/」が含まれているかをチェック。\n        INTERMediator.isTrident\n        クライアントのUserAgentから判定したTridentエンジンかどうかのチェック結果。「Trident/」が含まれているかをチェック。\n        INTERMediator.isEdge\n        クライアントのUserAgentから判定したEdgeエンジンかどうかのチェック結果。「Edge/」が含まれているかをチェック。\n        INTERMediatorOnPage.browserCompatibility\n        接続してきたブラウザの種類やバージョンから、アプリケーションが利用可能かどうかを判定するための情報をオブジェクトで指定する。詳細は、INTER-MediatorによるWebアプリケーションの概要にある「ブラウザのバージョンを調べる仕組み」を参照。\n        INTERMediatorOnPage.nonSupportMessageId\n        INTERMediatorOnPage.browserCompatibilityの仕組みを用いれば、サポートブラウザである場合にはエラーメッセージを非表示にすることができるが、その時のエラーメッセージが記載されたHTML要素のid属性値の文字列を指定する。既定値は「nonsupportmessage」\n      \n      \n        特定のターゲット指定を持つノードの検索\n        INTERMediatorOnPage.getNodeIdsHavingTargetFromNode(fromNode, imDefinition)\n        \n          引数：fromNode：基準となるノードで、このノードより下位のノードを検索する。ノードの配列でもOK\n          引数：imDefinition：ターゲット指定。例えば、「&lt;input type=\"text\" class=\"IM[item@unitprice]\" /&gt;」については、引数に \"item@unitprice\" を指定する \n          返り値：ノードのid属性を示す文字列の配列。ノードが発見された場合でid属性がない場合は、そのノードへの参照\n        \n        INTERMediatorOnPage.getNodeIdsHavingTargetFromRepeater(fromNode, imDefinition)\n        \n          引数：fromNode：基準となるノードで、このノードより上位のノードを検索し最初に見つかったリピータよりも下位のノードを検索する\n          引数：imDefinition：ターゲット指定。例えば、「&lt;input type=\"text\" class=\"IM[item@unitprice]\" /&gt;」については、引数に \"item@unitprice\" を指定する \n          返り値：ノードのid属性を示す文字列の配列。ノードが発見された場合でid属性がない場合は、そのノードへの参照\n        \n        INTERMediatorOnPage.getNodeIdsHavingTargetFromEnclosure(fromNode, imDefinition)\n        \n          引数：fromNode：基準となるノードで、このノードより上位のノードを検索し最初に見つかったエンクロージャよりも下位のノードを検索する\n          引数：imDefinition：ターゲット指定。例えば、「&lt;input type=\"text\" class=\"IM[item@unitprice]\" /&gt;」については、引数に \"item@unitprice\" を指定する \n          返り値：ノードのid属性を示す文字列の配列。ノードが発見された場合でid属性がない場合は、そのノードへの参照\n        \n      \n      \n        URLからパラメータを取り出す\n        INTERMediatorOnPage.getURLParametersAsArray()\n        URLの中のパラメータを取り出し、パラメータ名をキーとしたオブジェクトを返す。たとえば、「http://domain.name/page.html?a=1&amp;b=2」というページなら、返り値は {a:1, b:2}となる。\n      \n      \n      安全に別のページに移動する\n      INTERMediator.moveAnotherURL(url[, task])\n     location.hrefに文字列を代入することで別のページに移動できますが、フィールドの更新の途中かもしれません。このメソッドを利用すれば、更新処理を全て終えるのを待って引数urlで指定する別のページに移動できます。また、クライアント間同期処理を行っている場合、別ページに移動する前にページに表示している内容に関する情報を削除したいのですが、このメソッドで移動する前に削除を行います。taskはページ移動前に行う処理をクロージャで記述できますが、省略可能です。\n      \n      \n        Post Onlyモードでのメソッド\n        INTERMediatorOnPage.processingBeforePostOnlyContext = function(targetNode) {}\n        バリデーションが完了し、データベースへの書き込み前に呼び出される。falseを返すとデータベースの書き込み処理はキャンセルされる。引数targetにはPost Onlyモードのエンクロージャーへの参照が設定される。\n        INTERMediatorOnPage.processingAfterPostOnlyContext = function(targetNode, idValue) {}\n        新規レコードを作成した直後に呼び出される。引数targetにはPost Onlyモードのエンクロージャーへの参照が設定される。引数idValueは新たに作成されたレコードの主キー値が設定される。設定されていない場合は、レコード作成ができなかったことを示す。\n        INTERMediator.waitSecondsAfterPostMessage\n        ポストオンリーモードで、送信後の処理を何秒後に開始するかを秒数で指定。既定値は4秒後。\n      \n      \n        数値の書式設定\n        INTERMediatorLib.toNumber( str );\n        引数の文字列を数値に変換する。なお、JavaScript標準のparseInt、parseFloatを使う方が良いと思われる。\n        IMLibFormat.numberFormat( str, digit );\n        引数strの文字列を数値に変換し、カンマ区切りで表示する。小数点以下の桁数をdigitで指定する。\n      \n      \n        日付時刻のデータから文字列を生成\n        INTERMediatorLib.dateTimeStringISO( dt );\n        引数のDateクラスの値を、ISO8601形式（2015-06-21 00:00:00）に変換する。引数を省略すると、現在の日付を得る。日時はブラウザのローカル時刻。\n        INTERMediatorLib.dateTimeStringFileMaker( dt );\n        引数のDateクラスの値を、FileMaker Serverが受け付ける形式（06/21/2015 00:00:00）に変換する。引数を省略すると、現在の日付を得る。日時はブラウザのローカル時刻。\n        INTERMediatorLib.dateStringISO( dt );\n        引数のDateクラスの値を、ISO8601形式（2015-06-21）に変換する。引数を省略すると、現在の日付を得る。日付はブラウザのローカル時刻。\n        INTERMediatorLib.dateStringFileMaker( dt );\n        引数のDateクラスの値を、FileMaker Serverが受け付ける形式（06/21/2015）に変換する。引数を省略すると、現在の日付を得る。日付はブラウザのローカル時刻。\n        INTERMediatorLib.timeString( dt );\n        引数のDateクラスの値を、時刻の形式（12:34:56）に変換する。引数を省略すると、現在の時刻を得る。時刻はブラウザのローカル時刻。\n      \n      \n        要素の値を更新する\n        IMLibUI.valueChange(idValue)\n        引数にINTER-Mediatorによって展開されたノードのid属性値を指定すると、現在の値をもってデータベース側に更新を行う。INTER-Mediatorによる自動更新をしない場合に利用するかもしれない。\n        \n          注記：バージョン4.5でINTERMediator.valueChange(idValue)からIMLibUI.valueChange(idValue)に変更されました。\n        \n        INTERMediatorOnPage.doBeforeValueChange = function(idValue)\n        INTERMediatorOnPageオブジェクトにdoBeforeValueChangeメソッドを実装することで、ユーザーが値を変更しバリデーションが通った直後で、データベース等への書き込みが行われる前にこのメソッドが実行される。あらゆる要素の変更時にこのメソッドを通過するようになる。引数は変更のあったUI要素のid属性が得られるので、これを手がかりにして、処理をしたい要素を判定できる。返り値は不要で無視される。\n        INTERMediatorOnPage.doAfterValueChange = function(idValue)\n        NTERMediatorOnPageオブジェクトにdoAfterValueChangeメソッドを実装することで、ユーザーが値を変更しバリデーションが通り、データベース等への書き込みが成功した後に、このメソッドが実行される。あらゆる要素の変更時にこのメソッドを通過するようになる。引数は変更のあったUI要素のid属性が得られるので、これを手がかりにして、処理をしたい要素を判定できる。返り値は不要で無視される。\n        IMLibUI.revertOnValidationError\n        このプロパティがtrueだと、バリデーションエラーがあった場合、フィールドの値を元に戻す。falseだと何もしない。既定値はtrue。\n      \n      \n        INTERMediatorクラスのプロパティ\n        INTERMediator.debugMode = true | false\n        デバッグモード（展開の過程をページの最初に表示）での実行を行う。IM_Entryの4つ目の引数でコントロールするのが手軽\n        INTERMediator.separator = '@'\n        リンク定義の区切り文字で、既定値は@\n        INTERMediator.defDivider = '|',\n        複数のリンク定義がある場合の区切り文字で、既定値は |\n        INTERMediator.defaultTargetInnerHTML = true\n        リンク設定のターゲット指定がない場合、既定値はテキストノードを作成して下位のノードとする。ここにtrueを指定すると、ターゲット指定がない場合にはinnerHTMLに代入する\n        INTERMediator.navigationLabel = ...\n        ナビゲーションのカスタマイズ（別項目で詳細を解説）\n        INTERMediator.titleAsLinkInfo = true;\n        titile属性の内容をリンク設定として解釈する。既定値はtrue\n        INTERMediator.classAsLinkInfo = false;\n        class属性にあるIM[ ] でかこった箇所をリンク設定として解釈する。既定値はtrue\n      \n      \n        バリデーション後に呼び出される関数\n        INTERMediatorOnPage.doAfterValidationSucceed = function(target,linkInfo){}\n        バリデーションの設定がされていて、ルールの結果がtrueとなった直後に呼び出される。引数targetは調べたノードへの参照、linkInfoは対照となったリンク定義の文字列が得られる\n        INTERMediatorOnPage.doAfterValidationFailure = function(target,linkInfo){}\n        バリデーションの設定がされていて、ルールの結果がfalseとなった直後に呼び出される。引数targetは調べたノードへの参照、linkInfoは対照となったリンク定義の文字列が得られる。テキストフィールドの値をもとにして計算処理をしている場合、間違えた値で再計算をしてしまっているかもしれないが、この関数は、元の値に戻された後に呼び出されるので、さらに再計算などを組み込むことができる。\n      \n      \n        レコード作成後及び削除後に呼び出される関数\n        INTERMediatorOnPage.doAfterCreateRecord = function(newRedId, targetName){}\n        レコード作成が成功した後に呼び出される。引数newRedIdには、作成したレコードのキーフィールドの値が設定され、targetNameにはコンテキストのname属性の値が設定されて呼び出される。\n        INTERMediatorOnPage.doAfterDeleteRecord = function(targetName){}\n        レコード作成が成功した後に呼び出される。引数targetNameにはコンテキストのname属性の値が設定されて呼び出される。\n      \n      \n        マスター/ディテール形式のユーザーインタフェース\n        IMLibPageNavigation.moveDetail(keying)\n        keyingには「手キーフィールド=値」の形式を指定する。マスター表示しているときにこのメソッドを呼び出すと、引数に指定したレコードに関する詳細表示に切り替わる。\n        IMLibPageNavigation.moveDetailOnceAgain()\n        画面更新をして現在のディテールページを表示する。事実上、ディテールのページが表示されているときに、そのページの更新を行う\n      \n      \n        マスター/ディテール形式のユーザーインタフェース処理前後\n        INTERMediatorOnPage.naviBeforeMoveToDetail(masterContext, detailContext)\n        マスター表示からディテール表示への切り替え前に呼び出される。引数はマスターおよびディテールのコンテキストオブジェクト。\n        INTERMediatorOnPage.naviAfterMoveToDetail(masterContext, detailContext)\n        マスター表示からディテール表示への切り替え後に呼び出される。引数はマスターおよびディテールのコンテキストオブジェクト。\n        INTERMediatorOnPage.navibeforeMoveToMaster(masterContext, detailContext)\n        ディテール表示からマスター表示への切り替え前に呼び出される。引数はマスターおよびディテールのコンテキストオブジェクト。\n        INTERMediatorOnPage.naviAfterMoveToMaster(masterContext, detailContext)\n        ディテール表示からマスター表示への切り替え後に呼び出される。引数はマスターおよびディテールのコンテキストオブジェクト。\n        IMLibUI.mobileSelectionColor\n        マスター/ディーテイル、あるいはステップ動作する場合、モバイルデバイス、あるいはfullnaviを付けたコンテキストにおいて、ホバーのフィードバックのための背景色。既定値は「#BBBBBB」。\n      \n      \n        ステップ動作\n        INTERMediatorOnPage.《コンテキストで指定した名前》()\n        コンテキスト定義において、before-move-nextstepキーで指定した名前のメソッドをINTERMediatorOnPageオブジェクトに用意すると、ステップ移動時に呼び出される。このメソッドがない場合や、メソッドの返り値がnullの場合、コンテキスト定義の順序で次のステップに画面遷移する。次のステップが無い場合は、画面の遷移は行わない。このメソッドがfalseを返すと、前の画面に遷移する。コンテキスト名の文字列を返すと、そのコンテキストの画面を表示し、現在のコンテキストは表示しなくなる。\n        コンテキスト定義において、before-move-thisstepキーで指定した名前のメソッドは、ステップのコンテキストが合成された直後に呼び出される。after-leave-thisstepキーで指定した名前のメソッドは、次のステップが合成される直前に呼び出される。\n        IMLibPageNavigation.stepNavigation\n        ステップ動作で選択したそれぞれのセルが順番に入力された配列。最後の要素が、今表示されている画面での選択結果となる。要素は、key、contextの2つのプロパティを持つオブジェクトである。contextは、そのステップで利用されたコンテキストオブジェクト（IMLibContextクラス）を参照するので、選択したデータはもちろん、関連するフィールドや他のレコードを含めて参照できる。keyは、選択したレコードのキーで、「主キーフィールド名=主キー値」の形式を持つ。コンテキストのstoreプロパティで、keyの値をキーにすると、選択したレコードが取り出せる。\n        IMLibPageNavigation.getStepLastSelectedRecord()\n        現在のコンテキストで選択したレコードを得る。\n        IMLibPageNavigation.startStep()\n        navi-controlにstep-hideをもつ最初のコンテキストを表示する。ステップ動作のコンテキストを全てstep-hideで定義して、ボタン操作で最初のステップに移動したいような場合に利用する。 をするような場合に利用できるでしょう。\n        IMLibPageNavigation.backToPreviousStep()\n        「戻る」ボタンと同等な処理を行う。なお、複数ステップを戻るには、このメソッドを必要回数指定する。\n        IMLibPageNavigation.moveNextStep(key)\n        セルをタップしたのと同じくステップを進める処理を行う。この時、引数keyが、IMLibPageNavigation.stepNavigationの要素のkeyプロパティに設定される。直後に、before-move-nextstepキーで指定した名前のメソッドが呼び出される。\n      \n      \n        認証に関連する情報\n        INTERMediatorOnPage.authCountLimit\n        認証を行うとき、失敗を許す回数。既定値は4。\n        INTERMediatorOnPage.authCount\n        認証を行うときに、ここまでに失敗した回数。\n        INTERMediatorOnPage.authUser\n        認証に使用されているユーザー名。\n        INTERMediatorOnPage.requireAuthentication\n        通信処理後、ユーザー認証が必要な場合にtrueが設定されている。\n        INTERMediatorOnPage.authStoring\n        認証情報のキャッシュスル場合で、cookie、sessionstrageなど。設定はサーバー側で行われている。\n        INTERMediatorOnPage.authExpired\n        認証情報のキャッシュ時間の秒数。設定はサーバー側で行われている。\n        INTERMediatorOnPage.isNativeAuth\n        データベースのアカウントによって認証を行うネイティブ認証を行なっていればtrue。設定はサーバー側で行われている。\n        INTERMediatorOnPage.realm\n        認証のレルム。同一レルムのページは、認証のキャッシュ情報を共有できる。設定はサーバー側で行われている。\n        INTERMediatorOnPage.isShowChangePassword\n        ログインパネルにパスワード変更のためのテキストフィールドを追加し、パスワード変更機能を追加する。既定値はtrue。\n        INTERMediatorOnPage.isSetDefaultStyle\n        認証パネルにおいて、スタイルの設定を古いバージョンと同じにする。既定値はfalseで、既にこのプロパティはtrueにする理由はない。もし、認証パネルのスタイルを変更したい場合は、テーマの修正をするのが適切である。\n        INTERMediatorOnPage.authPanelTitle\n        認証パネルのタイトルを文字列で指定する。既定値のnullの場合、タイトルには、realmの文字列が設定される。\n        INTERMediatorOnPage.isOAuthAvailable\n        OAuthによる認証を行なっている場合にはtrueになる。既定値はfalse。\n        INTERMediatorOnPage.isLDAP\n        LDAP認証が設定されている場合にtrueになる。既定値はnull。\n        INTERMediatorOnPage.passwordPolicy\n        サーバー側の設定で定めたパスワードポリシーの定義文字列。\n        INTERMediatorOnPage.isEmailAsUsername\n        認証時のユーザー名にメールアドレスが使えるかどうかを示す論理値。\n        INTERMediatorOnPage.doAfterLoginPanel\n        ログインパネル表示直後に呼び出される関数をsetteidekiru.\n      \n      \n        エラーメッセージ、デバッグメッセージ\n        INTERMediator.setDebugMessage(message, level)\n        でバッグメッセージを設定する。引数messageが実際のメッセージで、levelはそのレベル。定義ファイルでのIM_Entry関数の4つ目の引数の数値より低いレベルのデバッグメッセージが画面あるいはコンソールに表示される。\n        INTERMediator.setErrorMessage(ex, moreMessage)\n        単にエラーメッセージを表示するだけなら第1引数に文字列を指定するだけでよい。フレームワーク内では、exに文字列ないしはExceptionクラスのオブジェクト、第2引数に付加的なメッセージを設定している。ex自身もしくはmessageプロパティに、moreMessageが追加されてエラーメッセージとなる。\n        INTERMediator.flushMessage()\n        エラーメッセージやデバッグメッセージを表示する\n        INTERMediatorLog.errorMessageByAlert\n        trueにするとエラーメッセージが登録されるとき、その内容をダイアログボックスで表示する。既定値はfalse。\n        INTERMediatorLog.errorMessageOnAlert\n        エラ〜メッセージをダイアログボックスで表示するとき、このプロパティに文字列を与えると、システム側からのメッセージは無視して、その文字列のみを表示する。既定値のnullのままだと、setErrorMessageの引数がダイアログボックスに表示される。\n        INTERMediatorLog.suppressDebugMessageOnPage\n        デバッグログを表示した場合でも、デバッグログをページ上に表示することはしないで、コンソールのみにデバッグ情報を表示する。\n        INTERMediatorLog.suppressErrorMessageOnPage\n        エラーログを表示した場合でも、エラーログをページ上に表示することはしないで、コンソールのみにエラー情報を表示する。\n      \n      \n        ローカルコンテキスト\n        IMLibLocalContext.clearAll()\n        ローカルコンテキストのオブジェクトを初期化して、記録された内容をクリアする\n        IMLibLocalContext.setValue(key, value)\n        指定したキーで値を保存する\n        IMLibLocalContext.getValue(key)\n        指定したキーの値を取り出す\n        IMLibLocalContext.archive()\n        ローカルコンテキストの内容をセッションストレージ（またはクッキー）に記録する\n        IMLibLocalContext.unarchive()\n        セッションストレージ（またはクッキー）に記録したデータからローカルコンテキストを復元する\n        IMLibLocalContext.update(idValue)\n        引数に指定したid属性値のノードがローカルコンテキストにバインドされていれば、その要素の値をコンテキストに反映させる。通常はchangeイベントで自動的にコンテキストに値が設定されるが、changeイベント以外での動作時に利用する必要が出る\n        INTERMediator.useSessionStorage\n        ローカルコンテキストをセッションストレージに保持する。既定値はtrue。\n      \n      \n        コンテキストオブジェクト\n        IMLibContextクラスのオブジェクトに対するメソッドは以下の通りです。通常は、new IMLibContext(contextName)で生成された結果を使っています。《IMLibContext》は、IMLibContextクラスのインスタンスを示します。\n        コンテキストごとに生成されるオブジェクト\n        《IMLibContext》.contextName\n        コンテキスト名\n        《IMLibContext》.enclosureNode\n        エンクロージャーの要素への参照\n        《IMLibContext》.repeaterNodes\n        リピーターの初期状態で、ドキュメントツリー外に複製して取ってあるもの。値はノードの配列。\n        《IMLibContext》.store\n        コンテキストが保持するデータベースの値。このオブジェクトのプロパティは、keyフィールードが「id」とすれば、id=3、id=420のように、「主キーフィールド名=値」の文字列。その文字列のプロパティはさらにオブジェクトとなっていて、そのオブジェクトのプロパティはフィールド名。そのフィールド名のプロパティに対する値がデータベースに記録された値。FileMaker Serverで、relationキーのportalがtrueの場合、その値がさらにオブジェクトとなっており、プロパティはリレーションシップの関連キーの値である。なお、この値は更新しても、データベースへの更新は自動的には行われない。\n        《IMLibContext》.setValue(recKey, key, value, nodeId, target)\n        コンテキストに値valueを設定する。キーとしてはrecKey（id=34、つまり主キーとイコール、その値を合成した文字列）およびkey（フィールド名）を指定する。最初は要素のid属性値nodeIdを伴ってい指定され、id属性値とターゲット指定targetで決定されるページ内のノードと、データベースの値の対応関係を記録する。nodeIdを省略すると、値を保存すると同時に、他のコンテキストの同じテーブルの同じレコードの同じフィールドとバインドしている値も更新し、要素に表示する値も更新する。\n        INTERMediatorOnPage.updateProcessedNode\n        このプロパティは既定値がfalseで、その場合、すでにバインドされたノードに再度値を設定する事はしない。trueに設定すれば、Widgetでなければ値の設定をバインドが終わったノードに対しても行う。\n        《IMLibContext》.getValue(recKey, key)\n        2種類のキーを指定して値を取り出す。最初のキーは、「主キーフィールド名=値」の文字列、次のキーはフィールド名。つまり、storeプロパティへのアクセッサーメソッド。なお、keyに \"_im_buttom_master_id\" を指定すると、「詳細」ボタンの要素に設定されているid属性値を得られるので、プログラムでクリック操作をしたい時には利用できる。\n        《IMLibContext》.getContextInfo(nodeId, target)\n        要素のid属性値とターゲットから、コンテキスト情報（{context: this, record: recKey, field: key}形式のオブジェクト）を得る。コンテキスト名とフィールド名だけのターゲットの場合は、\"\" を指定する\n        《IMLibContext》.getContextValue(nodeId, target)\n        要素のid属性値とターゲットから、コンテキストでの値を得る\n        《IMLibContext》.setDataAtLastRecord(key, value)\n        コンテキストの最後のレコードのkeyで指定したフィールドに、valueの値を設定し、データベースへの更新を行う。\n        《IMLibContext》.setDataWithKey(pkValue, key, value)\n        コンテキストにあるレコードをpkValueで指定して、そのレコードにあるkeyで指定したフィールドに、valueの値を設定し、データベースへの更新を行う。レコードの指定はフィールドの値のみで行う。\n        コンテキストを管理するIMLibContextPool\n        IMLibContextPool.poolingContexts\n        IMLibContextPoolは複数のコンテキストを管理するオブジェクト。このプロパティは配列で、管理しているそれぞれのIMLibContextクラスのオブジェクトが要素として記録されている\n        IMLibContextPool.getContextInfoFromId(idValue, target)\n        要素のid属性値とターゲットから、コンテキスト情報（{context: this, record: recKey, field: key}形式のオブジェクト）を得る。コンテキストをまたいで検索する\n        IMLibContextPool.updateContext(idValue, target)\n        id属性値とターゲットで示す要素の現在の値を、対応するコンテキストに書き込む\n        IMLibContextPool.contextFromEnclosureId(idValue)\n        指定したid属性を持つ要素がエンクロージャーのコンテキストオブジェクトを返す\n        IMLibContextPool.contextFromName(cName)\n        コンテキスト名からコンテキストを返すが、最初のコンテキストオブジェクトのみが返される\n        IMLibContextPool.getContextFromName(cName)\n        コンテキスト名からコンテキストを返すが、引数のコンテキスト名を持つすべてのコンテキストオブジェクトを含む配列が返される\n      \n      \n        イベント対応\n        IMLibMouseEventDispatch.setExecute(idValue, exec)\n        指定したid属性値の要素に対してclickイベントが発生したときにexecに指定した関数が実行されるようにする\n        IMLibMouseEventDispatch.setTargetExecute(targetValue, exec)\n        指定したターゲット指定の要素に対してclickイベントが発生したときにexecに指定した関数が実行されるようにする\n        IMLibKeyDownEventDispatch.setExecute(idValue, charCode, exec)\n        指定したid属性値の要素に対して、charCodeのキーを押したことによるkeydonwイベントが発生したときにexecに指定した関数が実行されるようにする\n        IMLibKeyUpEventDispatch.setExecute(idValue, charCode, exec)\n        指定したid属性値の要素に対して、charCodeのキーを離したことによるkeyupイベントが発生したときにexecに指定した関数が実行されるようにする\n        IMLibChangeEventDispatch.setExecute(idValue, exec)\n        指定したid属性値の要素に対してchangeイベントが発生したときにexecに指定した関数が実行されるようにする\n        IMLibChangeEventDispatch.setTargetExecute(targetValue, exec)\n        指定したターゲット指定の要素に対してchangeイベントが発生したときにexecに指定した関数が実行されるようにする\n        IMLibBlurEventDispatch.setExecute(idValue, exec)\n        指定したid属性値の要素に対してblurイベントが発生したときにexecに指定した関数が実行されるようにする\n        IMLibBlurEventDispatch.setTargetExecute(targetValue, exec)\n        指定したターゲット指定の要素に対してblurイベントが発生したときにexecに指定した関数が実行されるようにする\n        IMLibInputEventDispatch.setExecute(idValue, exec)\n        指定したid属性値の要素に対してinputイベントが発生したときにexecに指定した関数が実行されるようにする\n        IMLibInputEventDispatch.setTargetExecute(targetValue, exec)\n        指定したターゲット指定の要素に対してinputイベントが発生したときにexecに指定した関数が実行されるようにする\n      \n      \n        クライアントからの直接的なデータベース処理\n        INTER-Mediatorは、INPUT、SELECT、TEXTAREAタグ要素を編集してフォーカスを離れる時（つまり、onchangeイベントを受けて）、自動的にデータを書き戻すようにしています。しかしながら、データベースの読み書きの処理はこれだけでは足りないと思われます。たとえば、DIVタグ要素をドラッグできるようにして、ドラッグ先の座標をデータベースに書き戻すようなことをしたいと思うかもしれません。その場合、イベント処理関数で、ノードの属性やスタイルの値を取り出して、データベース処理を自前でやりたくなります。そのために、以下のように、CRUDに対応した4つの関数およびレコードコピーのための関数を用意してあります。\n        以下のメソッドはいずれも、ネットワーク処理を非同期で行います。通信のためのパラメータは、argsに指定します。それぞれ、直前に示した、同期通信の対応するAPIと同じように、argsを指定します。successProcとfailProcはそれぞれ、通信が成功した時、エラーが発生した時に呼び出されるメソッドを指定します。何もしないなら、nullを指定します。通信処理は非同期で実行されるため、これらのメソッドの直後にステートメントは、通常は通信終了前に実施されるでしょう。原則として、このメソッド以降はプログラムを何も書かない、つまり、一連の処理がこのメソッドの呼出で終わるように記述する必要があります。これらのメソッドは認証が必要な場合でも、不要な場合でも利用されます。認証が必要な場合、認証が失敗すると、繰り返しログインパネルが表示する仕組みも組み込んであります。\n        INTERMediator_DBAdapter.db_query_async(args, successProc, failProc)\n        データベースからの取り出しを行います。関数の返り値は1レコードがオブジェクトとなった配列です。args引数には以下のキーを利用したオブジェクトを指定します。\n        \n          \n            \n              属性\n              指定する値\n            \n            \n              name\n              定義ファイルのIM_Entry関数の第1引数に指定する配列のname属性の値\n            \n            \n              records\n              取り出すレコードの数（レコード数の上限）\n            \n            \n              fields\n              取り出すフィールドの名前の配列（現在はすべて*でアクセスしており無視される）\n            \n            \n              parentkeyvalue\n              外部キーフィールドの値\n            \n            \n              conditions\n              {field:xx, operator:xx, value:xx} の形式のオブジェクトの配列。検索条件をANDで追加する\n            \n            \n              useoffset\n              trueならオフセットの値を利用する。falseなら利用しない\n            \n          \n        \n        INTERMediator_DBAdapter.db_update_async(args, successProc, failProc)\n        　データベースのレコードの更新を行います。args引数には以下のキーを利用したオブジェクトを指定します。\n        \n          \n            \n              属性\n              指定する値\n            \n            \n              name\n              定義ファイルのIM_Entry関数の第1引数に指定する配列のname属性の値\n            \n            \n              conditions\n              {field:xx, operator:xx, value:xx} の形式のオブジェクトの配列。検索条件をANDで追加する\n            \n            \n              dataset\n              {field:xx, value:xx}の形式のオブジェクトの配列。設定するフィールドとその値を指定する\n            \n          \n        \n        INTERMediator_DBAdapter.db_delete_async(args, successProc, failProc)\n        データベースのレコード削除を行います。args引数には以下のキーを利用したオブジェクトを指定します。\n        \n          \n            \n              属性\n              指定する値\n            \n            \n              name\n              定義ファイルのIM_Entry関数の第1引数に指定する配列のname属性の値\n            \n            \n              conditions\n              {field:xx, operator:xx, value:xx} の形式のオブジェクトの配列。検索条件をANDで追加する\n            \n          \n        \n        INTERMediator_DBAdapter.db_createRecord_async(args, successProc, failProc)\n        データベースに新しいレコードを作成します。関数の返り値は、作成したレコードのキーフィールドの値です。args引数には以下のキーを利用したオブジェクトを指定します。\n        \n          \n            \n              属性\n              指定する値\n            \n            \n              name\n              定義ファイルのIM_Entry関数の第1引数に指定する配列のname属性の値\n            \n            \n              dataset\n              {field:xx, value:xx} の形式のオブジェクトの配列。新しいレコードに対して指定フィールドに値を設定する\n            \n          \n        \n        INTERMediator_DBAdapter.db_copy_async(args, successProc, failProc)\n        指定したレコードを複製します。関数の返り値は、作成したレコードのキーフィールドの値です。args引数には以下のキーを利用したオブジェクトを指定します。\n        \n          \n            \n              属性\n              指定する値\n            \n            \n              name\n              定義ファイルのIM_Entry関数の第1引数に指定する配列のname属性の値\n            \n            \n              conditions\n              {field:xx, operator:xx, value:xx} の形式のオブジェクトの配列。検索条件をANDで追加する\n            \n            \n              conditions\n              {name: xxx, field:xx, value:xx} の形式のオブジェクトの配列。nameは関連テーブルのコンテキスト名、外部キーフィールド、そして、親レコードを特定する「キーフィールド名=キーの値」形式の文字列をそれぞれ指定します。\n            \n          \n        \n        通信が失敗した時に呼び出されるfailProcの関数は引数がありません。成功した時に呼び出されるメソッドは、引数が1つあり、通信結果を含むオブジェクトを引数で得られます。そのオブジェクトは、以下のプロパティを持っています。このsuccessProcに、通信結果をもとにした処理を記述することが可能です。\n        \n          \n            \n              プロパティ\n              内容\n            \n            \n              dbresult\n              検索結果あるいは処理したレコードを示すオブジェクトの配列\n            \n            \n              resultCount\n              検索あるいは処理したレコード数\n            \n            \n              totalCount\n              現在の検索条件で得られる総レコード数\n            \n            \n              newRecordKeyValue\n              新しいレコードを作ったり複製をした時、新しいレコードのキーフィールドの値\n            \n            \n              newPasswordResult\n              パスワードの変更が成功したかどうかを示す論理値\n            \n            \n              registeredId\n              クライアント間連携で利用する登録ID\n            \n            \n              nullAcceptable\n              フィールドの値にnullが許可されているかどうか\n            \n          \n        \n        INTERMediator_DBAdapter.db_query(args)\n        INTERMediator_DBAdapter.db_queryWithAuth(args, completion)\n        INTERMediator_DBAdapter.db_update(args)\n        INTERMediator_DBAdapter.db_updateWithAuth(args, completion)\n        INTERMediator_DBAdapter.db_delete(args)\n        INTERMediator_DBAdapter.db_deleteWithAuth(args, completion)\n        INTERMediator_DBAdapter.db_createRecord(args)\n        INTERMediator_DBAdapter.db_createRecordWithAuth(args, completion)\n        上記の関数は、Ver.5までに搭載されていた同期通信でクライアントからサーバーに対してデータベース処理が可能なものです。Ver.6では利用できなくなっています。非同期の近い名前の関数から、引数を調べてください。\n        INTERMediator.ignoreOptimisticLocking\n        trueの場合データベース更新時に楽観的ロック（ページ構築時から値が変化していないかを検出）の処理を行わない。既定値はfalse。\n        INTERMediatorOnPage.newRecordId\n        直前に行ったデータベース処理がレコード作成の場合、作成したレコードのキーフィールドの値が設定されている。\n      \n      \n        キューへのタスク投入\n        IMLibQueue.setTask(function(completeTask){...}, execSoon, later)\n        INTER-Mediator内部での更新処理のためのサーバーへの通信は、全てキューに投入して処理されます。これにより、更新処理が複数同時に稼働してしまう問題を避けることができます。独自にJavaScriptでプログラムを組む時、非同期通信を上記のメソッドで実装する場合、通信処理自体をこのメソッドでキューへ登録するのが確実です。引数の関数の処理ブロック内で、非同期通信処理を呼び出します。なお、関数の引数はキューを終了することを示すためのクロージャーが設定されて呼び出されます。通信処理後などに「completeTask()」のように呼び出しを記述する必要があります。これが呼び出されないと、次のキューの処理に移行しません。execSoonはtrueにするとキューに投入せずすぐに実行します。laterをtrueにすると、優先度の低いキュートなり、実行前に100msの時間を確保します。最後の2つの引数は省略可能で、省略時はそれぞれfalseになります。\n        例えば、あるボタンを押して、データベース処理をした後、location.hrefにURLを代入して別のページに移動したいとします。そのとき、単に、コンテキストにあるsetDataAtLastRecordメソッドを使って直後にlocation.hrefへの代入を行うと、このメソッド内のデータベース更新の通信が非同期で行われ、通信処理が完了する前にページが遷移し、データベース処理がキャンセルされてしまう可能性があります。その場合、以下のように、データベース更新処理の後にタスクを定義します。なお、setDataAtLastRecordメソッドは内部でsetTaskメソッドを呼び出しており、キューを利用しています。最後のキューによりmove関数が登録されますが、その中でキューがなくなるまで待つという処理を行います。こうすれば、データベース処理が完了した後にlocation.hrefへの代入が行われます。move関数は自身を内部で呼び出しているので無限ループの可能性がありますが、ここでは短時間でデータベース処理は完了することを想定しています。\n                \n          function clickAnyButton() {\n  const context = IMLibContextPool.contextName('test') // コンテキストを確保\n  context.setDataAtLastRecord('field1', 0)  // コンテキストの最後のレコードを更新\n  context.setDataAtLastRecord('field2', -1) // コンテキストの最後のレコードを更新\n  IMLibQueue.setTask(moving)  // キューが処理を終えるまで待つ処理を登録\n}\n\nfunction moving(complete) {\n  if (IMLibQueue.tasks.length &lt;= 1) {\n    location.href = 'https://moving.to.this.url.site/all_right'\n  } else {\n    IMLibQueue.setTask(moving, false, true)\n  }\n  complete()\n} \n      \n\nクライアント同期処理のカスタマイズ\nINTERMediatorOnPage.syncBeforeUpdate = (d) =&gt; {}\nINTERMediatorOnPage.syncAfterUpdate = (d) =&gt; {}\nINTERMediatorOnPage.syncBeforeCreate = (d) =&gt; {}\nINTERMediatorOnPage.syncAfterCreate = (d) =&gt; {}\nINTERMediatorOnPage.syncBeforeDelete = (d) =&gt; {}\nINTERMediatorOnPage.syncAfterDelete = (d) =&gt; {}\nクライアント同期が設定されているページにおいて、変更処理が同期された側で、それぞれの変更処理が行われる前後に呼び出されるメソッドを定義できます。Beforeが名前に含まれているメソッドでは、返り値を設定でき、引き続き処理する場合はtrue、処理をキャンセルする場合はfalseを返します。引数dは、同期情報に関するオブジェクト（例：{entity: \"item\", field: [\"product_unitprice\"], 'justnotify: false, pkvalue: [\"3\"], value: [\"30\"]}）が設定されて呼び出されます。\n\n    "
    },
    {
        "id": 28,
        "parent": "/ja/for-programmers/",
        "path": "/ja/for-programmers/jscomponent.html",
        "title": "JavaScriptコンポーネントの使い方",
        "breadcrumb": "JavaScriptコンポーネントの使い方",
        "body": "\n            \n                はじめに\n                以下のムービーのようなドラッグ&amp;ドロップによるファイルのアップロードができます。サンプルでは、Sample_webpageにあるfileupload_MySQL.htmlを中心に見てください。\n                \n                    dragdrop\n                \n                単一のコンテキストとバインドしたファイルアップロード\n                ファイルのドラッグ&amp;ドロップによるアップロード機能は、JavaScriptのドラッグ&amp;ドロップの機能などを利用して実装しています。シンプルな利用方法は、ファイルのドラッグを受け付けたい箇所に、以下のように記述します。JavaScriptのプログラムはINTER-Mediatorに含まれているので、定義ファイルをscriptタブで読み込むだけで基本的には利用できます。\n                \n                    &lt;span data-im=\"testtable@vc1\" data-im-widget=\"fileupload\"&gt;&lt;/span&gt;\n                \n                単にドラッグ&amp;ドロップしてファイルをサーバーにアップロードするだけということは通常はなく、そのファイルをどこかに記録し、さらにパスなどを記録しておくことになるはずです。前述の例では、testtableというコンテキストのvc1フィールドに、ファイルのパスを記述します。実際にアップロードしたファイルが置かれるディレクトリは、IM_Entryの第2引数（オプション指定）で、'media-root-dir'キーでパスを指定します。\n                アップロード結果を関連レコードとして追加する\n                前述の方法は、アップロードを複数回行った場合、最後のアップロードしたファイルへのパスのみが残ります。これに対して、アップロード結果を別のコンテキストに新しいレコードを作成し、アップロードごとに新しいレコードを作成することもできます。別のコンテキストとの間にはリレーションシップの定義が必要です。以下の例は、testtableコンテキストのvc1フィールドに対してファイルアップロードのコンポーネントを使う場合です。まず、この場合も、testtable側にはパスを記録するフィールド（ここでのvc1）を一つ用意します。そして、アップロードがあれば、2つ目のコンテキストfileuploadに新たにレコードを作るとします。まず、2つのコンテキストは、fileupload側のreatlionキーの定義に従って1対多の関係にあります。加えて、testtable側にfile-uploadキーによる配列を定義します。この配列により、vc1フィールドでファイルのアップロードがあれば、fileupload側に新たなレコードを作るという動作をします。\n                \n                    IM_Entry(\n    array(\n        array(\n            'records' =&gt; 10000,\n            'name' =&gt; 'testtable',\n            'key' =&gt; 'id',\n            'file-upload' =&gt; array(\n                array('field'=&gt;'vc1', 'context'=&gt;'fileupload',)\n            ),\n        ),\n        array(\n            'name' =&gt; 'fileupload',\n            'key' =&gt; 'id',\n            'relation' =&gt; array(\n                array('foreign-key' =&gt; 'f_id', 'join-field' =&gt; 'id', 'operator' =&gt; '=')\n            ),\n        ),\n    ),\n    array(\n        'media-root-dir' =&gt; '/tmp',\n    ),\n    array('db-class' =&gt; 'PDO'),\n    false\n);\n                \n                そして、アップロードが行われた場合、fileuploadコンテキストに新しいレコードを作りますが、relationの指定に従って、fileupload側の外部キーのフィールドに、testtable側の主キーの値が自動的に設定されて、アップロードのレコードが関連付けられます。fileuploadコンテキスト側には、文字列型のpathフィールドを作成しておきます。このフィールドに、アップロードされたファイルのパスが設定されます。このフィールド名は決め打ちになります。fileuploadコンテキストのテーブルには他のフィールドも定義できます。\n                アップロードのプログレスバー\n                アップロードの経過を表示するプログレスバーを表示したい場合には、INTERMediator.construct(); の実行前に、以下のステートメントを実行させてください。\n                \n                    IMParts_Catalog.fileupload.progressSupported = true;\n                \n                加えて、Sample_webpageフォルダにあるupload_frame.phpファイルを、定義ファイルと同じフォルダにコピーしておいてください。\n                なお、プログレス表示はPHPがAPC(Alternative PHP Cache)に対応している必要があります。PHP v5.3で稼働させる方法は、こちらを参考にしてください。\n                フォーム形式のアップロード\n                ドラッグ&amp;ドロップによるファイルのアップロードは、実はInternet Explorer 10では動きません。それに必要なクラスがブラウザに用意されていないからです。その場合、フォーム形式のアップロードコンポーネントが表示されます。これと同じように、常に、フォーム形式のアップロード機能を設定したい場合、INTERMediator.construct(); の実行前に、以下のステートメントを実行させてください。\n                \n                    IMParts_Catalog.fileupload.forceOldStyleForm = true;\n                \n                FileMakerのオブジェクトフィールドにファイルをアップロードする\n                INTER-Mediator 5.1以降を使用している場合、FileMakerのオブジェクトフィールドに直接ファイルをアップロードできます。ただし、FileMaker Serverのバージョン13以降が必要、かつあらかじめデータベースのフィールドオプションにおいて［入力値の自動化］オプションの［計算値］に下記を設定しておく必要があります。\n                If (\n    GetContainerAttribute(Self; \"filename\") ≠ \"\";\n        Self;\n        Let([\n            fileName = GetValue(Self; 1);\n            content = Substitute(Self; fileName &amp; ¶; \"\")\n        ];\n        Base64Decode(content; fileName)\n    )\n)\n                定義ファイルでは、'file-upload'キーおよび下位のキーとして'field'キーと'container'キーを下記のように指定します。'field'キーの値はオブジェクトフィールドの名称です（下記の例ではvc1）。\n                'file-upload' =&gt; array(\n    array('field'=&gt;'vc1', 'container' =&gt; true)\n),\n\n            \n            \n                JavaScriptコンポーネントのプラグイン\n                以前から、HTMLエディタのtinyMCE、コードエディタのCodeMirrorや独自作成したファイルアップロードコンポーネントを使えるようにしていたのですが、なんとか「プラグイン」的に使える状態になったので、一度ドキュメントを作成します。JavaScriptで作ったコンポーネントに、データベースにあるフィールドの値を表示し、修正するとそれが書き戻される仕組みを提供します。ただし、コンポーネントごとに、初期化の方法は違うので、その部分を吸収するプラグインを作らないといけません。\n                JavaScriptコンポーネントの使い方\n                まず、JavaScriptのコンポーネントを使いたい場合には、次のように、data-im-widget属性にキーワードを書きます。プラグインができていればこれだけです。\n                \n                    &lt;div data-im=\"testtable@text1\" data-im-widget=\"tinymce\"&gt;&lt;/div&gt;\n                \n                ここで、tinyMCEを使うにはプラグインが必要ですが、これについては、すでにINTER-Mediatorの中にあります。Samples/Sample_webpage/tinymce_im.jsがそれなので、たとえば、ページファイルのヘッダ部に、次のような記述を行ってtinyMCE自身の読み込みと、プラグインの読み込みを行っておきます。もちろん、パスは適切なものを指定してください。\n                \n                    &lt;script type=\"text/javascript\" src=\"tinymce/js/tinymce/tinymce.min.js\"&gt;&lt;/script&gt;\n&lt;script type=\"text/javascript\" src=\"tinymce_im.js\"&gt;&lt;/script&gt;\n                \n                Ver.4.4現在、tinyMCE、CodeMirror、それから独自に作ったファイルアップロードコンポーネント（Samples/Sample_webpage/fileupload_MySQL.htmlがサンプル）が利用可能です。\n                JavaScriptコンポーネントプラグインの作り方\n                プラグイン（前記のtinymce_im.jsに相当）は、JavaScriptで記述します。もちろん、tinymce_im.jsもサンプルとして参照する必要があるでしょう。\n                プラグインのファイルでは、IMParts_Catalog変数のオブジェクトに、プラグインのオブジェクトを追加します。このときのキーが、data-im-widget属性に指定するキーワードとなります。以下はその基本構造です。\n                \n                    IMParts_Catalog[\"tinymce\"] = {\n    instanciate: function (parentNode) { },\n    ids: [],\n    finish: function (update) { }\n}\n                \n                右辺のオブジェクトは、instanciateとfinishという2つのメソッドを持つ事が重要です。INTER-Mediatorは、ページ合成時に、im-data-widget属性があるノードを見つけると、そのノードを引数にとって、instanciateメソッドを呼び出します。\n                一方、ページ合成の最終段階、つまり、DOMオブジェクトが確定してページ上に存在する状態になった後に、finishメソッドが呼び出されます。結果的に、im-data-widget属性が設定された要素×レコード数の回数instanciateメソッドが呼び出され、最後に1回finishが呼び出されます。\n                プラグインの作業として必要なこと\n                この2つのメソッドが行うことは、コンポーネントに対するゲッタおよびセッタメソッドをそれぞれ展開したコンポーネントに対して設定することです。また、対応コンポーネントのid属性値を得るメソッドも実装します。たとえば、instanciateメソッドに記述するとしたら、次のようになります。instanciateメソッドを呼び出されたときの引数parentNodeあるいはコンポーネントのルートの要素に対して、以下の決められた名称のメソッドを実装します。メソッドの中身はtinyMCEの場合の例です。\n                \n                    parentNode._im_getComponentId = function () { // data-im-widgetのある要素に設定\n    var theId = newId;\n    return theId;\n};\nparentNode._im_setValue = function (str) { // data-im-widgetのある要素に設定\n    var targetNode = newNode;\n    targetNode.innerHTML = str;\n};\ntargetNode._im_getValue = (function () { // コンポーネントのルートの要素に設定\n    var thisId = targetId;\n    return function () {\n        return tinymce.EditorManager.get(thisId).getContent();\n    }\n})();\n                \n                instanciateメソッドでの作業\n                通常、JavaScriptのコンポーネントは、特定の要素にidやclass値を適当に与えて、その要素の中に必要なオブジェクトを詰め込むといった動作をします。つまり、起点となる要素を用意しておき、そこに必要なオブジェクトを追加します。tinyMCEだと、手軽な作り方はTEXTAREAタグ要素を用意することですが、ページファイル上に記述した要素がどんな種類のタグ要素でもいいように、data-im-widget属性がある要素の子要素にTEXTAREAタグ要素を作り、その要素をtinyMCEで初期化するようにしています。\n                そのTEXTAREA要素のid属性は、適当に付けます。targetNodeで参照されるリピーター内の要素は、すでにid属性が設定されているので、そのid値に適当な文字を追加すれば、一意なid属性になります。_im_getComponentIdメソッドは、ここでのTEXTAREA要素に付けたidを返します。\n                なお、instanticateメソッド中は、まだ、リピーターはエンクロージャーに挿入されておらず、documentからたどれない状態になっています。その場合、初期化をしてもうまく動作しないと思われます。従って、instanciateメソッドでは、元になるTEXTAREA要素を作り、id番号を振り、そのid番号をidsプロパティの配列に追加して、必須のメソッドを定義するところまでしかできないのが一般的かと思います。idsプロパティはなくてもいいのですが、この後のfinalizeメソッドでそれぞれの要素を初期化するために、初期化すべき要素を後から特定できるようにするために、instanciateで作成した要素のidを残します。\n                instanciateメソッドの段階で実際に利用されるのは、_im_getComponentIdメソッドと_im_setValueメソッドなので、_im_getValueメソッドは実際には設定する必要はありません。_im_setValueメソッドについては、JavaScriptコンポーネントが初期化前であることを考慮して、機能する前の状態での値設定が可能なプログラムを記述する必要があります。\n                finalizeメソッドでの作業\n                この段階では、全ての要素がdocument配下にいるので、JavaScriptコンポーネントの初期化を実際に行います。なお、初期化した結果、ゲッタやセッタの動作を変えたい場合は、設定をしなおします。JavaScriptのコンポーネント内で修正した結果をデータベースに書き戻すには、_im_getValueメソッドを、初期化が終わった後の状態でのゲッタとして動作するように設定をする必要があります。単にデータベースに書き戻すだけでいいのなら、ゲッタの設定のみでかまいません。以下は、tinyMCEの例で、idsプロパティにコンポーネントのid属性値が配列として残されています。1つ1つの要素に対して、_im_getValueメソッドを追加しています。\n                \n                    for (var i = 0; i &lt; this.ids.length; i++) {\n     var targetNode = document.getElementById(this.ids[i]);\n     var targetId = this.ids[i];\n     if (targetNode) {\n         targetNode._im_getValue = (function () {\n             var thisId = targetId;\n             return function () {\n                 return tinymce.EditorManager.get(thisId).getContent();\n             }\n         })();\n     }\n }\n                \n                tinyMCEのプラグインは、ページ上にあるすべてTEXTAREAをHTMLエディタにしてしまう動作で初期化するので、tinyMCE.initメソッドを呼び出すだけです。コンポーネントによっては、個別にオブジェクトをidsプロパティから取得したid値で参照して、それぞれに何らかのメソッドを適用しないといけないかもしれません。\n                結果的に、それぞれのJavaScriptコンポーネントごとにうまく初期化をしないといけませんが、場合によってはフレームワークの更新も必要になるかもしれません。\n                自分でJavaScriptコンポーネントを作る場合\n                自分で１からコンポーネントを作る場合は、以下のプラグインの骨格を作り、後は自由につくっていいでしょう。このクラスにメソッドを集めてもいいですし、他のファイルから参照してもかまいません。\n                \n                    IMParts_Catalog[\"myjscomponent\"] = {\n    instanciate: function (parentNode) { },\n    ids: [],\n    finish: function (update) { }\n}\n                \n            \n        "
    },
    {
        "id": 29,
        "parent": "/ja/for-programmers/",
        "path": "/ja/for-programmers/media.html",
        "title": "MediaAccessクラスとその拡張点",
        "breadcrumb": "MediaAccessクラスとその拡張点",
        "body": "\n            \n                はじめに\n                INTER-Mediatorはデータベースの内容を取り出し、Webページに展開し、場合によっては書き直したデータをデータベースに書き戻します。この一連のDBを中心としたデータの流れがあるのですが、Webアプリケーションではこれだけではすべてはまかなえません。HTMLでページを作るときは写真などの画像を別のファイルで供給します。このHTML外に実データが存在するようなものを「メディア」と呼ぶことにします。\n                メディアにはいろいろな種類があります。主要なものはIMGタグ要素で表示する画像、OBJECTタグなどで表示するFlashのコンテンツやビデオなど、そしてリンク先で得られるものとなるでしょうか。また、それぞれ、サーバー上にスタティックにあるものや、データベースのオブジェクト型フィールドに存在する場合もあります。WebページからこれらにアクセスするためのものがMediaAccessクラスです。概ね、次のような用途に使用方法は分類できます。\n                \n                    サーバー上にある画像ファイルを参照する\n                    FileMakerのオブジェクトフィールドを参照する\n                    データ生成を指定したクラスにさせ、生成結果を返す\n                \n                ここで、単なる画像は普通にHTMLを書けばいいじゃないかと思うかもしれませんが、MediaAccessクラスを使う理由は、認証やアクセス権の設定との連携が可能になっているところです。\n            \n            \n                サーバー上にある画像ファイルを単に参照する\n                スタティックな画像で、認証が絡まない場合は、普通にIMGタグを記述します。また、画像ファイル名やパスがデータベースにある場合でも、必ずしもMediaAccessクラスは必要ないかもしれません。たとえば、あるテーブルのfilepathフィールドにファイル名が記録されているのなら、このようなIMGタグで表示できるでしょう。#srcにより、この要素のSRC属性にフィールドのデータが追加されます。\n                \n                    &lt;img src=\";figs/\"; data-im=\";context@filepath@#src\"; /&gt;\n                \n            \n            \n                サーバー上にある画像ファイルを認証を伴って参照する\n                一方、ページの内容を認証しなければ参照できないようにしたとき、やはりページに埋め込んだ画像なども認証を経由したいと考えます。Webサーバーレベルでの認証の場合は、ある意味、認証がない場合と概ね同じことで可能ですが、INTER-Mediatorの認証機能を使った場合、SRC要素がスタティックな画像を参照していれば、もしかしたら、認証しなくても画像だけは見えてしまうかもしれません。そんなことをしても大した情報流出にならないとも言えるのですが、ガードしたいものはガードするのが基本ですし、認証しているのに一部は誰でも見えるのは正しい運用ではありません。\n                そこで、IM_Entry関数の2つ目の引数（つまりオプション引数）に、'media-root-dir'というキーで、サーバー上にあるメディアファイルのフォルダへのルートからの絶対パスを指定しておきます。たとえば、\n                \n                    'media-root-dir' =&gt; '/var/www/images',\n                \n                となっていたとします。あるページファイルで使われている定義ファイルのパスがcontext.phpだったとします。すると、次の部分URLが、メディアを返します。ここで背後では、MediaAccessクラスが使われており、このクラスがメディアに対するプロキシになっているとも言えます。\n                \n                    context.php?media=ch1/shot345.png\n                \n                たとえば、IMGタグのSRC属性に上記のURLを記述すれば、media-root-dirと合成して、「/var/www/images/ch1/shot345.png」というファイルをアクセスし、その内容を取り出して、適切なMIMEタイプのヘッダとともに出力をします。\n                前記のURLにある画像ファイル名「shot345.png」がフィールドpicfileにあるような場合には、ページファイルの要素には以下のような記述ができます。media=は決められたキーワードです。\n                \n                    &lt;img src=\";context.php?media=ch1/\"; data-im=\";table@picfile@#src\"; /&gt;\n                \n                このとき、定義ファイルで認証が必要な設定になっていると、SRC属性のURLからの取得時にMediaAccessクラス内部で、認証の確認を行います。ここで、一般の認証時に使っているクレデンシャルをそのまま使うことが実はできません。一般の認証では、1つのアクセスごとに異なるチャレンジデータを使うことで、認証の乗っ取りをしにくくしています。しかし、そのためにメディア処理ではその仕組みが使えません。なぜなら、メディアへのアクセスは並列的にブラウザから行うからです。\n                そこで、メディアアクセス時の認証のためだけのクレデンシャルを生成させるようにしています。たとえば、直前のimgタグ要素の場合、tableという名前のコンテキストからの取得となりますが、そのコンテキスト定義（IM_Entry関数の第1引数）の'authentication'キー内部の'media-handling'キーの値をtrueにします。すると、このコンテキストのデータを取得するときに、サーバー側からメディア用のクレデンシャルを出力します。\n                IMGタグ要素などから実際にメディア取得を定義ファイルに対して行うとき、media=があれば、MediaAccessクラスに処理をまかせます。そのとき、クレデンシャルがクッキーに記録されてサーバー側に到達し、それを発行したクレデンシャルと比較することで認証が通っているかどうかを判定します。つまり、コンテキストが得られるということは認証が通っているわけで、その信頼関係をもとに秘密の合い言葉をやりとりします。このクレデンシャルは繰り返し使われる可能性があります。クッキーに記録し、時間が来れば消去するようにはなっているものの、クレデンシャルを盗まれるのはそれだけでメディアアクセスを可能にしてしまうことになります。従って、HTTPS（SSL）でのサーバー運用は必須とも言えるでしょう。\n            \n            \n                普通のHTMLでMediaAccessを経由させる\n                Webページを作って画像を埋め込むと、&lt;img src=\";img/cover.jpg\"; /&gt; などと記述します。これをMediaAccessクラスを使ってデータの取り出しを行いたいとしたら、ソースを全部変更しないといけないのかというとそうではありません。リダイレクトを使うことで、HTMLソースはそのままに、MediaAccessクラスを使うことができます。たとえば、.htaccessファイルを作り、たとえば次のような記述を作ります。\n                \n                    RedirectMatch img/(.+) http://host.name/myapp/context.php?media=$1\n                \n                すると、&lt;img src=\";img/cover.jpg\"; /&gt; は、&lt;img src=\";http://host.name/myapp/context.php?media=cover.jpg\"; /&gt; と同じことになるわけです。\n                部分パスと絶対パス、それらを消したり追加したりといろいろ複雑にはなりますが、このスタティックなメディアを認証した上で表示できるようにしたのがMediaAccessの最初のインプリメントでした。\n            \n            \n                FileMakerのオブジェクトフィールドを参照する\n                オブジェクトフィールドはデータベースごとに扱いが異なり、統一的にはやりにくい処理ではあります。MediaAccessクラスでは、FileMaker Serverをターゲットにオブジェクトフィールドに対応する機能を作成しました。\n                FileMakerはFXを経由し、XML共有の仕組みを使います。テキスト型や数値型は、基本的にテキストでフィールドにあるデータが得られます。一方、オブジェクトフィールドはオブジェクトそのもののデータではなく、フィールドのデータに応じた以下のような「テキスト」が得られます。\n                \n                    /fmi/xml/cnt/photo.jpg\nhttp://server:16000/…\n                \n                PDFは完全なURLで、FileMaker Serverに16000ポートで接続して取り出すことが可能です。JPEGなどの画像の場合は、URLのパスに相当するものが得られますが、たとえばIMGタグのSRC属性にそのまま指定が可能な文字列になります。\n                いずれにしても、両方ともURLであると解釈すればいいわけです。この仕組みはFileMaker Serverに限らず、一般的なアクセスにも使えます。つまり、media=URLと指定をした場合は、そのURLにアクセスしたデータをMediaAccessクラスが取得し、さらにクラスを呼び出した元にそのデータを返します。/fmi/xml/cntで始まる物だけは特別にURLであるという処理が組み込まれています。また、URLかどうかはそれ以外には、httpあるいはhttpsで開始するものかどうかで判定しています。\n            \n            \n                MediaAccessでのアクセス権\n                認証が成立したらすべて参照可能となり、成立しなければ参照不可という単純なものなら非常に話が早く、前に説明したmedia-tokenの仕組みで事は足りるのです。なお、データはCRUDの4つの側面がありますが、メディアに関しては「編集」というのはWeb世界ではかなり難易度が高い世界であり、MediaAccessクラスはほぼ参照のみのサポートになっています。\n                ここで、メディアそのものがログインしたユーザごとのアクセス権を持たせたい場合が出てきます。レコードについては、特定のフィールドにユーザ名やグループ名を入力することで、そのユーザやグループに所属したユーザでないと参照や更新ができない仕組みを持っています。フィールドのデータはそれでいいのですが、メディアは実体はレコードと別に有ります。ここで、個々のメディアをコンテキストのレコードと結合させ、レコードごとのアクセス権をメディアにまで及ぼす仕組みを組み込みました。\n                まず、IM_Entry関数の2つ目の引数（オプション引数）に、キーが'media-context'で値がコンテキスト名（コンテキストのnameキーに対する値）を与えます。すると、メディアはこのコンテキストにある特定のレコードの、1つのフィールドのようなふるまいになります。\n                \n                    'media-context' =&gt; 'context-name',\n                \n                実際にメディアにアクセスするパスは次のような形式にします。つまり、コンテキスト名、レコードの検索条件をパスに入れます。最初のfilesは特に意味はなく、相対パスの最初のキーワードです。context-nameは、media-contextの値と同じでなければなりません。そのコンテキストのkeyキーに対する値、つまり主キーがpidであるなら、たとえば、field=valueは、pid=312 のような値になります。\n                \n                    context.php?media=files/context-name/field=value/filename.png\n                \n                ここでもし、media-root-dirが /var/www/media であるなら、実際に\n                \n                    /var/www/media/files/context-name/pid=312/finename.png\n                \n                という絶対パスの画像ファイルが存在する必要があります。コンテキストの定義には、レコード単位のアクセス権設定があれば、メディアに対するアクセス権の認証の確認を行い、ユーザを特定します。pid=312のレコードがそのユーザにアクセス権があるのかどうかを確認することによって、アクセスの可否を決めます。従って、適当にpid=316などとパスを変えても、その条件で検索されたレコードが他のユーザに対する権利があるものであれば、400番台のレスポンスを返してデータは返しません。認証の確認を行い、そのユーザに対するアクセス権がないものは出力しないという仕様によりアクセス権は定義した通りに適用されます。\n                pid=312を、age=45のようにできると言えばできますが、おそらく、そういうディレクトリは存在せず、漏洩にはならないでしょう。\n                ファイルのアップロードのコンポーネントは、コンテキスト名やレコード検索条件のパスを自動的に作成するようにも作られています。\n                メディア関連処理は、開発している側で「必要の合った」状況しかうまく動かない可能性があります。ぜひとも、いろいろ試してフィードバックをください。\n            \n            \n                データ生成を指定したクラスにさせ生成結果を返す\n                URLを使用して、別のシステムにデータを取りに行くことができるということはかなり汎用的になります。しかしながら、別システムとの連動ということになり、開発はやや大変になると同時にセキュリティ面への配慮する場面も増えることになります。そこで、INTER-Mediatorで完結させるために、定義ファイルの呼び出しにおいて、\n                \n                    context.php?media=class://ClassName/context/criteria\n                \n                という呼び出しができます。この場合、ClassNameは定義ファイルと同じディレクトリなど、PHPが取得できる場所にあるクラスのファイル名です。ClassNameで指定したクラスには、processingというメソッドを記述します。そして、ヘッダを含めた応答すべてをこのメソッドの中で完結させます。\n                \n                    class ClassName {\n    function processing($contextData, $options) { }\n}\n                \n                スペック上はprocessingというメソッドがあればいいのですが、引数については、とりあえず作ったアプリケーションで必要なものを並べました。$contextDataは、パス内にあるcontextで指定したクラスに対して、パス内にあるcriteriaで指定した検索条件で得られたレコードないしはその配列が引数で渡されます。認証を行うと、1レコードに限定されるので、そのレコードの連想配列です。認証を行わないと単に検索条件となるので、連想配列の配列を返します。criteriaはたとえば「id=45」にすれば、idフィールドが45のレコードに絞り込みます。$optionには、定義ファイルのIM_Entryの2つ目の値が設定されます。\n                \n                この仕組みを作って作ったのが『FileMaker as a Relational Database』のサイトです。このサイトでは、書籍を購入した人にPDFおよびePubでの書籍を配布していますが、それぞれパーソナライズをしています。PDFはヘッダに購入者やメールアドレスを入れ込み、ePubでは特定のページに同じような内容のテキストを埋め込んで圧縮・アーカイブします。media=class://という記述は、そうしたドキュメント生成処理を記述できるような仕組みなのです。\n            \n        "
    },
    {
        "id": 30,
        "parent": "/ja/for-programmers/",
        "path": "/ja/for-programmers/serverextending.html",
        "title": "サーバーサイドの拡張（Ver.5.4以降）",
        "breadcrumb": "サーバーサイドの拡張（Ver.5.4以降）",
        "body": "\n            \n                データコンバータクラスの利用方法\n                IM_Entry関数の第2引数で、'formatter'を利用して、特定のコンテキストのフィールドに対して、データベースの読み書き前後にフィルタを設定することができます。このときに使うクラスをデータコンバータクラスと呼びます。使用する箇所では、ネームスペースを除いたクラス名だけを記述します。自分で作成もできますが、以下のものが最初から組み込まれています。自分で作成する場合はDataConverter_template.phpを参照してください\n                \n                    \n                        \n                            \\INTERMediator\\Data_Converter\\AppendPrefix.php\n                            parameterに指定した文字列を前につける\n                        \n                        \n                            \\INTERMediator\\Data_Converter\\AppendSuffix.php\n                            parameterに指定した文字列を後につける\n                        \n                        \n                            \\INTERMediator\\Data_Converter\\Currency.php\n                            parameterに指定した小数以下の桁数で、数値を通貨で表示する\n                        \n                        \n                            \\INTERMediator\\Data_Converter\\FMDateTime.php\n                            FileMaker Serverの出力する「月/日/年」形式の日付や時刻を整える\n                        \n                        \n                            \\INTERMediator\\Data_Converter\\HTMLString.php\n                            改行をBRタグ要素、そして&lt;や&gt;や&amp;を参照形式に変換する。parameterにautolinkと指定するとURLにAタグ要素を付加してリンクに変換する。バージョン4.2以降においてparameterにnoescapeと指定すると参照形式への変換を無効にする。データベースへの書き込み時はそのままの文字列\n                        \n                        \n                            \\INTERMediator\\Data_Converter\\MarkdownString\n                            マークダウン表記のテキストをHTMLに整形する。コンバーターを通したフィールドは、innerHTMLで受ける必要がある。現在サポートしているマークダウン表記は以下のとおり。\n                                \n                                    \n                                        \n                                            行頭の記号\n                                            動作\n                                        \n                                        \n                                            *\n                                            その行をHnタグで囲む。nは*の個数に対応する\n                                        \n                                        \n                                            -\n                                            その行を箇条書きにする。-を重ねて階層的に記述することも可能\n                                        \n                                        \n                                            #\n                                            クラスが「_im_markdown_p1」のPタグで囲む。#は2つおよび3つにも対応し、クラス名の末尾の数字と#の個数が対応する\n                                        \n                                        \n                                            @@IMG[file]\n                                            href属性がfileのIMGタグを生成すし、さらにクラスが「_im_markdown_para_img」のPタグで囲む\n                                        \n                                        \n                                            |\n                                            TABLEタグで表を作る。セルの区切りと末尾に|を入れる\n                                        \n                                    \n                                \n                            \n                        \n                        \n                            \\INTERMediator\\Data_Converter\\MySQLDateTime.php\n                            MySQLの出力する「年-月-日」形式の日付や時刻を整える\n                        \n                        \n                            \\INTERMediator\\Data_Converter\\Number.php\n                            parameterに指定した小数以下の桁数で、数値をカンマ付きで表示する\n                        \n                        \n                            \\INTERMediator\\Data_Converter\\NumberBase.php\n                            NumberやCurrencyの基底クラス\n                        \n                        \n                            \\INTERMediator\\Data_Converter\\NullZeroString.php\n                            書き込み時にデータが''ならNULLとする、読み込み時は逆変換\n                        \n                        \n                            \\INTERMediator\\Data_Converter\\DataConverter_template.php\n                            データコンバータのクラスのテンプレート\n                        \n                    \n                \n            \n            \n                データベースアクセス処理のアドバイザクラスを定義する\n                データベース側の処理に割り込むには「データベースクラスを自作する」で説明する手法（「データアクセスクラスのサブクラスを利用する方法」と定義します）とここで説明する手法（「アドバイザクラスを定義する方法」とします）の2通りがあります。「データアクセスクラスのサブクラスを利用する方法」だと、すべてのコンテキストに対する処理を記述しなければなりません。言い換えれば、複数あるコンテキストの１つだけに対して処理を加えたい場合、そのコンテキストのときだけプログラムが実行されるようにする必要があります。コンテキストが増減したときのメンテナンスタスクが増えます。「アドバイザクラスを定義する方法」だと、特定のコンテキストにだけ利用されるクラスを指定するので、「コンテキストごとに分岐させる」処理は不要です。必要な処理だけを記述する「アドバイザクラスを定義する方法」を使う方がプログラムの作成は容易でしょう。\n                IM_Entry関数の第一引数、つまりコンテキストの中に「extending-class」でクラス名を指定します。ここで指定したクラス名は任意のものでかまいませんが、そのクラスをPHPが認識できる場所に記述しておく必要があります。クラスは以下のようなインタフェースをインプリメントする必要があります。つまり、CRUDに対応する4種類のデータアクセス処理の前後にメソッドを含めることができるのです。\n                interface \\INTERMediator\\DB\\Extending\\BeforeRead {\n    public function doBeforeReadFromDB();\n}\ninterface \\INTERMediator\\DB\\Extending\\AfterRead {\n    public function doAfterReadFromDB($result);\n}\ninterface \\INTERMediator\\DB\\Extending\\AfterRead_WithNavigation {\n    public function doAfterReadFromDB( $result);\n    public function countQueryResult();\n    public function getTotalCount();\n}\ninterface \\INTERMediator\\DB\\Extending\\BeforeUpdate {\n    public function doBeforeUpdateDB();\n}\ninterface \\INTERMediator\\DB\\Extending\\AfterUpdate {\n    public function doAfterUpdateToDB($result);\n}\ninterface \\INTERMediator\\DB\\Extending\\BeforeCreate {\n    public function doBeforeCreateToDB();\n}\ninterface \\INTERMediator\\DB\\Extending\\AfterCreate{\n    public function doAfterCreateToDB($result);\n}\ninterface \\INTERMediator\\DB\\Extending\\BeforeDelete {\n    public function doBeforeDeleteFromDB();\n}\ninterface \\INTERMediator\\DB\\Extending\\AfterDelete {\n    public function doAfterDeleteFromDB($result);\n}\ninterface \\INTERMediator\\DB\\Extending\\BeforeCopy {\n    public function doBeforeCopyInDB();\n}\ninterface \\INTERMediator\\DB\\Extending\\AfterCopy{\n    public function doAfterCopyInDB($result);\n}\n\n                \n                メソッドの引数\n                Deleteを除くdoAfter____メソッドの$result引数は、対象レコードが連想配列の配列の形式で入っています。1レコードがフィールド名をキーとした連想配列になっており、レコードの数だけその配列があります。doAfterGetFromDBでは複数のレコードが得られますが、doAfterSetToDBやdoAfterNewToDBでは1レコードだけが返されます。doAfterDeleteメソッドでは、削除できたかどうかの論理値が設定されます。\n                doAfter____メソッドの返り値\n                doAfter____メソッドがあれば、その返り値を、データベースのクエリー結果やあるいは更新処理などをした結果のレコードとしてクライアントに返します。シンプルな方法としては、引数をそのまま返すようにプログラムを作成しますが、ここで、データベースからの取得結果を加工して返しても構いません。たとえば、doAfterGetFromDBメソッドで集計処理などを行い、同様に連想配列の配列にして結果を返します。また、新たなフィールドを追加するなども行えます。もちろん、連想配列のキーがフィールドになります。\n                doBefore____メソッドの返り値\n                Ver.8の途中より、doBefore____メソッドの返り値を利用できるようにしました。それ以前は、値を返しても何も使われていませんでした。通常は、doBefore___を実行し、クライアントから要求されたデータベース処理を行い、doAfter____を実行しますが、引数によってはdoBeforeで処理を終了させることができます。\n                \n                    doBefore____メソッドの返り値\n                    \n                        \n                            値\n                            動作\n                        \n                        \n                            false\n                            データベース処理を中断して、英語のエラーメッセージを表示する\n                        \n                        \n                            文字列\n                            データベース処理を中断して、文字列をエラーメッセージとして表示する\n                        \n                        \n                            \"\"\n                            データベース処理を続ける\n                        \n                        \n                            その他（返り値なしの場合も含む）\n                            データベース処理を続ける\n                        \n                    \n                \n                メソッドの作成例\n                以下は、データベースからレコードを取得した後に呼び出されるクラスの定義例です。MyProgramというクラス名は任意ですが、2つのメソッドはインタフェースに決められたものを定義します。doAfterGetFromDBはデータベースからデータを取得した後に呼び出されます。このとき、ナビゲーションを使ってページ送りの処理をしているのなら、「レコードの個数」をcountQueryResultメソッドで、「全レコード数」をgetTotalCountメソッドで返す必要があります。ナビゲーションがない場合にはこのメソッドの実装は不要です。また、ナビゲーションを使う場合でも、レコード総数がdoAfterGetFromDBの処理の後でも変わらないのであれば、countQueryResultメソッドは不要です。\n                class MyProgram extends \\INTERMediator\\DB\\UseSharedObjects implements \\INTERMediator\\DB\\Extending\\AfterRead {\n    function doAfterReadFromDB($result) {\n        foreach( $result as $record ) {\n            foreach( $record as $field =&gt; $value ) {\n                :\n            }\n        }\n        return $result;\n    }\n}\n\n                \n                countQueryResultメソッドを記述する場合の例を以下に示します。countQueryResultはdoAfterGetFromDBよりも後に呼び出されます。countQueryResultによって返されるのは、実際のレコード数ではなく、検索条件に合ったレコード数です。つまり、1万個のレコードのうち40個を表示している場合には、1万という数値を返す必要があります。doAfterGetFromDBで集計処理などをすると、1万レコードを取得して、それが20個などになると思います。その場合は20個を返さないといけません。この場合、自分でメンバ変数（dataCount）を定義して、そこに値を残しておくのが分かりやすい方法でしょう。\n                class MyProgram implements \\INTERMediator\\DB\\Extending\\WithNavigation {\n    var $dataCount;\n    \n    function doAfterReadFromDB($result) {\n            :\n        $this-&gt;dataCount = count( $result );\n        $return result;\n    }\n    \n    function countQueryResult() {\n        return $this-&gt;dataCount;\n    }\n}\n\n                \n                アドバイザクラス内でさまざまな情報にアクセスする\n                アドバイザクラスで「\\INTERMediator\\DB\\UseSharedObjects」クラスの子クラスにした場合は、他のオブジェクトへの参照が得られます。メソッドが呼び出された段階で、メンバ変数はオブジェクトを参照した状態になります。\n                \n                    \\INTERMediator\\DB\\UseSharedObjectsを継承したときに利用できるメンバ変数\n                    \n                        \n                            メンバ変数\n                            参照するもの\n                        \n                        \n                            $this-&gt;dbClass\n                            データベースクラスのインスタンス\n                        \n                        \n                            $this-&gt;authDbClass\n                            認証情報に使用するデータベースクラスのインスタンス\n                        \n                        \n                            $this-&gt;dbSettings\n                            \\INTERMediator\\DB\\Settingsクラスのインスタンス\n                        \n                        \n                            $this-&gt;logger\n                            DB_Loggerクラスのインスタンス\n                        \n                        \n                            $this-&gt;authCommon\n                            DB_AuthCommonクラスのインスタンス\n                        \n                        \n                            $this-&gt;formatter\n                            DB_Formattersクラスのインスタンス\n                        \n                    \n                \n                アドバイザクラスのメソッドでのデータベース処理\n                メソッド内で新たなデータベース処理を記述したい場合は、DB\\Proxyクラスを新たに生成してメソッドを利用すれば可能です。どんなメソッドがあるかは以下の「サーバーサイドのプログラムで利用できるAPI」で説明しています。しかしながら、若干冗長だったので、Ver.8の途中でより簡単にデータベース処理が記述できるようなトレイトProxy_ExtSupportを定義しました。例えば、アドバイザクラスを次のように定義します。ポイントは、class内で「use Proxy_ExtSupport;」と記述するところです。これによりいくつかのメソッドが使えるようになります。\n\n                use \\INTERMediator\\DB\\UseSharedObjects;\nuse \\INTERMediator\\DB\\Extending\\AfterRead;\nuse \\INTERMediator\\DB\\Proxy_ExtSupport;\n\nclass Advisor extends UseSharedObjects implements AfterRead\n{\n  use Proxy_ExtSupport;\n\n  public function doAfterReadFromDB($result)\n  {\n    $this-&gt;setFixedKey(\"id\");\n    $result = $this-&gt;dbRead(\"authuser\",[\"username\" =&gt; \"admin\"]);\n    return $result;\n  }\n} \nProxy_ExtSupportトレイトを利用したクラスでは、以下のメソッドが利用できます。いずれも、そのクラスにメソッドが追加されるので、this-&gt;で呼び出すことができます。\n\n                this-&gt;dbInit($datasource = null, $options = null, $dbspec = null, $debug = null)\n                Proxyクラスのインスタンスの初期化を行う方法。4つの引数は、定義ファイルのIM_Entry関数の引数と同様。引数は省略もでき、さらにこのメソッドの呼出自体も省略可能。\n\n               this-&gt;setFixedKey($key = null)\n                キーフィールドは、既定の状態では、「テーブル名_id」というネーミングルールに従うが、直後のデータベース処理で、キーフィールドを決め打ちしたい場合に引数に指定してこのメソッドを呼び出す。なお、コンテキスト定義を行なって引数に指定する場合は、keyキーを使って主キーを指定するので、このAPIを必ずしも使う必要はない。\n\n                this-&gt;getExtProxy()\n                内部で使っているProxyクラスへの参照。トランザクションをスタートしたりロールバックしたりするときに、この返り値にbeginTransaction()やcommitTransaction(), rollbackTransaction()を適用することができる。\n\n              this-&gt;dbRead($target, $query = null, $sort = null, $spec = null)\n               this-&gt;dbUpdate($target, $query = null, $data = null, $spec = null)\n               this-&gt;dbCreate($target, $data = null, $spec = null)\n                 this-&gt;dbDelete($target, $query = null, $spec = null)\n               それぞれ名称通りのデータベース処理を行う。$specにはdbInitメソッドの$datasource引数に指定するコンテンツ定義の配列を指定できる。コンテンツ定義のどのコンテンツを利用するかは、$targetで指定する。$query引数は検索条件、$sort引数は並べ替えの条件、$dataは変更や追加するフィールドと値を示す。\n                \n                    コンテキストの指定のパターン\n                    \n                        \n                            パターン\n                            説明\n                        \n                        \n                            dbInit: なし$spec: なし\n                            $targetが文字列「product」なら、productテーブルに対して、キーフィールドproduct_idであることを前提にデータベース処理を行う。\n                        \n                        \n                            dbInit: $datasourceを指定$specなし\n                            $targetには、$datasourceに存在するコンテキスト定義の名前（nameキーの値）を指定して、そのコンテキスト定義に応じたデータベース処理を行う。コンテキスト定義は複数あっても構わないので、1つのdbInitで複数のデータベース処理を行うことも可能。\n                        \n                        \n                            dbInit: なし$spec: 指定\n                            $specには$datasourceと同じ形式の配列を指定する。そのメソッドを使うときにだけ、$specのコンテキスト定義が有効になる。もちろん、$targetは、$specに存在するコンテキスト定義の名前（nameキーの値）を指定する。$specがあれば、$dbInitの$datasourceの指定は無視する。\n                        \n                    \n                \n                \n                    データベース処理の引数\n                    \n                        \n                            引数\n                            説明\n                            指定例\n                        \n                        \n                            query\n                            検索条件の指定\n                            [[\"field\" =&gt; \"id\", \"operator\" =&gt; \"=\", \"value\" =&gt; $id],...]\n// 基本的にはコンテキスト定義のqueryキーの定義と同じルール\n[\"id\" =&gt; $id,...] // フィールド名をキーにするとoperatorは=固定'\n                        \n                        \n                            sort\n                            並べ替え条件の指定\n                            [[\"field\" =&gt; \"lastDT\", \"direction\" =&gt; \"desc\"],...]\n// 基本的にはコンテキスト定義のsoftキーの定義と同じルール\n[\"lastDT\" =&gt; \"desc\",...] // フィールド名をキーにもできる\n                        \n                        \n                            data\n                            初期値、更新値\n                            [[\"field\" =&gt; \"lastDT\", \"value\" =&gt; $nowDT],...]\n// 基本的にはコンテキスト定義のdefault-valuesキーの定義と同じルール\n[\"lastDT\" =&gt; $nowDT,...] // フィールド名をキーにもできる\n                        \n                    \n                \n           \n            \n                データベースクラスを自作する\n                データベースクラスを独自に作成する場合には、以下のようなPHPのクラスが基本となります。もちろん、データベースクラスを1から作れるのですが、たぶん、そういうニーズはまずないと思います。データベースをPDOで使うならINTER-Mediatorの\\INTERMediator\\DB\\PDO.php、FileMaer Serverを使うならDB_FileMaker_FX.phpを拡張したクラスを定義します。基底クラスの方のファイルも読み込みが必要です。以下の例は、INTER-Mediatorフォルダと同じフォルダに、このデータベースクラスのファイルがあるというわけです。自分が作るクラスでも、最初にDBをつけないといけません。IM_Entry関数の引数などでの設定は、この場合DB_をのぞいた「MyOriginalDB」を指定します。\n                class \\INTERMediator\\DB\\MyOriginalDB extends \\INTERMediator\\DB\\PDO.php {\n    public function readFromDB() {\n        /* ここにプログラムを追加できる */\n        $result = super::readFromDB();\n        /* ここにプログラムを追加できる */\n        $this-&gt;mainTableCount = count( $result ); //レコード数\n        return $result;\n    }\n\n    public function countQueryResult()  {\n        return super::countQueryResult();\n    }\n\n    public function getTotalCount()  {\n        return super::getTotalCount();\n    }\n\n    public function updateDB() {\n        /* ここにプログラムを追加できる */\n        $result = super::updateDB();\n        /* ここにプログラムを追加できる */\n        return $result;\n    }\n    \n    public function createInDB($bypassAuth) {\n        /* ここにプログラムを追加できる */\n        $lastKeyValue = super::createInDB($bypassAuth);\n        /* ここにプログラムを追加できる */\n        return $lastKeyValue;\n    }\n    \n    public function deleteFromDB() {\n        /* ここにプログラムを追加できる */\n         $result = super::deleteFromDB();\n        /* ここにプログラムを追加できる */\n        return $result;\n    }\n    public function copyInDB()  {\n         $result = super::copyInDB();\n        return $result;\n    }\n}\n                自分で作るクラスでは、要はCRUDに対応した4つのメソッドをオーバーライドすることによって、独自の仕組みを組み込むことができます。また、4つのうち、特にプログラムの追加がない場合には、定義する必要はありません。いずれの関数も、コンテキスト名を引数に取ります。そして、現在処理しているコンテキスト名が設定されてこれらのメソッドを呼び出します。\n                readFromDBメソッドは、データベースからデータを取り出します。取り出し結果は連想配列の配列です。連想配列のキーがフィールド名になっています。そこから、特定のフィールドの値を元に集計をしたり、あるいは必要な値だけに取り除くなどの処理を、親クラスのreadFromDBメソッドを呼び出す後に入れればいいでしょう。リクエスト時と同じフィールド名を返す必要はなく（つまりINTER-Mediatorはそのチェックをしていない）、自由に連想配列の配列を作ります。そして、ページファイルの方で適切なフィールド名を指定すれば、集計結果が表示されます。なお、ページファイルで、一定レコード数ごとのページングをしているときには、mainTableCountメンバ変数にレコード数、つまり返す配列の要素数も指定します。何か問題が発生したのなら、array()を返します。以下のプログラムは売り上げのテーブルから集計を行う例です。\n                $result = super::readFromDB();\n$summary = array();\nforeach( $returnValue as $record ) {\n    $summary[ $record[ 'itemNo' ]] += $record[ 'qty' ] * $record[ 'unitPrice' ];\n    }\nreturn array( $summary );\n\n                \n                updateDBとdeleteFromDBメソッドは、いずれも値の更新や削除のときに呼び出されるメソッドです。返り値は論理値で、処理が成功すればtrueで失敗ならfalseです。createInDBは新規レコードの作成です。メソッドの返り値は、新たに作ったレコードのキーフィールドの値である必要があります。問題があれば返り値をfalseにします。\n            \n            \n                サーバーサイドのプログラムで利用できるAPI\n                以下、\\INTERMediator\\DB\\Proxyは\\INTERMediator\\DB\\Proxyクラスのオブジェクトへの参照を意味します。\n                \\INTERMediator\\DB\\Proxy-&gt;initialize($datasource, $options, $dbspec, $debug, $target = null)\n                \\INTERMediator\\DB\\Proxyクラスを初期化する。返り値はなし。生成した\\INTERMediator\\DB\\Proxyクラスのオブジェクトに対して適用することで、さまざまな設定が反映されたオブジェクト群を形成する。\n                \n                    initializeメソッドの引数\n                    \n                        \n                            引数\n                            指定する内容\n                        \n                        \n                            $datasource\n                            IM_Entry関数の第1引数と同様に、連想配列で表現されたコンテキストの配列。\n                        \n                        \n                            $options\n                            IM_Entry関数の第2引数と同様、さまざまな設定を含む連想配列。\n                        \n                        \n                            $dbspec\n                            IM_Entry関数の第3引数と同様、データベース接続に関する連想配列。\n                        \n                        \n                            $debug\n                            IM_Entry関数の第4引数と同様、falseならデバッグ出力なし、1ないしは2なら出力あり。\n                        \n                        \n                            $target\n                            コンテキストのnameキーの値のひとつを文字列で指定する。省略することも可能。\n                        \n                    \n                \n                \\INTERMediator\\DB\\Proxy-&gt;processingRequest($access, $bypassAuth)\n                初期化した\\INTERMediator\\DB\\Proxyクラスのオブジェクトに対して処理を行う。返り値はない。引数$bypassAuthは、認証やアクセス権設定を無視するが、この指定は慎重に行う必要がある。既定値はfalse。引数$accessに、行うデータベース処理を示す文字列を指定する。nullを指定したときや省略したときにはPOST時のパラメーターの\"access\"キーの値を使用する。$accessに指定できる値と動作は次の通り：'create'（レコードの作成）、'read'（データベースへのクエリー）、'update'（レコードの更新）、'delete'（レコードの削除）、'copy'（レコードの複製）、'challenge'（チャレンジの生成＝原則として何もしない）、'changepassword'（パスワード変更）、'unregister'（Pusherによるクライアント同期の登録解除）、'describe'（スキーマ情報を得る）。他に'select' 'new'が過去の互換性のために利用可能となっている。それ以外の文字列の場合は、特に何もしない。\n                \\INTERMediator\\DB\\Proxy-&gt;ignoringPost()\n                initializeメソッドではPOSTされたデータを取り込むが、その結果、処理拡張クラス内で新たに\\INTERMediator\\DB\\Proxyクラスを生成してコンテキストを別途用意したとき、POSTデータの取り込みをしたくない場合も発生する。そのときにこのメソッドをinitializeメソッドよりも前に呼び出す。\n                \\INTERMediator\\DB\\Proxy-&gt;getDatabaseResult()\n                データベースからの検索結果などで、1レコードが連想配列として表現され、その連想配列がレコード数分ある配列が返される。利用可能なprocessingRequestメソッドの最初の引数は、create（作成されたレコード）、read（検索結果）、update（更新後のレコード）、copy（複製後のレコード）、describe（スキーマ情報）。なお、レコード作成時にこの値が空の場合がまれにあるようです。PDOのlastInsertIdメソッドを使って新たに作成したレコードのキーフィールドの値を取得していますが、何らかの原因でそれが取得されず0が返され、作成したレコードの取得ができないのが原因です。解決策として、PHPのインストールをしなおしたら直ったなどが記載されていますが、決定的な方法はないようです。\n                \\INTERMediator\\DB\\Proxy-&gt;getDatabaseResultCount()\n                processingRequestメソッドの最初の引数がreadの場合、検索結果に含まれるレコード数を返す。コンテキストのrecordsキーが上限値となるが、実際に検索されたレコード数はそれより少ない場合もある。\n                \\INTERMediator\\DB\\Proxy-&gt;getDatabaseTotalCount()\n                processingRequestメソッドの最初の引数がreadの場合、検索条件に合致したレコード数を返す。\n                \\INTERMediator\\DB\\Proxy-&gt;getDatabaseNewRecordKey()\n                processingRequestメソッドの最初の引数がcreateあるいはcopyの場合、新たに作成されたレコードの主キーの値を返す。\n                \\INTERMediator\\DB\\Proxy-&gt;finishCommunication($notFinish)\n                出力するためのさまざまな準備を行う。\n                \\INTERMediator\\DB\\Proxy-&gt;exportOutputDataAsJSON()\n                JSON形式のテキストで各種データを出力する。\n                DB_Logger-&gt;setDebugMessage($str, $level)\n                引数$strに指定した文字列を、引数$levelに指定したレベルでのデバッグメッセージとして記録する。レベルは1ないしは2のみをサポートし、引数$levelを省略すると1になる。\n                DB_Logger-&gt;setErrorMessage($str)\n                引数$strに指定した文字列を、エラーメッセージとして記録する。\n                DB_Logger-&gt;setWarningMessage($str)\n                引数$strに指定した文字列を、警告メッセージとして記録する。\n                DB_Logger-&gt;getDebugMessages()\n                記録されたデバッグメッセージを要素として含む配列を返す。\n                DB_Logger-&gt;getErrorMessages()\n                記録されたエラーメッセージを要素として含む配列を返す。\n                DB_Logger-&gt;getWarningMessages()\n                記録された警告メッセージを要素として含む配列を返す。\n                \\INTERMediator\\DB\\Settings-&gt;setDataSourceName($dataSourceName)\n                引数に指定した文字列をnameキーの値として持つコンテキストを選択する。\n                \\INTERMediator\\DB\\Settings-&gt;getDataSourceName()\n                現在、選択されているコンテキストのnameキーに対する値。\n                \\INTERMediator\\DB\\Settings-&gt;getDataSourceTargetArray()\n                現在、選択されているコンテキストの定義内容を連想配列で返す。\n                \\INTERMediator\\DB\\Settings-&gt;getDataSourceDefinition($dataSourceName)\n                引数に指定した文字列をnameキーの値として持つコンテキスト定義の連想配列を返す。\n                \\INTERMediator\\DB\\Settings-&gt;getEntityForRetrieve()\n                クエリー処理に利用するエンティティ名を返す。つまり、viewキーの値が指定されていればその値、指定されていない場合にはnameキーの値が返される。\n                \\INTERMediator\\DB\\Settings-&gt;getEntityForUpdate()\n                更新処理に利用するエンティティ名を返す。つまり、tableキーの値が指定されていればその値、指定されていない場合にはnameキーの値が返される。\n                \\INTERMediator\\DB\\Settings-&gt;setStart($st)\n                検索結果の最初のいくつ目から結果として取り出すかを、引数の数値で指定する。クライアントのINTERMediator.startFromの値が自動的に設定される。\n                \\INTERMediator\\DB\\Settings-&gt;getStart()\n                検索結果の最初のいくつ目から結果として取り出すかが得られる。\n                \\INTERMediator\\DB\\Settings-&gt;setRecordCount($sk)\n                検索結果の中から、最大でいくつのレコードを取り出すかを引数の数値で指定する。コンテキストのrecordsキーの値や、クライアントINTERMediator.pageSizeの値など、すでに決まっている値が指定される。\n                \\INTERMediator\\DB\\Settings-&gt;getRecordCount()\n                検索結果の中から、最大でいくつのレコードを取り出すかが得られる。\n                \\INTERMediator\\DB\\Settings-&gt;getAggregationSelect()\n\\INTERMediator\\DB\\Settings-&gt;setAggregationSelect($value)\n                選択されているコンテキストに指定したaggregation-selectキーの設定と取得\n                \\INTERMediator\\DB\\Settings-&gt;getAggregationFrom()\n\\INTERMediator\\DB\\Settings-&gt;setAggregationFrom($value)\n                選択されているコンテキストに指定したaggregation-fromキーの設定と取得\n                \\INTERMediator\\DB\\Settings-&gt;getAggregationGroupBy()\n\\INTERMediator\\DB\\Settings-&gt;setAggregationGroupBy($value)\n                選択されているコンテキストに指定したaggregation-group-byキーの設定と取得\n                \\INTERMediator\\DB\\Settings-&gt;setDataSource($src)\n                引数には定義ファイルのIM_Entry関数の第1引数の値を指定して、コンテキスト定義の配列をオブジェクトに記録する。\n                \\INTERMediator\\DB\\Settings-&gt;getDataSource()\n                定義ファイルのIM_Entry関数の第1引数の値が返される。\n                \\INTERMediator\\DB\\Settings-&gt;setOptions($src)\n                引数には定義ファイルのIM_Entry関数の第2引数の値を指定して、オプション指定の配列をオブジェクトに記録する。\n                \\INTERMediator\\DB\\Settings-&gt;getOptions()\n                定義ファイルのIM_Entry関数の第2引数の値が返される。\n                \\INTERMediator\\DB\\Settings-&gt;setDbSpec($src)\n                引数には定義ファイルのIM_Entry関数の第3引数の値を指定して、データベース設定の配列をオブジェクトに記録する。\n                \\INTERMediator\\DB\\Settings-&gt;getDbSpec()\n                定義ファイルのIM_Entry関数の第3引数の値が返される。\n                \\INTERMediator\\DB\\Settings-&gt;setFieldsRequired($fieldsRequired)\n                フィールドの配列として、引数の配列を設定する。このメソッドは、配列そのものを設定するが、addValueWithField、addTargetFieldメソッドにより、フィールド一覧を管理する配列へ要素が追加される。\n                \\INTERMediator\\DB\\Settings-&gt;getFieldsRequired()\n                フィールドの配列を返す。\n                \\INTERMediator\\DB\\Settings-&gt;addTargetField($field)\n                フィールドの配列の要素として、引数に指定した文字列を追加する。\n                \\INTERMediator\\DB\\Settings-&gt;getFieldOfIndex($ix)\n                フィールドの配列から、引数に指定した番号の要素を返す。\n                \\INTERMediator\\DB\\Settings-&gt;setValue($values)\n                値の配列として、引数の配列を設定する。\n                \\INTERMediator\\DB\\Settings-&gt;getValue()\n                値の配列を返す。\n                \\INTERMediator\\DB\\Settings-&gt;addValue($value)\n                値の配列の要素として、引数に指定した文字列を追加する。\n                \\INTERMediator\\DB\\Settings-&gt;addValueWithField($field, $value)\n                フィールドの配列および値の配列の要素として、引数に指定した文字列をそれぞれ追加する。\n                \\INTERMediator\\DB\\Settings-&gt;getValuesWithFields()\n                フィールドの配列にある値をキー、そのキーに対する値を要素にした連想配列を返す。\n                \\INTERMediator\\DB\\Settings-&gt;getValueOfField($targetField)\n                引数に指定したフィールド名をフィールドの配列の何番目なのかを判別し、値の配列の同じ番号の要素を返す。つまり、フィールド名に対応した値を返す。\n                \\INTERMediator\\DB\\Settings-&gt;setForeignFieldAndValue($foreignFieldAndValue)\n                引数を外部キーの値を保持する配列に指定する。引数は、field、valueをキーとした連想配列の配列である必要がある。\n                \\INTERMediator\\DB\\Settings-&gt;getForeignFieldAndValue()\n                外部キーの値を保持する配列を返す。返される値は、field、valueをキーとした連想配列の配列。\n                \\INTERMediator\\DB\\Settings-&gt;addForeignValue($field, $value)\n                引数に指定したフィールド名と値を、外部キーの値を保持する配列に追加する。\n                \\INTERMediator\\DB\\Settings-&gt;getForeignKeysValue($targetField)\n                外部キーの値を保持する配列から、引数に指定したフィールドに対する値を返す。ない場合はnullが返る。\n                \\INTERMediator\\DB\\Settings-&gt;addExtraCriteria($field, $operator, $value)\n                追加的な検索条件を保持する配列に、引数の3つの要素を持つ連想配列として追加する。\n                \\INTERMediator\\DB\\Settings-&gt;getExtraCriteria()\n                追加的な検索条件を保持する配列を返す。\n                \\INTERMediator\\DB\\Settings-&gt;unsetExtraCriteria($index)\n                追加的な検索条件を保持する配列の中にある引数に指定したインデックスの要素を削除する。\n                \\INTERMediator\\DB\\Settings-&gt;getCriteriaValue($targetField)\n                追加的な検索条件を保持する配列から、引数に指定した文字列をfieldキーの値として持つ最初の要素を特定し、その要素のvalueキーの値を返す。\n                \\INTERMediator\\DB\\Settings-&gt;getCriteriaOperator($targetField)\n                追加的な検索条件を保持する配列から、引数に指定した文字列をfieldキーの値として持つ最初の要素を特定し、その要素のoperatorキーの値を返す。\n                \\INTERMediator\\DB\\Settings-&gt;setGlobalInContext($contextName, $operation, $field, $value)\n                引数に指定したコンテキストに、残りの引数で指定した設定内容を持つglobalキーの連想配列を追加する。もちろん、FileMaker Serverのみで意味のある機能である。\n                \\INTERMediator\\DB\\Settings-&gt;setPrimaryKeyOnly($primaryKeyOnly)\n\\INTERMediator\\DB\\Settings-&gt;getPrimaryKeyOnly()\n                検索条件の中から、主キー（コンテキストのkeyキー）で指定されたものだけを利用する設定とその状態の取得。なお、主キーのみを利用する検索は、データベースの更新前に楽観的ロックの仕組みを利用して、現在の値を取り出す場合に利用している。\n                \\INTERMediator\\DB\\Settings-&gt;addExtraSortKey($field, $direction)\n                追加のソート条件を記録した配列に、引数にしていたフィールドと基準（昇順ないしは降順）を追加する。\n                \\INTERMediator\\DB\\Settings-&gt;getExtraSortKey()\n                追加のソート条件を記録した配列を得る。\n                \\INTERMediator\\DB\\Settings-&gt;addAssociated($name, $field, $value)\n                レコードのコピーにおいて、関連するコンテキストに対する設定を追加する。\n                \\INTERMediator\\DB\\Settings-&gt;getAssociated()\n                レコードのコピーにおいて使用される関連するコンテキストに対する配列を得る。\n                \\INTERMediator\\DB\\Settings-&gt;setDbSpecServer($str)\n\\INTERMediator\\DB\\Settings-&gt;getDbSpecServer()\n\\INTERMediator\\DB\\Settings-&gt;setDbSpecPort($str)\n\\INTERMediator\\DB\\Settings-&gt;getDbSpecPort()\n\\INTERMediator\\DB\\Settings-&gt;setDbSpecUser($str)\n\\INTERMediator\\DB\\Settings-&gt;getDbSpecUser()\n\\INTERMediator\\DB\\Settings-&gt;setDbSpecPassword($str)\n\\INTERMediator\\DB\\Settings-&gt;getDbSpecPassword()\n\\INTERMediator\\DB\\Settings-&gt;setDbSpecDataType($str)\n\\INTERMediator\\DB\\Settings-&gt;getDbSpecDataType()\n\\INTERMediator\\DB\\Settings-&gt;setDbSpecDatabase($str)\n\\INTERMediator\\DB\\Settings-&gt;getDbSpecDatabase()\n\\INTERMediator\\DB\\Settings-&gt;setDbSpecProtocol($str)\n\\INTERMediator\\DB\\Settings-&gt;getDbSpecProtocol()\n\\INTERMediator\\DB\\Settings-&gt;setDbSpecDSN($str)\n\\INTERMediator\\DB\\Settings-&gt;getDbSpecDSN()\n\\INTERMediator\\DB\\Settings-&gt;setDbSpecOption($str)\n\\INTERMediator\\DB\\Settings-&gt;getDbSpecOption()\n                データベース処理に関する設定を行ったり取り出したりするメソッド。\n                \\INTERMediator\\DB\\Settings-&gt;setCurrentUser($str)\n\\INTERMediator\\DB\\Settings-&gt;getCurrentUser()\n                クライアントから申告されたユーザー名の設定及び取得と行うメソッド。\n                \\INTERMediator\\DB\\Settings-&gt;setUserAndPasswordForAccess($user, $pass)\n\\INTERMediator\\DB\\Settings-&gt;getAccessUser()\n\\INTERMediator\\DB\\Settings-&gt;getAccessPassword()\n                クライアントから申告されたユーザー名とパスワードの設定及び取得と行うメソッド。ネイティブ認証時にチャレンジに対応するレスポンスによって返されたユーザー名とパスワードが設定され、それ以外の時には設定されない。\n                \\INTERMediator\\DB\\Settings-&gt;setAuthentication($authentication)\n\\INTERMediator\\DB\\Settings-&gt;getAuthentication()\n                IM_Entry関数の第2引数（オプション設定）の、authenticationキーに対する値を記録あるいは取り出す。\n                \\INTERMediator\\DB\\Settings-&gt;getAuthenticationItem($key)\n                IM_Entry関数の第2引数（オプション設定）のauthenticationキーに対する値に対し、さらに引数の文字列のキーの値を取り出す。もし、引数に与えたキーに対する値が定義されていない場合で、引数がテーブル名の場合には、規定のテーブル名を返す。あるいは認証継続時間の場合には既定値として8時間が返される。\n                \\INTERMediator\\DB\\Settings-&gt;getUserTable()\n                認証に使用するテーブル名を返す。定義ファイル等で未設定の場合には既定値のauthuserが返される。\n                \\INTERMediator\\DB\\Settings-&gt;getGroupTable()\n                グループ管理に使用するテーブル名を返す。定義ファイル等で未設定の場合には既定値のauthgroupが返される。\n                \\INTERMediator\\DB\\Settings-&gt;getCorrTable()\n                グループ所属記録に使用するテーブル名を返す。定義ファイル等で未設定の場合には既定値のauthcorrが返される。\n                \\INTERMediator\\DB\\Settings-&gt;getHashTable()\n                認証でのチャレンジ等を記録するためのテーブル名を返す。定義ファイル等で未設定の場合には既定値のissuedhashが返される。\n                \\INTERMediator\\DB\\Settings-&gt;getExpiringSeconds()\n                認証結果を保持する時間を返す。定義ファイル等で未設定の場合には既定値の8時間が返される。\n                \\INTERMediator\\DB\\Settings-&gt;setRequireAuthentication($requireAuthentication)\n\\INTERMediator\\DB\\Settings-&gt;getRequireAuthentication()\n                ゲッターは、定義ファイルの内容から、認証が必要かどうかを求めた結果を返す。セッターはprocessingRequestメソッド内で判定結果を記録するために利用される。\n                \\INTERMediator\\DB\\Settings-&gt;setRequireAuthorization($requireAuthorization)\n\\INTERMediator\\DB\\Settings-&gt;getRequireAuthorization()\n                ゲッターは、定義ファイルの内容から、アクセス権の判定が必要かどうかを求めた結果を返す。セッターはprocessingRequestメソッド内で判定結果を記録するために利用される。\n                \\INTERMediator\\DB\\Settings-&gt;setDBNative($isDBNative)\n\\INTERMediator\\DB\\Settings-&gt;isDBNative()\n                ゲッターは、定義ファイルの内容から、ネイティブ認証を行うかどうかを求めた結果を返す。セッターはprocessingRequestメソッド内で判定結果を記録するために利用される。\n                \\INTERMediator\\DB\\Settings-&gt;setEmailAsAccount($emailAsAccount)\n\\INTERMediator\\DB\\Settings-&gt;getEmailAsAccount()\n                ゲッターは、定義ファイルの内容から、電子メールを認証時のユーザー名として使用できるかどうかを返す。セッターはprocessingRequestメソッド内で設定を記録するために利用される。\n                \\INTERMediator\\DB\\Settings-&gt;getLDAPSettings()\n                params.phpファイルで定義されたLDAPの設定値を持つ配列を返す。要素は順番に、サーバー名、ポート番号、検索ベース、コンテナ名、ユーザー名のキー名。\n                \\INTERMediator\\DB\\Settings-&gt;setLDAPExpiringSeconds($sec)\n\\INTERMediator\\DB\\Settings-&gt;getLDAPExpiringSeconds()\n                ゲッターは、params.phpファイルの内容から得られたLDAP認証の継続時間を返す。セッターは設定を記録するために利用される。\n                \\INTERMediator\\DB\\Settings-&gt;setSeparator($sep)\n\\INTERMediator\\DB\\Settings-&gt;getSeparator()\n                ターゲット指定の区切り文字（通常は「@」）を記録したり取得するメソッド。設定しない場合には、＠が返される。\n                \\INTERMediator\\DB\\Settings-&gt;setSmtpConfiguration($config)\n\\INTERMediator\\DB\\Settings-&gt;getSmtpConfiguration()\n                IM_Entry関数の第2引数（オプション設定）の、smtpキーに対する値を記録あるいは取り出す。\n            \n        "
    },
    {
        "id": 31,
        "parent": "/ja/for-programmers/",
        "path": "/ja/for-programmers/commitcode.html",
        "title": "ソースコードの投稿",
        "breadcrumb": "ソースコードの投稿",
        "body": "\n            \n                はじめに\n                \n                    INTER-Mediatorへのソースコードを投稿する場合の手順をまとめておきます。INTER-Mediatorのコミッターや、あるいはバグレポートの1つの方法として、ソースコードの投稿を歓迎します。手順は、Webサイトを利用した、いちばん手軽な方法が中心です。\n            \n            \n                ソースコード投稿の考え方\n                INTER-Mediatorはオープンソースプロジェクトであり、コミュニティを形成することで、開発が進行する手法を取り入れています。多くの方々によってソースコードがレビューされることで、システム全体が洗練され、セキュリティ的な問題点が解消されることが期待できます。また、新たな機能やバグ修正等のソースコードの投稿を受け付けることで、システムの継続的な進化も期待できます。そのために、INTER-Mediatorでは、GitHubを利用した「Pull Request」によるソースコードの投稿を広く受け付けることとします。\n            \n            \n                GitHubの組織「INTER-Mediator」\n                INTER-Mediatorは、GitHub上に「INTER-Mediator」という名称の組織を作成しており、そこにあるレポジトリが「マスターレポジトリ」となります。コミッターの開発結果はこのマスターレポジトリにまとめられますが、まとめる作業は、INTER-Mediator Directive Committeeのメンバーによって行われます。レポジトリの1つ「INTER-Mediator」は、フレームワーク本体やサンプルプログラムなどのソフトウエア全般がまとめられています。「INTER-Mediator_WebSite」は、INTER-MediatorのWebサイトのソースです。「INTER-Mediator」はForkをしてPull Requestを送る手法を基本とします。「INTER-Mediator_WebSite」はINTER-Mediator Directive Committeeメンバによる書き込み権限を与えることで、Forkをしないで単一のレポジトリでの運用を基本とします。したがって、本文書に書かれた内容は、フレームワーク本体の「INTER-Mediator/INTER-Mediator」というレポジトリの運用方法を記載したものとなります。\n                \n                \n                \n            \n            \n                GitHubアプリケーションを使ったPull Request\n                GitHubはバージョン管理システムのgitをベースにしており、すべてはgitのコマンドでできると言えますが、コマンドでの処理は習得に時間がかかると同時に失敗しやすいということもあります。しかしながら、GitHubは専用アプリケーションをリリースしており、そのアプリケーションを利用することで、ソースコードの投稿を簡単にできるようになっています。ここでは、なるべくGitHubアプリケーションと、GitHubのサイトを利用するということで、ソースコードを取得し、修正後に投稿する流れを説明します。\n                組織で管理しているマスターレポジトリは「INTER-Mediator/INTER-Mediator」と記載します。Gitの表記にしたがって「組織名/レポジトリ名」でレポジトリを記述することにします。ここで、GitHubのあるユーザmsykが、INTER-Mediator本体のレポジトリに対して、ソースコードの追加等を行い、その開発結果を投稿しようとします。\n                ソースコードの取得を最初に行いますが、その作業を「マスターレポジトリをForkする」などと呼ばれます。Forkにより、レポジトリの複製を自分自身のアカウントの領域に作成をします。マスターレポジトリへの書き込み権限を持つ人は限られていますが、パブリックなプロジェクトなので、逆にソースコードは誰でも取得できます。したがって、GitHubにアカウントがあれば、誰でもForkができることになります。GitHubにユーザmsykでログインをして作成した、ユーザmsykのINTER-Mediatorフレームワーク本体は、「msyk/INTER-Mediator」と記述をします。さらに、現実には、自分のアカウントにあるリモートのレポジトリのクローンを作業者のMac/PCの中にローカルのレポジトリとして作成をします。ソースコードの改変をする前に、まず、ここまでの準備が必要です。概念図は以下のとおりで、左側のマスターレポジトリをForkして、あるユーザのリモートレポジトリを作成し、そのクローンのレポジトリがローカルにあるという状態です。ここで、masterはブランチ名で、「A」はある状態を示します。この後に、ローカルのレポジトリのソースコードを変更した結果、状態が「B」になるというような図が出てきます。\n                \n                \n                Forkする\n                Forkをするには、GitHubに自分のアカウント（この場合はmsyk）でログインをします。そして、組織のページに移動して、マスタレポジトリのトップページを表示します。組織のマスターレポジトリは、レポジトリ名が「INTER-Mediator/INTER-Mediator」となっていることから、判別できます。そして、右上にある「Fork」のボタンをクリックします。これだけで、自分の領域にマスターレポジトリの複製のレポジトリが作成されます。なお、単に複製するだけでなく、マスターレポジトリが元々のオリジナルであることもきちんと記録されています。\n                \n                \n                \n                    「Fork」ボタンをクリックした後、画面が遷移して、自分自身の複製したレポジトリのページに移動しています。レポジトリ名が「msyk/INTER-Mediator」となっていて、ユーザmsykにINTER-Mediatorというレポジトリが作られたことがわかります。この段階では、マスターと同一のレポジトリです。\n                \n                \n                ローカルにクローンを作成する\n                さらに自分のレポジトリのクローンを自分のMac/PCに作成します。ここで、クローンはコマンドラインで作る方法などいろいろありますが、使用しているパソコンにGitHubアプリケーションをインストールしておけば、レポジトリのページの「Clone in Desktop」のボタンをクリックし、そしてローカルレポジトリを作るフォルダを指定するだけで、作成することができます。\n                \n                \n                コマンドラインで作るときには、ローカルレポジトリを作りたいフォルダをカレントフォルダにして、「git clone [レポジトリのURL]」と入力します。レポジトリのURLは、やはりレポジトリのページ右側にある「HTTPS clone URL」の部分のURLを指定しますが、コピーボタンがあるので、URLをコピーし、コマンドライン入力中にペースとすれば良いでしょう。\n                変更結果をPull Requestする\n                自分のローカルのレポジトリ内で、ファイルを修正したとします。その修正処理はmasterでもいいですが、独自に作成したブランチでもかまいません。以下の図では、「readme-file-modify」というローカルのブランチに、変更結果が存在する状態です。そして、GitHubアプリケーションで、ツールバーの右から2つ目のボタンをクリックすることで、Pull Requestを作成します。パネルをクリックすると、右側に「Pull Request」の薄青い背景のパネルが表示されます。ここで、最初のテキストボックスに概要、そして、広いテキストフィールドにはある程度の説明を入力します。\n                \n                \n                タイトルの直下の部分で、マージを希望する先のマスターレポジトリのブランチを指定してください。右側はローカルで現在選択されているブランチができていて、ここは変更できません。右側はクリックするとドロップダウンリストが表示され、レポジトリを選択できます。ローカルと同じ名前のブランチの場合で、マスターリポジトリにブランチがない場合、そのブランチはマスターレポジトリに作られます。「Send Pull Request」ボタンをクリックします。このPull Requestは、Forkしたレポジトリの元のレポジトリに送り届けられます。\n                \n                \n                リクエストでは、取り込み先のブランチを選択できます。通常、最終的に変更結果はmasterに統合されるので、完成した機能やあるいはバグの修正となると、masterに統合することでかまいません。一方、機能そのものが一部しか実現していないものの、その結果を他のデベロッパーにも見てもらいたいといった理由があれば、ブランチにPull Requestを送ってください。その後の統合作業については、ディスカッションの上進めましょう。\n                Pull Requestが終了するとメッセージが表示され、GitHubのサイトへのリンクも見えています。ここでは#220という番号も見えています。GitHubアプリケーションを使えば、Pull Requestはこのように簡単に作成できます。\n                \n                \n            \n            \n                マスターレポジトリの更新結果の取り込み\n                Pull Requestによって、複数の開発者からのPull Requestが行われると、当然のこととしてマスターレポジトリはどんどん更新され、それぞれのユーザのレポジトリは以前の状態のままになります。Pull Requestを出したユーザは、自分と同じ状態にマスターレポジトリが更新されたので、同一の状態になっています。しかしながら、別のアカウント（以下の図にあるsomeone）が、msykによるPull Requestを発行する前にForkして、自分アカウントにレジストリーを作っていたとしたら、組織のアカウントは状態Bになっても、someoneの方は状態Aのままになります。someoneのレポジトリは状態Bにしたいと考えます。\n                    \n                    \n                    一時期はGitHubアプリケーションの右上にある「Sync」ボタンをクリックするだけで、自分のローカルのレポジトリを、Forkした元のマスターレポジトリと同じ状態にできましたが、これは「バグ」だったようで、その後にこの作業は自動的にできなくなっています。Syncは、ローカルとその元になっているレポジトリの間だけの同期です。\n                    Forkした元のレポジトリの更新結果を受け入れるには、以下のようにコマンドラインで作業をします。コマンドは、カレントディレクトリが、ローカルレポジトリのフォルダのルートになっている状態で入力します。最初のgit remote -vを見ると、自分自身のGitHub上のレポジトリに対してorignという名前が付けられ、加えて、Fork元のレポジトリは、「INTER-Mediator」という名前が付けられています。よくある作業例ではupstremという名前付けが一般的ですが、この「INTER-Mediator」は、GitHubアプリケーションが自動的に定義を加えています。そして、fetchでFork元のレポジトリを取り込んで、現在のブランチ（ここでは、ローカルレポジトリのmasterが選択されているとする）に、Fork元のレポジトリのmasterブランチの更新結果をマージします。\n                    \n    \n-->\n                    $ git remote -v\nINTER-Mediator  https://github.com/INTER-Mediator/INTER-Mediator.git (fetch)\nINTER-Mediator  https://github.com/INTER-Mediator/INTER-Mediator.git (push)\norigin  https://github.com/msyk/INTER-Mediator.git (fetch)\norigin  https://github.com/msyk/INTER-Mediator.git (push)\n$ git fetch INTER-Mediator\n$ git merge INTER-Mediator/master\nUpdating 757ee4a..e41aabd\nFast-forward\n INTER-Mediator-UnitTest/sha1-test.js |  10 +++++\n LICENSE                              |   4 ++\n dist-docs/License.txt                |  29 ++++++++++++++\n dist-docs/buildup.sh                 |   2 +-\n dist-docs/change_log.txt             |   2 +\n dist-docs/readme.txt                 |   4 +-\n dist-docs/vm-for-trial/index.html    |   8 ++--\n lib/js_lib/sha1.js                   | 185 ----------------------------------------------------------------------------------------\n lib/js_lib/tinySHA1.js               |   1 +\n 9 files changed, 53 insertions(+), 192 deletions(-)\n create mode 100644 INTER-Mediator-UnitTest/sha1-test.js\n create mode 100644 LICENSE\n delete mode 100644 lib/js_lib/sha1.js\n create mode 100644 lib/js_lib/tinySHA1.js\n                    \n            \n            \n                GitHubのWebサイトからPull Requestを送る\n                ここまでにGitHubアプリケーションを使用した方法で、投稿から更新結果の受け取りまでを説明しました。ここからは、これらの作業をGitHubアプリケーションを使わないで行う方法を説明します。\n                変更結果を自分のレポジトリにpush\n                Pull RequestをGitHubアプリケーションを使わないで行うには、まず、変更結果を、自分のレポジトリに反映させます。\n                \n                \n                ローカルのレポジトリであらたなブランチを作ったり、あるいはマスターレポジトリにすでにブランチがある場合には、そのブランチを現在利用するブランチとしてプログラムの追加や変更を行います。ブランチの切り替えは、GitHubアプリケーションのツールバーでBranchesのボタンをクリックし、ブランチの一覧にある右端の▼をクリックして、「Switch to This Branch」を選択します。プログラムの変更を行った後は、GitHubアプリケーションのツールバーでChangesを選択し、CommitとSyncを行います。Syncにより現在のブランチへのpushも行います。\n                ローカルのレポジトリではmasterブランチのまま作業をして、それを自分のリモートレポジトリにpushするときに、新たなブランチを作成するの良いでしょう。たとえば、PHPStormで作業をしているのであれば、ブランチに含めたいファイルを選択したり、あるいはルートのフォルダを選択するなどして、VCSメニューからCommit Changesを選択します。するとコミットされるファイルの一覧と、コミットメッセージが見えるダイアログボックスが表示されます。メッセージを書き込んだ上で、Commitボタンにマウスポインタを移動させるとポップアップメニューが出るので「Commit and Push」を選択します。すると、さらにGit Pushと書かれたダイアログボックスが表示されるので、その下の部分のチェックボックスをオンにして、右側のテキストフィールドに、新たなブランチ名をキータイプします。すると、コミット結果が新たなブランチにpushされ、リモートレポジトリにここで入力した名前のブランチが作成されています。\n                \n                \n                \n                \n                Pull Requestの作成\n                ここまでの作業で、変更結果は、自分のリモートレポジトリ側には反映されていますが、これをマスターに反映するためには、Pull Requestをマスターレポジトリに対して要求します。以下の図では、new-funcというブランチに、改変結果が記録されているので、そのブランチをマスターレポジトリへ取り込んでもらうということを示しています。\n                \n                \n                ここまでの作業で改変した結果は自分自身のリモートレポジトリにあります。自分のアカウントでログインをして、自分のリモートレポジトリのページを開きます。ここで、ファイルリストの上の部分に、薄い黄色の枠で、Your recently pushed branches:という記述があれば、そこにある「Compare &amp; pull request」ボタンをクリックします。もし、出ていないようであれば、ファイルリストの上部の「branch: master」などと書かれいる部分からブランチを選択して、その左の緑色のボタンをクリックして、移動したページで「Create Pull Request」ボタンをクリックします。\n                \n                \n                Pull Requestを作成するページになります。ここで、追加した機能の概要などを記載して「Create pull request」ボタンをクリックします。作業はこれだけです。このユーザ側のレポジトリは、マスターリポジトリからForkしたものなので、このPull Requestは、マスターレポジトリ側に送られます。\n                \n                \n            \n            \n                Pull Requestの受け入れ\n                マスターレポジトリ側での受け入れ作業は、INTER-Mediator Directive Committeeで行います。Pull Requestがあれば、それをいったんマスターレポジトリにpullします。その段階では、リクエストを送ったのと同じブランチ名のものがマスターレポジトリにできあがります。そして、動作の検証やコードのレビューを行います。masterではないブランチでPull Requstがあったものは、masterへマージします。この場合、マスターレポジトリでPull Requestを行い、それを受け入れればmasterに反映されるということになります。\n                \n                \n                \n                \n                受け付けられたPull Requestはマスターレポジトリ側はでは次のように見えます。\n                \n                \n            \n            \n                マスターレポジトリからの部分的な受け入れ\n                GitHubアプリケーションを使えばSyncによりマスターレジストリの内容を即座にローカルに取り込むことができます。その作業をコマンドだけで行う方法を、以下に記述します。ローカルレポジトリをマスターとは異なる状態で保持する必要がある場合などには、この方法を応用して、必要な更新だけを取り込むようにします。以下、青色で太字が入力するコマンドで、#で始まるグレーの文字は説明です。\n                # Forkした自分のレポジトリをローカル側にクローンを作る（すでに作成済みなら不要）\n$ git clone https://github.com/msayukinii/INTER-Mediator.git\nCloning into 'INTER-Mediator'...\nremote: Counting objects: 7408, done.\nremote: Compressing objects: 100% (2387/2387), done.\nremote: Total 7408 (delta 4983), reused 7408 (delta 4983)\nReceiving objects: 100% (7408/7408), 8.04 MiB | 1.71 MiB/s, done.\nResolving deltas: 100% (4983/4983), done.\nChecking connectivity... done.\n# ローカルレポジトリのルートをカレントディレクトリにする\n$ cd INTER-Mediator/\n# 現在、masterブランチが選択されている。自分のレポジトリにはmaster以外に# targeting-generalizationというブランチもあり、ローカル側にもそのブランチはある\n$ git branch -a\n* master\n  targeting-generalization\n  remotes/origin/HEAD -&gt; origin/master\n  remotes/origin/master\n  remotes/origin/targeting-generalization\n# リモートレポジトリの一覧を見る。自分のリモートレポジトリが見えている\n$ git remote -v\norigin https://github.com/msayukinii/INTER-Mediator.git (fetch)\norigin https://github.com/msayukinii/INTER-Mediator.git (push)\n# 新たに、マスターリポジトリをupstreamという名前でローカルリポジトリに登録する\n$ git remote add upstream https://github.com/INTER-Mediator/INTER-Mediator.git\n# originだけでなくupstreamも管理対象のリモートレポジトリとして登録された\n$ git remote -v\norigin https://github.com/msayukinii/INTER-Mediator.git (fetch)\norigin https://github.com/msayukinii/INTER-Mediator.git (push)\nupstream https://github.com/INTER-Mediator/INTER-Mediator.git (fetch)\nupstream https://github.com/INTER-Mediator/INTER-Mediator.git (push)\n# upstreamで指定されるレポジトリの内容を取り込む\n$ git fetch upstream\nremote: Counting objects: 13, done.\nremote: Compressing objects: 100% (10/10), done.\nremote: Total 13 (delta 4), reused 7 (delta 3)\nUnpacking objects: 100% (13/13), done.\nFrom https://github.com/INTER-Mediator/INTER-Mediator\n* [new branch] master -&gt; upstream/master\n* [new branch] targeting-generalization -&gt; upstream/targeting-generalization\n# remotes/upstreamの2つのブランチが新たに加わった\n$ git branch -a\n* master\n  targeting-generalization\n  remotes/origin/HEAD -&gt; origin/master\n  remotes/origin/master\n  remotes/origin/targeting-generalization\n  remotes/upstream/master\n  remotes/upstream/targeting-generalization\n# upstream/masterを現在のローカルのmasterにマージする。これで、ローカルのmasterは、マスターレポジトリのmasterと同一の内容になった\n$ git merge upstream/master\nUpdating 10e5c96..720ff24\nFast-forward\nDB_Null.php | 177 +++++++++++++++\nINTER-Mediator-Element.js | 27 ---------------\nREADME.md | 2 +-\nSamples/templates/definition_file_full.php | 1 +\n4 files changed, 179 insertions(+), 28 deletions(-)\ncreate mode 100644 DB_Null.php\n# 自分のリモートレポジトリのmasterに、ローカルの内容をpushすることで、リモート側にも反映される。ただし、この作業は必須ではない\n$ git push origin master\n# さらにマスターレポジトリ側の別のブランチを取り込みたいのなら、まず、ローカル側を受け入れるブランチに切り替える\n$ git checkout targeting-generalization\nSwitched to branch 'targeting-generalization'\nYour branch is ahead of 'origin/targeting-generalization' by 2 commits.\n  (use \"git push\" to publish your local commits)\n# すでにマスターレポジトリのブランチは取り込んであるので、マージすれば、このブランチもマスターレポジトリの内容と同じになる\n$ git merge upstream/targeting-generalization\nAlready up-to-date!\nMerge made by the 'recursive' strategy.\n                \n                上位の一連のコマンドの流れを図示すると次のようになります。一度、upstreamで参照を作っておけば、以後は、fetchしてmergeすることで、マスターレポジトリの内容をローカルのmasterに取り込むことができます。\n                \n                \n                最初に前提として「masterが正」であるということを記述しましたが、場合によっては、機能が完成する前にレビューや共同作業目的で、ブランチのPull Requestが発生するかど思われます。そういうブランチはマスターレポジトリに残したままになり、fetchによってupstreamにも取り込まれます。こちらは必要に応じてマージすればいいと思われます。また、共同で新たな機能を作る場合、各自がForkしたレポジトリで作業するのは、更新結果の配布に時間がかかることも予想されます。その場合、共同開発している中の1人のForkしたレポジトリに他の開発者も書き込み権限を与えて登録して、単一のレポジトリで各自がcommit/pushするという開発モデルの方が効率がいいと思われます。\n            \n        "
    },
    {
        "id": 36,
        "parent": "/ja/for-developers/",
        "path": "/ja/for-developers/lookup.html",
        "title": "値をコピーするルックアップ",
        "breadcrumb": "値をコピーするルックアップ",
        "body": "\n            \n                ルックアップについて\n                ルックアップとは、特定のフィールドにリレーションシップで得られた値を自動的に埋め込む仕組みです。FileMakerでも機能の1つとして利用できるものです。データベースの世界では、リレーショナルデータベースの考え方が優位であり、マスターテーブルとリンクして値を参照することが中心的です。しかしながら、アプリケーションを作る上では、マスター参照のように常にマスターに定義した値が得られるということがニーズであるだけでなく、その時点のマスターの値を複製しておくというニーズもあります。帳票作成では現実な方法として値を複製しておくことはよく行われます。リレーショナルデータベース的にはそれによって正規化が崩れるという主張もあるかもしれませんが、理論的な綺麗さよりも、ニーズをよりシンプルに満たす方法として、複製はよく利用されています。\n            \n            \n                ルックアップの設定\n                ルックアップの動作と設定をまとめた図を以下に示します。ここでは会計アプリケーションにおいて、仕分けパターンを選択すると、それに応じて借方科目と貸方科目がルックアップとして記録されるという状況を考えます。パターンと2つの科目の合計3つの項目に関して、同一のテーブルにフィールドが用意されています。いずれもマスターを持つもので、主キー値をINTEGERで保存しています。このアプリケーションはこちらのレポジトリで公開されているので、実際に手元でご利用いただけます。\n                \n                    \n                \n                「貸方科目」の設定を見てください。まず、data-imは「account_detail」コンテキストの「credit_id」フィールドが設定されています。このポップアップメニューの値はcredit_idフィールドとバインドされていて、フィールドの値とポップアップの選択結果が連動します。もちろん、optionには科目マスターの項目が並んでいます。ここまでは、普通のINTER-Mediatorの開発手法と変わりません。\n                これに加えて、data-im-control属性をポップアップメニューに設定しています。この属性値として、「lookup:A:B」の形式で設定を行います。これにより「Aの値が変更されれれば、Bの設定に応じて値を取り出し、data-im属性に従って値を記録する」ということを行います。\n                ここでAは「account_detail@assort_pattern_id」となっています。このターゲット指定は、「仕分けパターン」のポップアップメニューのdata-im属性と同一です。つまり、まず、「仕分けパターンのポップアップが変更されれば、」という定義が加わっていることになります。\n                Bについては、取り出し先を指定しますが、一般にはマスター参照などを行うコンテキスト定義（ここでは「assort_pattern_lookup」）をあらかじめ定義しておきます。ポップアップメニューにより、assort_pattern_idに値が設定されて、その値を利用して、assort_pattern_lookupに検索をかけます。検索条件は、assort_pattern_idの値と、assort_pattern_lookupコンテキストのrelationキーに指定したフィールド名を利用して自動的に作成されます。なお、特に理由がないのであれば、ルックアップで利用するコンテキストはqueryキーなどの検索条件はかからないようにしておくのが良いでしょう。また、recordsは自動的に1に設定されるので、コンテキストで指定する必要はありません。そして、コンテキストから検索されると、Bの@以降に記載したフィールドの値が取り出されて、ポップアップメニューのdata-im属性に指定したフィールドに保存します。要素の値が設定されるだけでなく、データベースへの更新も行われます。\n                なお、ルックアップの機能はポップアップにだけ機能するのではなく、テキストフィールドなどのUI要素で稼働します。\n            \n        "
    },
    {
        "id": 37,
        "parent": "/ja/practices/",
        "path": "/ja/practices/practice-tips.html",
        "title": "ティップス集",
        "breadcrumb": "ティップス集",
        "body": "\n            \n                スタイルの値にフィールドの値を設定する\n                HTML要素にフィールドの値を表示させるには、data-im属性を使うのはよくご存知だと思います。通常は属性の値に「コンテキスト名@フィールド名」と書きますが、これによりinput属性などではvalue属性に、value属性のない要素には、小要素の1つとしてフィールドの値のテキスト値をセットします。加えて、フィールドの値をスタイルに設定できます。例えば、次のように記載すると、要素のstyle属性のdisplayの値として、フィールドmyStyleの値が設定されます。「style.」に続いて、JavaScriptでのstyle属性で利用できるキーを指定します。つまり、背景色なら、@style.backgroundColorと指定します。\n                &lt;span data-im=\"myContext@myStyle@style.display\"&gt;&lt;/span&gt;\n                この場合、フィールドmyStyleに「none」や「inline-block」などの値が入っていないといけませんが、もともとコンテキストから得られるリレーションで、display属性スタイルに合致しない値が入っているのなら、コンテキスト定義の中でcalculationキーを使って計算式を設定しましょう。ここで、is_showフィールドが1の場合は表示、そうでない場合は非表示にしたい場合、上記のように要素のdata-im属性を指定するとともに、定義ファイルに以下のような記述を追加します。こうすればデータベース側でmyStyleフィールドが存在していなくても、ダウンロードした結果に計算結果のmyStyleフィールド（計算プロパティ）が追加されて、is_showフィールドの値に応じてdisplayスタイルが設定されることになります。\n                IM_Entry(\n    [\n        [\n            'name' =&gt; 'myContext',\n            'view' =&gt; 'person_list',\n            'table' =&gt; 'person',\n            'key' =&gt; 'person_id',\n           'calculation' =&gt; [\n                ['field' =&gt; 'myStyle', 'expression' =&gt; \"if(is_show, 'in-lineblock', 'none')\"],\n            ], ....\n        ], ...\n            \n            \n                一覧ページから詳細ページに移動するボタンを設置する\n                一覧ページと選択したレコードの詳細ページを移動するナビゲーションはよく作られます。INTER-Mediatorでは、簡単にそうしたUIを作成する方法として、navi-controlキーにmasterやdetailなどの値を設定したコンテキストを定義ファイルで定義することで簡単に実現します。詳細は、プラクティスの一覧と詳細に記載しています。\n                しかしながら、さまざまな理由で、一覧と詳細を別々のHTMLファイルで用意する場合があります。例えば、ファイル送信コンポーネントを使うような場合だと、ファイルの送信後にページ更新が必要になり、詳細ページから一覧ページに勝手に移行してしまうので、別々のHTMLにするのが1つの解決策です。また、単純な一覧と詳細ではないような場合、別々に作る方が作りやすいかもしれません。その場合、一覧のページに、詳細のページに移動するボタンをつけたいでしょう。典型的には次のようなコードになるでしょう。\n                &lt;button onclick=\"detailpage.html?id=\"\n    data-im=\"myList@person_id@#onclick\"&gt;\n&lt;/button&gt;\n                ここではmyListコンテキストに、主キー値としてperson_idフィールドが存在しているとします。ここで、data-imのターゲット指定に「@#onclick」が存在します。これにより、person_idフィールドの値が、onclick属性の末尾に追加されます。person_idが35なら、onclick属性の値は「detailpage.html?id=35」となります。詳細のページでこのURL引数を取り出す方法は、次に説明します。\n            \n            \n                URLの検索パラメータの値を検索条件にする\n                前の項目で説明した一覧ページから詳細ページに移動するボタンを設置した場合など、URLに詳細に表示すべきレコードの主キー値が検索パラメータとしてに含まれています。検索パラメータを取り出して、それを検索条件として与えるには、INTERMediatorOnPage.doBeforeConstructメソッドにプログラムを記載します。\n                INTERMediatorOnPage.doBeforeConstruct = () =&gt; {\n  const params = INTERMediatorOnPage.getURLParametersAsArray()\n  const contextName = 'myDetail'\n  INTERMediator.clearCondition(contextName)\n  INTERMediator.addCondition(contextName, {field: 'person_id', value: parseInt(params['id']), operator: '='})\n    :\n                INTERMediatorOnPage.getURLParametersAsArray()によりURLに含まれる検索パラメータをオブジェクトとして取得できます。その後は、INTERMediator.clearConditionで一度コンテキストの検索条件を消してから、INTERMediator.addConditionでコンテキストの検索条件を追加します。doBeforeConstructメソッド内なので、この後に、データベースアクセスを行います。その時に、addConditionで追加した条件が付加されて、該当するレコードを取得できます。例えば、URLが「detailpage.html?id=35」なら、「id = 35」という検索条件がSELECT句に追加されます。なお、この場合、idパラメータが存在しない場合などの処理は必要に応じて組み込んでください。\n            \n            \n                ページ移動時に「保存されない」場合の対処\n                一覧と詳細ページを別々に作っている場合、詳細から一覧のページに移動する「戻る」ボタンを独自に設置しなければなりません。navi-controlを使えば自動的に用意しました。その場合、シンプルなリンクやlocation.href属性への代入等を行うことが簡単な方法ですが、詳細ページに編集可能テキストフィールドやテキストエリアがある場合には、それらの値が“場合によって”保存されないことがあります。これは、「戻る」ボタンをクリック時に編集中のテキストフィールドからフォーカスが外れて、テキストフィールドの更新のためのデータベースアクセスがスタートするからです。そのアクセスが終了しない間に一覧ページに移動すると、更新処理が失敗して更新がかからず、「保存されていない」と思ってしまいます。この場合、更新処理が終わってからページ移動をするようにします。例えば、戻るボタンのonclickに以下のようなmovePage関数の呼び出しを設置します。URLは引数にしましたが、固定文字列でもいいでしょう。IMLibQueue.setTaskにキューに入れる処理を記述しますが、その中ではキューを進めるために、引数で渡されたクロージャを呼びだすcomplete()を書きます。そして、setTaskの2、3番目の引数を、false、trueと記述します。これがあれば、優先度の低いキューとなり、更新処理が終わるのを確実に待って、この場合はlocation.hrefへの代入が行われます。\n                function movePage(url) {\n  IMLibQueue.setTask((complete) =&gt; {\n    complete()\n    location.href = url\n  }, false, true)\n}\n            Ver.11より、APIを増やしました。上記と同じことが、以下の１行で実行可能です。\n            INTERMediator.moveAnotherURL(url)\n            \n            \n                「クリックを受け付けない場合がある」と感じた時の対処\n                サーバの応答にもよるのですが、テキストフィールドを編集中にボタンをクリックした時、ボタンのクリックが受け付けないという思う場合が出てきます。その時は、CSSセレクタ#_im_progress（つまり、idが_im_progress）の要素に対して、pointer-event属性をnoneにしてください。この時、クリック時の処理は、優先度の低いキューに入れる方が良い場合があります。このページに記載の『ページ移動時に「保存されない」場合の対処』を参照してください。\n                #_im_progress {\n    pointer-events: none;\n}\n                この_im_progressは、何かの処理を背後で行なっているときに出てくるギアのマークの背景オブジェクトです。既定の状態では、pointer-eventsは既定値（auto）であり、ギアが出ている間にページ内をクリックしても、_im_progressがイベントを拾うので何も起こりません。この属性をnoneにすることで、ギアが出ている間でも背後に見えているボタンなどをクリックできるようになります。テキストフィールドの編集時にボタンを押すと、一瞬ギアが出るので、その間にボタンのクリックが受け付けない時間帯が発生します。これはタイミングと処理のスピードの問題で、一定した動作ではないかもしれません。\n                開発者としてはこの属性はnoneにしたいですし、以前はそうしていました。しかしながら、いくつかの案件で、「連打したらおかしくなる」と言われこの属性を規定値にしました。連打により、ページ構築途中の状態をクリックできてしまうようで、チェックボックスなどは確かに連打には弱いようです。しかしながら、連打を防ぐと、このタイトルのようにクリックを受け付けない瞬間が出てくるためいずれにしても使い勝手は良くありません。この調整は実際の案件に合わせるしかないという結論で、クリックを受け付けないということをINTER-Mediatorの既定値としています。\n            \n            \n                条件に応じてページ生成を行わないようにする\n                URLの検索パラメータに想定した項目がない場合にページを表示したくないかもしれません。その場合、INTERMediatorOnPage.doBeforeConstructメソッドに次のように記載します。この例では、idとpパラメータの両方がない場合、その後のページ構築をキャンセルするようにしました。ページ構築を行うかどうかは、INTERMediatorOnPage.isAutoConstructプロパティの値に応じます。つまり、通常はこのプロパティがtrueなのでページ構築をしますが、以下の場合はidとpパラメータのいずれかが存在しない場合ページ生成を行わなず、この後のデータベース接続などは行いません。\n               INTERMediatorOnPage.doBeforeConstruct = () =&gt; {\n  const params = INTERMediatorOnPage.getURLParametersAsArray()\n  if (!params['id'] || !params['p']) {\n    INTERMediatorOnPage.isAutoConstruct = false\n    return\n  }\n        :\n            \n             \n                Bootstrapのクラス名を自動生成されるボタンに適用する\n                INTER-MediatorのサイトをBootstrapを使ってデザインすることは可能です。実際に使って作っているサンプルもあります。ヘッダや各種要素に通常通りBootstrapのclassなどを適用すればOKです。しかしながら、削除や新規作成ボタンなどは自動的に作られるので、class属性が書けないと思ってしまいます。そのままだと、なんだか古いデザインのボタンになってしまい、ちょっとガッカリな感じです。そこで、JavaScriptを利用することでプロパティに追加するclassタグを記述できるようになっています。以下はその指定例です。buttonClassDeleteプロパティへの代入により、削除ボタンのclassに「btn btn-warning」が加わりますので、標準状態では黄色いボタンになります。以下のように、複製、削除、挿入、詳細、一覧に戻るのボタンのclassを追加するための変数があります。\n                \n                    INTERMediatorOnPage.doBeforeConstruct = function () {\n  INTERMediatorOnPage.buttonClassCopy = \"btn btn-info\"\n  INTERMediatorOnPage.buttonClassDelete = \"btn btn-warning\"\n  INTERMediatorOnPage.buttonClassInsert = \"btn btn-success\"\n  INTERMediatorOnPage.buttonClassMaster = \"btn btn-primary\"\n  INTERMediatorOnPage.buttonClassBackNavi = \"btn btn-primary\"\n};\n                \n            \n            \n                デバッグ情報をページ上に出さない\n                開発中はデバッグ情報を詳細にチェックしながら記述を調整することはよく行います。ページ上にデバッグ情報を出していますが、同時にブラウザの開発者向けツールでも表示できます。ページ上のデバッグ情報を消去するボタンはあるのですが、毎回押すのが面倒になってきます。その場合、以下のプロパティをtrueにすることで、デバッグ情報は開発者向けツールでは表示するものの、ページ上には表示しなくなります。\n                 \n                    INTERMediatorOnPage.doBeforeConstruct = function () {\n    INTERMediatorLog.suppressDebugMessageOnPage = true;\n};\n                \n           \n            \n                検索機能をANDにする\n                テキストフィールドなどにdata-im=\"_@condition:contextname:fieldslist:*match*\"のようにローカルコンテキストの指定を入れることで、指定したコンテキストに自動的に検索条件を挿入してデータベース処理をするので、検索機能を簡単に実装できます。ただし、その場合、いくつかのテキストフィールドを用意するとOR検索になります。これをAND検索にするには、以下のようなプロパティへの設定で可能にできます。\n                \n                    INTERMediatorOnPage.doBeforeConstruct = function () {\n        INTERMediator.lcConditionsOP1AND = false;\n        INTERMediator.lcConditionsOP2AND = true;\n};\n                \n            \n            \n                検索機能で値を区切って条件指定する\n                テキストフィールドなどにdata-im=\"_@condition:contextname:fieldslist:*match*\"のようにローカルコンテキストの指定を入れることで、指定したコンテキストに自動的に検索条件を挿入してデータベース処理をするので、検索機能を簡単に実装できます。この時、検索条件の値はテキストフィールド等に入力された通りになりますが、INTERMediator.lcConditionsOP3ANDにtrueを代入すると、テキストフィールドの値を半角あるいは全角のスペースで区切って複数の検索条件として与えることができます。このままだと区切った値のそれぞれの検索をORしますが、INTERMediator.lcConditionsOP3ANDに'AND'を代入するとそれぞれの検索をANDします。\n                \n                    INTERMediatorOnPage.doBeforeConstruct = function () {\n        INTERMediator.lcConditionsOP1AND = false;\n        INTERMediator.lcConditionsOP2AND = true;\n        INTERMediator.lcConditionsOP3AND = true;\n};\n                \n            \n            \n                マスター/ディテールページで新規レコード作成時に詳細ページに移動する\n                コンテキスト定義でnavi-controlキーで、masterやdetailなどを使って一覧と詳細ページを組んでいる場合、通常は一覧側に新規レコードを作成するボタンを表示させます。その場合、詳細ページに移動して入力等を行うため、一覧の中で新しいレコードを探さないといけないかもしれません。以下のようなプログラムをJavaScript記述可能な場所に書いておけば、新規レコード作成後に、新規作成したレコードの詳細ページに移動します。ここで、ifの条件にある「account_list」は、実際にレコードが作成されるコンテキストのnameキーの値を指定しておきます。また、moveDetailメソッドの引数は、「詳細ページのコンテキストのkey=newId変数の値」という検索条件のような文字列を指定します。これにより該当するレコードを詳細ページで表示します。\n                \n                    INTERMediatorOnPage.doAfterCreateRecord = (newId, contextName) =&gt; {\n  if (contextName == 'account_list') {\n    IMLibPageNavigation.moveDetail('account_id=' + newId)\n  }\n}\n                \n            \n            \n                一覧と詳細が別々のページである場合に新規レコード作成時に詳細ページに移動する\n                一覧と詳細ページを別々のページで組んでいる場合、通常は一覧側に新規レコードを作成するボタンを表示させます。詳細ページは、URLのパラメータにid=123のような記述を行なって特定のレコードを検索するようにします。新しいレコードを一覧ページで作った直後、詳細ページに移動して入力等を行うため、一覧の中で新しいレコードを探さないといけないかもしれません。以下のようなプログラムをJavaScript記述可能な場所に書いておけば、新規レコード作成後に、新規作成したレコードの詳細ページに移動します。ここで、ifの条件にある「account_list」は、実際にレコードが作成されるコンテキストのnameキーの値を指定しておきます。また、location.hrefに代入する文字列は、詳細ページの仕様に合わせたURLを指定します。\n                \n                    INTERMediatorOnPage.doAfterCreateRecord = (newId, contextName) =&gt; {\n  if (contextName == 'account_list') {\n    location.href = `index_detail.html?id=${newId}`\n  }\n}\n                \n            \n            \n                disabled属性を条件に応じて設定する\n                HTMLの属性にフィールドの値を設定する場合、data-im属性に指定するターゲット指定に「コンテキスト名@フィールド名@属性名」と記述することで可能です。しかしながら、disabled属性は、そこに設定する値でのグレーにするコントロールはできず、この属性が存在するかどうかで動作が決まり、他の属性と動作が異なります。こうした違いを本来はフレームワークで吸収したいところではありますが、Ver.9現在それは実現していません。ここで、フィールド、is_activeの値に応じて（\"\"やnull、0の場合はグレーにする）ボタンをグレーにするということを実現するための方法を示します。まず、コンテキストに、post-repeater属性を記述します。\n                IM_Entry(\n    [\n        [\n            'name' =&gt; 'myList',\n            'view' =&gt; 'person_list',\n            'table' =&gt; 'person',\n            'key' =&gt; 'person_id',\n            'post-repeater' =&gt; 'disablingButton', ....\n        ], ...\n                ページファイルでは、まず、調べたい値があるis_activeをページ上に展開するために、spanタグでこのフィールドの値を表示します。もし、その値がページ上に見えているのが好ましくない場合は、displayスタイル属性をnoneにしておきます。また、is_showの値に応じてグレーにしたい要素は、disablingというクラスにしておきます。\n                &lt;button class=\"disabling\" onclick=\"detailpage.html?id=\"\n    data-im=\"myList@person_id@#onclick\"&gt;\n&lt;/button&gt;\n&lt;span data-im=\"myList@is_active\" style=\"display:none\"&gt;&lt;/span&gt;\n                そして、以下のようなプログラムをJavaScriptで組み込みます。メソッド名は、コンテキスト定義のpost-repeater属性の値を指定します。リピーターの合成が終わったときに、引数repeatersにリピータの配列をセットしてこのメソッドが呼び出されます。INTERMediatorOnPage.getNodeIdsHavingTargetFromNodeは引数のリピータから、is_activeフィールドを展開した要素のid属性値の配列を取り出します。リピータ内部から取るので、言わば「特定の1つのレコード」について、is_activeを展開した要素が特定できます。ここでは要素は1つと仮定します。その値に応じて、値が0なら、そのリピータ内のクラス属性がdisablingの要素を取り出して、disabled属性をtrueにしてグレーにしています。\n                INTERMediatorOnPage.adjustOptions = (repeaters) =&gt; {\n  const ids = INTERMediatorOnPage.getNodeIdsHavingTargetFromNode(repeaters, 'myList@is_active')\n  if (ids.length &gt; 0 &amp;&amp; parseInt(document.getElementById(ids[0]).innerHTML) == 0) {\n    for (const repeater of repeaters) {\n      const nodes = repeater.getElementsByClassName('disabling')\n      for (const node of nodes) {\n        node.disabled = true\n      }\n    }\n  }\n}\n                \n                \n                \n                \n            \n            \n                \n                \n            \n        "
    },
    {
        "id": 38,
        "parent": "/ja/for-novices/",
        "path": "/ja/for-novices/trial.html",
        "title": "トライアル版の利用方法",
        "breadcrumb": "トライアル版の利用方法",
        "body": "\n            \n                はじめに\n                INTER-Mediatorの試用や学習用に、簡単な操作でサーバとして実行できるWebアプリケーションについての情報をこの文書に記載します。Dockerを利用するか、phpのサーバモード等で直接実行することを想定したWebアプリケーションです。後者の方法は「ダイレクトホスティング」と呼ぶことにします。いずれかの方法で稼働することができます。\n                Webアプリケーションでは、INTER-Mediatorのサンプルプログラムを稼働することができると同時に、稼働に必要なファイルをWebブラウザ上で編集して実行できるようになっており、自分でHTMLや設定を作って実行することもできます。INTER-Mediatorのハンズオンや学習用教材での利用を見込んでいます。\n                従来は試用や学習用にVMを用意していましたが、Ver.9以降はフリーかつプラットフォームに依存しないVM環境が整わないため、VMよりDockerベースに移行しました。Webアプリケーション自体は、INTER-Mediator Ver.10以降で利用できますが、基本的にはインストール作業をしたときの最新版が稼働するようになっています。\n            \n            \n                Dockerでインストールして稼働する\n                まず、お使いのプラットフォーム上でDocker Desktopを起動しておく必要があります。Docker Desktopのインストール方法はこちらを参考にしてください。Docker Desktopが稼働可能な状態になったら以下のコマンドを実行します。\n                git clone https://github.com/inter-mediator/IMApp_Trial\ncd IMApp_Trial\ndocker-compose up -d\n                コンテナのビルドに10分以上かかるかもしれません。しかし、これだけでINTER-Mediatorの開発環境が実行可能になりました。データベースを含むサーバ一式及びINTER-Mediatorのインストール等は全て自動的に行われています。\n                Creating network \"imapp_trial_default\" with the default driver\nCreating imapp_trial_db_1 ... done\nCreating php-apache_im    ... done\n                上のようなメッセージが確認できたら、Webブラウザで http://localhost:9080/ を開いてください。INTER-Mediatorのデモアプリのトップページが表示されます。トップページに解説がありますので、そちらを参照すれば使用方法等が示されています。\n                編集可能なページや定義ファイルはDockerコンテナの外側のファイルに格納されているので、永続的に表示されます。 MySQLはDockerコンテナとして起動し、スキーマも割り当て済みですが、DBは永続的ではないので、コンテナ起動後に追加したデータはIMコンテナを停止すると消えます。\n            \n            \n                ダイレクトホスティングによるインストール\n                OSにセットアップしたWebサーバやデータベースを利用して稼働する方法を「ダイレクトホスティング」と総称します。サーバやデータベースのソフトウエアにはさまざまなものがありますが、ApacheとMySQLを使用する想定でここでは手順を紹介しましょう。\n                準備\n                PHP、git、composer、MySQL、Node.jsをインストールして稼働できるようにしてください。\n                データベースにはINTER-Mediatorのサンプルデータベース（データベース名'test_db'）を以下のMySQL用スキーマで用意します。すでにINTER-Mediatorを使用している場合は、このサンプルDBを既にセットアップしていると思われるので、それをそのまま使用しても構いません。\n                https://raw.githubusercontent.com/INTER-Mediator/INTER-Mediator/master/dist-docs/sample_schema_mysql.txt\n                MySQLを用意し、rootパスワードを知っている場合、IMApp_Trialリポジトリをクローンした後、以下のようにtest_dbを設定することができます。\n                cd IMApp_Trial # カレントディレクトリがこのリポジトリのルートであると仮定します。\nmysql -u root -p &lt; vendor/inter-mediator/inter-mediator/dist-docs/sample_schema_mysql.txt\n# Homebrew ユーザは root のパスワードを設定しないかもしれないので、 -p パラメータを削除してください。\n# Windows ユーザは、ディレクトリの区切り文字を / から \\ または ¥ に変更する必要があります。\n                セットアップ\n                このWebアプリは、composerをベースにしています。IMApp_Trialリポジトリをクローンして、リポジトリのルートで以下のようにcomposerコマンドを実行します。\n                git clone https://github.com/inter-mediator/IMApp_Trial\ncd IMApp_Trial\ncomposer update\n                Windowsの場合の追加セットアップ\n                Windows Subsystem for Linux (WSL) があれば、macOS/Linux と同じように設定できます。 Windows PowerShellなどを使っていない場合、composer updateコマンドの最後でエラーになります。 IMApp_Trialのカレントディレクトリで、以下のコマンドを手動で実行する必要があります。 この2つのコマンドは、shを使ったシェルスクリプトですので、bashアプリケーションが自動的に立ち上がります。\n                cd .¥vendor¥inter-mediator¥inter-mediator\nnpm install\ncd .¥dist-docs\n./generateminifyjshere.sh\ncd ..¥..¥..¥..¥lib\n./trialsetup.sh\ncd ..\n                アプリケーションのスタートアップ\n                Webアプリを手っ取り早くホストするには、phpコマンドのサーバーモードが便利です。IMApp_Trialディレクトリがカレントディレクトにして、以下のコマンドを実行します。\n                php -S localhost:9000\n                これで、同じホストで実行されているブラウザから、 http://localhost:9000/ という url でアプリケーションにアクセスできるようになります。トップページに解説がありますので、そちらを参照すれば使用方法等が示されています。\n            \n        "
    },
    {
        "id": 39,
        "parent": "/ja/for-developers/",
        "path": "/ja/for-developers/sendmail10.html",
        "title": "メール送信(Ver.10)",
        "breadcrumb": "メール送信(Ver.10)",
        "body": "\n            \n                はじめに\nINTER-Mediatorのメールを送る機能は、Ver.5までの仕組みと、Ver.6以降の仕組みが大きく異なっています。ここでは前者を「旧アーキテクチャ」、後者を「新アーキテクチャ」と呼びます。Ver.6を実装では、旧アーキテクチャの実装は残して新アーキテクチャも組み込み、相互に切り替えて運用できるようにしました。また、過去のアプリケーションとの互換性を考慮して、既定値では旧アーキテクチャでの稼働を規定値にしました。Ver.10では、既定値を新アーキテクチャとしましたが、旧アーキテクチャに切り替えることは可能です。しかしながら、今後は新アーキテクチャが使われることがメインになると想定して、新アーキテクチャのみをこの文書では紹介します。旧アーキテクチャでのメール機能の利用についてはメール送信(Ver.5)あるいはメール送信(Ver.6)をご覧ください。\n                メールはPHPのmail関数を使う方法と、メールサーバを利用する方法を使用できます。mail関数を使う場合UNIX系サーバならsendmailコマンドをたたく方法になります。SMTPサーバーを利用してメールを送信する場合、Ver.10まではswiftmailerを利用します。Ver.11で、symfony/mailerに切り替えています。\n            \n            \n                定義ファイルへの指定\n                \n                    [第1引数, コンテキスト定義]\n                    メール送信\n                \n               \n                    \n                    \n                        配列指定\n                        値\n                    \n                    \n                        キー\n                        インデックス\n                        下位のキー\n                    \n                    \n                    \n                    \n                        'send-mail'あるいは'messaging'\n                        'driver'\n                        \n                        メールを送信する場合は、値は'mail'、あるいはこのエントリーごと省略する（send-mailキーの場合は記述してはいけない）\n                    \n                    \n                        'read'\n                        \n                        コンテキストに対してレコードの取り出しを行った後にメールを送信する。\n                    \n                    \n                        'from'\n                        送信者名や送信者アドレスが含まれるフィールド名、あるいはアドレスの文字列。文字列内に「@@フィールド名@@」の記述があれば、フィールドのレコードに置き換わる\n                    \n                    \n                        'to'\n                        送信先が含まれるフィールド名、あるいはアドレスの文字列。文字列内に「@@フィールド名@@」の記述があれば、フィールドのレコードに置き換わる。複数の送信先はカンマで区切る\n                    \n                    \n                        'cc'\n                        Cc先が含まれるフィールド名、あるいはアドレスの文字列。文字列内に「@@フィールド名@@」の記述があれば、フィールドのレコードに置き換わる。複数の送信先はカンマで区切る\n                    \n                    \n                        'bcc'\n                        Bcc先が含まれるフィールド名、あるいはアドレスの文字列。文字列内に「@@フィールド名@@」の記述があれば、フィールドのレコードに置き換わる。複数の送信先はカンマで区切る\n                    \n                    \n                        'subject'\n                        件名が含まれるフィールド名、あるいは件名の文字列。文字列内に「@@フィールド名@@」の記述があれば、フィールドのレコードに置き換わる\n                    \n                    \n                        'body'\n                        メール本文が含まれるフィールド名、あるいは本文の文字列。文字列内に「@@フィールド名@@」の記述があれば、フィールドのレコードに置き換わる\n                    \n                    \n                        'template-context'\n                        メールの文面を得られるコンテキスト名と検索条件。テーブルに文面のテンプレートをセットしているものとする\n                    \n                    \n                        'store'\n                        送信したメールをここで指定したコンテキストに対して新規レコードを作成して保存する\n                    \n                    \n                        'attachment'\n                        添付するファイルへの相対パスの文字列、あるいはそれを含むフィールド名。文字列内に「@@フィールド名@@」の記述があれば、フィールドのレコードに置き換わる\n                    \n                    \n                        'f-option'\n                        UNIXでSMTPサーバを経由しない場合にtrueを指定すると、fromの指定が有効\n                    \n                    \n                        'body-wrap'\n                        右端の折り返しのバイト数\n                    \n                    \n                        'update'\n                        \n                        コンテキストに対してレコードの更新処理を行った後にメールを送信する。第3次元については、readと同様\n                    \n                    \n                        'create'\n                        \n                        コンテキストに対して新たなレコードを作るアクションを起こした後にメールを送信する。第3次元については、readと同様\n                    \n                    \n                \n                \n                    [第2引数, オプション設定]メール送信サーバー\n                \n                \n                    \n                    \n                        配列指定\n                        値\nparams.phpで変数名\n                    \n                    \n                        第1次元\n                        第2次元\n                    \n                    \n                    \n                    \n                        'smtp'\n                        'server'\n                        メール送信時に使用するサーバのホスト\n                        $sendMailSMTP\n                    \n                    \n                        'port'\n                        メール送信時に使用するサーバのポート\n                    \n                    \n                        'protocol'\n                        メール送信時に使用するプロトコルで、省略すると'smtp'を選択する。こちらのDSNのProtocolの指定となる（Ver.11で追加）\n                    \n                    \n                        'username'\n                        メール送信時に認証で使用するユーザー名\n                    \n                    \n                        'password'\n                        メール送信時に認証で使用するパスワード\n                    \n                    \n                        'encryption'\n                        通信処理の暗号化をする場合にその方法を指定する。'ssl'、あるいは'tls'を指定する（Ver.11以降は無視される）\n                    \n                    \n                \n               定義ファイルでの指定例を以下に示します。\n                \nIM_Entry(\n    &nbsp; &nbsp; array( &nbsp; // Contexts\n    &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;array(\n    &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;'name' =&gt; 'request',\n    &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;'send-mail' =&gt; array(\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'create' =&gt; array(\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;     'from' =&gt; 'info@msyk.net',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'to' =&gt; '@@email@@',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'cc' =&gt; 'msyk@me.com',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'subject' =&gt; 'ビジネスマッチング申し込み',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'body' =&gt; '受け付けました。\\n本当です。',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'f-option' =&gt; true,\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'body-wrap' =&gt; 76,\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)\n    &nbsp; &nbsp; ),\n    &nbsp; &nbsp; array(   // Options\n    &nbsp; &nbsp; &nbsp; &nbsp; 'formatter' =&gt; array(...),\n    &nbsp; &nbsp; &nbsp; &nbsp; 'smtp' =&gt; array(\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'protocol' =&gt; 'smtp',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'server' =&gt; 'mysmtp.msyk.net',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'port' =&gt; 587,\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;   'username' =&gt; 'msyktest@msyk.net',\n    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;'password' =&gt; 'oshienai',\n    &nbsp; &nbsp; &nbsp; &nbsp; )\n    &nbsp; &nbsp; ),\n    &nbsp; &nbsp; array('db-class' =&gt; 'PDO'),\n    &nbsp; &nbsp; false\n    );\n                \n            \n            \n                メールを送信するタイミングの指定\n                'send-mail'キーの配列の次のレベルのキーとして、'read' 'update' 'create'のいずれかを指定できます。それぞれ、データベースからの読み込み時、更新時、新規レコード作成時を意味し、コンテキストに対するそれぞれのタイミングでメールを送信します。いずれも、データベース処理が終了してからメールの送信にかかります。上記の例では、新規レコード作成時に、メールが送信されます。\n            \n            \n                メールの内容\n                メールの送信者はfromキー、宛先はto、cc、bccキー、件名はsubjectキー、本文はbodyキーで指定した文字列になります。一定の文字列で良い場合は単に記述するだけです。一方、全ての値でフィールドの値に置き換えるテンプレート処理が可能です。readの場合のメールだと、その時にviewキーのテーブルやビュー等で読み出した1つのレコードのフィールドを「@@フィールド名@@」の部分に置き換えてメールを作成することができます。create、updateの場合は対象レコードをviewキーのフィールドもしくはビューから取り出します。\n基本的にはメールはUTF-8でエンコードして送られます。定義ファイルはUTF-8を利用するので、日本語の文字列は通常通り記述して、UTF-8で保存すればその文字がメールで利用されます。ヘッダについては、base64のインラインエンコードを、ASCIIコード以外の文字について行います。本文はそのままですが、ヘッダのContent-TypeのcharsetにUTF-8という文字を付けます。つまり、本文はbase64等でのエンコードは行いません。\n本文は一定の長さで改行を入れます。既定値では72バイトですが、'body-wrap'キーで異なる値にできます。0に設定すると改行しません。ここで、バイト数ですが、実際のバイト数ではなく、日本語は2バイト、英語は1バイトと数えた結果で示しています。実際のエンコードはUTF-8なので、嘘と言えば嘘のカウントになりますが、おそらくこうして指定をすることに慣れている人が多いので、ここでは実態とは関係ない数値ではありますけども実用的という意味で「2バイトルール」でカウントしたものとします。\nUNIXでSMTPサーバーを使わない場合、通常はメールソースのFrom:は無視されて、UNIXアカウントそのものをFrom:として設定してしまいます。ただし、サーバー側で許可されていれば「'f-option' =&gt; true」の指定を定義ファイル内に記述することで、sendmailコマンドの-fパラメータを指定して、送信者の指定が可能です。\n            \n            \n                SMTPサーバーの指定\n                定義ファイルのIM_Entry関数の第3引数のオプション領域に'smtp'キーで配列を指定します。その他のキーは、前記の例の通りで、キーを見れば意味は分かると思います。もし、SMTP認証をしない場合は、serverとportだけを指定します。認証する場合は、server, port, username, passwordを指定します。\n                SMTPサーバーの指定は、params.phpファイルでも指定が可能です。変数名として、$sendMailSMTPの定義し、値は'smtp'の右側の配列と同様に指定をします。params.phpファイルでの指定よりも、定義ファイルの指定が優先されます。どこにもSMTPサーバーの設定がない場合には、mail関数での送信になります。\n                Windowsの場合、mail関数はSMTP利用するので、php.iniにサーバー情報などを書くことで対処できます。従って、'smtp'の指定やparams.phpファイルでの指定は一般には不要ですが、もし設定すれば、mail関数ではなく、swiftmailによるメール送信ができます。\n            \n            \n                Gmailのアカウントでメール送信する場合（Ver.11以降）\n                Gmailへの送信は、symfony/mailerの機能を使って送信します。ライブラリの「symfony/google-mailer」は、INTER-Mediatorのcomposer.jsonファイルに記述済みなので、通常はすでにインストールされているはずです。設定としては、prtocol、username、passwordのみを指定してください。serverに相当する値は背後で自動的にdefaultになります。params.phpファイルに指定する場合の例を示します。なお、パスワードはログインのためのパスワードではなく、AppPasswordによって発行されたコードを指定します。\n$sendMailSMTP = array(\n    \"protocol\" =&gt; \"gmail+smtp\",\n    \"username\" =&gt; \"msyk.nii83@gmail.com\",\n    \"password\" =&gt; \"himitsunopassword\",\n);\n           \n            \n                AWSのSESでメール送信する場合（Ver.11以降）\n                AWSのSES（Simple Email Service）での送信にはSMTPも利用できますが、APIを使った送信も可能です。送信処理は、symfony/mailerの機能を使って送信します。ライブラリの「symfony/amazon-mailer」は、INTER-Mediatorのcomposer.jsonファイルに記述済みなので、通常はすでにインストールされているはずです。設定としては、prtocol、username、passwordのみを指定してください。serverに相当する値は背後で自動的にdefaultになります。params.phpファイルに指定する場合の例を示します。なお、アクセスキーとシークレットキーは、AWSのIAMで作成したユーザに対して発行されたものを指定します。このユーザには、アクセス許可としてAmazonSesSendingAccessを指定します。\n$sendMailSMTP = array(\n    \"protocol\" =&gt; \"ses+https\",\n    \"username\" =&gt; \"yourACCESSKEY\",\n    \"password\" =&gt; \"yourSECRETKEY\",\n);\nAWS SESの利用にはいくつかポイントがあります。まず、Verified AddressというところにFromに指定するメールアドレスを登録します。ここに登録しないとエラーとなります。登録時、そのメールアドレスに対して確認メールが送信され、そこに記載されたリンクをクリックしないといけないので、メールの受信がができるアドレスである必要があります。そして、サービスを利用した段階では、SES自体がサンドボックスモードになっていて、Fromだけでなく送信先もVerified Addressである必要があります。原則として、サンドボックスモードでメール送信のテストをするので、必要なアドレスを全部登録しておきます。そして、実際に運用する段階で、プロダクションモードに変更しますが、設定だけではできず、Amazon側に申請する必要があります。メール送信の頻度や内容などを比較的詳しくレポートしないと追加情報を求められるので、そのつもりで申請に臨みます。また、申請は人間による処理をしているようで、即座に反映はされませんので注意が必要です。\nsymfony/mailerは既定値では、Irelandのリージョンつまり、eu-west-1を利用します。Verified Addressはリージョンごとに設定されるので、この設定とメーラが利用するリージョンを合わせないといけません。もし、東京リージョンをメール送信で利用したいのであれば、'server'キーの値に「default?region=ap-northeast-1」を指定します。そうすれば、東京リージョンに設定したVerified Addressでメール送信が可能です。\n           \n            \n                symfony/mailerがサポートするプロトコル（Ver.11以降）\n                symfony/mailerのドキュメントにあるUsing a 3rd Party Transportはもちろんサポートしていますが、追加のプロトコルを利用するためにはライブラをインストールしなければなりません。INTER-Mediatorは既定値ではGmailとAWS SESだけをインストールしてあります。\n            \n            \n                ファイルを添付する\n                ファイルを1つだけ追加できます。添付するには、media-root-dirキーの指定が必要です。そして、media-root-dirキーと、attachmentキーから得られるパスを繋いだ絶対パスのファイルを添付します。attachmentキーに「@@フィールド名@@」を用いてフィールド名を指定した場合、そのフィールドは、ファイルのアップロードコンポーネントを利用してアップロードした場合に自動的に設定されるパス名であることを想定しています。\n            \n            \n                送信結果をデータベースに残す\n                storeキーには、同じ定義ファイル内に定義した、レコード作成可能なコンテキストを指定します。メール送信を行うと、そのコンテキストに、新たにレコードを作って送信した結果を残せます。エラーがあって送れない場合でも結果を残します。なお、指定したコンテキストには、以下のフィールドがあるものとします。フィールド名は固定でカスタマイズはできません。フィールド名から、何が入力されるかは判別可能だと思います。\n                to_field、bcc_field、cc_field、from_field、subject、body、errors\n                あるテーブルの関連テーブルに送信結果を残す場合、relationキーを指定します。すると、上位のコンテキストの主キー値を自分自身の外部キーフィールドに設定できるので、作られたメール送信レコードに元のテーブルとの関連を残すことができます。ただし、operatorが=のものだけです。また、送信結果を残すコンテキストにqueryキーがあり、operatorが=のものがある場合、その値も初期値として設定されます。\n            \n            \n                データベースに入れたテンプレートにある文面でメールを作成する\n                メールの文面や送り先などをデータベースに入れておき、それを元にメールを作成して送付するには、template-contextキーを指定します。例えば、「mail_template@id=3」のように記述します。mail_templateは、同じ定義ファイルにある読み込み可能なコンテキストで、このコンテキストから読み出したデータについては、以下のようなフィールドがあるものとします。フィールド名は固定でカスタマイズはできません。フィールド名から、何が入力されているかは判別可能だと思います。\n                 to_field、bcc_field、cc_field、from_field、subject、body\n                 @以降は、コンテキストの中の検索条件を指定しますが、この記述は条件そのものではなく、=の前後で分離して、WHERE id = 3 のような検索条件で検索をします。実際には最初の1つのレコードだけを利用します。そのレコードからそれぞれのフィールドを取り出しますが、値そのままの場合もありますが、テンプレートのデータにある「@@フィールド@@」を、実際にメールを送るときのデータに置き換えることも可能です。\n           \n            \n                HTMLメールの送信\n                メールの文面の最初の文字列が &lt;html&gt; である場合、HTMLメールとして送信します。添付ファイルも1つまでは一緒に送れますが、添付ファイルをHTMLに埋め込みたい場合、本文の文面内で##image## と記述すればOKです。ただし、画像ファイルであるという前提で文面を作成してください。\n            \n            \n                メッセージングとしてメール送信\n                send-mailキーはVer.6でも利用できますが、メッセージ送信機能を拡張するにあたり、send-mailキーの代わりにmessagingキーを指定することもできます。その場合は、配列にdriverキーで値がmailのエントリーを入れるか、drivierキーを省略することでも構いません。\n            \n        "
    }
]